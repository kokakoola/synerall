var T1=T1||{};T1.constants=function(){"use strict";return{ON_DOC_CLICK:"onDocumentClick",ON_KEY_PRESS:"onKeyPress",ON_WIN_RESIZE:"onWindowResize",ON_BREAKPOINT_CHANGE:"onBreakpointChange",GET_BREAKING_POINT:"returnBreakPoint",GLOBAL_SCROLL:"scroll",GLOBAL_SWIPE:"swipe",JS_VIDEOJS:"/external.scripts/video.min.js",CLASS_ACTIVE:"active",CLASS_CARCHAPTER:"car-chapter",CLASS_ERROR:"error",CLASS_ERROR_FORM:"error-form",URI_MINI_CARCONFIG_DATA:"/api/cardb/minicarconfig/",URL_MINI_CARCONFIG_IMG:"vehicle/[MODEL]/[GRADE]/exterior-32_[COLOUR].png",URL_GOOGLE_MAPS_API:"https://maps.googleapis.com/maps/api/js?client={CLIENT_ID}&sensor=false&v=3.14",URL_GOOGLE_MAPS_API_DEV:"https://maps.googleapis.com/maps/api/js?key={API_KEY}&sensor=false&v=3.14",URL_GOOGLE_STATIC_MAPS_API:"http://maps.google.com/maps/api/staticmap?client={CLIENT_ID}",URL_GOOGLE_STATIC_MAPS_API_DEV:"http://maps.google.com/maps/api/staticmap?key={API_KEY}",URL_SUBMIT_FORM_CONTACT:"/api/feedback/contact",URL_SUBMIT_FORM_CONTACT_DEALER:"/api/feedback/contact",URL_SUBMIT_FORM_BROCHURE:"/api/feedback/brochure",URL_SUBMIT_FORM_TESTDRIVE:"/api/feedback/testdrive",URL_SUBMIT_FORM_MY_TOYOTA_LOGIN:"/api/user/login",URL_SUBMIT_FORM_MY_TOYOTA_SEARCH_CAR:"/config",URL_SUBMIT_FORM_MY_TOYOTA_SAVE_CAR:"/api/user/save",URL_SUBMIT_FORM_MY_TOYOTA_SAVE_DEALER:"/api/user/save",URL_SUBMIT_FORM_MY_TOYOTA_REGISTER:"/api/user/create",URL_SUBMIT_FORM_MY_TOYOTA_PASSWORD:"/api/user/reset",URL_SUBMIT_FORM_MY_TOYOTA_RESET_PASSWORD:"/api/user/reset-password",URL_MY_TOYOTA_DELETE_CAR:"/api/user/save",URL_MY_TOYOTA_DELETE_DEALER:"/api/user/save",URL_MY_TOYOTA_CONFIG:"/config/toyota",URL_DEALERS:"/api/dealer",URL_DEALERS_ALL:"/api/dealers/all",URL_DEALERS_NEAR:"/api/dealer/nearest/",URL_DEALERS_DRIVE:"/api/dealer/drive/",URL_DEALERS_REGIONS:"/api/dealer/regions",URL_DEALERS_CITIES:"/api/dealer/cities",URL_DEALERS_LOCAL:"/api/dealers/local/",URL_DEALERS_REGIONAL:"/api/dealers/regional/",URL_CAR_CONFIG_OVERLAYER:"/publish/CARCONFIG_LOAD/",ANIMATION_SPEED_FADE:666,ANIMATION_SPEED_SCROLL:666,SCREEN_XTRASMALL:480,SCREEN_SMALL:768,SCREEN_MEDIUM:992,SCREEN_LARGE:1200,PAGEOVERLAYER_TOOLBARWIDTH:73,HASH_ADD:"onHashAdd",HASH_REMOVE:"onHashRemove",HASH_CHANGE:"onHashChange",HASH_REPLACE:"onHashReplace",HASH_REWRITE:"onHashRewrite",MODE_SWITCH_MOBILE:"onSwitchMobile",MODE_SWITCH_DESKTOP:"onSwitchDesktop",MODE_INIT_MOBILE:"onInitDesktop",MODE_INIT_DESKTOP:"onInitDesktop",MOBILE_OPEN:"onMobileOpen",LAZY_LOAD:"onLazyLoad",SKROLLR_REFRESH:"onSkrollrRefresh",STATS_CATEGORY_PAGE:"page",STATS_CATEGORY_MODEL:"model",STATS_CATEGORY_EVENT:"event",STATS_CATEGORY_COMPONENT:"component",STATS_ACTION_SCROLL:"scroll",STATS_ACTION_COLLAPSE:"collapse",STATS_ACTION_EXPAND:"expand",STATS_ACTION_CLICK:"click",STATS_TRACK_SECTIONSCROLL:"sectionScroll",STATS_TRACK:"onTrack",STATS_TRACK_CAROUSEL:"onTrackCarousel",FORM_VALIDATION_RULE_SELECT:"select",FORM_VALIDATION_RULE_LENGTH:"length",FORM_VALIDATION_RULE_NUMBER:"number",FORM_VALIDATION_RULE_EMAIL:"email",FORM_VALIDATION_RULE_PHONE:"phone",FORM_VALIDATION_RULE_PARITY:"parity",FORM_VALIDATION_RULE_REGEXP:"regexp",CTA_TYPES:{DOWNLOAD:"download",FINANCE:"finance",LOAD:"load",PRINT:"print",SAVE:"save",SEND:"send",TESTDRIVE:"testdrive",DEALERFINDER:"dealerfinder",CUSTOM:"custom"},CARCONFIG_STEPS:{MODEL:"models",BODY:"bodyType",ENGINE:"engine",TRANSMISSION:"transmission",WHEELDRIVE:"wheelDrives",GRADE:"grades",COLOUR:"colours"},FORM_CROSS_DOMAIN_POST:"onFormCrossDomainPost",FORM_CROSS_DOMAIN_PAGE_READY:"onPageReadyCrossDomainRequest",TOAST_CUSTOM:"customToastEvent",KEYCODE_LEFT:37,KEYCODE_UP:38,KEYCODE_RIGHT:39,KEYCODE_DOWN:40,KEYCODE_ESC:27,GALLERY_ITEM_CLICK:"onGalleryItemClick",GALLERY_MOBILE_BUILD:"onGalleryMobileBuild",GALLERY_SCROLL:"onGalleryScroll",MEDIAOVERLAYER_HIDE:"onMediaOverLayerHide",MEDIAOVERLAYER_VIDEO_CLICK:"onMediaOverlayerVideoClick",IFRAME_DESTROY:"onIframeSlid",OTHER_FEATURES_CLICK:"onOtherFeaturesClick",OTHER_FEATURES_SHOWALL:"otherFeaturesShowAll",VIDEO_CLICK:"onVideoClick",VIDEO_STOP:"onVideoStop",VIDEO_CREATEPLAYER:"onVideoCreatePlayer",VIDEO_CREATEDPLAYER:"onVideoCreatedPlayer",VIDEO_RESET:"onVideoReset",CAROUSEL_CREATE:"onCarouselCreate",CAROUSEL_CREATED:"onCarouselCreated",CAROUSEL_INITIALIZE:"onCarouselInitialize",CAROUSEL_EXPAND:"onCarouselExpand",CAROUSEL_SLIDE:"onCarouselSlide",CAROUSEL_CREATERESPONSIVE:"onCarouselCreateResponsive",CAROUSEL_RESONSIVECREATED:"onCarouselCreatedResponsive",PAGEOVERLAYER_OPEN:"pageOverlayerOpen",PAGEOVERLAYER_LOAD:"pageOverlayerLoaded",PAGEOVERLAYER_CLOSE:"pageOverlayerClose",PAGEOVERLAYER_CLOSED:"pageOverlayerClosed",PAGEOVERLAYER_REOPEN_MAINCONTENT:"pageOverlayerReopenMain",PAGEOVERLAYER_RESIZE_IMAGE:"pageOverlayerResizeImage",PAGEOVERLAYER_RESIZE:"pageOverlayerResize",PAGEOVERLAYER_DESTROY:"pageOverlayerDestory",PAGE_INITIALIZED:"pageInitialized",SEARCH:"onSearch",FULL_SEARCH:"onFullSearch",READMORE_SHOW:"onShowReadMore",READMORE_HIDE:"onHideReadMore",READMORE_HIDE_SELECTED:"onHideSelectedReadMore",CARSPIN_INIT:"onCarspinInit",EXPANDITEMSBUTTON_CLICK:"onExpandItemsButtonClicked",SCROLL_TRACK_ADD:"onScrollTrackAddElements",SCROLL_TRACK_APPEAR:"onScrollTrackAppear",FIGURE_LOAD:"figureLoaded",IFRAME_LOAD:"iframeLoaded",IFRAME_REQUEST:"iframeRequested",SPOTLIGHTS_CLICK:"spotlightClicked",NAVIGATION_PRIMARY_EXPAND:"navigationPrimaryExpand",NAVIGATION_PRIMARY_COLLAPSE:"navigationPrimaryCollapse",NAVIGATION_SET_SCROLLTO:"navigationSetScrollTo",NAVIGATION_ADD_BREADCRUMB_LINK:"navigationAddBreadcrumbLink",NAVIGATION_REMOVE_BREADCRUMB_LINK:"navigationRemoveBreadcrumbLink",REVIEW_BUTTON_CLICKED:"reviewsButtonClicked",ENGINE_COMPARE_CHANGE:"engineCompareEdit",ENGINE_COMPARE_PRINT:"engineComparePrint",MODEL_COMPARE_CHANGE:"modelCompareEdit",MODEL_COMPARE_PRINT:"modelComparePrint",MOBILE_COMPARE_CHANGE:"mobileCompareChange",MOBILE_COMPARE_MODELS_CHANGE:"mobileCompareModelsChange",COMPARE_ENGINES:"compareEngines",COMPARE_MODELS:"compareModels",COMPARE_PACKS:"comparePacks",REVIEW_AVARAGE_RATING:"reviewRatingArrived",REVIEW_LOADBAZAR:"loadBazarEvent",REVIEW_OPENREVIEWS:"openOverlayerWithReviews",REVIEW_SEE_REVIEWS:"loadFirstThreeReviews",REVIEW_FEEDBACK_CLICK:"clickedOnFeedbackButtons",REVIEW_GETREVFORM:"getReviewForm",CARCONFIG_LOAD:"ccLoad",CARCONFIG_END:"ccEnd",CARCONFIG_SAVE_CONFIG:"ccSaveConfig",CARCONFIG_LOAD_CONFIG:"ccLoadConfig",CARCONFIG_MINI_LOAD:"ccMiniLoad",CARCONFIG_MINI_END:"ccMiniEnd",CARCONFIG_MINI_INIT:"ccMiniInit",OVERLAY_READY:"overlayReady",FORM_LOAD:"formLoad",FORM_ERROR:"formError",FORM_VALIDATION_FAILED:"formValidationFailed",TABS_LOAD:"tabsLoad",TABS_SWITCH:"tabSwitch",DEALER_LOAD:"dealerLoad",DEALER_SAVE:"dealerSave",DEALER_SELECTED:"dealerSelected",DEALERS_FOUND:"dealersFound",BEFORE_FORM_SUBMIT:"beforeFormSubmit",SUBMIT_FORM_RETURN:"submitFormReturn",VALIDATE_FORM_RETURN:"validateFormReturn",EPRIVACY_AUTO_APPROVED:"ePrivacyAutoApproved",EPRIVACY_CANCELED:"ePrivacyCanceled",EPRIVACY_OPEN:"ePrivacyOpen",EPRIVACY_SAVED:"ePrivacySaved",EPRIVACY_LOAD_COMPONENT:"ePrivacyLoadComponent",EPRIVACY_COOKIE_NAME:$("head").data("eprivacy-cookie")||"TmeEPrivacy",MY_TOYOTA_MY_CARS:"MyToyotaMyCars",MY_TOYOTA_MY_DEALERS:"MyToyotaMyDealers",MY_TOYOTA_OWNERS_AREA:"MyToyotaOwnersArea",MY_TOYOTA_LOGIN:"MyToyotaLogin",MY_TOYOTA_LOGIN_SUCCESS:"MyToyotaLoginSuccess",MY_TOYOTA_LOGIN_FAIL:"MyToyotaLoginFail",MY_TOYOTA_CANCEL_LOGIN:"MyToyotaCancelLogin",MY_TOYOTA_REGISTER:"MyToyotaRegister",MY_TOYOTA_FORGOTTEN_PASSWORD:"MyToyotaForgottenPassword",MY_TOYOTA_RESET_PASSWORD:"MyToyotaSetPassword",MY_TOYOTA_HASH_PASSWORD:"MyToyotaHashPassword",MY_TOYOTA_SAVE_CAR:"MyToyotaSaveCar",MY_TOYOTA_SAVED_CAR:"MyToyotaSavedCar",MY_TOYOTA_STORED_CAR:"MyToyotaStoredCar",MY_TOYOTA_GET_CAR:"MyToyotaGetCar",MY_TOYOTA_SAVED_DEALER:"MyToyotaSavedDealer",MY_TOYOTA_SAVE_DEALER_FAILED:"MyToyotaSaveDealerFailed",MY_TOYOTA_DEALER_ALREADY_SAVED:"MyToyotaDealerAlreadySaved",MY_TOYOTA_TAB_SWITCH:"MyToyotaTabSwitch",MY_TOYOTA_SEARCH_FAILED:"MyToyotaSearchNoResult",MY_TOYOTA_SEARCH_FOUND:"MyToyotaSearchFound",MY_TOYOTA_CAR_ALREADY_SAVED:"MyToyotaCarAlreadySaved",MY_TOYOTA_DISPLAYED_SAVED_CARS:6,SOCIAL_SHARED:"socialSharedLink",ACCESSORIES_FILTER_CLICKED:"accessoriesFilterClicked",ACCESSORIES_INTERACTION_VIEWALL:"accessoriesOverlayInteraction",ACCESSORIES_TABBTN_CLICKED:"accessoriesTabsClicked",ACCESSORIES_SWITCHVIEW:"accessoriesSwitchView",FINANCE_RATES_ON:"enableFinanceRates",FINANCE_RATES_OFF:"disbaleFinanceRates",FINANCE_RATES_LOADED:"financeRatesLoaded",FINANCE_RATES_COOKIE_NAME:"financeRates",FINANCE_EXTERNAL_POST_REQUEST:"financeExternalPostRequest",INSURANCE_EXTERNAL_POST_REQUEST:"insuranceExternalPostRequest",FINANCE_CONFIG:"financeConfig",GOOGLE_MAP_LOAD:"googleMapLoad",SECTION_HOMEPAGE_CHILD_PAGES:"/api/content",SECTION_HOMEPAGE_CHILD_NUM_BIG_OPTIONS:4,SECTION_HOMEPAGE_CHILD_FILTERING_COUNT:4,SECTION_HOMEPAGE_CHILD_FILTERING_COUNT_NEW_FILTER:12,SECTION_HOMEPAGE_CHILD_FILTERING_PROMOS:"false",SECTION_HOMEPAGE_CHILD_FILTERING_REQ_TIMEOUT:5e3,SECTION_HOMEPAGE_CHILD_VISIBLE_SMALL_OPTIONS:4,SECTION_HOMEPAGE_CHILD_SHOW_MORE_OPTIONS:4,SECTION_HOMEPAGE_CHILD_SHOW_MORE_OPTIONS_SM:3,SECTION_HOMEPAGE_CHILD_SHOW_MORE_OPTIONS_XS:2,CALCULATE_VISIBLE_AREA_OF_THE_IMAGE:"getVisibleAreaOfImage",DEFAULT_EXTERIOR_VIEW:"exterior-32.png",MISSING_IMAGE:"ty-missing-image.jpg"}}(),function(a){"use strict";a.fn.inView=function(){var b=a(this),c=a(window),d={top:c.scrollTop(),left:c.scrollLeft()};d.bottom=d.top+c.height();var e=b.offset();return e.bottom=e.top+b.outerHeight(),d.bottom>e.top&&d.top<e.bottom?Math.round((d.bottom-e.top)/b.height()*100):0}}(jQuery),function(a){"use strict";a.fn.showT1Loader=function(){var b=a(this),c=b.find(".t1-loader"),d=null,e='<div class="t1-loader"><img src="/images/t1-loader.gif" /></div>';0===c.length&&(b.prepend(e),c=b.find(".t1-loader")),c.height(b.height()),c.show(),d=c.find("img"),d.css("margin-top",c.height()/2-d.height()/2+"px")},a.fn.hideT1Loader=function(){var b=a(this),c=b.find(".t1-loader");c.length>0&&c.hide()},a.fn.destroyT1Loader=function(){var b=a(this),c=b.find(".t1-loader");c.length>0&&c.remove()}}(jQuery),function(a){a.fn.touchToScroll=function(b){var c={touchStart:function(b){var d=a(this),e=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],f={element:d,x:e.pageX,y:e.pageY,scrollX:d.scrollLeft(),scrollY:d.scrollTop()};a(document).bind("touchend",f,c.touchEnd),a(document).bind("touchmove",f,c.touchMove)},touchMove:function(a){a.preventDefault();var b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],c={x:b.pageX-a.data.x,y:b.pageY-a.data.y};a.data.element.scrollLeft(a.data.scrollX-c.x),a.data.element.scrollTop(a.data.scrollY-c.y)},touchEnd:function(){a(document).unbind("touchmove",c.touchMove),a(document).unbind("touchend",c.touchEnd)}};return b===!0?this.on("touchstart",c.touchStart):b===!1&&this.off("touchstart",c.touchStart),this}}(jQuery);var T1=T1||{};T1.utilities=function(){"use strict";var a={getIeVersion:function(){return/MSIE (\d+\.\d+);/.test(navigator.userAgent)?Number(RegExp.$1):1e3},isIeMobile:function(){return null!==navigator.userAgent.match(/IEMobile/g)}},b={isChrome:navigator.userAgent.indexOf("Chrome")>-1,isExplorer:navigator.userAgent.indexOf("MSIE")>-1,isFirefox:navigator.userAgent.indexOf("Firefox")>-1,isSafari:-1===navigator.userAgent.indexOf("Chrome")&&navigator.userAgent.indexOf("Safari")>-1,isOpera:navigator.userAgent.indexOf("Presto")>-1},c={isIpad:function(){return null===navigator.userAgent.match(/iPad/g)?!1:!0},isIphone:function(){return null===navigator.userAgent.match(/iPhone/g)?!1:!0},isIOS:function(){return null===navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!1:!0}},d={hasFlash:function(){var a=!1;try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");b&&(a=!0)}catch(c){void 0!==navigator.mimeTypes["application/x-shockwave-flash"]&&(a=!0)}return a}},e={checkedEvents:{},hasEvent:function(a){return e.checkedEvents[a]||a in document}},f={isAndroid:function(){return null===navigator.userAgent.match(/Android/i)?!1:!0},isMobileAndroid:function(){var a=navigator.userAgent.match(/Android|Mobile Safari/g);return a?a.length>=2:!1}},g={youtubeEmbedUrl:"http://www.youtube.com/embed/<id>?rel=0&hd=<hd>;autoplay=<autoplay>;controls=<controls>;modestbranding=<modestbranding>&wmode=opaque&html5=1",getEmbedUrl:function(a,b){if(!a)return"";var c=g.getYouTubeId(a),d=g.youtubeEmbedUrl;return b||(b={}),c?(d=d.replace("<hd>",b.hd||"1"),d=d.replace("<autoplay>",b.autoplay||"1"),d=d.replace("<controls>",b.controls||"0"),d=d.replace("<modestbranding>",b.modestbranding||"1"),d.replace("<id>",c)):a},getYouTubeId:function(a){if(!a)return"";var b=a.replace(/.*\/(.*?)v=|&.*|.*\/|\?.*/g,"");return new RegExp("[:/.]").test(b)?null:b}},h={test:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("touch")&&-1!==navigator.platform.toLowerCase().indexOf("win")}},i=Modernizr.touch?"touchend":"click",j={getCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},setCookie:function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},rmCookie:function(a){j.setCookie(a,"",-1)}},k={bp:"xs",changeBp:function(a,b){k.bp=b},getCurrentBp:function(){return k.bp},inView:function(a,b){var c=$(window),d=c.scrollTop(),e=c.scrollTop()+c.height(),f=a.offset().top+a.outerHeight()-(b||0);return e>=f&&f>=d?!0:!1}},l={getContrastYIQ:function(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?"black":"white"},lightenDarkenColor:function(a,b){var c=!1;"#"==a[0]&&(a=a.slice(1),c=!0);var d=parseInt(a,16),e=(d>>16)+b;e>255?e=255:0>e&&(e=0);var f=(d>>8&255)+b;f>255?f=255:0>f&&(f=0);var g=(255&d)+b;return g>255?g=255:0>g&&(g=0),(c?"#":"")+(g|f<<8|e<<16).toString(16)},isTooDark:function(a,b){var c=!1;b||(b=40);var d=parseInt(a,16),e=d>>16&255,f=d>>8&255,g=d>>0&255,h=.2126*e+.7152*f+.0722*g;return b>h&&(c=!0),c}},m={calculate:function(a){if(a){var b=a.parent(),c=b.height(),d=b.width(),e=a.get(0).naturalHeight,f=a.get(0).naturalWidth,g=f-d,h=e-c,i=g/f*100,j=h/e*100,k=e*f,l=c*d,m=k-l,n=m/k*100;PubSub.publish(T1.constants.CALCULATE_VISIBLE_AREA_OF_THE_IMAGE,{imageHeight:e+"px",imageWidth:f+"px",containerHeight:c+"px",containerWidth:d+"px",unvisibleX:g+"px",unvisibleY:h+"px",unvisibleXperc:Math.round(i)+"%",unvisibleYperc:Math.round(j)+"%",unvisibleTotalArea:m+"px²",unvisiblePercentage:Math.round(n)+"%",image:a})}}},n={getMonthlyAmount:function(){var a=0;return a}};return{init:function(){PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,k.changeBp)},currentBreakpoint:k.getCurrentBp,ieVersion:a.getIeVersion,isIeMobile:a.isIeMobile(),hasFlash:d.hasFlash,hasEvent:e.hasEvent,isIpad:c.isIpad,isIOS:c.isIOS,isIphone:c.isIphone,isAndroid:f.isAndroid,isMobileAndroid:f.isMobileAndroid,iswindowsTablet:h.test,clickEvent:i,cookies:j,contrastYIQ:l.getContrastYIQ,lightenDarken:l.lightenDarkenColor,isTooDark:l.isTooDark,imgVisibleArea:m.calculate,financeMonthly:n.getMonthlyAmount,youtube:g,browser:b,viewport:k}}(),window.console||(window.console={log:function(){},dir:function(){}}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Object.resolve=function(a,b){for(var c=(a||"").split("."),d=0;d<c.length;d++)b&&(b=void 0!==b[c[d]]?b[c[d]]:null);return b},Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),"function"!=typeof Object.keys&&(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b});var T1=T1||{};T1.scriptLoader=function(){"use strict";var a={load:function(){var a=T1.constants,b=[a.JS_VIDEOJS];Modernizr.load({test:!(T1.utilities.isIOS()||T1.utilities.isMobileAndroid()),yep:b})},loadScript:function(a,b){var c=$("<script>");c.attr("type","text/javascript"),c.attr("href",a),$.each(b,function(a,b){c.attr(a,b)}),$("body").append(c)},loadStyle:function(a,b){var c=$("<link>");c.attr("rel","stylesheet"),c.attr("type","text/css"),c.attr("href",a),$.each(b,function(a,b){c.attr(a,b)}),$("head").append(c)}};return{init:a.load,loadScript:a.loadScript,loadStyle:a.loadStyle}}();var T1=T1||{};T1.errorHandler=function(){"use strict";var a={isErrorHandled:!1,errorToken:"",init:function(){var b=a;window.onerror&&(window.onerror=b.handleError),b.errorToken=PubSub.subscribe(T1.constants.ERROR,b.handleError)},handleError:function(b,c,d){var e=a,f={};e.isErrorHandled||(e.isErrorHandled=!0,f.message=b,f.url=c,f.line=d,e.logError(f,!1),e.isErrorHandled=!1)},logError:function(a,b){var c="Error ";$.each(a,function(a,b){b&&(c+=": "+b.toString()+"\n")}),console.log(c),b&&PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$("body"),customText:c,centerScreen:!0,timeout:2e3})}};return{init:a.init,handleError:a.handleError}}();var T1=T1||{};T1.scrollTracking=function(){"use strict";var a={trackElements:null,scrollRecalcInterval:500,trackId:0,currentViewPortElements:{},lastRecalcTop:0,lastTop:0,win:$(window),viewp:{height:$(window).height()},scrollDirection:"down",init:function(){var b=a,c=T1.constants;PubSub.subscribe(c.GLOBAL_SCROLL,b.trackScroll),PubSub.subscribe(c.GLOBAL_SWIPE,b.trackScroll),PubSub.subscribe(c.SCROLL_TRACK_ADD,b.addElements),PubSub.publish(c.SCROLL_TRACK_ADD,{elements:$(".topfeatures"),options:{direction:"down",threshold:200,event:T1.constants.SKROLLR_REFRESH}}),PubSub.publish(c.SCROLL_TRACK_ADD,{elements:$("#footfocus"),options:{direction:"down",threshold:200,event:T1.constants.SKROLLR_REFRESH}})},test:function(a,b){console.log("SCROLLED "+b.element.prop("id")+" "+(new Date).toTimeString())},trackScroll:function(){var b=a;b.trackElements&&(b.viewp.top=b.win.scrollTop(),b.viewp.bottom=b.viewp.top+b.viewp.height,b.scrollDirection=b.viewp.top>b.lastTop?"down":"up",b.lastTop=b.viewp.top,Math.abs(b.lastRecalcTop-b.viewp.top)>b.scrollRecalcInterval&&(b.recalc(),b.lastRecalcTop=b.viewp.top),b.checkElements())},checkElements:function(){var b=a,c=null,d=null,e={};for(var f in b.trackElements)if(c=b.trackElements[f])for(var g=0;g<c.conditions.length;g++)d=c.conditions[g],"string"==typeof d.threshold&&-1!==d.threshold.indexOf("%")&&(d.threshold=c.el.outerHeight()*(parseInt(d.threshold.replace("%",""),10)/100)),c.offset.top-d.threshold<b.viewp.bottom&&c.offset.bottom+d.threshold>b.viewp.top&&(b.currentViewPortElements[f+d.id]||(-1!=d.direction.indexOf(b.scrollDirection)&&PubSub.publish(d.event,{element:c.el}),d.once&&(c.conditions.splice(g,1),0===c.conditions.length&&delete b.trackElements[f])),e[f+d.id]=!0);b.currentViewPortElements=e},recalc:function(){var b=a;if(b.trackElements)for(var c in b.trackElements)b.recalcElement(b.trackElements[c])},recalcElement:function(a){a.offset=a.el.offset(),a.offset.bottom=a.offset.top+a.el.outerHeight()},addElements:function(b,c){for(var d=c.elements,e=c.options,f=0;f<d.length;f++)a.addElement(d.eq(f),e);return d},addElement:function(b,c){var d=a,e=b.prop("scrollTrackId");d.trackElements||(d.trackElements={}),e||(e="scroll"+d.trackId,b.prop("scrollTrackId",e),d.trackId++),d.trackElements[e]||(d.trackElements[e]={offset:null,el:b,conditions:[]}),c||(c={}),d.trackElements[e].conditions.push({id:"condition"+d.trackElements[e].conditions.length,threshold:c.threshold||0,direction:c.direction||"updown",once:c.once||!1,event:c.event||T1.constants.SCROLL_TRACK_APPEAR}),d.recalcElement(d.trackElements[e])}};return{init:a.init}}();var T1=T1||{};T1.lazyLoad=function(){"use strict";var a={mode:"mobile",placeholder:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",dataAttribute:"lazyload",init:function(){var b=a;PubSub.subscribe(T1.constants.SCROLL_TRACK_APPEAR,b.appear),PubSub.publish(T1.constants.SCROLL_TRACK_ADD,{elements:$(".maincontent > section, .maincontent > article, #footfocus"),options:{once:!0}})},initImageContainer:function(b,c){if(c.elements&&c.initImages)for(var d=a,e=null,f=0;f<c.elements.length;f++)e=c.elements.get(f),e.imagesInitialized||(d.initImages($(e).find("[data-"+d.dataAttribute+"-^]")),e.imagesInitialized=!0)},initImages:function(b){for(var c=0;c<b.length;c++)a.initImage(b.eq(c))},initImage:function(b){(void 0===b.attr("src")||b.attr("src")===!1)&&b.is("img")&&b.attr("src",a.placeholder)},appear:function(b,c){var d=a,e=c.element||c,f=(c.options||{},e.attr("data-"+d.dataAttribute+"-desktop")?e:e.find("[data-"+d.dataAttribute+"-desktop]"));e.is&&e.is(":visible")&&d.loadImages(f)},loadImages:function(b){for(var c=null,d=0;d<b.length;d++)c=b.eq(d),a.loadImage(c)},loadImage:function(b){var c=a,d=b.get(0),e=b.attr("data-"+c.dataAttribute+"-"+c.mode)||b.attr("data-"+c.dataAttribute+"-desktop");e&&"#"!==e||(d["loaded-"+c.mode]=!0),d["loaded-"+c.mode]||(b.is("img")||b.is("iframe")?b.attr("src",e):b.is("figure")?b.attr("data-src",e):b.css("background-image","url('"+e+"')"),d["loaded-"+c.mode]=!0)},getMode:function(){var b=window.innerWidth||$(window).innerWidth();a.mode=b>T1.constants.SCREEN_SMALL?"desktop":"mobile"},switchDesktop:function(){a.mode="desktop"},switchMobile:function(){a.mode="mobile"}};return a.getMode(),a.appear("preLoad",{element:$("#mainfocus")}),{init:a.init,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile}}();var T1=T1||{};T1.iframeresponsive=function(){"use strict";var a={init:function(){var b=a;PubSub.subscribe(T1.constants.ON_WIN_RESIZE,b.resizeIframes),PubSub.subscribe(T1.constants.IFRAME_LOAD,b.initResponsiveIframe),$(window).on("message",b.resizeIframes)},initResponsiveIframe:function(b,c){var d=a,e=$(c);$(c).off("load",d.resizeIframes).on("load",e,d.resizeIframes),d.resizeIframes({data:e})},resizeIframes:function(b){var c=a,d=null;if("message"===b.type)d=c.findIframe(b.originalEvent.source),d&&(d.is(".overlayerContent > div > iframe")||d.height(b.originalEvent.data));else for(var e=b.data||$(".iframe-responsive"),f=0;f<e.length;f++)d=e.eq(f),"true"!==d.attr("crossdomain")&&d.height(d.contents().find("body").height()+60)},findIframe:function(a){for(var b=$("iframe"),c=0;c<b.length;c++)if(b[c].contentWindow===a)return b.eq(c)}};return{init:a.init}}();var T1=T1||{};T1.request=function(){"use strict";var a={parameters:{},getQueryStringParameters:function(){var b=a,c=decodeURIComponent(document.URL);if(c.indexOf("?")>-1)for(var d=c.split("?")[1],e=d.split("&"),f=0;f<e.length;f++){var g=e[f].split("=");b.parameters[g[0].toString()]=g[1].split("#")[0]}return b.parameters},getQueryStringParameter:function(b){var c=a;return c.parameters=c.getQueryStringParameters(),c.parameters[b]},getDomainName:function(){return T1.settings.mock?"http://t1-dev-glen.herokuapp.com":window.location.protocol+"//"+window.location.host}};return{getQueryStringParameter:a.getQueryStringParameter,getQueryStringParameters:a.getQueryStringParameters,getDomainName:a.getDomainName}}();var T1=T1||{};T1.toast=function(){"use strict";var a={content:null,init:function(){a.content=T1.labels?T1.labels.toastText:"",PubSub.subscribe(T1.constants.TOAST_CUSTOM,a.prepare),$(window).on("orientationchange",a.resetPos)},prepare:function(b,c){if(c.customContainer){var d=a,e=c.customContainer,f=c.customText||a.content,g={display:"none"},h=c.timeout||!1;$(".toast",e).hide();var i=$("<div/>");if(c.removeDefaultClass||i.addClass("toast"),c.customClass&&i.addClass(c.customClass),i.html(f),i.css(g).appendTo(e),!c.noPosition){var j=c&&c.centerScreen?d.centerScreen(i):d.getPos(i,e);i.css({position:c&&c.centerScreen?"fixed":"absolute",top:c.top||j.y,left:c.left||j.x}),c.css&&i.css(c.css)}i.css({cursor:"pointer"}),d.show(i,c.immediate),h&&"number"==typeof h?setTimeout(function(){d.hide(i)},h):e.on("mousedown touchstart",function(){d.hide(i)})}},getPos:function(a,b){var c=b.height()/2-a.innerHeight()/2,d=b.width()/2-a.innerWidth()/2;return{x:d+"px",y:c+"px"}},centerScreen:function(b){return a.getPos(b,$(window))},show:function(a,b){b?a.show():a.fadeIn(T1.constants.ANIMATION_SPEED_FADE)},hide:function(a){a.fadeOut(T1.constants.ANIMATION_SPEED_FADE,function(){$(this).remove()})},resetPos:function(){var b=a,c=$(".toast"),d=c.closest("section"),e=b.getPos(c,d);c.css({top:e.y,left:e.x})}};return{init:a.init}}();var T1=T1||{};T1.bubble=function(){"use strict";var a={initDesktop:function(){var b=a,c=T1.constants;PubSub.subscribe(c.PAGEOVERLAYER_LOAD,b.initOnDemand),b.initOnDemand()},initOnDemand:function(){var b=a,c=$("[data-bubble]");c.unbind().bind("click",b.toggle)},toggle:function(b){var c=a,d=$(b.target),e=d.position(),f=d.width(),g=$("."+d.data("bubble")),h=g.hasClass(T1.constants.CLASS_ACTIVE);b.preventDefault(),c.hideAll(),g.css("left",e.left+f/2-48),h||g.addClass(T1.constants.CLASS_ACTIVE)},hideAll:function(){var a=$(".bubble");a.removeClass("active")}};return{initDesktop:a.initDesktop,initMobile:a.initMobile}}();var T1=T1||{};T1.compatibility=function(){"use strict";var a={init:function(){var b="true"===T1.settings.showIncompatibleBrowser;b&&T1.utilities.ieVersion()<10&&a.showFallbackMessage()},showFallbackMessage:function(){PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$("body"),customText:T1.labels.wrongBrowser.incompatibleBrowser,centerScreen:!0,immediate:!0,css:{width:"80%",left:"0","margin-left":"10%","margin-right":"10%"}})}};return{init:a.init}}();var T1=T1||{};T1.navigation=function(){"use strict";var a={isSmallLogo:!1,isPrimaryNavOpen:!1,scrollSpyList:[],isSecondLevelVisible:!1,currentSpy:null,isMoreSelected:!1,moreOptionSecondIteration:!1,breadcrumbLinkTemplate:!1,currentDropdown:null,init:function(){var b=a,c=T1.constants,d=$("#nav-primary .navbar-inner .dropdown"),e=$("#nav-secondary-level li"),f=$("#menu-breadcrumb li"),g=$("#menu-search, .navigation-menu .input-search, .content-navigation-cta .input-search"),h=g.find("input.search"),i=g.find("a");h.on("keydown",b.handleSearch),i.on("click",b.handleSearch),Modernizr.touch?PubSub.subscribe(c.GLOBAL_SWIPE,b.handleWindowScroll):PubSub.subscribe(c.GLOBAL_SCROLL,b.handleWindowScroll);var j,k;if($("input.search").on("touchstart",function(a){j=$(a.currentTarget)}),$(".navigation-menu").on("click",function(a){k=$(a.currentTarget)}),d.on("hide.bs.dropdown",function(a){return void 0!==j&&j.hasClass("search")||k?(j=void 0,k=void 0,!1):void b.handleHideDropdown(a)}),d.on("show.bs.dropdown",b.handleShowDropdown),PubSub.subscribe(T1.constants.NAVIGATION_SET_SCROLLTO,b.setScrollTo),$("body").on(T1.utilities.clickEvent,".scrollTo",a.scrollToClick),b.setLogo(),e.length>0){b.initSecondLevel(e);var l=$(".page-disclaimer");l.length>0&&b.setDisclaimerPosition(l)}return f.length>0&&b.initBreadCrumb(),$(".dropdown-menu").find("[data-bt-track]").on(T1.utilities.clickEvent,b.runBTEvent),null},switchDesktop:function(){$("#dropdown-menu-car").touchToScroll(!0)},switchMobile:function(){$("#dropdown-menu-car").touchToScroll(!1)},initSecondLevel:function(b){var c,d=a,e=T1.constants,f=$("#nav-secondary-level .dropdown > a"),g=b.find("a");d.isSecondLevelVisible=!0,b.on(T1.utilities.clickEvent,d.handleSecondLevelClick),f.on(T1.utilities.clickEvent,a.onMoreOptionClick),PubSub.subscribe(e.ON_DOC_CLICK,a.onDOCClick),PubSub.subscribe(e.ON_BREAKPOINT_CHANGE,d.setMoreLi);for(var h=0;h<g.length;h++)c=$(g[h]),c.attr("href")&&"#"===c.attr("href").substr(0,1)&&-1===d.scrollSpyList.indexOf(c.attr("href"))&&d.scrollSpyList.push(c.attr("href"))},initBreadCrumb:function(){var b=a,c=T1.constants,d=$("#menu-breadcrumb .active > a"),e=$("#breadcrumb-link-template");b.setBreadcrumbsArrowPosition(),PubSub.subscribe(c.ON_BREAKPOINT_CHANGE,b.setBreadcrumbsVisibleItems),PubSub.subscribe(c.ON_WIN_RESIZE,b.setBreadcrumbsArrowPosition),PubSub.subscribe(c.NAVIGATION_ADD_BREADCRUMB_LINK,b.addBreadcrumbLink),PubSub.subscribe(c.NAVIGATION_REMOVE_BREADCRUMB_LINK,b.removeLastBreadcrumbLink),d.on("click",a.onBreadcrumbActiveLinkClick),e&&(b.breadcrumbLinkTemplate=e.html(),e.remove())},setDisclaimerPosition:function(a){a.css("margin-top","130px")},runBTEvent:function(){PubSub.publish(T1.constants.STATS_TRACK_CAROUSEL,{el:this})},setScrollTo:function(b,c){var d=$(c);d.off(T1.utilities.clickEvent),d.on(T1.utilities.clickEvent,a.scrollToClick)},scrollToClick:function(){var b=$(this),c=b.data("scrollTo")||b.data("scrollto"),d={},e=null,f=$("#nav-primary"),g=0;if("string"==typeof c)try{c=$.parseJSON(c)}catch(h){}if(c&&(c.jumpTo||c.animation||c.animation===!1))if(c.animation===!1)$(document).scrollTop(c.top||0);else if("fixed"===f.css("position")&&(a.isSecondLevelVisible&&(g+=$("#nav-secondary-level").height()),g+=f.find(".navbar-inner").height(),d={offset:-g}),e=$(0===$(c.parent).size()?"body":c.parent),T1.utilities.isIOS()===!0){var i=$(c.jumpTo).offset().top;void 0!==d.offset&&(i+=d.offset),$(window).scrollTop(i)}else e.scrollTo(c.jumpTo,c.easing||500,d);else{var j=b.attr("href"),k=b.attr("target");"_blank"===k?window.open(j,"_blank"):location.href=j}},handleWindowScroll:function(){setTimeout(a.setLogo,150),setTimeout(a.setScrollSpyActive,50)},handleShowDropdown:function(b){if("xs"!==T1.utilities.currentBreakpoint()&&$(b.currentTarget).hasClass("my-toyota")===!1){setTimeout(function(){$("body").addClass("noscroll")},T1.constants.ANIMATION_SPEED_FADE)}$(this).attr("data-bt-state",""),a.toggleDropdown(b,!0)},handleHideDropdown:function(b){$("body").removeClass("noscroll"),$(b.target).attr("data-bt-state","collapse"),a.toggleDropdown(b,!1)},toggleDropdown:function(b,c){var d=a,e=$(b.target),f=e.children(".dropdown-toggle"),g=e.children(f.attr("data-action-target")),h=e.find(".input-search input.search"),i=g.find(".navigation-menu.visible-xs");c?(PubSub.publish(T1.constants.NAVIGATION_PRIMARY_EXPAND,b),d.isSmallLogo||d.toggleFadeLogo(),h.length>0&&(h.show(),h.on(T1.utilities.clickEvent,function(b){a.stopPropagation(b),h.removeAttr("readonly")}))):h.length>0&&(h.hide(),h.attr("readonly","")),d.isPrimaryNavOpen=c,d.currentDropdown=g,(i.length<1||i.is(":hidden"))&&(d.setMenuSize(),d.isPrimaryNavOpen?PubSub.subscribe(T1.constants.ON_WIN_RESIZE,d.setMenuSize):PubSub.unsubscribe(T1.constants.ON_WIN_RESIZE,d.setMenuSize))},handleSearch:function(b){var c,d;if("click"===(b.eventType||b.type))b.preventDefault(),a.stopPropagation(b),c=$(b.target).closest(".input-search").find("input.search");else{if(13!==b.which)return;c=$(b.target)}d=c.val(),d.length>0&&PubSub.publish(T1.constants.HASH_CHANGE,"/publish/search/origin=menu/q="+d)},stopPropagation:function(a){a.stopPropagation()},setLogo:function(){var b=$(window).scrollTop(),c=$("#nav-primary"),d=$("#mainfocus"),e=c.height(),f=d.length>0?d.height():e+1;a.isSmallLogo||(c.find("#logo-big").css("margin-top",-1*b*f/f),b>=f-e&&a.toggleFadeLogo())},setMenuSize:function(){var b=a,c=b.currentDropdown,d="content"!==c.attr("data-expand-height");if(b.isPrimaryNavOpen)if(d){var e="sm"===T1.utilities.currentBreakpoint()?56:70;c.css("height",$(window).height()-e)}else c.css("height",c.children(".container").outerHeight());else c.css("height",0)},toggleFadeLogo:function(){var b=a;$("#logo-big").css("opacity",b.isSmallLogo?1:0),$("#logo-medium").css("opacity",b.isSmallLogo?0:1),b.isSmallLogo=!b.isSmallLogo},handleSecondLevelClick:function(b){var c=$("#nav-secondary-level li"),d=$("#nav-secondary-level .dropdown .sub-menu"),e=$(this);e.hasClass("dropdown")||(c.removeClass("active"),e.addClass("active"),e.parent().hasClass("dropdown")||(d.removeAttr("style"),a.isMoreSelected=!1),b.preventDefault())},setMoreLi:function(){var b=$("#nav-secondary-level"),c=b.find(".container"),d=b.find("li.dropdown");if(b.css("overflow","hidden"),b.is(":visible")&&b.height()<c.height()){var e,f=$("#nav-secondary-level > ul > li").not(".dropdown"),g=d.find(".sub-menu"),h=0,i=c.width();d.css("display","inline-table");for(var j=0===d.length?0:d[0].clientWidth,k=f.length,l=0;k>l&&(h+=f[l].clientWidth,!(h+j>i));l++);e=f.slice(l,k),e.prependTo(g),b.css("overflow","visible"),a.moreOptionSecondIteration=!1,0===e.length&&d.css("display","none")
}else if(b.css("overflow","visible"),a.moreOptionSecondIteration===!1){a.moreOptionSecondIteration=!0;var m=d.find("li");m.appendTo(b.find("ul")),m.remove(),d.insertAfter(b.find("li:last")),a.setMoreLi()}else a.moreOptionSecondIteration=!1},setScrollSpyActive:function(){var b=$(window).scrollTop(),c=a.scrollSpyList,d=$("#nav-secondary-level li"),e=null,f=0,g=null,h=0,i=$("#nav-primary .navbar-inner").height();a.isSecondLevelVisible&&(i+=$("#nav-secondary-level").height()),b+=i;for(var j=c[c.length-1],k=0;k<c.length;k++)if(e=$(c[k]),!(e.length<1)){f=Math.floor(e.offset().top);var l=f-300;b>=l&&f>h&&(h=f,g=e.attr("id")),$(window).scrollTop()===$(document).height()-$(window).height()&&(h=f,g=$(j).attr("id"))}a.currentSpy!==g&&(a.currentSpy=g,d.removeClass("active"),d.find('a[href="#'+g+'"]').each(function(){$(this).parent().addClass("active")}))},setBreadcrumbsArrowPosition:function(){var a=$("#menu-breadcrumb li.active");a.length>0&&a.find("i.sprite-menu-dark-arrow").css("left",a.position().left+(a.find("a").width()/2-a.find("i.sprite-menu-dark-arrow").width()/2)+"px")},setBreadcrumbsVisibleItems:function(b,c){var d=$("#menu-breadcrumb"),e=d.find("li"),f=e.filter(":visible"),g=2*d.width(),h=0,i=function(a){for(var b=0,c=0;c<a.length;c++)b+=$(a[c]).outerWidth(!0);return b};if("xs"===c&&(g=1*d.width()),i(f)>g){for(var j=0;j<f.length;j++)if(f.eq(j).hide(),f=e.filter(":visible"),j--,i(f)<=g){a.setBreadcrumbsArrowPosition();break}}else{h=e.length-f.length;for(var k=h;k>=0&&i(f)+e.eq(k).width()<=g;k--)e.eq(k).show(),f=e.filter(":visible")}},addBreadcrumbLink:function(b,c){var d="",e=$("#menu-breadcrumb");a.breadcrumbLinkTemplate&&e.length>0&&a.checkExistence(c.name,e)&&(d=_.template(a.breadcrumbLinkTemplate,{element:c}),e.find(".active").removeClass("active").find("> a").off("click"),e.append(d),e.find(".active > a").on("click",a.onBreadcrumbActiveLinkClick))},checkExistence:function(a,b){var c=b.text();return-1===c.indexOf(a)},removeLastBreadcrumbLink:function(){var b=$("#menu-breadcrumb");b.length>0&&(b.find(".active").remove(),b.find("li").last().addClass("active").find("> a").on("click",a.onBreadcrumbActiveLinkClick))},onBreadcrumbActiveLinkClick:function(){return!1},onMoreOptionClick:function(){var b=$("#nav-secondary-level .dropdown .sub-menu");a.isMoreSelected?(a.isMoreSelected=!1,b.removeAttr("style")):(b.css("opacity","1"),b.css("display","block"),a.isMoreSelected=!0)},onDOCClick:function(b,c){var d=$("#nav-secondary-level .dropdown .sub-menu"),e=$(c.target);(0===e.parents("#nav-secondary-level").length||e.parents("#nav-secondary-level").length>0&&0===e.parents(".dropdown").length)&&(d.removeAttr("style"),a.isMoreSelected=!1)}};return{init:a.init,initDesktop:a.initDesktop,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile}}();var T1=T1||{};T1.myToyota=function(){"use strict";var a={isAuthenticated:null,overlayerOpen:!1,displayedCars:null,savedCarsImageSize:{width:300,height:95},animationsDuration:150,mapZoomLevel:12,mapSize:[230,122],storage:null,hidePrices:null,showRatesMonthly:!1,mapsApiUrl:null,version:1,eventsStack:{},stores:{cars:"cars",dealers:"dealers"},panes:{myCars:{id:"pane-my-cars",form:"#form-my-cars",messages:{}},saveCar:{id:"pane-save-car",forms:{save:"#form-save-car",login:"#form-login-save-car"}},myDealer:{id:"pane-my-dealer",form:"#form-my-dealer"},ownersArea:{id:"pane-owners-area"},resetPassword:{id:"pane-reset-password",form:"#form-reset-password"},login:{id:"pane-login",form:"#form-login"},register:{id:"pane-register",form:"#form-register"},forgottenPassword:{id:"pane-forgotten-password",form:"#form-forgotten-password"}},panesEvent:{"pane-register":T1.constants.MY_TOYOTA_REGISTER,"pane-forgotten-password":T1.constants.MY_TOYOTA_FORGOTTEN_PASSWORD,"pane-save-car":T1.constants.MY_TOYOTA_SAVE_CAR,"pane-reset-password":T1.constants.MY_TOYOTA_HASH_PASSWORD},classes:{loginForm:"login-form",formSuccess:"form-success",formError:T1.constants.CLASS_ERROR_FORM,carsExtended:"extended",carExtendable:"extendable"},init:function(){b.initLocalStorage(),b.isAuthenticated=T1.mypage&&T1.mypage.user?!0:!1,b.mapsApiUrl=T1.constants.URL_GOOGLE_STATIC_MAPS_API_DEV+"&zoom={ZOOM}&size={SIZE}&maptype=roadmap&sensor=false&visual_refresh=true&scale=2&center={POINT}&markers=color:red%7Clabel:C%7C{POINT}",PubSub.subscribe(c.MY_TOYOTA_MY_CARS,b.requestMyCars),PubSub.subscribe(c.MY_TOYOTA_MY_DEALERS,b.requestMyDealer),PubSub.subscribe(c.MY_TOYOTA_OWNERS_AREA,b.requestOwnersArea),PubSub.subscribe(c.MY_TOYOTA_LOGIN,b.requestLogin),PubSub.subscribe(c.MY_TOYOTA_LOGIN_SUCCESS,b.loginSuccess),PubSub.subscribe(c.MY_TOYOTA_RESET_PASSWORD,b.requestPasswordReset),PubSub.subscribe(c.MY_TOYOTA_HASH_PASSWORD,b.setPasswordHash),PubSub.subscribe(c.BEFORE_FORM_SUBMIT,b.beforeFormSubmit),PubSub.subscribe(c.SUBMIT_FORM_RETURN,b.formReturn),PubSub.subscribe(c.VALIDATE_FORM_RETURN,b.validateFormReturn),PubSub.subscribe(c.MY_TOYOTA_SAVE_CAR,b.requestSaveCar),PubSub.subscribe(c.MY_TOYOTA_GET_CAR,b.getCar),PubSub.subscribe(c.PAGEOVERLAYER_CLOSED,b.overlayerClosed),PubSub.subscribe(c.PAGEOVERLAYER_LOAD,b.initOverlayer),PubSub.subscribe(c.CARCONFIG_SAVE_CONFIG,b.saveCar),PubSub.subscribe(c.CARCONFIG_END,b.storeCar),PubSub.subscribe(c.DEALER_SAVE,b.saveDealer),PubSub.subscribe(c.DEALER_SELECTED,function(a,c){b.storeDealer(c),b.loadStoredDealers()}),b.hidePrices="true"===T1.settings.hidePrices,b.showRatesMonthly="true"===T1.settings.finance.showRatesMonthly,b.displayedCars=c.MY_TOYOTA_DISPLAYED_SAVED_CARS||6,b.panes.myCars.messages[404]=T1.labels.mytoyota.carConfigurationNotFound},initLocalStorage:function(){try{b.storage=window.localStorage}catch(a){console.log("Initialization of local storage failed:"+a.message)}},initOverlayer:function(a,d){!b.overlayerOpen&&d.el.find("#forms.my-toyota").size()&&(b.overlayerOpen=!0,PubSub.subscribe(c.TABS_SWITCH,b.publishLocalTabEvent),$("#cancelSearchMyCar").click(b.resetSearchMyCarForm),$("#savedCarsExtender").click(b.toggleSavedCars),$("#cancelSaveMyCar").click(b.resetSaveACarForm),$(".toyota-tabs .login-link").click(function(){b.setLoginRedirection($(this).parents(".tab-pane").attr("id"))}),$(".toyota-tabs .btn-cancel").click(b.cancelLogin),$(".toyota-tabs").click(b.closeAllOvl),$(b.panes.saveCar.forms.login).find(".input-row > div").addClass("col-sm-6"),b.setAuthenticatedState(b.isAuthenticated),b.loadUserData(),b.loadStoredCars(),b.loadStoredDealers())},initSavedCarsOnDemand:function(){$("#savedCarsExtender").click(b.toggleSavedCars),b.setAuthenticatedState(b.isAuthenticated),b.loadSavedCars()},publishLocalTabEvent:function(a,d){for(var e in b.panes)if(b.panes[e].id===d)return PubSub.publishSync(c.MY_TOYOTA_TAB_SWITCH,d),b.publishPaneEvent(d),!1},publishPaneEvent:function(a){a&&b.panesEvent[a]&&PubSub.publish(b.panesEvent[a])},getActiveTab:function(){return $(".toyota-tabs a.active").attr("data-tab")},setAuthenticatedState:function(a){b.isAuthenticated=a,$("#forms.my-toyota").toggleClass("authenticated",a),a||(T1.mypage&&(T1.mypage.user=null),$("."+b.classes.loginForm).each(function(){this.reset()}))},requestMyCars:function(){b.requestMyToyota(b.panes.myCars.id)},requestMyDealer:function(){b.requestMyToyota(b.panes.myDealer.id)},requestOwnersArea:function(){b.requestMyToyota(b.panes.ownersArea.id)},requestLogin:function(){b.requestMyToyota(b.panes.login.id)},requestPasswordReset:function(){b.requestMyToyota(b.panes.resetPassword.id)},setPasswordHash:function(){$("#password-hash").val(window.location.hash.substr(window.location.hash.lastIndexOf("/")+1))},requestAuthentication:function(){b.isAuthenticated&&b.setAuthenticatedState(!1),b.requestMyToyota(b.panes.login.id)},requestMyToyota:function(a){if(!b.overlayerOpen){PubSub.publish(c.PAGEOVERLAYER_OPEN,{url:decodeURIComponent($("#myToyota").data("url"))+"?tab="+a,ajax:!0,sync:!0});var d=PubSub.subscribe(c.PAGEOVERLAYER_LOAD,function(){PubSub.publish(c.TABS_SWITCH,a),PubSub.unsubscribe(d)})}},searchACar:function(a,d){var e=$(b.panes.myCars.form);e.find("#car-code").val(a),d&&($("#"+b.panes.myCars.id).addClass("hidden"),b.addStackEvent(c.MY_TOYOTA_SEARCH_FOUND,function(){b.addStackEvent(c.TABS_SWITCH,function(){$("#"+b.panes.myCars.id).removeClass("hidden")}),e.find(".btn-save").click()})),b.addStackEvent(c.TABS_SWITCH,function(){e.find(".btn-submit").click()})},beforeFormSubmit:function(a,c){if(c.form.is(b.panes.myCars.form))b.beforeSearchForm(a,c);else if(c.form.is(b.panes.login.form)||c.form.is(b.panes.saveCar.forms.login))c.json=!0,c.data=JSON.stringify({email:c.form.find('input[name="email"]').val(),password:c.form.find('input[name="password"]').val()});else if(c.form.is(b.panes.saveCar.forms.save)){var d=$("#searchCarResult").data("searched-car"),e=b.getSavedCar(d.id);e?(c.cancel=!0,PubSub.publish(T1.constants.MY_TOYOTA_CAR_ALREADY_SAVED,e),b.displayFormError(c.form,T1.labels.mytoyota.carAlreadySaved)):(b.collectObject(b.stores.cars,d),c.json=!0,c.data=JSON.stringify(b.getUser().data))}else c.form.is(b.panes.resetPassword.form)&&(c.json=!0,c.data=JSON.stringify({key:$("#password-hash").val(),password:$("#reset-password").val()}))},beforeSearchForm:function(a,b){b.url=T1.settings.loadSaveServer+c.URL_SUBMIT_FORM_MY_TOYOTA_SEARCH_CAR+"/"+b.form.find("#car-code").val()+"/short/"},formReturn:function(a,c){var d={isError:!1,message:null};b.overlayerOpen&&(b.resetFormClasses(c.form),"success"===c.status?c.data.success||!b.errorMessage(c.data)?c.form.is($(b.panes.myCars.form))?b.formMyCarsReturn(a,c):c.form.is($(b.panes.login.form))||c.form.is($(b.panes.saveCar.forms.login))?b.formLoginReturn(a,c):c.form.is($(b.panes.register.form))||c.form.is($(b.panes.forgottenPassword.form))||c.form.is($(b.panes.resetPassword.form))?b.resetFormReturn(a,c):c.form.is($(b.panes.saveCar.forms.save))&&b.formSaveCarReturn(a,c):d={isError:!0,message:b.errorMessage(c.data)}:(c.showError=!1,d={isError:!0,message:b.formStatusMessage(c.form,c.code)||c.message||c.status}),d.isError&&(b.resetStackEvents(),b.manageFormReturnError(c,d)))},manageFormReturnError:function(a,d){d.isError&&(b.displayFormError(a.form,d.message),a.form.is($(b.panes.myCars.form))?PubSub.publish(c.MY_TOYOTA_SEARCH_FAILED,{result:a,error:d.message}):a.form.is($(b.panes.login.form))&&PubSub.publish(c.MY_TOYOTA_LOGIN_FAIL,{}))},errorMessage:function(a){return a.message||(a.error?a.error.message?a.error.message:a.error:null)},formStatusMessage:function(a,c){var d;return a.is($(b.panes.myCars.form))&&(d=b.panes.myCars),d&&d.messages&&d.messages[c]?d.messages[c]:void 0},validateFormReturn:function(a,c){b.overlayerOpen&&(c.form.is($(b.panes.register.form))||c.form.is($(b.panes.forgottenPassword.form))||c.form.is($(b.panes.resetPassword.form)))&&(c.validated=c.data.success)},formMyCarsReturn:function(a,d){var e=$("#searchCarResult");b.loadACar(d.data,e,b.suggestDeleteCar),e.data("searched-car",d.data),$(b.panes.saveCar.forms.save).find("#save-car-name").val(d.data.car),d.form.addClass(b.classes.formSuccess),PubSub.publishSync(c.MY_TOYOTA_SEARCH_FOUND,{car:d.data.car})},formLoginReturn:function(a,d){PubSub.publish(c.MY_TOYOTA_LOGIN_SUCCESS,d.data),d.form.is($(b.panes.login.form))?b.loginRedirect():PubSub.publish(c.TABS_SWITCH,b.panes.saveCar.id)},loginRedirect:function(){var a=$("#"+b.panes.login.id).attr("data-tab-redirect")||b.panes.myCars.id;PubSub.publish(c.TABS_SWITCH,a)},loginSuccess:function(a,c){b.setUser(c.user),b.setAuthenticatedState(c.success),b.loadUserData()},getUser:function(){return T1.mypage&&T1.mypage.user?T1.mypage.user:null},setUser:function(a){T1.mypage||(T1.mypage={}),T1.mypage.user=a,b.checkDefaultStorage()},resetFormReturn:function(a,b){b.form.get(0).reset()},formSaveCarReturn:function(a,d){var e=$("#searchCarResult").data("searched-car"),f=b.getSavedCar(e.id);b.setUser(d.data.user),b.loadSavedCars(),b.resetSearchMyCarForm(),b.resetSaveACarForm(),b.extendSavedCar(),PubSub.publish(c.TABS_SWITCH,b.panes.myCars.id),PubSub.publish(c.MY_TOYOTA_SAVED_CAR,{car:f})},extendSavedCar:function(){b.isMySavedCarsExtended()&&$("#savedCars>.row:not(.template):not(:visible):last").slideDown(b.animationsDuration)},saveCar:function(a,d){b.isAuthenticated?b.overlayerOpen?b.searchACar(d.configCode,!0):(b.addStackEvent(c.PAGEOVERLAYER_LOAD,function(){b.searchACar(d.configCode,!0)}),PubSub.publish(c.HASH_CHANGE,"/publish/my_toyota_my_cars")):(b.addStackEvent(c.MY_TOYOTA_LOGIN_SUCCESS,function(){b.saveCar(a,d)}),PubSub.publish(c.HASH_CHANGE,"/publish/my_toyota_login"))},storeCar:function(a,c){b.storage&&b.requestCarInfo(c,!0)},requestCarInfo:function(a,c,d,e){var f=$.ajax({type:"GET",dataType:"JSON",url:b.getCarInfoUrl(a)});f.done(d||b.getCarInfoSuccessHandle(c)),f.fail(e||b.handleCarInfoRequestFail)},getCarInfoUrl:function(a){var b=T1.settings.loadSaveServer+"/config/";return a.configCode?b+=a.configCode:a.modelId?(b+="toyota/"+T1.settings.country+"/"+T1.settings.language+"/",b+=a.modelId+"/"+a.carId+"/"+a.colourId+"/short/"):a.ConfigurationID&&(b+=a.ConfigurationID+"/short"),b},getCarInfoSuccessHandle:function(a){return function(c){c.message||c.error&&c.error.message?b.showErrorMessage(b.errorMessage(c)):a&&!b.getStoredCar(c.id)?(b.storeObject(b.stores.cars,c),PubSub.publish(T1.constants.MY_TOYOTA_STORED_CAR,c)):a||b.getSavedCar(c.id)?!a&&b.getSavedCar(c.id)&&(PubSub.publish(T1.constants.MY_TOYOTA_CAR_ALREADY_SAVED,c),console.log(T1.labels.mytoyota.carAlreadySaved+": "+c.id)):b.updateUserData(b.stores.cars,c)}},handleCarInfoRequestFail:function(a,b,c){console.log(b+": "+c)},getStoredCar:function(a){return b.getObject(b.getStorage(),b.stores.cars,a)},getSavedCar:function(a){return b.isAuthenticated?b.getObject(b.getUser().data.mytoyota,b.stores.cars,a):void 0},removeCar:function(a){a.preventDefault(),PubSub.publishSync(c.STATS_TRACK,{node:$(a.target)}),b.removeObject(b.stores.cars,a.data.code,a.data.callback)},removeObject:function(a,c,d){for(var e=b.getStorage(),f=0;f<e[a].length;f++)if(parseInt(e[a][f].id,10)===parseInt(c,10)){e[a].splice(f,1),b.setStorage(e),d();break}},getObject:function(a,b,c,d){for(var e=a[b],f=0;f<e.length;f++)if(parseInt(e[f].id,10)===parseInt(c,10))return d&&(d.index=f),e[f]},storeDealer:function(a){b.getStoredDealer(a.id)||b.storeObject(b.stores.dealers,a)},getStoredDealer:function(a){return b.getObject(b.getStorage(),b.stores.dealers,a)},saveDealer:function(a,d){if(b.isAuthenticated){var e=b.getSavedDealer(d.dealer.id);e?PubSub.publish(c.MY_TOYOTA_DEALER_ALREADY_SAVED,{dealer:d.dealer}):b.updateUserData(b.stores.dealers,d.dealer)}else PubSub.publishSync(c.HASH_REMOVE,""),b.overlayerOpen?(b.setLoginRedirection(b.panes.myDealer.id),PubSub.publishSync(c.TABS_SWITCH,b.panes.login.id),b.setSaveDealerState(a,d)):(b.addStackEvent(c.PAGEOVERLAYER_LOAD,function(c,e){e.el.find("#forms.my-toyota").size()&&(b.setSearchQuery(d.search),b.setLoginRedirection(b.panes.myDealer.id),b.setSaveDealerState(a,d))}),PubSub.publishSync(c.HASH_ADD,"/publish/my_toyota_login"))},setSaveDealerState:function(a,d){b.addStackEvent(c.MY_TOYOTA_TAB_SWITCH,function(){b.clearStackEvent(c.MY_TOYOTA_LOGIN_SUCCESS),b.clearStackEvent(c.MY_TOYOTA_CANCEL_LOGIN)},function(a,c){return c!=b.panes.login.id}),b.addStackEvent(c.MY_TOYOTA_LOGIN_SUCCESS,function(){b.clearStackEvent(c.MY_TOYOTA_CANCEL_LOGIN),b.saveDealer(a,d)}),b.addStackEvent(c.MY_TOYOTA_CANCEL_LOGIN,function(){b.clearStackEvent(c.MY_TOYOTA_LOGIN_SUCCESS),$(b.panes.myDealer.form).find("a.btn-search-dealers i").click()})},setSearchQuery:function(a){if(a){var c=$(b.panes.myDealer.form);c.find(".input-search input").val(a.query),c.find('input[name="options"]').prop("checked",!1),$(a.options).each(function(a,b){c.find('input[value="'+$(b).val()+'"]').prop("checked",!0)})}},addStackEvent:function(a,c,d){b.eventsStack[a]=b.eventsStack[a]||[],b.eventsStack[a].push({callback:c,token:PubSub.subscribe(a,b.processStackEvent),condition:d})},processStackEvent:function(a,c){b.eventsStack[a]&&($.each(b.eventsStack[a],function(d){(!b.eventsStack[a][d].condition||b.eventsStack[a][d].condition(a,c))&&(PubSub.unsubscribe(b.eventsStack[a][d].token),b.eventsStack[a][d].callback(a,c))}),b.clearStackEvent(a))},clearStackEvent:function(a){b.eventsStack[a]&&($(b.eventsStack[a]).each(function(c){PubSub.unsubscribe(b.eventsStack[a][c].token)}),delete b.eventsStack[a])},resetStackEvents:function(){for(var a in b.eventsStack)b.clearStackEvent(a);b.eventsStack={}},getSavedDealer:function(a){return b.isAuthenticated?b.getObject(b.getUser().data.mytoyota,b.stores.dealers,a):void 0},updateUserData:function(a,d){if(b.isAuthenticated){b.collectObject(a,d);var e=$.ajax({type:"POST",dataType:"JSON",beforeSend:function(a){a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json")},url:T1.request.getDomainName()+c.URL_SUBMIT_FORM_MY_TOYOTA_SAVE_DEALER,data:JSON.stringify(b.getUser().data)});e.done(function(e){if(e.success){if(b.setUser(e.user),b.loadSavedDealers(),a==b.stores.dealers){var f=b.getSavedDealer(d.id);f&&PubSub.publish(c.MY_TOYOTA_SAVED_DEALER,{dealer:f})}}else b.unCollectObject(a,d.id),b.showErrorMessage(b.errorMessage(e)),b.manageUpdateUserError(a,d,b.errorMessage(e))}),e.fail(function(c){b.unCollectObject(a,d.id),b.showErrorMessage(b.errorMessage(c)),b.manageUpdateUserError(a,d,b.errorMessage(c))})}},manageUpdateUserError:function(a,d,e){a==b.stores.dealers&&PubSub.publish(c.MY_TOYOTA_SAVE_DEALER_FAILED,{dealer:d,error:e})},removeDealer:function(a){a.preventDefault(),PubSub.publishSync(T1.constants.STATS_TRACK,{node:$(a.target)}),b.removeObject(b.stores.dealers,a.data.code,a.data.callback)},storeObject:function(a,c){if(b.storage){c.storeDate=globalize.format(new Date,"d"),c.saved=!1,a===b.stores.cars&&b.addCarCustomName(c);var d=b.getStorage();d[a].push(c),b.setStorage(d)}},getStorage:function(){var a=$.parseJSON(b.storage.mytoyota||null)||b.defaultStorage();return a&&a.version===b.version||(a=b.resetStorage()),a},setStorage:function(a){b.storage.mytoyota=JSON.stringify(a)},resetStorage:function(){var a=b.defaultStorage();return b.storage.mytoyota=JSON.stringify(a),a},defaultStorage:function(){return{version:b.version,cars:[],dealers:[]}},checkDefaultStorage:function(){T1.mypage.user.data||(T1.mypage.user.data={}),T1.mypage.user.data.mytoyota||(T1.mypage.user.data.mytoyota=b.defaultStorage())},collectObject:function(a,c,d){b.isAuthenticated&&(c.storeDate=globalize.format(new Date,"d"),c.saved=!0,a===b.stores.cars&&b.addCarCustomName(c),void 0!==d?b.getUser().data.mytoyota[a].splice(d,0,c):b.getUser().data.mytoyota[a].push(c))},addCarCustomName:function(a){a.customName=$("#save-car-name").val()||null},unCollectObject:function(a,c){if(b.isAuthenticated)for(var d=b.getUser().data.mytoyota[a],e=0;e<d.length;e++)if(parseInt(d[e].id,10)===parseInt(c,10)){d.splice(e,1);break}},loadUserData:function(){b.isAuthenticated&&(b.checkDefaultStorage(),b.loadSavedCars({skipSocialInit:!0}),b.loadSavedDealers())},loadSavedCars:function(a){if(a=a||{},b.isAuthenticated){var c=b.getUser().data.mytoyota.cars,d=$("#savedCars"),e=d.find(">.row.template"),f=b.isMySavedCarsExtended();a.insert||d.find(">.row:not(.template)").remove();for(var g=c.length-1;g>=0;g--){var h=e.clone().removeClass("template"),i=d.find(">.row:not(.template) > div");i.size()>=b.displayedCars&&h.addClass(b.classes.carExtendable),f&&h.show(),b.appendObjRow(d,h,c[g],b.loadACar,b.suggestDeleteCar)}d.find(".template").appendTo(d),a.skipSocialInit||b.initSocialButtons(),b.setExtenderCarsCount(d.find(">.row:not(.template) > div").size())}},loadACar:function(a,d,e){if(!(a&&a.id&&a.car))return console.log(a.code||"not a car"),!1;if(d.find(".obj-desc").attr("data-obj-code",a.id),d.find("img").attr("src",b.getCarImagePath(a.code)),d.find(".hybrid").toggle(a.hybrid||!1),d.find(".title").html(b.htmlDecode(a.customName||a.car)),!b.hidePrices&&a.price){var f=a.price.listWithDiscount,g=b.htmlDecode(globalize.format(f,"c"));d.find(".price").html(g)}if(d.find(".desc a").hide(),b.showRatesMonthly&&T1.labels.pricePerMonth){var h=T1.labels.pricePerMonth.replace("%a",220).replace("%m",12);d.find(".desc strong").text(h)}return d.find(".code i").html(b.htmlDecode(a.code)),d.find(".date").text(a.storeDate),d.find(".saved").toggle(a.saved||!1),d.find(".btn-edit").on("click",function(b){b.preventDefault(),PubSub.publish(T1.constants.HASH_CHANGE,c.URL_CAR_CONFIG_OVERLAYER+"tyCode="+a.code)}),d.find(".btn-read-more").attr("href",a.carChapterUrl),d.find(".btn-delete").click(e),!0},htmlDecode:function(a){return $("<div/>").html(a).text()},getCarImagePath:function(a){return a?T1.settings.CCISServer+"/configuration/"+a+"/width/"+b.savedCarsImageSize.width+"/height/"+b.savedCarsImageSize.height+"/exterior-32.png":null},loadStoredCars:function(){b.loadStoredObjects($("#recentlyViewedCars"),b.getStorage().cars,b.loadACar,b.suggestRemoveCar)},loadStoredDealers:function(){b.loadStoredObjects($("#recentlyViewedDealers"),b.getStorage().dealers,b.loadADealer,b.suggestRemoveDealer)},loadStoredObjects:function(a,c,d,e){var f=a.find(">.row.template");a.find(">.row:not(.template)").remove();for(var g=c.length-1;g>=0;g--){var h=f.clone().removeClass("template");b.appendObjRow(a,h,c[g],d,e)}a.find(".template").appendTo(a)},appendObjRow:function(a,b,c,d,e){var f=a.find(">.row:not(.template):last() > div").size();d(c,b,e)&&(f%2===0?a.append(b):a.find(">.row:not(.template):last()").append(b.find("> div")))},loadSavedDealers:function(a){if(b.isAuthenticated){var c=b.getUser().data.mytoyota.dealers||[],d=$("#savedDealers"),e=d.find(">.row.template");a||d.find(">.row:not(.template)").remove();for(var f=c.length-1;f>=0;f--){{var g=e.clone().removeClass("template");d.find(">.row:not(.template) > div")}b.appendObjRow(d,g,c[f],b.loadADealer,b.suggestDeleteDealer)}d.find(".template").appendTo(d),b.initSocialButtons()}},loadADealer:function(a,c,d){if(a){var e="http://",f=/^http:\/\//.test(a.url)?a.url:e+a.url,g=c.find(".website");return c.find(".obj-desc").attr("data-obj-code",a.id),c.find("img").attr("src",b.getMapUrl(a)),c.find(".name").html(b.htmlDecode(a.name)),c.find(".address:eq(0)").html(b.htmlDecode(a.address.address1)),c.find(".address:eq(1)").html(b.htmlDecode(a.address.zip+" "+a.address.city+(a.address.region?"("+a.address.region+")":""))),g.attr("href",b.htmlDecode(f)).toggle(f!==e),g.attr("target","_blank"),c.find(".website").attr("data-bt-value","string"==typeof a.url&&a.url.length>0?a.url:""),c.find(".website span").html(b.htmlDecode(a.url)),c.find(".btn-details").attr("href",b.htmlDecode(f)).css({display:""!==$.trim(a.url)?"inline-block":"none"}),c.find(".btn-map").attr("href",b.htmlDecode(f)),f===e&&c.removeAttr("href"),c.find(".btn-delete").click(d),!0}return!1},getMapUrl:function(a){var c=a.address.origin.lon+","+a.address.origin.lat;return b.mapsApiUrl.replace("{API_KEY}",T1.settings.dealer.googleAPIKey).replace("{ZOOM}",b.mapZoomLevel).replace("{SIZE}",b.mapSize.join("x")).replace(new RegExp("{POINT}","g"),c)},initSocialButtons:function(){PubSub.publishSync(c.EPRIVACY_LOAD_COMPONENT,{root:$("#savedCars > .row:not(.template), #savedDealers > .row:not(.template)"),callback:function(){$("#savedCars .share-options").each(function(){var a=$(this),b=a.parents(".form-btn").find(".btn-read-more").attr("href");a.find("a").attr("data-link",b)})}})},toggleSavedCars:function(){var a=b.displayedCars/2,c=$("#savedCars").find(">.row:gt("+(a-1)+"):not(.template)"),d=c.find(":visible").size()>a,e=$({});d&&(c=$(c.get().reverse())),$("#savedCarsExtender").toggleClass(b.classes.carsExtended,!d),c.each(function(){var a=$(this);e.queue(function(c){a.animate({height:"toggle",opacity:"toggle"},b.animationsDuration,c)})})},isMySavedCarsExtended:function(){return $("#savedCarsExtender").hasClass(b.classes.carsExtended)},setExtenderCarsCount:function(a){$("#savedCarsExtender i.count").text(a),$("#savedCarsExtender").toggle(a>b.displayedCars)},resetSearchMyCarForm:function(a){a&&a.preventDefault(),$("#car-code").focus().val(""),b.resetFormClasses($(b.panes.myCars.form))},resetSaveACarForm:function(){$("#save-car-name").val(""),b.resetFormClasses($(b.panes.saveCar.forms.save))},setLoginRedirection:function(a){$("#"+b.panes.login.id).attr("data-tab-redirect",a)},cancelLogin:function(a){a.preventDefault(),a.stopImmediatePropagation(),b.loginRedirect(),PubSub.publishSync(c.MY_TOYOTA_CANCEL_LOGIN)},requestSaveCar:function(){$(b.panes.myCars.form).hasClass(b.classes.formSuccess)&&$("#searchCarResult > .row:first").clone().appendTo($("#pane-save-car .col-xtra-info").empty())},getCar:function(a,c){c.out={car:null},c.out.car=b.getSavedCar(c.id)||b.getStoredCar(c.id)},suggestDeleteCar:function(a){var c=$(this),d=c.parents(".form-btn").siblings(".obj-desc");a.preventDefault(),b.ovlRemoveObj(d,b.carDeleted,b.requestDeleteCar,b.stores.cars,b.getUser().data.mytoyota)},suggestRemoveCar:function(a){var c=$(this),d=c.parents(".obj-desc");a.preventDefault(),b.ovlRemoveObj(d,b.loadStoredCars,b.removeCar,b.stores.cars,b.getStorage())},suggestDeleteDealer:function(a){var c=$(this),d=c.parents(".form-btn").siblings(".obj-desc");a.preventDefault(),b.ovlRemoveObj(d,b.dealerDeleted,b.requestDeleteDealer,b.stores.dealers,b.getUser().data.mytoyota)},suggestRemoveDealer:function(a){var c=$(this),d=c.parents(".obj-desc");a.preventDefault(),b.ovlRemoveObj(d,b.loadStoredDealers,b.removeDealer,b.stores.dealers,b.getStorage())},ovlRemoveObj:function(a,c,d,e,f){if(!a.find(".del-ovl").size()){var g=a.attr("data-obj-code"),h=a.parents("section:first"),i=h.find(">.del-ovl.template").clone(),j={index:0};i.attr("data-obj-code",g).removeClass("template"),h.find(".del-ovl:not(.template)").remove(),a.append(i),a.find(".btn-yes").click({store:e,code:g,object:b.getObject(f,e,g,j),index:j.index,callback:c},d),a.find(".btn-no").click(function(a){a.preventDefault()})}},requestDeleteCar:function(a){a.preventDefault(),b.requestDelete(a,T1.request.getDomainName()+c.URL_MY_TOYOTA_DELETE_CAR)},requestDeleteDealer:function(a){a.preventDefault(),b.requestDelete(a,T1.request.getDomainName()+c.URL_MY_TOYOTA_DELETE_DEALER)},requestDelete:function(a,c){if(b.isAuthenticated){b.unCollectObject(a.data.store,a.data.code);var d=$.ajax({type:"POST",dataType:"JSON",url:c,beforeSend:function(a){a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json")},data:JSON.stringify(b.getUser().data)});d.done(a.data.callback(a)),d.fail(b.objDeleteError(a))}},carDeleted:function(a){return function(c){c.success?(b.setUser(c.user),b.loadSavedCars()):b.objDeleteError(a,b.errorMessage(c))()}},dealerDeleted:function(a){return function(c){c.success?(b.setUser(c.user),b.loadSavedDealers()):b.objDeleteError(a,b.errorMessage(c))()}},objDeleteError:function(a,c){return function(d){var e=$(a.target).parents(".del-ovl");b.collectObject(a.data.store,a.data.object,a.data.index),e.addClass("error").find("h5").html(c||d.responseText||T1.labels.forms.errorSubmit),e.animate({height:e.get(0).scrollHeight},b.animationsDuration)}},closeAllOvl:function(a){$(a.target).is(".btn-edit, .btn-delete, .btn-yes")||$("#forms.my-toyota .del-ovl:not(.template)").remove()},displayFormError:function(a,c){a.find(".error-message").html(c),a.addClass(b.classes.formError)},resetFormClasses:function(a){a.removeClass(b.classes.formError+" "+b.classes.formSuccess)},overlayerClosed:function(a,c){b.overlayerOpen&&$(c.overlayer).find("#forms.my-toyota").size()&&(PubSub.unsubscribe(b.publishLocalTabEvent),b.resetStackEvents(),b.overlayerOpen=!1)},showErrorMessage:function(a){console.log(a),PubSub.publish(c.TOAST_CUSTOM,{customText:a,centerScreen:!0,timeout:2e3})}},b=a,c=T1.constants;return{init:a.init,isAuthenticated:function(){return a.isAuthenticated},requestCarInfo:function(a,c,d){b.requestCarInfo(a,!1,c,d)}}}();var T1=T1||{};T1.modal=function(){"use strict";var a={triggers:$(".modal-launcher"),modals:$(".modal-container"),init:function(){a.hideOpenModals(),a.modals.each(a.addCloseButton),a.triggers.click(function(b){b.preventDefault(),a.hideOpenModals();var c=a.getContent($(this)),d=a.getPosition(c);c.css({top:d.y+"px",left:d.x+"px"}).fadeIn("slow")}),PubSub.subscribe(T1.constants.ON_DOC_CLICK,function(b,c){$(c.target).hasClass("modal-launcher")||0!==$(c.target).parents(".modal-container").length||a.hideOpenModals()})},getPosition:function(a){var b=$(window).width(),c=$(window).height(),d=a.outerWidth(),e=a.outerHeight(),f=(b-d)/2,g=(c-e)/2;return{x:f,y:g}},getContent:function(a){var b=$(".modal-container",a.closest("article"));return b},hideOpenModals:function(){var a=$(".modal-container");a.filter(":visible").find(".video-js").length>0&&PubSub.publish(T1.constants.VIDEO_STOP,{}),a.hide()},addCloseButton:function(){var b=a,c=$("<a/>").addClass("closelink").attr("href","#").css({position:"absolute",bottom:"-40px",right:"3px"}).html("Close ").append($("<i/>").addClass("icon-remove"));c.click(function(a){a.preventDefault(),b.hideOpenModals()}),$(".feature-cbv",this).append(c)},close:function(a){a.hide()}},b={init:a.init};return b}();var T1=T1||{};T1.carousel=function(){"use strict";var a={carouselId:"T1Carousel",carouselIndex:0,carouselClass:"carousel-container",carouselInnerClass:"carousel-inner",carouselExpanded:"expanded",carouselType:"slide",carouselInnerNode:null,youtubeUrl:"http://www.youtube.com/embed/<id>?rel=0&hd=1;autoplay=1;controls=0;modestbranding=1&wmode=opaque",init:function(){$("."+b.carouselClass).each(function(){b.initializeCarousel(this,$(this).data())}),b.initializeCarouselExpanders(),PubSub.subscribe(T1.constants.CAROUSEL_CREATE,b.buildCarousel),PubSub.subscribe(T1.constants.CAROUSEL_INITIALIZE,b.initializeCarousel),PubSub.subscribe(T1.constants.CAROUSEL_EXPAND,b.toggleExpand),b.animations.set(),$("body").on("keydown",b.captureKeys)},animations:{set:function(){for(var a in b.animations)"set"!==a&&b.animations[a].init&&b.animations[a].init()},fade:{init:function(){var a=$(".carousel.fade");!Modernizr.csstransitions&&a.length>0&&(a.find(".item").css({zoom:1,filter:"alpha(opacity=0)",opacity:0}),a.find(".item.active").css({zoom:1,filter:"alpha(opacity=100)",opacity:1}),a.on("slid.bs.carousel",function(){var a=$(this).find(".item.active");a.animate({opacity:1},500)}).on("slide.bs.carousel",function(){var a=$(this).find(".item.active");a.animate({opacity:0},500,function(){$(this).trigger("slid.bs.carousel")})}))}}},next:function(){$(".carousel-control.right").trigger("click")},previous:function(){$(".carousel-control.left").trigger("click")},captureKeys:function(a){if(a=window.event||a)switch(a.keyCode){case T1.constants.KEYCODE_LEFT:b.previous();break;case T1.constants.KEYCODE_RIGHT:b.next();break;case T1.constants.KEYCODE_ESC:b.hide()}},initializeCarousel:function(a,c){var d=$(a),e=c.enableswipe||!0;b.enableBTTracking({prev:d.find(".carousel-control.left"),next:d.find(".carousel-control.right"),indicators:d.find(".carousel-indicators li")}),c||(c={},c.interval=!1),d.carousel(c),b.animations.set(),e&&b.enableSwipe({carousel:d}),d.on("slid.bs.carousel",function(){PubSub.publish(T1.constants.CAROUSEL_SLIDE,{carousel:d})}),PubSub.publish(T1.constants.CAROUSEL_CREATED,d)},initializeCarouselExpanders:function(){$(".carousel-expander[data-carousel]").unbind("click",b.toggleExpand).click(function(a){var c=$(this);PubSub.publishSync(T1.constants.CAROUSEL_EXPAND,{expanded:!c.hasClass(b.carouselExpanded),expander:c,carousel:$(c.data("carousel")).find("."+b.carouselClass)}),a.preventDefault()})},toggleExpand:function(a,c){c.expander.toggleClass(b.carouselExpanded,c.expanded),c.carousel.toggleClass(b.carouselExpanded,c.expanded),c.carousel.hasClass(b.carouselExpanded)?(c.expander.text(T1.labels.viewLess),c.carousel.carousel("pause")):(c.expander.text(T1.labels.viewAll+" ("+c.expander.data("carousel-size")+")"),c.carousel.carousel("cycle"))},buildCarousel:function(a,c){c.id||b.carouselIndex++;var d=c.id?c.id:b.carouselId+b.carouselIndex,e=c.activeSlide||0,f=c.targetNode||$("body"),g=$("<div></div>").attr("id",d),h=$("<div></div>").addClass("carouselNav"),i=$("<a></a>").addClass("carousel-control left").attr("data-slide","prev").attr("data-target","#"+d),j=$("<a></a>").addClass("carousel-control right").attr("data-slide","next").attr("data-target","#"+d),k=c.enableswipe||!0,l=c.options||{};
g.addClass(b.carouselClass+" carousel "+(c.type?c.type:b.carouselType)),h.append(b.buildIndicators(c.slides.length,e,d)),g.append(b.buildCarouselSlideWrapper(c.slides,e)),j.append('<i class="icon-angle-right" data-icon="\f105"></i>'),i.append('<i class="icon-angle-left" data-icon="\f104"></i>'),h.append(i),h.append(j),g.append(h),f.append(g),b.enableBTTracking({prev:i,next:j,indicators:h.find("li")}),l.interval||(l.interval=!1),g.carousel(l),k&&b.enableSwipe({carousel:g}),g.on("slid.bs.carousel",function(){PubSub.publish(T1.constants.CAROUSEL_SLIDE,{carousel:g})}),PubSub.publish(T1.constants.CAROUSEL_CREATED,g)},buildIndicators:function(a,b,c){var d=$("<ol></ol>"),e=null,f=null;for(d.addClass("carousel-indicators"),f=0;a>f;f++)e=$("<li></li>").attr("data-target","#"+c).attr("data-slide-to",f.toString()).addClass(f===b?"active":""),d.append(e);return d},buildCarouselSlideWrapper:function(b,c){for(var d=a,e=null,f=$("<div/>").addClass(d.carouselInnerClass),g=null,h=null,i=null,j=0;j<b.length;j++){switch(g=$("<div></div>").addClass("item").addClass(j===c?"active":""),e=b[j],e.dataNode&&g.data("dataNode",e.dataNode),e.type){case"image":g.attr("data-type","image"),h=$("<img>"),i=e.isLazyLoad?{"data-lazy-load":e.src}:{src:e.src},h.attr(i),g.append(h);break;case"video":g.attr("data-type","video"),e.target=g,e.lazyLoadPoster=!0,j===c&&(e.autoplay=!0),PubSub.publishSync(T1.constants.VIDEO_CREATEPLAYER,e);break;case"iframe":g.attr("data-type","iframe"),h=$("<iframe></iframe>"),h.attr({"data-lazy-load":e.link,width:"100%",height:"100%",frameborder:"0"}),g.append(h);break;case"external-video":g.attr("data-type","external-video"),h=$("<iframe></iframe>"),h.attr({"data-lazy-load":d.youtubeUrl.replace(/<id>/gi,e.youtubeId),width:"100%",height:"100%",frameborder:"0"}),g.append(h);break;case"html":h=$(e.html),g.append(h)}f.append(g)}return d.carouselInnerNode=f,f},enableSwipe:function(a){var c="ontouchstart"in window||navigator.msMaxTouchPoints>0;if(a.carousel&&c){var d=$(a.carousel),e=a.prevFn||function(){d.carousel("prev")},f=a.nextFn||function(){d.carousel("next")};d.find("."+b.carouselInnerClass).swipe({swipeLeft:f,swipeRight:e,excludedElements:"button, input, select, textarea, .noSwipe"})}},enableBTTracking:function(b){b&&(b.next&&b.next.click(a.runBTEvent),b.prev&&b.prev.click(a.runBTEvent),b.indicators&&b.indicators.click(a.runBTEvent))},runBTEvent:function(){var a=this,b=function(){PubSub.publish(T1.constants.STATS_TRACK_CAROUSEL,{el:a})};setTimeout(b,T1.constants.ANIMATION_SPEED_FADE)}},b=a;return{init:a.init}}();var T1=T1||{};T1.carouselResponsive=function(){"use strict";var a={breakpoints:["lg","md","sm","xs"],currentBreakpoint:"xs",init:function(){var b=a;PubSub.subscribe(T1.constants.CAROUSEL_CREATERESPONSIVE,b.buildResponsiveCarousels),PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,b.rebuildResponsiveCarousels),b.buildResponsiveCarousels("init",{})},getCarouselData:function(b){if(b.container){var c=a,d=b.container.find(".responsive-item").get(),e=b.currentBreakpoint||c.currentBreakpoint||"xs",f=[],g=b.maxCols||12,h=b.container.parent().data(),i=0,j=0,k=0,l=$("<div></div>").addClass("container"),m=$("<div></div>").addClass("row"),n=null;for(i;i<d.length;i++)n=$(d[i]),n.hasClass("hide")||(k=c.getColumnSize({node:n,breakpoint:e}),j+=k,g>=j&&m.append(d[i]),j>=g&&(l.append(m),f.push({type:"html",html:l}),b.container.append(l),l=$("<div></div>").addClass("container"),m=$("<div></div>").addClass("row"),j>g?(m.append(d[i]),j=k):j=0));return 0!==j&&(l.append(m),f.push({type:"html",html:l}),b.container.append(l)),h.slides=f,h.targetNode=b.container,h}},rebuildResponsiveCarousels:function(b,c){var d=a;d.currentBreakpoint=c,d.buildResponsiveCarousels(b,{})},buildResponsiveCarousels:function(b,c){var d=a,e=c.container||$(".responsive-carousel");d.currentBreakpoint=c.breakpoint||d.currentBreakpoint||"xs",e.each(d.createCarousel)},getColumnSize:function(b){if(b.node){var c=a,d=b.breakpoint||c.currentBreakpoint||"xs",e=b.node.attr("class")||"",f=c.breakpoints.indexOf(d);for(f;f<c.breakpoints.length;f++)if(-1!==e.indexOf("col-"+c.breakpoints[f]))return parseInt(e.replace(new RegExp(".*col-"+c.breakpoints[f]+"-| .*","g"),""),10);return 12}},createCarousel:function(b,c){for(var d=a,e=$(c),f=e.find(".orig-data-copy"),g=e.find(".carousel-wrapper"),h=(e.find(".loader"),{display:"none"}),i={display:"block"},j=e.find(".carousel").hasClass("expanded"),k=e.attr("data-excluded-bps"),l=void 0!==k?k.split(","):[],m=!1,n=0;n<l.length;n++)if(d.currentBreakpoint===l[n]){m=!0;break}if(m===!1){g.css(h),g.children().remove(),0===f.length&&(f=$("<div></div>").addClass("orig-data-copy").append(e.children()),e.append(f)),0===g.length&&(g=$("<div></div>").addClass("carousel-wrapper"),e.append(g)),g.append(f.children().clone());var o=d.getCarouselData({container:g,maxCols:e.data("maxcols")});if(o.slides.length>1){PubSub.publishSync(T1.constants.CAROUSEL_CREATE,o);var p=g.find(".carousel");PubSub.publishSync(T1.constants.CAROUSEL_EXPAND,{expanded:j,expander:$('.carousel-expander[data-carousel="#'+e.attr("id")+'"]'),carousel:p})}g.css(i),f.hide(),g.show()}else f.show(),g.hide()}};return{init:a.init}}();var T1=T1||{};T1.ctaCC=function(){"use strict";var a={container:$("#ctaCC"),mainFocus:$("#mainfocus"),tolerance:0,buffers:{viewPort:null,expireDelay:null},breakpoints:{xs:T1.constants.SCREEN_XTRASMALL,sm:T1.constants.SCREEN_SMALL,md:T1.constants.SCREEN_MEDIUM,lg:T1.constants.SCREEN_LARGE},init:function(){b.container.size()&&"pc"==T1.statistics.getPlatform()&&PubSub.subscribe(c.ON_BREAKPOINT_CHANGE,b.breakpointChanged)},enable:function(){b.container.size()&&($(window).bind("scroll",b.checkViewPort),b.checkViewPort())},disable:function(){b.container.size()&&(b.clearBuffer("viewPort"),$(window).unbind("scroll",b.checkViewPort),b.container.hide())},resetPosition:function(){b.container.css({top:($(window).height()-b.container.outerHeight()+b.tolerance)/2})},breakpointChanged:function(a,d){b.resetTolerance(),b.breakpoints[d]>=c.SCREEN_LARGE?b.enable():b.disable()},resetTolerance:function(){b.tolerance=$("#nav-primary").height()+$("#nav-secondary-level").outerHeight()},checkViewPort:function(){b.buffers.viewPort||(b.buffers.viewPort=setTimeout(function(){T1.utilities.viewport.inView(b.mainFocus,b.tolerance)?b.container.fadeOut():b.container.is(":visible")?b.resetExpireDelay():(b.resetPosition(),b.container.fadeIn({complete:b.resetExpireDelay})),b.clearBuffer("viewPort")},300))},resetExpireDelay:function(){b.container.is(":visible")&&(b.clearBuffer("expireDelay"),b.buffers.expireDelay=setTimeout(function(){b.container.fadeOut(),b.clearBuffer("expireDelay")},3e3))},clearBuffer:function(a){clearTimeout(b.buffers[a]),b.buffers[a]=null}},b=a,c=T1.constants;return{init:a.init}}();var T1=T1||{};T1.accessories=function(){"use strict";var a={filters:$(".accessories-filter ul"),tokenLoadOverlayer:"",listState:"image-view",accessories:$(".accessories"),init:function(){var a=b.filters.find('input[type="checkbox"]'),c=b.accessories.find(".btn-group > a");b.isTrackingEnabled="object"==typeof window.t1DataLayer,b.accessories.removeClass("container"),b.filters.length>0&&(a.prop("checked",!0).trigger("change"),a.on("change",b.filterAccessories)),PubSub.subscribe(T1.constants.ACCESSORIES_INTERACTION_VIEWALL,b.viewAll),b.accessories.find(".filter-bar .viewall").on("click",function(){PubSub.publish(T1.constants.HASH_CHANGE,"/publish/ACCESSORIES_INTERACTION_VIEWALL/single=false")});var d=b.accessories.find(".switch-view");d.text(T1.labels.switchTo+" "+T1.labels.listView).append('<i class="icon-list-ul"></i>'),d.on("click",b.switchView),c.click(b.switchTab),0===c.filter(".active").length&&b.switchTab({target:c.eq(0)}),PubSub.subscribe(T1.constants.CAROUSEL_SLIDE,b.onCarouselSlide),PubSub.subscribe(T1.constants.CAROUSEL_CREATED,b.onCarouselCreated),b.accessories.find(".btn-disclaimer").on("click",b.ovlDisclaimerClick),b.accessories.find(".inline-disclaimer .toggleLink").on("click",b.inlineDisclaimerClick)},onCarouselCreated:function(a,c){c.is(b.accessories.find(".carousel.slide"))&&c.find(".item.active .btn-disclaimer").on("click",b.ovlDisclaimerClick)},onCarouselSlide:function(a,c){c.carousel.is(b.accessories.find(".carousel.slide"))&&c.carousel.find(".item.active .btn-disclaimer").on("click",b.ovlDisclaimerClick)},ovlDisclaimerClick:function(a){a.preventDefault();var b=$(this).closest(".expansion-content"),c=b.find(".ovl-disclaimer"),d=c.is(":visible")?-c.height():c.height();c.slideToggle(),b.hasClass("top")&&b.animate({top:b.offset().top-d})},inlineDisclaimerClick:function(a){a.preventDefault(),$(this).closest(".inline-disclaimer").find(".disclaimer-content").slideToggle()},switchTab:function(a){var c=$(a.target),d=$(c.prop("hash"));if(c.addClass("active"),a.preventDefault&&a.preventDefault(),b.inOverlayer(c)){var e=$(".overlayerContent").last(),f=e.find(a.target.hash),g=$(a.target);g.removeClass("active"),PubSub.publish(T1.constants.STATS_TRACK,{node:g}),e.scrollTo(f,T1.constants.ANIMATION_SPEED_SCROLL),a.stopPropagation()}else b.accessories.find("> .tab-content > .tab-pane").css({display:"none"}),d.fadeIn(T1.constants.ANIMATION_SPEED_FADE)},inOverlayer:function(a){return a.closest("section").hasClass("view-all")},filterAccessories:function(a){var c=$(a.target),d=c.closest(".tab-pane"),e=c.prop("checked"),f=d.find('input[type="checkbox"]'),g=f.filter(":checked"),h=d.find(".accessories-item");if("all"===c.val().toLowerCase())h[e?"removeClass":"addClass"]("hide");else{h.addClass("hide");var i=null,j="";g.each(function(a,b){j=$(b).val().toLowerCase(),h.each(function(a,b){i=$(b),-1!==i.data("filter").toLowerCase().indexOf(j)&&i.removeClass("hide")})})}b.inOverlayer(c)||PubSub.publishSync(T1.constants.CAROUSEL_CREATERESPONSIVE,{container:d.find("> .responsive-carousel")})},viewAll:function(){var a=b.accessories.clone(!0);a.addClass("container view-all"),a.find(".container").removeClass("container"),a.find(".viewall").remove(),a.find(".carousel-wrapper").remove(),a.find(".responsive-carousel").removeClass("responsive-carousel"),a.find(".tab-pane").css({display:"inline-block"}),a.find(".filter-bar > .btn-group > a").removeClass("active"),a.find(".orig-data-copy").show(),a.find("form, .form").each(function(){PubSub.publish(T1.constants.FORM_LOAD,$(this))}),PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{html:a,el:b.accessories,styleClass:"accessories-all"})},switchView:function(a){var c=$(a.target).closest("section").find(".accessories-item"),d="image-view"===b.listState;c.removeClass(d?"col-sm-3":"col-sm-6").addClass(d?"col-sm-6":"col-sm-3"),c.each(function(){var a=$(".row > div",this);if(a.length>0)d?(a.eq(0).removeClass("col-xs-12").addClass("col-xs-3"),a.eq(1).removeClass("col-xs-12").addClass("col-xs-9")):(a.eq(0).addClass("col-xs-12").removeClass("col-xs-3"),a.eq(1).addClass("col-xs-12").removeClass("col-xs-9"));else{var b=$(".list-unstyled",this);b.length>0&&(d?$("li",b).eq(0).addClass("col-xs-3"):$("li",b).eq(0).removeClass("col-xs-3"))}}),$(this).text(T1.labels.switchTo+" "+T1.labels[d?"imageView":"listView"]).append('<i class="'+(d?"icon-th-large":"icon-list-ul")+'"></i>'),b.listState=d?"list-view":"image-view",b.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:$(this),extraData:{action:"switch_view",value:d?"list":"images"}})}},b=a;return{init:a.init}}();var T1=T1||{};T1.gallery=function(){"use strict";var a={mainContainer:$(".gallery-horizontal"),rows:null,lastHeight:0,highestHeight:0,isIE8:T1.utilities.ieVersion()<=8,mobileIdSeq:0,IE8:{drag:!1,startPoint:0,moved:!1,lastX:0,arrowInterval:200,lastNode:null,lastDate:(new Date).getTime(),on:function(){},options:{}},scrollSettings:{scrollX:!0,scrollY:!1,momentum:!0,eventPassthrough:!0},isIpad:T1.utilities.isIOS(),initDesktop:function(){var b=a;b.initSources(b.mainContainer,"desktop"),b.mainContainer.css({display:"block"}),b.mainContainer.addClass("hidden-xs"),$("#pagecontent").css({display:"block"}),b.mainContainer.css("visibility","visible"),b.mainContainer.on("dragstart",function(){return!1}),b.rows=$(".gallery-horizontal-row",b.mainContainer),b.rows.each(b.loadRow);for(var c=0;c<b.mainContainer.length;c++){var d=$(b.mainContainer[c]).attr("data-highest-height");$(b.mainContainer[c]).find(".gallery-item").css("height",d)}var e=$(".gallery-item .item-content").height();$(".gallery-item .item-content").css("padding-bottom",e-40),b.isIE8&&b.fixIe8(),T1.utilities.isIpad&&(a.scrollSettings.momentum=!1),$(".item-content").length>0&&$(".item-content *").attr("unslectable","on"),b.mainContainer.each(function(){PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$(this)})})},switchDesktop:function(){var b=a,c=b.mainContainer.closest("section");c.addClass("gallery-horizontal")},initMobile:function(){var b=a,c=b.mainContainer.closest("section");c.each(b.buildMobileThumbGrid)},switchMobile:function(){var b=a,c=b.mainContainer.closest("section");c.removeClass("gallery-horizontal")},initSources:function(a,b){var c=a.find("img"),d=function(a,c){var d=$(c),e=d.data("src-"+b);e&&d.attr("src",e)};c.each(d)},buildMobileThumbGrid:function(b,c){var d=a,e=$(c),f=e.find(".mobile.gallery");if(0===f.length){f=$("<div></div>").addClass("mobile gallery container visible-xs");var g=($("<h1>"+(e.data("section-title")||"Gallery")+"</h1>").appendTo(f),$("<div></div>").addClass("row")),h=$("<div></div>").addClass("col-xs-12 thumbnail-grid"),i=e.find(".gallery-item"),j=function(a,b){var c=$(b);if(c.find("img").data("src-mobile")){var d=c.clone(),e=c.hasClass("item-link")?d:d.find(".item-link"),f=e.attr("id");f&&e.attr("id","mobile_"+f),d.attr("style",""),d.find("img").removeAttr("width").removeAttr("height"),d.find(".item-content").css({display:"none"}),e.click(function(b){b.preventDefault(),PubSub.publish(T1.constants.HASH_ADD,"/gallery/"+f+"/"+a)}),h.append(d)}};i.each(j),g.append(h),f.append(g),e.append(f),d.initSources(f,"mobile")}var k=PubSub.subscribe(T1.constants.ON_WIN_RESIZE,d.resizeMobileGrid),l=PubSub.subscribe(T1.constants.PAGEOVERLAYER_REOPEN_MAINCONTENT,function(){PubSub.unsubscribe(k),PubSub.unsubscribe(l)});d.resizeMobileGrid("init mobile grid")},resizeMobileGrid:function(){var a=$(window),b=$(".thumbnail-grid"),c=b.find(".gallery-item:first").width()||78;b.css({width:Math.floor(a.width()/c)*c})},fixIe8:function(){var b=a,c=($(document),$(".gallery")),d=function(a){var c=(new Date).getTime();if(a.delta||!(c-b.IE8.lastDate<100)){var d=a.delta||a.pageX-b.IE8.lastX,e=b.IE8.lastNode,f=e.offset().left+d,g=-(e[0].scrollWidth-$(window).width());b.IE8.lastDate=c,b.IE8.lastX=a.pageX,d>10&&(b.IE8.hasMooved=!0),f>0&&(f=0),g>f&&(f=g),e.css({"margin-left":f+"px"}),$(".left",e).css("margin-left",Math.abs(f)+"px")}},e=function(a){b.IE8.lastNode=$(this).closest(".gallery-horizontal-row"),a.delta=b.IE8.arrowInterval,d(a)},f=function(a){b.IE8.lastNode=$(this).closest(".gallery-horizontal-row"),a.delta=-b.IE8.arrowInterval,d(a)},g=function(a){b.IE8.drag=!1,Math.abs(b.IE8.startPoint-a.pageX)>10&&(PubSub.publish(T1.constants.GALLERY_SCROLL,this),b.IE8.moved=!0)},h=function(a){b.IE8.drag=!0,b.IE8.lastX=a.pageX,b.IE8.startPoint=a.pageX,b.IE8.lastNode=$(this),b.IE8.moved=!1},i=function(a){b.IE8.drag&&d(a)};b.rows.mousedown(h),c.find(".gallery-nav-arrow.left").click(e),c.find(".gallery-nav-arrow.right").click(f),c.mouseup(g),c.mousemove(i)},loadRow:function(b,c){var d=a,e=$(this),f=a.addControls();e.append(f);var g=$("<div/>").addClass("iscroller"),h=a.getRowHeight(e);e.height(h.height),g.width(h.width);var i=$(".gallery-horizontal-row-inner",this);i.wrap(g);var j=d.isIE8?d.IE8:new IScroll(c,d.scrollSettings);j.options.tap=!0,d.checkBoundaries(".iscroller",e,j),PubSub.subscribe(T1.constants.ON_WIN_RESIZE,function(){"function"==typeof j.refresh&&j.refresh()}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_CLOSED,function(){$(window).trigger("resize")}),j.on("scrollStart",function(){$(".gallery-horizontal-row-inner a",e).css("cursor","move"),e.css("cursor","move")}),j.on("scrollEnd",function(){PubSub.publish(T1.constants.GALLERY_SCROLL,this.wrapper),$(".gallery-horizontal-row-inner a",e).css("cursor","pointer"),e.css("cursor","default"),d.checkBoundaries(".iscroller",e,j)}),e.data("iscroll",j);var k=d.isIOS?"touchend":"click";$("a",i).on(k,function(a){if(a.preventDefault(),j.moved)a.stopPropagation();else{var b=$(this).hasClass("gallery-item")?$(this):$(this).closest(".gallery-item");location.hash="/gallery/"+this.id+"/"+$(this).closest(".gallery").find(".gallery-item").index(b)}}),d.isIE8||a.loadNavigation(e)},checkBoundaries:function(a,b,c){0===$(a,b).position().left?$(".left",b).addClass("inactive"):$(".left",b).removeClass("inactive"),$(a,b).position().left===c.maxScrollX?$(".right",b).addClass("inactive"):$(".right",b).removeClass("inactive")},getRowHeight:function(b){var c=0,d=0,e=a;return $(".gallery-item",b).each(function(){var a=$("img",this).width();$(this).width(a);var f=$(this).height(),g=$(this).width();f>c&&(c=f),d+=g;var h=b.closest(".gallery"),i=h.attr("data-highest-height")?h.attr("data-highest-height"):0;c>i&&h.attr("data-highest-height",c),c>e.highestHeight&&(e.highestHeight=c)}),{height:c,width:d}},addControls:function(){{var a=$("<div/>").addClass("navigation-arrows");$("<a/>").addClass("gallery-nav-arrow left").append($("<span/>").addClass("icon-angle-left").attr("data-icon","\f104")).appendTo(a),$("<a/>").addClass("gallery-nav-arrow right").append($("<span/>").addClass("icon-angle-right").attr("data-icon","\f104")).appendTo(a)}return a},loadNavigation:function(b){var c=a,d=$("a.left",b),e=$("a.right",b),f=this,g=c.isIOS?"touchend":"click";d.on(g,function(){$(this).is(".inactive")||f.goTo(b,!0)}),e.on(g,function(){$(this).is(".inactive")||f.goTo(b,!1)})},goTo:function(a,b){b="undefined"==typeof b?!1:b;var c,d=this,e=a.data("iscroll"),f=$(".gallery-item",a),g=0,h=0;f.each(function(a,b){return d.inViewPort(b)?(c=b,!1):void 0});var i=b?$(c).prev():$(c).next();0===i.length?(g=i.width(),h=g):(g=i.position(),h=g.left+1),e.scrollTo(-h,0,500)},inViewPort:function(a){var b=$(window),c=$(a),d={top:b.scrollTop(),left:b.scrollLeft()};d.right=d.left+b.width(),d.bottom=d.top+b.height();var e=c.offset();return e.right=e.left+c.outerWidth(),e.bottom=e.top+c.outerHeight(),!(d.right<e.left||d.left>e.right||d.bottom<e.top||d.top>e.bottom)}},b={initDesktop:a.initDesktop,initMobile:a.initMobile,switchMobile:a.switchMobile,switchDesktop:a.switchDesktop,scroll:a.iscrollObj};return b}();var T1=T1||{};T1.otherfeatures=function(){"use strict";var a={section:$(".otherfeatures"),container:$(".fc-group-container"),controls:$(".fb-group .fb-item"),toggleButton:$(".fb-toggle",".fb-group"),otherFeaturesClass:"otherfeatures",featureGroup:null,inOverlayer:!1,tokenCloseAllFeatures:null,feature:$(".feature"),onlyHybrid:null,initDesktop:function(){var b=a;b.onlyHybrid=b.section.hasClass("hybrid-only"),PubSub.subscribe(T1.constants.OTHER_FEATURES_SHOWALL,b.openAllFeatures),b.controls.click(b.tabControlClick),b.toggleButton.click(b.toggleClick);var c=function(){var a=$(this).parent().prev(".modal-container");PubSub.publish(T1.constants.FIGURE_LOAD,a)};$(".icon-play.modal-launcher").click(c),PubSub.subscribe(T1.constants.ON_DOC_CLICK),b.controls.length>1&&b.tabControlClick({target:b.controls.eq(0)}),$(a.featureGroup).is("hybrid-only")&&b.toggleClick({target:b.toggleButton}),a.onlyHybrid&&a.filterHybrid(!0)},tabControlClick:function(b){var c=a,d=$(b.target),e=d.data("section-filter");return".fc-group"===e?(window.location.hash=d.attr("href"),!1):(b.preventDefault&&b.preventDefault(),c.controls.removeClass("active"),c.inOverlayer||d.addClass("active"),c.featureGroup=e,c.hideAll(),c.showOne(c.featureGroup),void 0)},toggleClick:function(b){var c=a,d=$(b.target),e=d.closest("section");b.preventDefault&&b.preventDefault(),d.toggleClass("btn-grey").toggleClass("btn-blue"),d.toggleClass("activated").toggleClass("inactivated"),d.is(".activated")?(e.attr("data-bt-state","hybrid"),d.text(d.attr("data-viewnonhybrid"))):(e.attr("data-bt-state","nonhybrid"),d.text(d.attr("data-viewhybrid"))),c.filterHybrid(d.is(".activated"))},switchDesktop:function(){var b=a;b.feature.find(".read-more-container a").removeClass("listed-feature").addClass("readMore"),b.feature.off("click",b.openFeature)},switchMobile:function(){var b=a;b.feature.find(".read-more-container a").removeClass("readMore").addClass("listed-feature"),b.feature.on("click touchstart",b.openFeature)},openFeature:function(a){a.preventDefault();var b=$(a.target).closest("article");$(".expansion-feature").slideUp().prev(".feature").find(".read-more-container a").removeClass("open-state"),b.next(".expansion-feature").is(":visible")||b.next(".expansion-feature").slideDown().prev(".feature").find(".read-more-container a").addClass("open-state")},filterHybrid:function(a){a="undefined"==typeof a?!1:a,a?$(".fc-group-content").hide().filter(".hybrid").fadeIn(1e3):$(".fc-group-content").hide().not(".hybrid").fadeIn(1e3)},hideAll:function(){var b=a;b.inOverlayer||b.container.children().hide()},showOne:function(b){var c=a;c.inOverlayer?$(".overlayerContent").animate({scrollTop:$(".overlayerContent").find(b).offset().top-30},"slow"):$(b,a.container).eq(0).fadeIn(1e3)},openAllFeatures:function(){PubSub.publishSync(T1.constants.VIDEO_RESET,{});var b=a,c=$("<div/>").addClass("allfeatures"),d=$("<div/>").addClass("container").addClass("otherfeatures"),e=$("."+b.otherFeaturesClass).clone(!0),f=e.attr("data-section-title");d.append(e),c.append(d),e.find("a[data-section-filter='.fc-group']").remove(),e.find(".fc-group").css({display:"inline-block",opacity:1}),b.container=e.find(".fc-group-container"),b.controls=e.find(".fb-item",".fb-group"),b.controls.filter(".active").removeClass("active"),PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{html:c,styleClass:"otherFeaturesOverlayer",pageName:f}),b.inOverlayer=!0,b.tokenCloseAllFeatures=PubSub.subscribe(T1.constants.PAGEOVERLAYER_REOPEN_MAINCONTENT,b.closeAllFeatures)},closeAllFeatures:function(){var b=a;b.container=$(".fc-group-container"),b.controls=$(".fb-item",".fb-group"),b.inOverlayer=!1,b.controls.length>1&&b.controls.eq(0).trigger("click"),PubSub.unsubscribe(b.tokenCloseAllFeatures)}},b={initDesktop:a.initDesktop,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile,featureGroup:a.featureGroup};return b}();var T1=T1||{};T1.readMore=function(){"use strict";var a={lastPlaceRef:null,lastExpanded:null,lastActiveButton:null,isOpen:!1,lastOpenedToolTip:null,isMobile:!1,inOverlayer:!1,menuHeight:null,pubsubHideToken:null,pubsubReadMoreToken:null,closestCarousel:"",init:function(){var b=a;$("body").on("tap click",".expansion-content .closelink",function(a){a.preventDefault()}),$("body").on("tap click",".readMore",function(a){a.preventDefault(),PubSub.publish(T1.constants.READMORE_SHOW,{target:$(this),e:a})}),b.pubsubReadMoreToken=PubSub.subscribe(T1.constants.READMORE_SHOW,b.show),b.pubsubHideToken=PubSub.subscribe(T1.constants.ON_DOC_CLICK,b.hideAll),PubSub.subscribe(T1.constants.READMORE_HIDE_SELECTED,b.readMoreHideSelected)},switchDesktop:function(){a.isMobile=!1},switchMobile:function(){a.isMobile=!0},show:function(b,c){var d=a,e=c.target||$(".readMore"),f=e.closest(".container"),g=$(window);d.menuHeight||(d.menuHeight=$("#nav-primary").height()),d.inOverlayer=e.parents(".overlayerWrapper").length>0;var h=d.inOverlayer?".overlayerContent":"body",i=f.find(e.attr("data-tooltip-selector")).last().appendTo(h),j=i.height()+10,k=e.offset(),l=e.closest(".carousel");if(a.isMobile){null!==d.lastExpanded&&d.hideAll("byHand",{target:d.lastExpanded}),d.isOpen=!0;var m=i.html(),n=i.height(),o=$("<div/>").addClass("mobile-expansion expansion-content").html(m).prependTo($("body")).height(0);$(".expansion-arrow",o).remove(),o.animate({height:n+"px"},T1.constants.ANIMATION_SPEED_FADE),d.lastExpanded=i,d.lastActiveButton=e,d.lastPlaceRef=e.parent(),e.toggleClass("active-state"),PubSub.unsubscribe(d.pubsubHideToken),PubSub.unsubscribe(d.pubsubReadMoreToken);{setTimeout(function(){d.pubsubHideToken=PubSub.subscribe(T1.constants.ON_DOC_CLICK,d.hideAll),d.pubsubReadMoreToken=PubSub.subscribe(T1.constants.READMORE_SHOW,d.show)},500)}}else{d.inOverlayer?(k.left-=i.closest(".overlayerContent").offset().left,i.addClass("expansion-pageovelayer-content")):i.removeClass("expansion-pageovelayer-content"),d.hideAll("showReadMore",{target:d.lastPlaceRef}),i.attr("style","display: block"),i.removeClass("top bottom left right"),d.lastExpanded=i,0===f.length&&(f=g);var p=f.offset();p||(p={left:0,top:0});var q=(k.top-j<g.scrollTop()+d.menuHeight?"bottom":"top")+" "+(p.left+f.width()>k.left+i.width()||f.width()<i.width()?"right":"left");i.addClass(q);var r=-1!==q.indexOf("bottom")?k.top+e.height()+5:k.top-j-5,s=-1!==q.indexOf("right")?k.left:k.left+e.width()-i.width();d.inOverlayer&&(r+=$(h).scrollTop()),i.css({top:r,left:s}),l.length>0&&(l.carousel("pause"),d.closestCarousel=l),d.lastActiveButton&&d.lastActiveButton.removeClass("active-state"),d.lastPlaceRef=e.parent(),d.lastOpenedToolTip=i,e.toggleClass("active-state"),d.lastActiveButton=e,d.isOpen=!0,setTimeout(function(){i.addClass("active")},1)}},hideAll:function(b,c){if(a.isOpen===!0){var d=$(c.target);if(!(d.parent().hasClass("readMore")||d.hasClass("readMore")||d.parents().hasClass("expansion-inner")&&!d.hasClass("closelink"))){if(a.isMobile)a.hideMobile(c.animation);else{var e=a.lastOpenedToolTip;e.removeClass("active")}PubSub.publish(T1.constants.READMORE_HIDE,{target:d}),a.lastExpanded.attr("style",""),a.lastPlaceRef&&a.lastPlaceRef.after(a.lastExpanded),a.closestCarousel.length>0&&a.closestCarousel.carousel("cycle"),a.lastActiveButton.toggleClass("active-state"),a.isOpen=!1}}},hideMobile:function(){$(".mobile-expansion").animate({height:0},T1.constants.ANIMATION_SPEED_FADE,function(){$(this).remove()})},readMoreHideSelected:function(b,c){a.isOpen!==!0||a.isMobile||a.hideAll("byHand",c)}};return{init:a.init,switchMobile:a.switchMobile,switchDesktop:a.switchDesktop}}();var T1=T1||{};T1.skrollr=function(){"use strict";var a={initDesktop:function(){location.hash.indexOf("disableSkrollr")>-1||!Modernizr.touch&&T1.utilities.ieVersion()>8&&(PubSub.subscribe(T1.constants.SKROLLR_REFRESH,a.refreshSkrollr),skrollr.init({forceHeight:!1,smoothScrolling:!1,edgeStrategy:"ease",easing:"quadratic"}))},refreshSkrollr:function(){var a=skrollr.get();a&&a.refresh()}};return{initDesktop:a.initDesktop}}();var T1=T1||{};T1.article=function(){"use strict";var a={init:function(){a.setVideoButton(),a.setAjaxRequest(),a.setIFrameContent()},setVideoButton:function(){var a=$(".sprite-videoplayer-start-button");a.on("click",function(){var a=$(this),b=a.data("youtubeid")||a.data("video");location.hash="/youtube/"+b.replace(/(.*v=|&.*)|(.*embed\/|\?.*)/g,"")})},setAjaxRequest:function(){var a=$("#articleAjax");a.on("click",function(a){location.hash="/ajax/"+this.id,location.hash&&a.preventDefault()})},setIFrameContent:function(){var a=$("#articleIFrame");a.on("click",function(a){location.hash="/iframe/"+encodeURIComponent($(this).prop("href")),location.hash&&a.preventDefault()})}},b={init:a.init};return b}();var T1=T1||{};T1.topfeatures=function(){"use strict";var a={CLASS_BUTTON_HYBRID:"btn-hybrid-view",CLASS_MODE_HYBRID:"secondary-content-active",initDesktop:function(){$(".topfeature").length>0&&a.setupHybrid()},setupHybrid:function(){var b=600,c=400,d=function(a,d){a.animate({opacity:0},b,function(){d(a),a.animate({opacity:1},c)})},e=function(b){var c="",e=b.attr("data-hybrid");b.is("header[data-hybrid]")?(c=b.css("background-image"),b.attr("data-hybrid",c),d(b,function(a){a.css("background-image",e)})):b.is("h2[data-hybrid]")||b.is(".topfeature-description p")?(c=b.text(),b.attr("data-hybrid",c),d(b,function(a){a.text(e)})):b.is("."+a.CLASS_BUTTON_HYBRID)&&(c=b.text(),b.attr("data-hybrid",c),b.text(e).toggleClass("btn-blue").toggleClass("btn-grey"))};$(".topfeature:has(header[data-hybrid],h2[data-hybrid])").each(function(){var d=$(this),f=d.find("header[data-hybrid]"),g=d.find("h2[data-hybrid]"),h=d.find(".topfeature-description p"),i=d.find("."+a.CLASS_BUTTON_HYBRID),j=function(i){i.preventDefault();var j=$(i.target);j.attr("data-bt-state",j.hasClass("btn-blue")?"hybrid":"nonhybrid");var k=$(this);setTimeout(function(){e(k)},b+c),d.toggleClass(a.CLASS_MODE_HYBRID),e(f),e(g),e(h)};j=_.throttle(j,c+b),i.click(j)})},setHybridState:function(a){a.preventDefault();var b=$(a.target);b.attr("data-bt-state",b.hasClass("btn-blue")?"hybrid":"nonhybrid")}};return{initDesktop:a.initDesktop}}();var T1=T1||{};T1.engineCompare=function(){"use strict";var a={engineNodesMainContainer:$(".compare-equipment"),allCompare:$(".compare-button"),compareButtons:null,compareCheckboxes:null,selectedEngines:[],engines:[],engineImages:{},engineTitles:{},enginePayments:{},fuelTypes:{},overlayContent:null,gridContainer:null,controlContainer:null,editSelect:null,filterContainer:null,changeCompareMenu:null,data:null,titles:{},bodyTypes:null,currentBodyType:null,currentFuelType:!1,modal:null,pageName:$(".enginecompare").attr("data-section-title"),hidePrices:null,minWarningText:null,maxWarningText:null,exceptionsLegendId:"engines-exceptions-legend",initDesktop:function(){a.hidePrices="true"===T1.settings.hidePrices,0!==a.engineNodesMainContainer.length&&(a.isTrackingEnabled="object"==typeof window.t1DataLayer,a.minWarningText=T1.labels.comparator.compareMinEng,a.maxWarningText=T1.labels.comparator.compareMaxEng,a.compareButtons=$(".compare-btn",a.engineNodesMainContainer),a.compareCheckboxes=$(".compare-check",a.engineNodesMainContainer),a.overlayContent=$(".compare-data"),a.gridContainer=$(".ec-grid-container",a.overlayContent),a.controlContainer=$(".compare-top-controls",a.overlayContent),a.editSelect=$(".engine-model-options",a.overlayContent),a.filterContainer=$(".other-options",a.overlayContent),a.compareButtons.on("click",a.onCompareBtnClick),a.allCompare.on("click",a.onAllCompare),a.compareCheckboxes.prop("checked",!1),a.getData(),PubSub.subscribe(T1.constants.ENGINE_COMPARE_CHANGE,function(){a.compareCheckboxes.prop("checked",!1),a.compareButtons.removeClass("btn-dark");for(var b=0;b<a.selectedEngines.length;b++){var c=a.selectedEngines[b];$("input[data-engine-select-type='"+c+"']").prop("checked",!0).parent().addClass("btn-dark")}a.compareCheckboxes.trigger("change")}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_OPEN,function(){$(".overlayerWrapper").is(".compare-overlay-wrapper")&&$(".compare-data",".compare-overlay-wrapper").length>0&&null===a.modal&&(a.modal=$("<div/>").addClass("ec-select-modal").css("width",$(window).width()+"px").hide().prependTo($(".overlayerContent")),a.modal.on("click",a.onJustCloseClick))}),PubSub.subscribe(T1.constants.ON_WIN_RESIZE,function(){var a=$(window).width()-15;$(".ec-select-modal").css("width",a+"px")}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_CLOSED,function(){null!==a.modal&&a.modal.remove(),a.overlayContent.find(".scrollcontainer").remove()}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_RESIZE,a.setScrollContainerSize),PubSub.subscribe(T1.constants.ENGINE_COMPARE_PRINT,a.print),a.compareCheckboxes.slice(0,3).prop("checked",!0).trigger("change"),a.compareButtons.slice(0,3).removeClass("btn-grey").addClass("btn-dark"),a.compareCheckboxes.on("change",a.onCheckboxChange))},print:function(){PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{url:decodeURIComponent($("#enginecompare").data("print-url")),ajax:!0,styleClass:"print-overlay-wrapper",pageName:a.pageName});var b=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,function(c,d){$(d.el).find("#printEnginesCompare")&&(a.loadPrintContent(),window.print(),PubSub.unsubscribe(b))})},loadPrintContent:function(){var a=$(".compare-data").children().clone(),b=a.find("#panelGroup-engines"),c=$("#printEnginesCompare");a.find(".filter-holder, .selection-trigger-holder, .icon-remove-container, .buttonrow, .mini-edit-selection-menu, td[data-filtered=false]").remove(),a.find("i.exceptions").each(function(a,c){var d=$(c),e="(*"+(a+1)+") "+d.closest("tr").find("td:first()").text(),f=$('<div id="exceptionsPanel-'+a+'" class="exceptions panel panel-default"><div class="panel-heading"><h4><b>'+e+'</b></h4></div><div id="mc_pane-exceptions'+a+'" class="panel-collapse collapse"></div></div>'),g=$(d.attr("data-tooltip-selector")).find(".expansion-inner").clone();
d.text(d.text()+" (*"+(a+1)+")"),g.find(".row > div").attr("class","").addClass("col-lg-6 col-md-6 col-sm-6"),f.find(".panel-collapse").addClass("exceptions-panel").append(g.children(".row")),f.appendTo(b)}),a.find(".expansion-content").remove(),a.appendTo(c),c.find(".section-title").prepend(("<h4>"+T1.labels.comparator.printDate+"</h4>").replace("{date}",globalize.format(new Date,"F"))).prepend($('<img class="logo"/>').attr("src",c.attr("data-logo-url")))},onCompareBtnClick:function(a){a.preventDefault();var b=$("input",$(this).parent());b.trigger("change")},onAllCompare:function(){$(this).trigger("blur"),a.renderTable(),PubSub.publish(T1.constants.HASH_CHANGE,"/publish/pageoverlayer_open/html=.compare-data/preserveContent=true/styleClass=compare-overlay-wrapper/pageName="+a.pageName)},renderTable:function(){a.selectedEngines=[];for(var b=0;b<a.compareCheckboxes.length;b++)a.compareCheckboxes.get(b).checked&&(a.selectedEngines.push(a.compareCheckboxes.eq(b).attr("data-engine-select-type")),a.sortSelectedEngines());a.filterColumns(),a.generateSelectionControls()},onEditSelection:function(){a.filterColumns(),a.generateSelectionControls()},onCheckboxChange:function(b){var c=$(this).parent();a.extendCheckboxChange(a,c,$(this),b)},extendCheckboxChange:function(b,c,d,e){if(d.is(":checked")){if(!a.checkCompareSize(b))return PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$("body"),customText:b.maxWarningText,timeout:2e3,centerScreen:!0}),d.prop("checked",!1).trigger("change"),void e.preventDefault();c.removeClass("btn-grey").addClass("btn-dark")}else{if(!a.checkCompareMinSize(b))return PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$("body"),customText:b.minWarningText,timeout:2e3,centerScreen:!0}),d.prop("checked",!0).trigger("change"),void e.preventDefault();c.removeClass("btn-dark").addClass("btn-grey")}},sortSelectedEngines:function(){a.selectedEngines.sort(function(b,c){var d=a.engines.indexOf(b),e=a.engines.indexOf(c);return d>e?1:-1})},checkCompareSize:function(a){var b=a.compareCheckboxes.filter(":checked").length;return 3>=b},checkCompareMinSize:function(a){var b=a.compareCheckboxes.filter(":checked").length;return b>1},getData:function(){var b=$(".car-model").data("car-model");$.getJSON("/api/cardb/enginecompare/"+b,a.onGetData)},onGetData:function(b){0!==b.length&&(a.data=b,a.generateHTML())},generateHTML:function(){a.generateIndexes(),a.addCollapsePanels()},generateIndexes:function(){a.bodyTypes=a.data.bodyTypes,a.fuelTypes=a.data.fuelTypes,a.fuelTypes.unshift({code:!1,name:T1.labels.viewAll}),a.currentBodyType=a.bodyTypes[0].code;for(var b in a.data.engines[0].bodyTypes[a.currentBodyType]){var c=a.data.engines[0].bodyTypes[a.currentBodyType][b];a.titles[b]=[];for(var d=0;d<c.items.length;d++)a.titles[b].push({name:c.items[d].name,id:c.items[d].id})}for(var e=0;e<a.data.engines.length;e++){a.engines.push(a.data.engines[e].code);var f=null;a.data.engines[e].images&&(f=a.data.engines[e].images["IMG_TECH-GUIDE_91x91"]),a.engineImages[a.data.engines[e].code]={img:f,title:a.data.engines[e].title,hybrid:a.data.engines[e].isHybrid?a.data.engines[e].isHybrid:!1,fuelType:a.data.engines[e].fuel},a.enginePayments[a.data.engines[e].code]=a.data.engines[e].payments}a.addFilters()},addFilters:function(){var b=$("<div/>").addClass("filter-holder").appendTo(a.filterContainer),c=$("<div/>").addClass("body-type-filter").appendTo(b).addClass("darker"),d=$("<div/>").addClass("fuel-filter").appendTo(b).addClass("darker"),e=$("<div/>").addClass("legend-holder").appendTo(b),f=a.getExpansionContainer(a.exceptionsLegendId).appendTo(e);a.isTrackingEnabled&&(c.attr({"data-bt-action":"click_function","data-bt-value":"change_bodytype"}),d.attr({"data-bt-action":"filter_engine"})),$("<h5/>").text(T1.labels.comparator.chooseBodytype+":").appendTo(c),$("<h5/>").text(T1.labels.comparator.chooseFuel+":").appendTo(d);var g=$("<div/>",{"class":"dropdown","data-select":"bodytype"}),h=$("<a/>",{"class":"dropdown-toggle",href:"#","data-validation":"select","data-toggle":"dropdown",role:"button"}).append("<span>Please select</span><i class='icon-chevron-down'></i>"),i=$("<ul/>",{"class":"dropdown-menu",role:"menu"});if(a.bodyTypes.length>2){g.append(h).append(i).appendTo(c);for(var j in a.bodyTypes)a.addDropDownItem(a.bodyTypes[j].name,a.bodyTypes[j].code,i,c,a.onBodyFilterChange,a.currentBodyType)}else for(var k in a.bodyTypes)a.addRadioButton(a.bodyTypes[k].name,a.bodyTypes[k].code,c,"body-type-label","ec-body-type-radio","ec-filter-body-type",a.onBodyFilterChange,a.currentBodyType,a.isTrackingEnabled?{"data-bt-track":""}:null);for(var l=0;l<a.fuelTypes.length;l++){var m;switch(a.fuelTypes[l].code){case!1:m="all";break;case"1":m="fuel";break;case"2":m="diesel";break;case"h_1":m="hybrid";break;default:m=a.fuelTypes[l].name}a.addRadioButton(a.fuelTypes[l].name,a.fuelTypes[l].code,d,"fuel-type-label","ec-fuel-type-radio","filter-fuel-type",a.onFuelFilterTypeChange,!1,a.isTrackingEnabled?{"data-bt-value":m,"data-bt-track":""}:null)}$("<span/>").attr("data-tooltip-selector","#"+a.exceptionsLegendId).addClass("cs-legend-exceptions  mc-legend-label readMore").text(T1.labels.exceptions).appendTo(e),f.find(".expansion-inner").html(T1.labels.exceptionsDetails)},addDropDownItem:function(a,b,c,d,e,f){if("undefined"!=typeof b){d.hasClass("form")||d.addClass("form");var g=$("<li/>"),h=$("<a/>",{"data-value":b,href:"#",text:a}).appendTo(g);h.off("click").on("click",{container:d,itemTxt:a},e),g.appendTo(c),b===f&&d.find(".dropdown-toggle span").html(a)}},addRadioButton:function(b,c,d,e,f,g,h,i,j){if("undefined"!=typeof c){d.hasClass("form")||d.addClass("form");var k=$("<input/>").addClass(f).attr({name:g,type:"radio","data-icon-type":"icon-radio-checked"}).addClass("dark-input").val(c);if(j)for(var l in j)k.attr(l,j[l]);var m=$("<label/>").addClass(e).addClass("radio").text(b);"function"==typeof h&&k.on("click",h);var n=a.generateUniqueId(f);k.attr("id",f+n),m.attr("for",f+n),k.appendTo(d),m.appendTo(d),c===i&&k.attr("checked","checked")}},generateUniqueId:function(a){for(var b=Math.floor(65536*(1+Math.random())).toString(16).substring(1);$("#"+a+b).length>0;)b=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return b},onBodyFilterChange:function(b){var c=$(this);if(c.is("a")){b.preventDefault(),a.currentBodyType=c.data("value");var d=b.data.container;d.find(".dropdown-toggle span").html(b.data.itemTxt)}else{if(!c.is(":checked"))return;a.currentBodyType=c.val()}$("data-cell").each(function(){var b=$(this).data(a.currentBodyType)||"-";$(this).html(b)}),a.resetView()},onFuelFilterTypeChange:function(){a.currentFuelType=$(this).val(),a.fadeEngines(a.currentFuelType)},fadeEngines:function(a){$(".mini-edit-selection-item, .img-select-thumb, .data-cell").css("opacity","1.0"),a&&"false"!==a&&($(".mini-edit-selection-item[ec-fuel-type!='"+a+"']").css("opacity","0.3"),$(".img-select-thumb[ec-fuel-type!='"+a+"']").css("opacity","0.3"),$(".data-cell[ec-fuel-type!='"+a+"']").css("opacity","0.3"))},addCollapsePanels:function(){var b,c=$("<div/>").addClass("panel-group").attr("id","panelGroup-engines").appendTo(a.gridContainer),d=a.hidePrices?0:1;if(!a.hidePrices){var e=a.addPricesTable();e.find("tr").size()&&(b=a.addCollapsePanel(c,0,T1.labels.comparator.prices),b.html(e))}for(var f in a.data.engines[0].bodyTypes[a.currentBodyType])b=a.addCollapsePanel(c,d,f),b.html(a.addSpecTable(f)),a.addSpecCells(f),d++},resetView:function(){a.gridContainer.empty(),a.addCollapsePanels()},addCollapsePanel:function(b,c,d){var e=$("<div/>").addClass("panel panel-default").appendTo(b),f=$("<div/>").addClass("panel-heading").appendTo(e),g=$("<h4/>").addClass("panel-title").appendTo(f),h=$("<a/>").attr({"data-toggle":"collapse","data-parent":"#panelGroup-engines",href:"#ec_pane"+c}).text(d).addClass("ec-toggle-head").appendTo(g);a.isTrackingEnabled&&h.attr({"data-bt-action":"click_tab","data-bt-value":d,"data-bt-track":""}),h.on("click",a.togglePanelHeaders),$("<i/>").addClass("icon-chevron-down").prependTo(h);var i=$("<div/>").attr("id","ec_pane"+c).addClass("panel-collapse collapse").appendTo(e);return 0===c&&(i.addClass("in"),$("i",h).removeClass("icon-chevron-down").addClass("icon-chevron-up")),$("<div/>").addClass("panel-body").appendTo(i)},togglePanelHeaders:function(){var a=$(this).is(".mc-toggle-head")?$("i",".mc-toggle-head"):$("i",".ec-toggle-head");a.removeClass("icon-chevron-up").addClass("icon-chevron-down"),$("i",this).toggleClass("icon-chevron-up icon-chevron-down")},addSpecTable:function(b){for(var c=$("<table/>").addClass("table col-lg-12 col-md-12 col-sm-12").attr("data-category",b),d=$("<tbody/>").appendTo(c),e=a.titles[b],f=0;f<e.length;f++){var g=$("<tr/>").appendTo(d).attr("data-row-name",e[f].id);$("<td/>").addClass("title-cell").html(e[f].name).appendTo(g)}return c},addSpecCells:function(b){for(var c=a.data.engines,d=0;d<c.length;d++)if(c[d].bodyTypes[a.currentBodyType][b]){var e=c[d].bodyTypes[a.currentBodyType][b].items,f=c[d].code,g=$('table[data-category="'+b+'"]');for(var h in e){for(var i=e[h],j=$('tr[data-row-name="'+i.id+'"]',g),k=$("<td/>").html(i.value).addClass("data-cell").attr({"data-engine-type":f,"ec-fuel-type":c[d].fuel}),l=0;l<a.bodyTypes.length;l++)if(c[d].bodyTypes[a.bodyTypes[l].code]&&c[d].bodyTypes[a.bodyTypes[l].code][b]&&c[d].bodyTypes[a.bodyTypes[l].code][b].items[h]){var m=c[d].bodyTypes[a.bodyTypes[l].code][b].items[h].value,n=a.bodyTypes[l].code;k.attr("data-"+n,m)}i.grades&&a.addExceptions(k,i.grades,i.id+"-"+d+"-"+h),j.append(k)}}a.renderTable()},addExceptions:function(b,c,d){var e=a.getExpansionContainer("item-"+d),f=e.find(".expansion-inner"),g=$("<i/>").html(b.html()).addClass("readMore exceptions");g.attr("data-tooltip-selector","#item-"+d),b.empty().append(g);for(var h=0;h<c.length;h++){var i=$('<div class="row"/>');i.append($('<div class="col-lg-6 col-md-6 col-sm-6"/>').html(c[h].name)),i.append($('<div class="col-lg-6 col-md-6 col-sm-6"/>').html(c[h].value)),f.append(i)}b.append(e)},getExpansionContainer:function(b){return a.engineNodesMainContainer.find(".expansion-content.template").clone().attr("id",b).removeClass("template")},hasCurrentBodyType:function(b){for(var c=0;c<b.bodyTypes.length;c++)if(b.bodyTypes[c].code===a.currentBodyType)return!0;return!1},addPricesTable:function(){for(var b=$("<table/>").addClass("table table-prices col-lg-12 col-md-12 col-sm-12").attr("data-category","PRC"),c=a.getGrades(),d=0;d<c.length;d++)if(a.hasCurrentBodyType(c[d])){{var e=c[d],f=e.minPrice&&e.minPrice.car?e.minPrice.car:e.car,g=T1.settings.CCISHost+"vehicle/"+a.data.code+"/"+f+"/width/91/height/91/"+T1.constants.DEFAULT_EXTERIOR_VIEW,h=e.images&&e.images[0]&&e.images[0].fileName?T1.settings.cardbImageHost+e.images[0].fileName:"/images/"+T1.constants.MISSING_IMAGE,i=$("<tr/>").attr("data-grade-code",e.code).appendTo(b),j=$("<td/>").addClass("table-row title-cell col-lg-6 col-md-6 col-sm-6").appendTo(i);$("<img/>").attr("src","None"===a.data.ccVersion?h:g).appendTo(j)}j.append(e.name);for(var k in e.bodyTypes){var l=e.bodyTypes[k];if(a.currentBodyType===l.code)for(var m in a.data.engines){var n=a.data.engines[m];j=$("<td/>").html("<i class='icon-minus' />").addClass("data-cell").attr({"data-engine-type":n.code,"ec-fuel-type":n.fuel}).appendTo(i);var o=a.getGradeCurrentBodyType(e),p=null;if(o){for(var q=0;q<o.engines.length;q++)if(o.engines[q].code===n.code){p=o.engines[q];break}if(p)if(/^h_/.test(n.fuel)&&i.addClass("hybrid"),p.price.list){var r=$("<span/>").addClass("new-price").html(globalize.format(p.price.listWithDiscount,"c")).append($('<i class="icon-tag"></i>')),s=$("<span/>").addClass("old-price").html(globalize.format(p.price.list,"c"));j.empty().append($("<p/>").addClass("promo").append([r,s]))}else j.html(globalize.format(p.price.listWithDiscount,"c"))}}}}return b},getGradeCurrentBodyType:function(b){for(var c in b.bodyTypes)if(b.bodyTypes[c].code===a.currentBodyType)return b.bodyTypes[c];return null},getGrades:function(){for(var b=[],c=0;c<a.data.subModels.length;c++)b=$.merge(b,a.data.subModels[c].grades);return b},updateCells:function(){var b=a.selectedEngines.length,c=a.gridContainer.find("tr");$.each(c,function(){var c=$(this).find("td"),d=c.not("td:first");c.eq(0).addClass("col-lg-6 col-md-6 col-sm-6"),d.attr("class",""),d.addClass("data-cell"),d.addClass(a.getColSize("lg",b,6)+" "+a.getColSize("md",b,6)+" "+a.getColSize("sm",b,6))})},filterColumns:function(){var b=a.gridContainer.find(".data-cell");b.attr("data-filtered",!1).css("display","table-cell");var c=b.filter(function(){var b=$(this).attr("data-engine-type"),c=-1===a.selectedEngines.indexOf(b);return c});c.attr("data-filtered",!0),a.updateCells(),c.css("display","none")},generateSelectionControls:function(){a.editSelect.empty();var b=$("<div/>").addClass("optioncontainer").appendTo(a.editSelect);$("<div/>").addClass("itemrow").appendTo(b),$("<div/>").addClass("buttonrow").appendTo(b),a.sortSelectedEngines();for(var c=0;c<a.selectedEngines.length;c++)a.generateThumbs(a.selectedEngines[c]);$("<div/>").addClass("clearfix").appendTo(a.editSelect),a.generateSelectEdit(a.editSelect),a.fadeEngines(a.currentFuelType)},generateThumbs:function(b){var c,d,e,f=a.editSelect.find(".optioncontainer"),g=f.find(".itemrow"),h=f.find(".buttonrow");if(a.engineImages[b]){c=a.engineImages[b].img,c&&(d=T1.settings.cardbImageHost+c);var i=$("<div/>").addClass("img-select-thumb ").attr({"ec-engine-type":b,"ec-fuel-type":a.engineImages[b].fuelType}).appendTo(g);e=$("<div/>").addClass("img-select-label-container").appendTo(i),c&&$("<img/>").addClass("img-responsive").attr("src",d).appendTo(e);var j=$("<div/>").addClass("label-wrapper engine clearfix").appendTo(e);a.engineImages[b].hybrid&&$("<span/>").addClass("label label-default hybrid").text("hybrid").appendTo(j);var k=$("<div/>").addClass("infocontainer engine").appendTo(i),l=$("<h4/>").text(a.engineImages[b].title).attr("ec-engine-type",b).appendTo(k),m=a.enginePayments[b]!=={}&&void 0!==a.enginePayments[b]?T1.labels.pricePerMonth.replace("%a",a.enginePayments[b][0].amount).replace("%m",a.enginePayments[b][0].months):" ";$('<span class="finance-rate">'+m+"</span>").appendTo(k),a.engineImages[b].hybrid&&l.addClass("selected-hybrid");var n=$("<div/>").addClass("icon-remove-container").prependTo(i),o=$("<i/>").addClass("icon-remove ec-thumb-remove").appendTo(n),p=$("<div/>").addClass("buttoncontainer");p.appendTo(h),o.on("click",a.onMiniRemoveClick)}},generateSelectEdit:function(b){var c=$("<div/>").addClass("mini-edit-selection-menu").appendTo(b);$("<h4/>").addClass("mini-edit-selection-header").text(T1.labels.comparator.selectEngine).appendTo(c);for(var d=null,e=null,f=0;f<a.engines.length;f++){f%4===0&&(d=$("<div/>").addClass("itemrow").appendTo(c),e=$("<div/>").addClass("buttonrow form").appendTo(c));var g=T1.settings.cardbImageHost+a.engineImages[a.engines[f]].img,h=a.engineImages[a.engines[f]].hybrid,i=$("<div/>").addClass("mini-edit-selection-item form").attr("ec-fuel-type",a.engineImages[a.engines[f]].fuelType).appendTo(d),j=$("<div/>").addClass("img-select-label-container").appendTo(i);$("<img/>").addClass("img-responsive").attr("src",g).appendTo(j);var k=$("<div/>").addClass("label-wrapper engine clearfix").appendTo(j);h&&$("<span/>").addClass("label label-default hybrid").text("hybrid").appendTo(k);var l=$("<div/>").addClass("infocontainer").appendTo(i),m=$("<h4/>").text(a.engineImages[a.engines[f]].title).appendTo(l);h&&m.addClass("hybrid");var n=$("<a/>").html("<label>"+T1.labels.compare+"</label>").addClass("btn btn-grey mini-compare-btn").appendTo(i),o=$("<input/>").attr({type:"checkbox","data-engine-select-type":a.engines[f]}).addClass("mini-compare-cb").prependTo(n);-1!==$.inArray(a.engines[f],a.selectedEngines)&&(n.addClass("btn-dark"),o.prop("checked",!0).trigger("change"));var p=$("<div/>").addClass("mini-edit-selection-button");n.appendTo(p),p.appendTo(e)}var q=$("<div/>").addClass("selection-trigger-holder").prependTo(b),r=$("<button/>").addClass("btn-dark btn ec-change-compare-btn").text(T1.labels.comparator.changeEngineSelect).append($("<i/>").addClass("icon-chevron-down")).prependTo(q);a.isTrackingEnabled&&r.attr({"data-bt-action":"click_function","data-bt-value":"change_engines","data-bt-track":""}),$("<div/>").addClass("clearfix").appendTo(c);var s=$("<button/>").text(T1.labels.update).addClass("btn btn-dark save-and-close-button").appendTo(c),t=$("<button/>").text(T1.labels.cancel).addClass("btn btn-link just-close-button").appendTo(c);r.on("click",a.onMiniEditClick),s.on("click",a.onSaveAndCloseClick),t.on("click",a.onJustCloseClick),$(".mini-compare-btn",a.overlayContent).on("click",a.onMiniEditButtonClicked),$(".mini-compare-cb",a.overlayContent).on("change",a.onMiniEditCheckboxChecked),a.changeCompareMenu=c,c.hide()},onJustCloseClick:function(){$(".mini-compare-cb",a.overlayContent).each(function(){var b=$(this).data("engine-select-type"),c=$.inArray(b,a.selectedEngines);$(this).prop("checked",-1!==c),-1===c?$(this).parent().removeClass("btn-dark"):$(this).parent().addClass("btn-dark")}),$(".ec-change-compare-btn",".selection-trigger-holder").trigger("click")},onSaveAndCloseClick:function(){a.selectedModels=[],$(".mini-compare-cb",a.overlayContent).each(function(){var b=$(this).data("engine-select-type");if($(this).is(":checked"))-1===$.inArray(b,a.selectedEngines)&&a.selectedEngines.push(b);else{var c=a.selectedEngines.indexOf(b);-1!==c&&a.selectedEngines.splice(c,1)}}),a.filterColumns(),a.generateSelectionControls(),a.modal.hide(),a.toggleScrollContainer(),PubSub.publish(T1.constants.ENGINE_COMPARE_CHANGE,{})},onMiniEditCheckboxChecked:function(b){if($(this).is(":checked")){if($(".mini-compare-cb:checked",a.overlayContent).length>3)return PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$(".overlayerContent"),customText:a.maxWarningText,timeout:2e3}),$(this).prop("checked",!1),b.preventDefault(),!1;$(this).parent().addClass("btn-dark")}else{if($(".mini-compare-cb:checked",a.overlayContent).length<2)return PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$(".overlayerContent"),customText:a.minWarningText,timeout:2e3}),$(this).prop("checked",!0),b.preventDefault(),!1;$(this).parent().removeClass("btn-dark")}},onMiniEditButtonClicked:function(){var a=$("input",this);a.trigger("click")},onMiniRemoveClick:function(){var b=$(this).parents(".img-select-thumb").attr("ec-engine-type");if(2===a.selectedEngines.length)return void PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:a.editSelect,customText:a.minWarningText,timeout:2e3});PubSub.publish(T1.constants.ENGINE_COMPARE_CHANGE,{engineType:b});var c=a.selectedEngines.indexOf(b);a.selectedEngines.splice(c,1),$(this).parent().remove(),$(".img-select-thumb").attr("class","").addClass(".img-select-thumb "+a.getColSize()),a.onEditSelection()},onMiniEditClick:function(b){b.preventDefault(),$(this).toggleClass("btn-dark").toggleClass("half-btn");var c=$("i",this);c.hasClass("icon-chevron-down")?(c.removeClass("icon-chevron-down"),c.addClass("icon-chevron-up"),T1.utilities.isIpad()&&$(".ec-grid-container").css("pointer-events","none")):c.hasClass("icon-chevron-up")&&(c.removeClass("icon-chevron-up"),c.addClass("icon-chevron-down"),T1.utilities.isIpad()&&$(".ec-grid-container").css("pointer-events","auto")),a.toggleScrollContainer(),$(".mini-edit-selection-menu").toggle(),$(this).trigger("blur"),a.modal.toggle(),T1.utilities.isIpad()&&($(".mini-edit-selection-menu").css("-webkit-transform","translate3d(0,0,1px)"),$(this).css("-webkit-transform","translate3d(0,0,1px)"))},toggleScrollContainer:function(){return T1.utilities.isIpad()?void $(".ec-select-modal").css("pointer-events","none"):void(a.overlayContent.find(".scrollcontainer").length>0?a.overlayContent.find(".scrollcontainer").remove():($('<div class="scrollcontainer"></div>').appendTo(a.overlayContent),a.setScrollContainerSize()))},setScrollContainerSize:function(){var b=a.overlayContent.find(".scrollcontainer");b.length>0&&b.css("height",a.overlayContent.height()+"px")},getColSize:function(b,c,d){"undefined"==typeof b&&(b="lg"),"undefined"==typeof d&&(d=12),("undefined"==typeof c||isNaN(c))&&(c=a.selectedEngines?a.selectedEngines.length:a.selectedModels.length);var e=Math.floor(d/c);return"col-"+b+"-"+e}},b={initDesktop:a.initDesktop,selectedEngines:a.selectedEngines,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile,extendCheckboxChange:a.extendCheckboxChange,onMiniEditButtonClicked:a.onMiniEditButtonClicked,getColSize:a.getColSize,addRadioButton:a.addRadioButton,togglePanelHeaders:a.togglePanelHeaders};return b}();var T1=T1||{};T1.engineMobileCompare=function(){"use strict";var a={section:$("#mobilecompare"),container:$(".mobile-compare"),tabs:null,dataContainer:null,dataGridContainer:null,dataHeadContainer:null,dataEngineTriggers:null,dataModelTriggers:null,backButton:null,modelContainer:null,modelContainerHeader:null,modelId:null,data:null,engineData:null,modelData:null,enginePromotions:[],bodyPromotions:[],currentTab:null,hidePrices:null,directCall:!1,directEngine:null,initMobile:function(){a.container&&0!==a.container.length&&(a.hidePrices="true"===T1.settings.hidePrices,a.tabs=$(".ecm-section-toggle",a.container),a.dataContainer=$(".ecm-data-container",a.container),a.dataGridContainer=$(".ecm-data-table",a.container),a.dataHeadContainer=$(".ecm-data-head",a.container),a.dataEngineTriggers=$(".ecm-engine-trigger",a.container),a.dataModelTriggers=$(".ecm-model-trigger",a.container),a.backButton=$(".ecm-back-button",a.container),a.modelContainer=$(".ecm-grid-container",a.container),a.modelContainerHeader=$(".ecm-model-container > div.section-title",a.container),PubSub.subscribe(T1.constants.PAGEOVERLAYER_OPEN,function(){var b=a.section.attr("data-extended-param"),c=$(".ecm-section-toggle[data-ecm-task='"+b+"']");a.currentTab=b,c.length>0&&c.trigger("click")}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,function(a,b){1===$(".ecm-container",b.el[0]).length&&setTimeout(function(){scrollTo(0,0)},1)}),PubSub.subscribe(T1.constants.MOBILE_COMPARE_CHANGE,a.toDataPage),a.tabs.click(a.onTabClick),a.dataEngineTriggers.click(a.onEngineNodeClick),a.backButton.click(a.toOverviewPage),a.getData())},onTabClick:function(b){b.preventDefault(),a.tabs.removeClass("active"),$(this).addClass("active");var c=$(this).data("ecm-task");PubSub.publish(T1.constants.HASH_REPLACE,{oldValue:a.currentTab,newValue:c}),a.currentTab=c,$(".ecm-sub-container").hide(),$("."+c).show(),scrollTo(0,0)},onEngineNodeClick:function(a){a.preventDefault&&a.preventDefault();var b=$(this).data("ecm-engine-type");PubSub.publish(T1.constants.HASH_ADD,"/publish/mobile_compare_change/engineCode="+b)},generateDataTable:function(b){$(".ecm-selected-title",a.dataHeadContainer).text(b.name),b.promotions&&b.promotions.length>0?($(".ecm-promo-count-holder",a.dataHeadContainer).text("("+b.promotions.length+")"),$(".ecm-promo-count").show()):$(".ecm-promo-count").hide(),a.showSelectedEnginePromotions(b.code,".ecm-data-container");var c=b.specs;$(".ecm-selected-specs-table",a.dataGridContainer).remove();for(var d=$("<table/>").addClass("ecm-selected-specs-table table table-striped").prependTo(a.dataGridContainer),e=0;e<c.length;e++){var f=c[e];if(f.quick){var g=$("<tr/>").addClass("ecm-selected-specs-row").appendTo(d);$("<td/>").addClass("ecm-specs-cell-name").text(f.name).appendTo(g),$("<td/>").addClass("ecm-specs-cell-value").text(f.value).appendTo(g)}}PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{html:".ecm-data-container",preserveContent:!0,pageName:a.section.data("section-title")})},toDataPage:function(b,c){var d=c.engineCode;if(null===a.engineData)a.directCall=!0,a.directEngine=d;else{for(var e=null,f=0;f<a.engineData.length;f++){var g=a.engineData[f];if(g.code===d){e=g;break}}a.generateDataTable(e)}},toOverviewPage:function(a){a.preventDefault(),PubSub.publish(T1.constants.HASH_REMOVE,"")},getData:function(){var b=$(".car-model").data("car-model");$.getJSON("/api/cardb/mobilespecs/"+b,a.onGetData)},onGetData:function(b){a.data=b,a.engineData=a.data.engines,a.modelData=a.data.bodyTypes,a.modelId=a.data.modelId.replace("{","").replace("}","");var c=a.countPromotions();$(".ecm-engine-available-title",a.container).append("("+a.engineData.length+")"),c>0?$(".ecm-engine-promotions-title",a.container).append("("+c+")"):($(".ecm-engine-promotions-title",a.container).hide(),$(".ecm-engine-promotions-title",a.container).prev("span").hide()),a.generateBodySpecs()},generateBodySpecs:function(){var b=a.countPromotions(!0);$(".ecm-model-available-title",a.modelContainerHeader).append("("+a.modelData.length+")"),b>0?$(".ecm-model-promotions-title",a.modelContainerHeader).append("("+b+")"):($(".ecm-model-promotions-title",a.modelContainerHeader).hide(),$(".ecm-model-promotions-title",a.modelContainerHeader).prev("span").hide());for(var c=0;c<a.modelData.length;c++){var d=a.modelData[c];a.addModelTable(d)}a.addPromotions()},addModelTable:function(b){var c=$("<table/>").addClass("table table-striped ecm-body-info-table").prependTo(a.modelContainer);if(b.promotions){var d=$("<div/>").addClass("ecm-promotions-holder ecm-promotions-holder-body").prependTo(a.modelContainer);$("<h4/>").append($("<span/>").addClass("ecm-model-promotions-title").text(b.name+" "+T1.labels.comparator.promotions+"("+b.promotions.length+")").append($("<i/>").addClass("icon-tag"))).appendTo(d),a.generatePromotionsNodes(b.promotions,d,"body")}var e=$("<tr/>").addClass("ecm-body-info-row").appendTo(c);$("<td/>").addClass("ecm-body-info-header").text(b.name).attr("colspan",2).appendTo(e);for(var f=0;f<b.specs.length;f++)if(b.specs[f].quick){var g=$("<tr/>").addClass("ecm-body-info-row").appendTo(c);$("<td/>").addClass("ecm-body-info-cell-name").text(b.specs[f].name).appendTo(g),$("<td/>").addClass("ecm-body-info-cell-value").text(b.specs[f].value).appendTo(g)}},countPromotions:function(b){"undefined"==typeof b&&(b=!1);for(var c=b?a.modelData:a.engineData,d=0,e=[],f=0;f<c.length;f++){var g=c[f];if(g.promotions){for(var h=0;h<g.promotions.length;h++){var i=g.promotions[h],j="code"in i?i.code:null;$.inArray(j,e)<0&&e.push(j)}d=e.length}}return d},addPromotions:function(){for(var b=0;b<a.engineData.length;b++)if(a.engineData[b].promotions){$(".promolabel",".ecm-engine-trigger[data-ecm-engine-type='"+a.engineData[b].code+"']").show();for(var c=0;c<a.engineData[b].promotions.length;c++){var d=a.engineData[b].promotions[c];d.engineCode=a.engineData[b].code,d.engine=!0,a.enginePromotions.push(d)}}var e=$("<div/>").addClass("ecm-promotions-holder ecm-promotions-holder-engine").insertBefore(a.dataGridContainer);a.generatePromotionsNodes(a.enginePromotions,e,"engine")},generatePromotionsNodes:function(b,c,d){c.empty();for(var e="<a class='ecm-promotions-node ecm-promotions-node-{{TYPE}}' ecm-promotion-code='{{CODE}}' href='{{LINK}}'><img src='{{IMG}}' /><span class='ecm-promotions-special-offer'>"+T1.labels.comparator.promotions+"<i class='icon-tag'/></span><h4 class='ecm-promotions-title'>{{NAME}}</h4><span class='ecm-promotions-sub-title'>{{SUB_TITLE}}</span><span class='finance-rate'>{{REPAYMENT_RATE}}</span><i class='icon-angle-right'/></a>",f=0;f<b.length;f++){var g=a.hidePrices?"":T1.labels.priceFrom.replace("%s",globalize.format(b[f].price.listWithDiscount,"c")),h=b[f].payments!=={}&&void 0!==b[f].payments?T1.labels.pricePerMonth.replace("%a",b[f].payments.amount).replace("%m",b[f].payments.months):" ",i=T1.settings.CCISHost+T1.constants.URL_MINI_CARCONFIG_IMG.replace(/\[LANG\]/g,T1.settings.language).replace(/\[MODEL\]/g,a.modelId).replace(/\[GRADE\]/g,b[f].cheapestCar.replace("{","").replace("}","")).replace(/\[COLOUR\]/g,"040").concat("?width=160&height=80"),j=e.replace(/{{TYPE}}/g,d).replace(/{{LINK}}/g,"/promo/"+b[f].code.replace("{","").replace("}","")).replace(/{{IMG}}/g,i).replace(/{{NAME}}/g,b[f].name).replace(/{{SUB_TITLE}}/g,g);j=j.replace(/{{CODE}}/g,b[f].engine?b[f].engineCode:"body"),j=j.replace(/{{REPAYMENT_RATE}}/g,h),c.append(j)}c.append($("<div/>").addClass("clearfix")),a.directCall&&"engine"===d&&(a.showSelectedEnginePromotions(a.directEngine,c),a.directCall=!1,a.toDataPage(T1.constants.MOBILE_COMPARE_CHANGE,{engineCode:a.directEngine}))},showSelectedEnginePromotions:function(a,b){$(".ecm-promotions-node-engine",b).hide(),$(".ecm-promotions-node-engine[ecm-promotion-code='"+a+"']",b).show()}},b={initMobile:a.initMobile,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile};return b}();var T1=T1||{};T1.modelCompare=function(){"use strict";var a={modelNodesMainContainer:$(".compare-models"),modelDataContainer:$(".compare-model-data"),compareButtons:null,allCompare:$(".compare-model-button"),compareCheckboxes:null,toggleButtons:null,changeCompareMenu:null,data:null,financeData:null,bodyTypes:null,currentBodyType:null,engines:{},availableEngines:[],equipment:[],hybridCars:[],specialOffers:[],grades:[],bodyTypeValues:{},engineTypeValues:{},overlayContent:null,gridContainer:null,controlContainer:null,editSelect:null,filterContainer:null,selectedModels:[],modelData:{},models:[],modal:null,overlayerOpen:!1,pageName:$(".equipmentcompare").attr("data-section-title"),hidePrices:null,minWarningText:null,maxWarningText:null,exceptionsLegendId:"models-exceptions-legend",initDesktop:function(){a.hidePrices="true"===T1.settings.hidePrices,0!==a.modelNodesMainContainer.length&&(a.isTrackingEnabled="object"==typeof window.t1DataLayer,a.minWarningText=T1.labels.comparator.compareMinEqu,a.maxWarningText=T1.labels.comparator.compareMaxEqu,a.compareButtons=$(".compare-btn",a.modelNodesMainContainer),a.compareCheckboxes=$(".model-check",a.modelNodesMainContainer),a.toggleButtons=$(".mc-show-hide-button",a.modelNodesMainContainer),a.overlayContent=$(".compare-model-data"),a.gridContainer=$(".mc-grid-container",a.overlayContent),a.controlContainer=$(".compare-top-controls",a.overlayContent),a.editSelect=$(".engine-model-options",a.overlayContent),a.filterContainer=$(".other-options",a.overlayContent),a.compareButtons.on("click",a.onCompareBtnClick),a.allCompare.on("click",a.onAllCompare),a.compareCheckboxes.prop("checked",!1),a.compareCheckboxes.slice(0,3).prop("checked",!0).trigger("change"),a.compareButtons.slice(0,3).removeClass("btn-grey").addClass("btn-dark"),a.compareCheckboxes.on("change",a.onCheckboxChange),a.toggleButtons.on("click",a.onTabToggle),PubSub.subscribe(T1.constants.MODEL_COMPARE_CHANGE,function(){a.compareCheckboxes.prop("checked",!1),a.compareButtons.removeClass("btn-dark");for(var b=0;b<a.selectedModels.length;b++){var c=a.selectedModels[b];$("input[data-model-select-type='"+c+"']").prop("checked",!0).parent().addClass("btn-dark")}a.compareCheckboxes.trigger("change")}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_OPEN,function(){$(".overlayerWrapper").is(".compare-overlay-wrapper")&&$(".compare-model-data",".compare-overlay-wrapper").length>0&&null===a.modal&&!a.overlayerOpen&&(a.modal=$("<div/>").addClass("mc-select-modal").css("width",$(window).width()+"px").hide().prependTo($(".overlayerContent")),a.modal.on("click",a.onJustCloseClick),a.overlayerOpen=!0)}),PubSub.subscribe(T1.constants.ON_WIN_RESIZE,function(){var a=$(window).width()-15;$(".mc-select-modal").css("width",a+"px")}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_CLOSED,function(){a.overlayerOpen&&(a.modal.remove(),a.overlayContent.find(".scrollcontainer").remove(),a.overlayerOpen=!1)}),PubSub.subscribe(T1.constants.READMORE_HIDE,function(){$(".title2",a.modelNodesMainContainer).removeClass("read-more-active")}),PubSub.subscribe(T1.constants.READMORE_SHOW,function(b,c){$(".title2",a.modelNodesMainContainer).removeClass("read-more-active"),c.target.addClass("read-more-active")}),PubSub.subscribe(T1.constants.PAGEOVERLAYER_RESIZE,a.setScrollContainerSize),PubSub.subscribe(T1.constants.MODEL_COMPARE_PRINT,a.print),PubSub.subscribe(T1.constants.FINANCE_RATES_ON,a.requestFinanceData),PubSub.subscribe(T1.constants.FINANCE_RATES_OFF,a.clearFinanceData),a.getData())},switchDesktop:function(){$(".equipmentcompare").show()},switchMobile:function(){$(".equipmentcompare").hide()
},onTabToggle:function(){var a=$(this).data("mc-target");$(".mc-toggleable-container").hide(),$(a).show()},onAllCompare:function(){a.overlayerOpen||(a.selectedModels=[],$(".model-check:checked").each(function(){a.selectedModels.push($(this).data("model-select-type"))}),a.filterColumns(),PubSub.publish(T1.constants.HASH_CHANGE,"/publish/pageoverlayer_open/html=.compare-model-data/preserveContent=true/styleClass=compare-overlay-wrapper/pageName="+a.pageName)),$(".mc-body-type-radio[value='"+a.currentBodyType+"']",a.modelNodesMainContainer).prop("checked",!0).trigger("change")},onCheckboxChange:function(b){var c=$(this).parent();T1.engineCompare.extendCheckboxChange(a,c,$(this),b)},getData:function(){var b=$(".car-model").data("car-model");$.getJSON("/api/cardb/equipmentcompare/"+b,a.onGetData)},onGetData:function(b){0!==b.length&&(a.data=b,a.bodyTypes=b.bodyTypes,a.currentBodyType=a.bodyTypes[0].code,a.equipment=b.equipment,a.grades=a.getGrades(),a.generateIndexes(),a.addCollapse(),a.addFilters(),a.selectedModels=[],$(".model-check:checked").each(function(){a.selectedModels.push($(this).data("model-select-type")+"")}),$(".mc-main-image").each(function(){$(".hybrid",$(this).parents(".img_with_label")).length>0&&a.hybridCars.push($(this).attr("data-model-type")),$(".special-offer",$(this).parents(".img_with_label")).length>0&&a.specialOffers.push($(this).attr("data-model-type"))}),a.filterColumns(),a.generateSelectionControls(),a.requestFinanceData())},requestFinanceData:function(){if("true"===T1.settings.finance.showRatesMonthly&&T1.financeRates.enabled()){for(var b={},c=0;c<a.grades.length;c++)b[a.grades[c].code]=a.grades[c].minPrice.config;T1.financeService.requestFinanceData({configs:b,success:function(b){a.financeData=b,a.loadFinanceData()},multiple:!0,source:"ModelsComparer"})}else a.clearFinanceData()},loadFinanceData:function(b){if(b=b||a.financeData){for(var c=0;c<a.grades.length;c++){var d=a.grades[c].code,e=a.modelNodesMainContainer.find('div.form[data-model-type="'+d+'"]'),f=b[d]&&b[d].rate?b[d].rate:null,g=b[d]&&b[d].show?b[d].show:null;if(f&&(f.monthlyPayment&&e.find(".monthly-payment").html(T1.financeService.formatFinanceString(T1.labels.comparator.monthlyPayment,f,g)),g.effectiveRate&&f.effectiveInterestRate||g.annualRate&&f.annualInterestRate)){var h=T1.financeService.formatFinanceString(T1.labels.comparator.priceRate,f,g),i="_"+a.grades[c].car,j=a.getExpansionContainer(i,!0).appendTo(e),k=T1.financeService.getDisclaimer(f,!0,T1.labels.viewDisclaimer);e.find(".payment-rate").html(h+" ").append($('<a href="#" class="readMore"/>').html(T1.labels.viewDisclaimer).attr("data-tooltip-selector","#"+i)),j.find(".expansion-inner").empty().append(k)}}a.refreshShortFinanceData(b)}},refreshShortFinanceData:function(b){if(b=b||a.financeData)for(var c=0;c<a.grades.length;c++){var d=a.grades[c].code,e=a.modelDataContainer.find('div.img-select-thumb[mc-model-type="'+d+'"]'),f=b[d]&&b[d].rate?b[d].rate:null,g=b[d]&&b[d].show?b[d].show:null;if(f&&f.monthlyPayment){var h="_"+a.grades[c].car,i=a.getExpansionContainer(h,!0).appendTo(e),j=T1.financeService.getDisclaimer(f,!0,T1.labels.viewDisclaimer),k=e.find(".monthly-payment");k.html(T1.financeService.formatFinanceString(T1.labels.comparator.shortMonthlyPayment,f,g)),k.append($('<a href="#" class="readMore"/>').attr("data-tooltip-selector","#"+h).append($('<i class="icon-info-sign"/>'))),i.find(".expansion-inner").empty().append(j)}}},clearFinanceData:function(){a.modelNodesMainContainer.find("div.form .monthly-payment"),a.modelNodesMainContainer.find("div.form .payment-rate")},getGrades:function(){for(var b=[],c=0;c<a.data.subModels.length;c++)b=$.merge(b,a.data.subModels[c].grades);return a.escapeArrayOfObjects(b)},escapeArrayOfObjects:function(a){for(var b=0;b<a.length;b++)a[b].code=encodeURIComponent(a[b].code);return a},filterColumns:function(){a.resetHighlight(),$(".data-cell").addClass("filtered").hide();for(var b=0;b<a.selectedModels.length;b++){var c=$(".data-cell[mc-model-type='"+a.selectedModels[b]+"']");c.attr("class","data-cell").addClass(T1.engineCompare.getColSize("lg",a.selectedModels.length,6)+" "+T1.engineCompare.getColSize("md",a.selectedModels.length,6)+" "+T1.engineCompare.getColSize("sm",a.selectedModels.length,6)).show()}$(".mc-fuel-type-header").attr("colspan",a.selectedModels.length+1),$(".data-cell",".table-prices").addClass("mc-price-cell"),a.generateSelectionControls()},addCollapse:function(){var b=$("<div/>").addClass("panel-group").attr("id","panelGroup-models").appendTo(a.gridContainer);a.hidePrices||a.equipment.unshift({name:T1.labels.comparator.prices,code:"PRC",items:!1});for(var c=0,d=0;d<a.equipment.length;d++){var e=a.equipment[d],f=$("<div/>").addClass("panel panel-default").appendTo(b),g=$("<div/>").addClass("panel-heading").appendTo(f),h=$("<h4/>").addClass("panel-title").appendTo(g),i=$("<a/>").attr({"data-toggle":"collapse","data-parent":"#panelGroup-models",href:"#mc_pane"+c}).text(e.name).addClass("mc-toggle-head").appendTo(h);a.isTrackingEnabled&&i.attr({"data-bt-action":"click_tab","data-bt-value":e.code,"data-bt-track":""}),i.on("click",T1.engineCompare.togglePanelHeaders),$("<i/>").addClass("icon-chevron-down").prependTo(i);var j=$("<div/>").attr("id","mc_pane"+c).addClass("panel-collapse collapse").appendTo(f);0===c&&(j.addClass("in"),$("i",i).removeClass("icon-chevron-down").addClass("icon-chevron-up"));var k=$("<div/>").addClass("panel-body").attr("data-equipment-code",e.code).appendTo(j);k.html(a.addTable(e.code)),c++}},addTable:function(b){if("PRC"===b)return a.addPricesSection();for(var c=$("<table/>").addClass("table table col-lg-12 col-md-12 col-sm-12").attr("data-category",b),d=a.equipment,e=0;e<d.length;e++){var f=d[e];if(f.code===b)for(var g=0;g<f.items.length;g++){{var h=f.items[g],i=$("<tr/>").attr("data-row-name",h.code).addClass("table-parent").appendTo(c);$("<td/>").addClass("title-cell table-row col-lg-6 col-md-6 col-sm-6").html(h.name).appendTo(i)}a.addCells(i)}}return c},addCells:function(b){for(var c=b.data("row-name"),d=0;d<a.grades.length;d++){var e=a.grades[d],f=$("<td/>").addClass("data-cell").attr("mc-model-type",e.code).appendTo(b),g={};for(var h in e.bodyType)if(null!==e.bodyType[h]){if(g[h]=e.bodyType[h].equipment[c]?!0:!1,h===a.currentBodyType)if(e.bodyType[h].equipment[c]){switch(e.bodyType[h].equipment[c].equipped){case"s":f.html("<i class='icon-radio-checked' />");break;case"o":f.html("<i class='icon-radio-uncheck' />");break;case"-":f.html("<i class='icon-minus' />")}e.bodyType[h].equipment[c].cars&&a.addExceptions(f.find("i"),e.bodyType[h].equipment[c].cars,c.toString().replace(/[^a-zA-Z0-9]/g,"")+"-"+d+"-"+h)}else f.html("<i class='icon-minus' />")}else f.html("<i class='icon-minus' />"),g[h]=!1;f.data("equipment",g)}},addExceptions:function(b,c,d){var e=a.getExpansionContainer("item-"+d),f=e.find(".expansion-inner");b.text("?").addClass("readMore exceptions"),b.attr("data-tooltip-selector","#item-"+d);for(var g=0;g<c.length;g++){var h=$('<div class="row"/>');h.append($('<div class="col-lg-10 col-md-10 col-sm-10"/>').html(c[g].name)),h.append("s"===c[g].equipped?"<i class='icon-radio-checked' />":"o"===c[g].equipped?"<i class='icon-radio-uncheck' />":"<i class='icon-minus' />"),f.append(h)}b.parent().append(e)},getExpansionContainer:function(b,c){var d=a.modelNodesMainContainer.find(".expansion-content.template").clone().attr("id",b).removeClass("template");return c&&d.append($("<div/>").addClass("expansion-arrow")),d},addPricesSection:function(){var b=$("<table/>").addClass("table table-prices col-lg-12 col-md-12 col-sm-12").attr("data-category","PRC"),c=null;for(var d in a.engines)for(var e=a.engines[d],f=0;f<e.length;f++){var g=e[f];if(c!==g.fuelName){var h=$("<tr/>").appendTo(b);$("<td/>").html($("<h4/>").text(g.fuelName)).addClass("col-lg-12 col-md-12 col-sm-12 mc-fuel-type-header").appendTo(h),c=g.fuelName}{var i=$("<tr/>").addClass("table-parent").attr("data-engine-code",g.code).attr("data-fuel-type",g.fuelCode).appendTo(b),j=$("<td/>").addClass("table-row title-cell col-lg-6 col-md-6 col-sm-6").appendTo(i);$("<img/>").attr("src",g.images?T1.settings.cardbImageHost+g.images["IMG_TECH-GUIDE_91x91"]:"").appendTo(j)}j.append(g.name),"H_1"===g.fuelCode&&i.addClass("hybrid"),a.addEnginePriceCells(i,g.code)}return b},reloadPricesSection:function(){var b=$(".compare-model-data table.table-prices").empty();b.replaceWith(a.addPricesSection()),a.filterColumns()},addEnginePriceCells:function(b,c){for(var d=0;d<a.grades.length;d++)for(var e=a.grades[d],f=0;f<a.bodyTypes.length;f++){var g=null;g=0===$("td.mc-price-cell[mc-model-type='"+e.code+"']",b).length?$("<td/>").attr("mc-model-type",e.code).addClass("data-cell mc-price-cell").html("<i class='icon-minus'></i>").appendTo(b):$("td.mc-price-cell[mc-model-type='"+e.code+"']",b).eq(0);var h=a.bodyTypes[f].code,i=e.bodyType[h];if(i&&null!==i&&a.currentBodyType===h)for(var j in i.fuelType){var k=i.fuelType[j].engine;if(k[c]){if(k[c].minPrice.list){var l=$("<span/>").addClass("new-price").html(globalize.format(k[c].minPrice.listWithDiscount,"c")).append($('<i class="icon-tag"></i>')),m=$("<span/>").addClass("old-price").html(globalize.format(k[c].minPrice.list,"c"));g.empty().append($("<p/>").addClass("promo").append([l,m]))}else g.html(globalize.format(k[c].minPrice.listWithDiscount,"c"));g.attr("data-price-"+c,k[c].minPrice.listWithDiscount),g.attr("mc-engine-type",c)}}}},generateSelectEdit:function(b){b.hasClass("form")||b.addClass("form");var c=$("<div/>").addClass("mini-edit-selection-menu").appendTo(b);$("<h4/>").addClass("mini-edit-selection-header").text(T1.labels.comparator.selectGrade).appendTo(c);var d=null,e=null,f=0;for(var g in a.modelData){var h=$(".mc-main-image[data-model-type='"+g+"']").attr("src");f%4===0&&(d=$("<div/>").addClass("itemrow").appendTo(c),e=$("<div/>").addClass("buttonrow").appendTo(c));var i=$("<div/>").addClass("mini-edit-selection-item").appendTo(d),j=$("<div/>").addClass("img-select-label-container").appendTo(i);$("<img/>").addClass("img-responsive").attr("src",h).appendTo(j);var k=$("<div/>").addClass("label-wrapper clearfix").appendTo(j),l=$("<div/>").addClass("infocontainer").appendTo(i),m=$("<h4/>").text(a.modelData[g].name).appendTo(l);if(-1!==$.inArray(g,a.hybridCars)&&(m.addClass("hybrid"),k.append($("<span/>").addClass("label hybrid").text(T1.labels.hybrid))),!a.hidePrices&&a.modelData[g].price){var n=null;a.modelData[g].price.discount?(k.append($("<span/>").addClass("label special-offer").text(T1.labels.promotionSpecialOffer).append($("<i/>").addClass("icon-tag"))),n=a.modelData[g].price.discount):n=a.modelData[g].price.normal,$("<span/>").addClass("compare-from-price").text(T1.labels.priceFrom.replace("%s",globalize.format(n,"c"))).appendTo(l)}var o=$("<a/>").html("<label>"+T1.labels.compare+"</label>").addClass("btn btn-grey mini-compare-btn"),p=$("<input/>").attr({type:"checkbox","data-model-select-type":g}).addClass("mini-compare-cb").prependTo(o);-1!==$.inArray(g,a.selectedModels)&&(o.addClass("btn-dark"),p.prop("checked",!0).trigger("change"));var q=$("<div/>").addClass("mini-edit-selection-button");o.appendTo(q),q.appendTo(e),f+=1}var r=$("<div/>").addClass("selection-trigger-holder").prependTo(b),s=$("<button/>").addClass("btn-dark btn mc-change-compare-btn").text(T1.labels.comparator.changeModelSelect).append($("<i/>").addClass("icon-chevron-down")).prependTo(r);a.isTrackingEnabled&&s.attr({"data-bt-action":"click_function","data-bt-value":"change_models","data-bt-track":""}),$("<div/>").addClass("clearfix").appendTo(c);var t=$("<button/>").text(T1.labels.update).addClass("btn btn-dark save-and-close-button").appendTo(c),u=$("<button/>").text(T1.labels.cancel).addClass("btn btn-link just-close-button").appendTo(c);s.on("click",a.onMiniEditClick),t.on("click",a.onSaveAndCloseClick),u.on("click",a.onJustCloseClick),$(".mini-compare-btn",a.overlayContent).on("click",a.onMiniEditButtonClicked),$(".mini-compare-cb",a.overlayContent).on("change",a.onMiniEditCheckboxChecked),c.hide(),a.changeCompareMenu=c},print:function(){PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{url:$("#equipmentcompare").data("print-url"),ajax:!0,styleClass:"print-overlay-wrapper",pageName:a.pageName});var b=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,function(c,d){$(d.el).find("#printModelsCompare")&&(a.loadPrintContent(),window.print(),PubSub.unsubscribe(b))})},loadPrintContent:function(){var a=$(".compare-model-data").children().clone(),b=a.find("#panelGroup-models"),c=$("#printModelsCompare");a.find(".filter-holder, .selection-trigger-holder, .icon-remove-container, .buttonrow, .mini-edit-selection-menu, td.filtered").remove(),a.find("i.exceptions").each(function(a,c){var d=$(c),e="(*"+(a+1)+") "+d.closest("tr").find("td:first()").text(),f=$('<div id="exceptionsPanel-'+a+'" class="exceptions panel panel-default"><div class="panel-heading"><h4><b>'+e+'</b></h4></div><div id="mc_pane-exceptions'+a+'" class="panel-collapse collapse"></div></div>'),g=$(d.attr("data-tooltip-selector")).find(".expansion-inner").clone();d.text(d.text()+" (*"+(a+1)+")"),g.find(".row > div").attr("class","").addClass("col-lg-6 col-md-6 col-sm-6"),f.find(".panel-collapse").addClass("exceptions-panel").append(g.children(".row")),f.appendTo(b)}),a.find(".expansion-content").remove(),a.appendTo(c),c.find(".section-title").prepend(("<h4>"+T1.labels.comparator.printDate+"</h4>").replace("{date}",globalize.format(new Date,"F"))).prepend($('<img class="logo"/>').attr("src",c.attr("data-logo-url")))},onJustCloseClick:function(){$(".mini-compare-cb",a.overlayContent).each(function(){var b=$(this).data("model-select-type"),c=$.inArray(b,a.selectedModels);$(this).prop("checked",-1!==c),-1===c?$(this).parent().removeClass("btn-dark"):$(this).parent().addClass("btn-dark")}),$(".mc-change-compare-btn",".selection-trigger-holder").trigger("click")},onSaveAndCloseClick:function(){a.selectedModels=[],$(".mini-compare-cb",a.overlayContent).each(function(){var b=$(this).data("model-select-type");if($(this).is(":checked"))-1===$.inArray(b,a.selectedModels)&&a.selectedModels.push(b);else{var c=a.selectedModels.indexOf(b);-1!==c&&a.selectedModels.splice(c,1)}}),a.sortSelectedModels(),a.filterColumns(),a.generateSelectionControls(),a.modal.hide(),a.toggleScrollContainer(),PubSub.publish(T1.constants.MODEL_COMPARE_CHANGE,{})},onMiniEditClick:function(){$(this).toggleClass("btn-dark").toggleClass("half-btn");var b=$("i",this);b.hasClass("icon-chevron-down")?(b.removeClass("icon-chevron-down"),b.addClass("icon-chevron-up"),T1.utilities.isIpad()&&$(".mc-grid-container").css("pointer-events","none")):b.hasClass("icon-chevron-up")&&(b.removeClass("icon-chevron-up"),b.addClass("icon-chevron-down"),T1.utilities.isIpad()&&$(".mc-grid-container").css("pointer-events","auto")),a.toggleScrollContainer(),$(".mini-edit-selection-menu").toggle(),$(this).trigger("blur"),a.modal.toggle(),T1.utilities.isIpad()&&($(".mini-edit-selection-menu").css("-webkit-transform","translate3d(0,0,1px)"),$(this).css("-webkit-transform","translate3d(0,0,1px)"),$(".mc-grid-container").css("z-index","0"))},toggleScrollContainer:function(){if(T1.utilities.isIpad())return void $(".mc-select-modal").css("pointer-events","none");if(a.overlayContent.find(".scrollcontainer").length>0)a.overlayContent.find(".scrollcontainer").remove();else{var b=$('<div class="scrollcontainer"></div>').appendTo(a.overlayContent);b.on("click",function(){a.modal.trigger("click")}),a.setScrollContainerSize()}},setScrollContainerSize:function(){var b=a.overlayContent.find(".scrollcontainer");b.length>0&&b.css("height",a.overlayContent.height()+"px")},onMiniEditCheckboxChecked:function(b){var c=$(this);if(c.is(":checked")){if($(".mini-compare-cb:checked",a.overlayContent).length>3)return PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$(".overlayerContent"),customText:a.maxWarningText,timeout:2e3}),c.prop("checked",!1),b.preventDefault(),!1;c.parent().addClass("btn-dark")}else{if($(".mini-compare-cb:checked",a.overlayContent).length<2)return PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$(".overlayerContent"),customText:a.minWarningText,timeout:2e3}),c.prop("checked",!0),b.preventDefault(),!1;c.parent().removeClass("btn-dark")}},onMiniEditButtonClicked:function(){var a=$("input",this);a.trigger("click")},onCompareBtnClick:function(a){a.preventDefault();var b=$("input",$(this).parent());b.trigger("change")},generateIndexes:function(){for(var b=0;b<a.data.engines.length;b++){var c=a.data.engines[b];"undefined"==typeof a.engines[c.fuelName]&&(a.engines[c.fuelName]=[]),a.engines[c.fuelName].push(c),a.availableEngines.push(c.code)}a.data.grades=[];for(var d=0;d<a.data.subModels.length;d++){var e=a.data.subModels[d].grades;a.data.grades=a.data.grades.concat(e)}for(var f=0;f<a.grades.length;f++){var g=a.grades[f],h={name:g.name};g.minPrice&&(h.price={},g.minPrice.list?(h.price.normal=g.minPrice.list,h.price.discount=g.minPrice.listWithDiscount):h.price.normal=g.minPrice.listWithDiscount),a.modelData[g.code]=h,a.models.push(g.code);var i=$("i[data-model-type='"+g.code+"']").parent(),j=$("<div/>").addClass("expansion-content").hide().insertAfter(i),k=$("<div/>").addClass("expansion-inner").html(g.feature).appendTo(j);$("<a/>").addClass("closelink").attr("href","#").css({position:"absolute",top:"10px",right:"10px"}).text(T1.labels.close+" ").append($("<i/>").addClass("icon-remove")).appendTo(j);var l=(a.data.code,$("<a/>").addClass("compare-full-details btn btn-grey"));a.isTrackingEnabled&&l.attr({"data-bt-action":"click_function","data-bt-value":"view_grade_details","data-bt-track":""}),l.attr("href",$(".equipmentcompare").data("base-grade-link")+g.code).text(T1.labels.comparator.viewFullGradeDetails).appendTo(k),j.append($("<div/>").addClass("expansion-arrow")),i.attr("data-tooltip-selector",".modelcompare_tooltipcontent_"+f).addClass("readMore"),j.addClass("modelcompare_tooltip modelcompare_tooltipcontent_"+f)}a.generateBodyTypeIndexes()},generateBodyTypeIndexes:function(){for(var b={},c={},d=0;d<a.data.grades.length;d++){var e=a.data.grades[d];b[e.code]=e.bodyType,c[e.code]={};for(var f in e.bodyType){c[e.code][f]={};for(var g in e.bodyType[f].fuelType)for(var h in e.bodyType[f].fuelType[g].engine)c[e.code][f][h]=e.bodyType[f].fuelType[g].engine[h].minPrice}}a.bodyTypeValues=b,a.engineTypeValues=c},addFilters:function(){var b=$("<div/>").addClass("filter-holder").appendTo(a.filterContainer),c=$("<div/>").addClass("body-type-filter").appendTo(b).addClass("darker"),d=$("<div/>").addClass("grades-filter").appendTo(b).addClass("darker"),e=$("<div/>").addClass("legend-holder").appendTo(b),f=a.getExpansionContainer(a.exceptionsLegendId).appendTo(e);a.isTrackingEnabled&&(c.attr({"data-bt-action":"click_function","data-bt-value":"change_bodytype"}),d.attr({"data-bt-action":"highlight_diff"})),$("<h5/>").text(T1.labels.comparator.chooseBodytype+":").appendTo(c),$("<h5/>").text(T1.labels.comparator.highlightDifferences+":").appendTo(d);var g=$("<div/>",{"class":"dropdown","data-select":"bodytype"}),h=$("<a/>",{"class":"dropdown-toggle",href:"#","data-validation":"select","data-toggle":"dropdown",role:"button"}).append("<span>Please select</span><i class='icon-chevron-down'></i>"),i=$("<ul/>",{"class":"dropdown-menu",role:"menu"});if(a.bodyTypes.length>2){g.append(h).append(i).appendTo(c);for(var j in a.bodyTypes)a.addDropDownItem(a.bodyTypes[j].name,a.bodyTypes[j].code,i,c,a.onBodyFilterChange,a.currentBodyType)}else for(var k in a.bodyTypes)T1.engineCompare.addRadioButton(a.bodyTypes[k].name,a.bodyTypes[k].code,c,"body-type-label","mc-body-type-radio","mc-filter-body-type",a.onBodyFilterChange,a.currentBodyType,a.isTrackingEnabled?{"data-bt-track":""}:null);T1.engineCompare.addRadioButton(T1.labels.selectOn,"on",d,"grades-type-label","mc-grades-type-radio","highlight-grades",a.onGradeFilterChange,"off",a.isTrackingEnabled?{"data-bt-value":"on","data-bt-track":""}:null),T1.engineCompare.addRadioButton(T1.labels.selectOff,"off",d,"grades-type-label","mc-grades-type-radio","highlight-grades",a.onGradeFilterChange,"off",a.isTrackingEnabled?{"data-bt-value":"off","data-bt-track":""}:null);var l=$("<span/>").addClass("mc-legend-standart mc-legend-label").text(T1.labels.comparator.standard).appendTo(e);$("<i/>").addClass("icon-radio-checked").prependTo(l);var m=$("<span/>").addClass("mc-legend-option mc-legend-label").text(T1.labels.comparator.optional).appendTo(e);$("<i/>").addClass("icon-radio-uncheck").prependTo(m);var n=$("<span/>").addClass("mc-legend-not-applicable mc-legend-label").text(T1.labels.comparator.notApplicable).appendTo(e);$("<i/>").addClass("icon-minus").prependTo(n);var o=$("<span/>").addClass("mc-legend-special-offer mc-legend-label").text(T1.labels.promotionSpecialOffer).appendTo(e);$("<i/>").addClass("icon-tag").prependTo(o),$("<span/>").attr("data-tooltip-selector","#"+a.exceptionsLegendId).addClass("cs-legend-exceptions  mc-legend-label readMore").text(T1.labels.exceptions).appendTo(e),f.find(".expansion-inner").html(T1.labels.exceptionsDetails)},addDropDownItem:function(a,b,c,d,e,f){if("undefined"!=typeof b){d.hasClass("form")||d.addClass("form");var g=$("<li/>"),h=$("<a/>",{"data-value":b,href:"#",text:a}).appendTo(g);h.off("click").on("click",{container:d,itemTxt:a},e),g.appendTo(c),b===f&&d.find(".dropdown-toggle span").html(a)}},onBodyFilterChange:function(b){a.resetHighlight();var c=$(this);if(c.is("a")){b.preventDefault(),a.currentBodyType=c.data("value");var d=b.data.container;d.find(".dropdown-toggle span").html(b.data.itemTxt)}else{if(!c.is(":checked"))return;a.currentBodyType=c.val()}a.reloadPricesSection(),$("td.data-cell:not(.mc-price-cell)",a.overlayContent).each(function(b){var c="<i class='icon-minus'></i>",d=$(this).attr("mc-model-type"),e=$(this).parent().attr("data-row-name"),f=a.bodyTypeValues[d];if(f[a.currentBodyType]&&f[a.currentBodyType].equipment&&f[a.currentBodyType].equipment[e]){var g=f[a.currentBodyType].equipment[e].equipped;switch(g){case"s":c="<i class='icon-radio-checked'></i>";break;case"o":c="<i class='icon-radio-uncheck'></i>";break;case"-":}$(this).html(c),f[a.currentBodyType].equipment[e].cars&&a.addExceptions($(this).find("i"),f[a.currentBodyType].equipment[e].cars,e.toString().replace(/[^a-zA-Z0-9]/g,"")+"-"+b+"-"+a.currentBodyType)}else $(this).html(c)})},onGradeFilterChange:function(){var a=$(".table-parent:not([data-engine-code])");switch($(this).val()){case"on":a.each(function(){var a=!0,b=$(".data-cell",this).eq(0),c=b.html(),d=b.nextAll().not(".filtered");d.each(function(){return $(this).html()!==c?(a=!1,!1):void 0}),a||$("td",this).eq(0).css("background","#f07f0a")});break;case"off":$("td",a).css("background","inherit")}},resetHighlight:function(){$(".mc-grades-type-radio[value='off']").prop("checked",!0),$("td",$(".table-parent:not([data-engine-code])")).css("background","inherit")},sortSelectedModels:function(){a.selectedModels.sort(function(b,c){var d=a.models.indexOf(b),e=a.models.indexOf(c);return d>e?1:-1})},generateSelectionControls:function(){a.editSelect.empty();var b=$("<div/>").addClass("optioncontainer").appendTo(a.editSelect);$("<div/>").addClass("itemrow").appendTo(b),$("<div/>").addClass("buttonrow").appendTo(b);for(var c=0;c<a.selectedModels.length;c++)a.generateThumbs(a.selectedModels[c]);$("<div/>").addClass("clearfix").appendTo(a.editSelect),a.generateSelectEdit(a.editSelect),a.refreshShortFinanceData()},generateThumbs:function(b){try{var c=a.editSelect.find(".optioncontainer"),d=c.find(".itemrow"),e=c.find(".buttonrow"),f=$("<div/>").addClass("finance-rate"),g=$.inArray(b,a.selectedModels),h=$(".mc-main-image[data-model-type='"+b+"']").attr("src"),i=$("<div/>").addClass("img-select-thumb").attr({"mc-model-type":b}).appendTo(d),j=$("<div/>").addClass("img-select-label-container").appendTo(i);$("<img/>").addClass("img-responsive").attr("src",h).appendTo(j);var k=$("<div/>").addClass("label-wrapper clearfix").appendTo(j),l=$("<div/>").addClass("infocontainer model").appendTo(i),m=$("<h4/>").text(a.modelData[b].name).attr("mc-model-type",b).appendTo(l);-1!==$.inArray(b,a.hybridCars)&&(m.addClass("hybrid"),k.append($("<span/>").addClass("label hybrid").text(T1.labels.hybrid))),f.append($("<span/>").addClass("monthly-payment")).appendTo(l),-1!==$.inArray(b,a.specialOffers)&&k.append($("<span/>").addClass("label special-offer").text(T1.labels.promotionSpecialOffer));var n=$("<div/>").addClass("icon-remove-container").prependTo(i),o=$("<i/>").addClass("icon-remove ec-thumb-remove").appendTo(n),p=$("<div/>").addClass("buttoncontainer ");p.appendTo(e);var q=$("<a/>").addClass("btn btn-grey config-btn ");a.isTrackingEnabled&&q.attr({"data-bt-eventclass":"ctaevent","data-bt-action":"click_cta","data-bt-value":"carconfigurator","data-bt-workflowname":"carconfigurator","data-bt-workflowstep":"0","data-bt-track":""});var r="#"+T1.constants.URL_CAR_CONFIG_OVERLAYER+"modelid="+a.data.modelId+"/carid="+a.grades[g].car;q.attr("href",r),q.html(T1.labels.configureButton).append($("<i/>").addClass("icon-chevron-right")).appendTo(p),o.on("click",a.onMiniRemoveClick)}catch(s){console.log(s.message)}},onMiniRemoveClick:function(){var b=$(this).parent().parents(".img-select-thumb").attr("mc-model-type");if(2===a.selectedModels.length)return void PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:a.editSelect,customText:a.minWarningText,timeout:2e3});PubSub.publish(T1.constants.MODEL_COMPARE_CHANGE,{selectedModel:b});var c=a.selectedModels.indexOf(b);a.selectedModels.splice(c,1),$(this).parent().remove(),$(".img-select-thumb").attr("class","").addClass(".img-select-thumb "+T1.engineCompare.getColSize()),a.onEditSelection()},onEditSelection:function(){a.filterColumns(),a.generateSelectionControls()}},b={initDesktop:a.initDesktop,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile};return b}();var T1=T1||{};T1.compareModelsMobile=function(){"use strict";var a={container:$("#compareModelsMobile"),dataContainer:$("#gcmEquipments"),data:{source:null,hybrid:{grades:[]},nonHybrid:{grades:[]},index:null},currentTab:null,deferOvl:null,initMobile:function(){b.container.size()&&(PubSub.subscribe(T1.constants.PAGEOVERLAYER_OPEN,function(a,c){c.grade&&c.html.is(b.dataContainer)&&b.loadDetails(c.grade)}),PubSub.subscribe(T1.constants.MOBILE_COMPARE_MODELS_CHANGE,b.mobileCompareModelsChange),PubSub.subscribe(T1.constants.FINANCE_RATES_ON,a.requestFinanceData),PubSub.subscribe(T1.constants.FINANCE_RATES_OFF,a.clearFinanceData),b.container.find(".gcm-section-toggle").click(b.onTabClick),b.container.find(".gcm-model-trigger").click(b.onModelNodeClick),b.getData())},onTabClick:function(a){a.preventDefault&&a.preventDefault(),b.container.find(".gcm-section-toggle").removeClass("active");var c=$(this).addClass("active");PubSub.publish(T1.constants.HASH_REPLACE,{oldValue:b.currentTab,newValue:c.data("gcm-task")}),b.currentTab=c.data("gcm-task"),b.container.find(".gcm-sub-container").removeClass("active"),$("."+c.data("gcm-task")).addClass("active"),scrollTo(0,0)},onModelNodeClick:function(a){a.preventDefault&&a.preventDefault(),"a"!==a.target.nodeName.toLowerCase()&&PubSub.publish(T1.constants.HASH_ADD,"/publish/mobile_compare_models_change/modelCode="+$(this).data("gcm-model-code"))},loadDetails:function(a){var d=b.groupCarEquipment(a);b.dataContainer.find("header h1").html(a.name),b.dataContainer.find("header h4:not(.gcm-promo-count) i").html(globalize.format(a.minPrice.listWithDiscount,"c")),a.minPrice.discounts&&b.dataContainer.find("header .gcm-promo-count-holder").html("("+a.minPrice.discounts.length+")"),b.dataContainer.find("header .gcm-promo-count").toggle(a.minPrice.discountsApplied||!1),b.dataContainer.find("header img").attr("src",T1.settings.CCISHost+"vehicle/"+b.data.source.code+"/"+a.minPrice.car+"/"+c.DEFAULT_EXTERIOR_VIEW),b.dataContainer.find("header p").html(a.description||""),b.dataContainer.find("header a").attr("href",b.data.source.links.CarConfigurator),b.loadCarOptions(d),b.loadCarAccessories(d)},groupCarEquipment:function(a){var b={};if(a.equipment)for(var c=0;c<a.equipment.length;c++){var d=a.equipment[c];b[d.type]||(b[d.type]=[]),b[d.type].push(d)}return b},loadCarOptions:function(a){var d=b.dataContainer.find("#topFeatures").hide();if(d.empty(),a.CarOption){for(var e=0;e<a.CarOption.length;e++){var f=$('<div class="col-xs-6"></div>'),g=b.getOptionImage(a.CarOption[e]);$("<img/>").attr("src",g?T1.settings.cardbImageHost+g.fileName:"/images/"+c.MISSING_IMAGE).appendTo(f),$("<p/>").html(a.CarOption[e].name).appendTo(f),f.appendTo(d)}d.show()}},getOptionImage:function(a){if(a.images)for(var b=0;b<a.images.length;b++)if("IMG_PNG_285x260"===a.images[b].type)return a.images[b]},loadCarAccessories:function(a){var c=b.dataContainer.find("#standardFeatures").hide();if(c.empty(),a.CarAccessory){for(var d=0;d<a.CarAccessory.length;d++)$("<li/>").html(a.CarAccessory[d].name).appendTo(c);c.show()}},mobileCompareModelsChange:function(a,c){if(b.data.source){var d=b.getGrade(c.modelCode);d&&PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{html:b.dataContainer,preserveContent:!0,grade:d,pageName:b.container.data("section-title")}),b.deferOvl=null}else b.deferOvl={evt:a,data:c}},getCarModel:function(){return $(".car-model").data("car-model")},getData:function(){$.getJSON("/api/cardb/gradesequipment/"+b.getCarModel(),b.onGetData)},onGetData:function(a){b.data.source=a;for(var c=0;c<a.subModels.length;c++){var d=a.subModels[c];d.isHybrid?b.data.hybrid=d:b.data.nonHybrid=d}b.deferOvl&&b.mobileCompareModelsChange(b.deferOvl.evt,b.deferOvl.data),b.requestFinanceData(),b.loadPromotions()},getGrade:function(a){if(!b.data.source.index){b.data.source.index={};for(var c=b.getGrades(),d=0;d<c.length;d++)b.data.source.index[c[d].code]=c[d]}return b.data.source.index[a]},getGrades:function(){return b.data.hybrid.grades.concat(b.data.nonHybrid.grades)},loadPromotions:function(){b.data.source&&$(".gcm-model-trigger").each(function(){var a=$(this),c=b.getGrade(a.data("gcm-model-code"));c&&c.minPrice.discountsApplied&&a.find(".promolabel").show()})},requestFinanceData:function(){if("true"===T1.settings.finance.showRatesMonthly&&T1.financeRates.enabled()){for(var c={},d=b.getGrades(),e=0;e<d.length;e++)c[d[e].code]=d[e].minPrice.config;T1.financeService.requestFinanceData({configs:c,success:a.loadFinanceData,multiple:!0,source:"MobileModelsComparer"})}else a.clearFinanceData()},loadFinanceData:function(c){for(var d=b.getGrades(),e=0;e<d.length;e++){var f=d[e].code,g=a.container.find('.gcm-model-trigger[data-gcm-model-code="'+f+'"]'),h=c[f]&&c[f].rate?c[f].rate:null,i=c[f]&&c[f].show?c[f].show:null;if(h&&(h.monthlyPayment&&g.find(".monthly-payment").html(T1.financeService.formatFinanceString(T1.labels.comparator.monthlyPayment,h,i,"b")),i.effectiveRate&&h.effectiveInterestRate||i.annualRate&&h.annualInterestRate)){var j=T1.financeService.formatFinanceString(T1.labels.comparator.priceRate,h,i,"b"),k="_"+d[e].car,l=a.getExpansionContainer(k,!0).appendTo(g),m=T1.financeService.getDisclaimer(h,!0,T1.labels.viewDisclaimer);g.find(".payment-rate").html(j+" ").append($('<a href="#" class="readMore"/>').html(T1.labels.viewDisclaimer).attr("data-tooltip-selector","#"+k)),l.find(".expansion-inner").empty().append(m)}}},clearFinanceData:function(){a.container.find(".monthly-payment"),a.container.find(".payment-rate")},getExpansionContainer:function(b,c){var d=a.container.find(".expansion-content.template").clone().attr("id",b).removeClass("template");return c&&d.append($("<div/>").addClass("expansion-arrow")),d}},b=a,c=T1.constants;return{initMobile:a.initMobile,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile}}();var T1=T1||{};T1.dimensions=function(){"use strict";{var a={container:$("#dimensions"),init:function(){b.container.size()&&b.container.find(".body-filter .dropdown-menu a").click(b.bodyFilterChanged)},bodyFilterChanged:function(a){var c=$(a.target);a.preventDefault(),c.closest(".dropdown-menu").find("li a").removeClass("selected"),b.container.find(".body-filter .dropdown-toggle >span").html(c.html()),c.addClass("selected"),b.container.find(".specifications.active").removeClass("active"),b.container.find(c.attr("href")).addClass("active")
}},b=a;T1.constants}return{init:a.init}}();var T1=T1||{};T1.spotlights=function(){"use strict";var a={labels:{},init:function(){var b=a,c=$(".spotlights");c.length>0&&(PubSub.subscribe(T1.constants.SPOTLIGHTS_CLICK,b.changeText),c.find('a[data-toggle="collapse"]').on("click",b.pub),c.find(".spotlight:not(.direct-link)").on("click",b.clickedSpotlight))},changeText:function(a,b){var c=$(b),d=c.parents(".spotlights"),e="expanded",f=T1.labels.viewLess,g=T1.labels.viewAll,h="";if(d.hasClass(e)){h=" ("+$(".spotlight",d).length+")";var i=g+h;c.text(""+i),d.removeClass(e),d.attr("data-bt-state","collapse")}else c.text(""+f),d.addClass(e),d.attr("data-bt-state","")},pub:function(){PubSub.publish(T1.constants.SPOTLIGHTS_CLICK,this)},clickedSpotlight:function(a){a.preventDefault();var b=$(this),c=b.parents(".spotlights"),d=c.attr("id"),e=c.find(".spotlight:not(.direct-link)").index($(this));location.hash="/spotlight/"+d+"/"+e}};return{init:a.init,changeText:a.changeText}}();var T1=T1||{};T1.specialLink=function(){"use strict";var a={selectors:".action-overlayer, .action-overlayer-ajax, .action-scroll-to",init:function(){$("body").on("click",b.selectors,b.open)},open:function(a){var b=$(this),c=b.prop("href");if(b.hasClass("action-overlayer"))a.preventDefault(),PubSub.publish(T1.constants.HASH_CHANGE,"/iframe/"+encodeURIComponent(c));else if(b.hasClass("action-overlayer-ajax"))a.preventDefault(),PubSub.publish(T1.constants.HASH_CHANGE,"/ajax/"+encodeURIComponent(c));else{if(!b.hasClass("action-scroll-to"))return;a.preventDefault();var d=b.closest(".overlayerContent");(d.length>0?d:$(window)).scrollTo($(b.prop("hash")),T1.constants.ANIMATION_SPEED_SCROLL)}}},b=a;return{init:a.init,initOnDemand:a.initOnDemand}}();var T1=T1||{};T1.social=function(){"use strict";window.___gcfg={lang:"en-GB"};var a={shareButton:$(),isFadingIn:!1,CLASS_SHARE_BUTTON:"share-button",CLASS_LIKE_BUTTON:"like-button",CLASS_NO_POPUP:"no-popup",CLASS_SHARE_ARROW:"sprite-share-arrow",CLASS_SHARE_ARROW_BOTTOM:"sprite-share-arrow-inverted",CLASS_POSITION_BOTTOM:"bottom",CLASS_EPRIVACY_FIGURE:"eprivacy-component",tcmid:$("body").attr("data-tcmid"),init:function(){return b.initShare($("."+b.CLASS_SHARE_BUTTON)),b.initRating(),b.initLike($("."+b.CLASS_LIKE_BUTTON)),null},initShare:function(a){a.size()&&(PubSub.unsubscribe(b.hideBox),PubSub.subscribe(T1.constants.ON_DOC_CLICK,b.hideBox),a.find("> a").unbind("click",b.toggleBox).bind("click",b.toggleBox),a.find(".share-options a").unbind("click",b.onOtherLinkClick).bind("click",b.onOtherLinkClick),b.shareButton=b.shareButton.add(a))},initRating:function(){var a=$(".icon-star").eq(0);if(T1.mypage){var c=T1.mypage.rating.ratingTotal,d=T1.mypage.rating.count,e=d>0?c/d:0;e>0&&b.updateRating(a,e)}$(".rate-button .share-options i").click(b.rate)},initLike:function(a){a.click(function(){var a=$(this),b=a.find(".fb-like > span > iframe");a.attr("data-interval",setInterval(function(){var a=new RegExp("height[:][s]*[^;'\"]*"),c=b.attr("style").toLowerCase().match(a);c&&c[0]&&parseInt(c[0].match(/\d+/g))>300?b.parent().css({height:parseInt(c[0].match(/\d+/g))}).addClass("full-height"):b.parent().css("height","").removeClass("full-height")},500))})},initFB:function(a){window.FB&&a.each(function(){var a=$(this),b=a.find(".fb-like");window.FB.XFBML.parse(this),b.find("span").css("width",b.data("width"))})},clearLikeSurvey:function(){b.shareButton.filter(".like-button").each(function(){var a=$(this);clearInterval(a.attr("data-interval")),a.attr("data-interval",null)})},rate:function(){var a=$(this),c=$.ajax({type:"POST",dataType:"JSON",url:a.parents(".rate-button").data("url"),data:{tcmid:b.tcmid,score:5-a.index()}});c.done(b.ratingSuccess(a)),c.fail(b.ratingError(a))},ratingSuccess:function(a){return function(c){c.success?(c.rating&&b.updateRating(a,c.rating.ratingTotal/c.rating.count),b.ratingMessage(a,T1.labels.rateSubmitted,!c.success)):b.ratingMessage(a,T1.labels.rateAlreadySubmitted,!0)}},ratingError:function(a){return function(c,d,e){b.ratingMessage(a,e||T1.labels.forms.errorSubmit,!0)}},ratingMessage:function(a,b,c){a.parents(".share-options").html('<p class="response'+(c?" error ":"")+'">'+b+"</p>")},updateRating:function(a,b){b=Math.round(2*b)/2;var c=a.parents(".rate-button").find(">a i.icon-star");c.removeClass("highlighted half"),c.filter(":lt("+Math.floor(b)+")").addClass("highlighted"),b%1&&c.filter(":eq("+Math.floor(b)+")").addClass("highlighted half")},switchMobile:function(){b.shareButton.addClass(b.CLASS_NO_POPUP),$("figure."+b.CLASS_EPRIVACY_FIGURE).addClass(b.CLASS_NO_POPUP)},switchDesktop:function(){b.shareButton.removeClass(b.CLASS_NO_POPUP),$("figure."+b.CLASS_EPRIVACY_FIGURE).removeClass(b.CLASS_NO_POPUP)},onOtherLinkClick:function(a){var c=$(this),d=c.attr("href"),e=c.attr("data-link")||c.closest("section").attr("data-link")||window.location.href,f=c.closest(".overlayerContent");f.length>0&&f.find(".carousel").length>0&&(e=f.find(".carousel .item.active").data().dataNode.attr("href")),c.data("encode")&&(e=encodeURIComponent(e)),d=d.replace(/\[URL\]/g,e);var g=c.parents("."+b.CLASS_SHARE_BUTTON);g.hasClass(b.CLASS_NO_POPUP)?c.attr("href",d):(window.open(d,"_blank","location=yes,height=420,width=550"),a.preventDefault()),PubSub.publish(T1.constants.SOCIAL_SHARED,{href:d,url:e,node:c})},hideBox:function(a,c){var d=$(c.target);b.isFadingIn||0!==d.closest(".share-options").length||(b.doHideBox(),b.clearLikeSurvey())},doHideBox:function(){var a=b.shareButton.not(".no-popup").find(".share-box"),c=$("#social-tools-gallery").find(".share-box");c.fadeOut("fast"),a.fadeOut("fast",function(){if($(this).hasClass(b.CLASS_POSITION_BOTTOM)){$(this).removeClass(b.CLASS_POSITION_BOTTOM);var a=$(this).find("."+b.CLASS_SHARE_ARROW_BOTTOM);a.css("marginTop","-1px"),a.toggleClass(b.CLASS_SHARE_ARROW+" "+b.CLASS_SHARE_ARROW_BOTTOM)}})},toggleBox:function(a){var c=$(this),d=c.parent(),e=d.closest(".container"),f=d.find(".share-box"),g="",h=e.offset(),i=f.offset(),j=null,k=null,l=null;if(!f||f.is(":visible")||d.hasClass("no-popup"))d.hasClass("no-popup")&&(f.is(":visible")?f.slideUp("slow"):f.slideDown("slow"));else if(b.doHideBox(),b.isFadingIn=!0,f.fadeIn(function(){b.isFadingIn=!1}),h&&i){l=f.find(".share-options"),k=f.find("."+b.CLASS_SHARE_ARROW),k.css("margin-left",d.innerWidth()/2-k.innerWidth()/2+"px"),g="-"+(l.innerWidth()/2-(k.innerWidth()/2+parseFloat(k.css("margin-left").replace("px",""))))+"px",l.css("margin-left",g),j=l.offset(),h.left+e.width()<j.left+l.width()?(l.css("margin-left","0px"),j=l.offset(),g=h.left+e.width()-(j.left+l.width())+"px",l.css("margin-left",g)):h.left>j.left&&(l.css("margin-left","0px"),j=l.offset(),g=h.left-j.left+"px",l.css("margin-left",g));var m=f.offset(),n=$(window),o=$("#nav-primary"),p=$("#nav-secondary-level"),q=n.scrollTop()+o.height();if(q=p.length>0?q+p.height():q,m.top<q){f.addClass(b.CLASS_POSITION_BOTTOM),k.toggleClass(b.CLASS_SHARE_ARROW_BOTTOM+" "+b.CLASS_SHARE_ARROW);var r=k.height()+l.outerHeight();k.css("marginTop",-(r-2))}}a.preventDefault()}},b=a;return{init:a.init,switchMobile:a.switchMobile,switchDesktop:a.switchDesktop,share:{init:a.initShare},like:{init:function(b){a.initShare(b),a.initLike(b),a.initFB(b)}}}}();var T1=T1||{};T1.tables=function(){"use strict";var a={init:function(){return PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,a.sortable),a.sortable(),null},sortable:function(){for(var a=$(".sortable-table"),b=0;b<a.length;b++){for(var c=0,d={headers:{},sortList:[]},e=$(a[b]),f=e.find("th"),g=0;g<f.length;g++){var h=f[g],i=$(h),j=i.data("sortable-headers"),k=i.data("sortable-sort");switch(j&&(d.headers[c]=j),k){case"asc":d.sortList.push([c,0]);break;case"desc":d.sortList.push([c,1])}c++}e.tablesorter(d)}}};return{init:a.init}}();var T1=T1||{};T1.disclaimer=function(){"use strict";var a={init:function(){a.setDisclaimer()},setDisclaimer:function(){var a=666;$(".disclaimer-view").on("click",function(b){b.preventDefault(),$(this).prev().fadeIn(a),$(this).hide()}),$(".disclaimer-close").on("click",function(b){b.preventDefault();var c=$(this).parents(".disclaimer");c.hide(),c.next().fadeIn(a)})}},b={init:a.init};return b}();var T1=T1||{};T1.ePrivacy=function(){"use strict";var a={ePrivacyDisclaimer:$("#ePrivacyDisclaimer"),ePrivacyDisclaimerTimoutId:null,overlayerOpen:!1,figures:$([]),isMobile:!1,CLASS_FIGURE:"eprivacy-component",enabled:!1,init:function(){b.enabled="true"===T1.settings.enableEprivacy&&T1.settings.eprivacy?!0:!1,PubSub.subscribe(c.EPRIVACY_LOAD_COMPONENT,b.loadComponent),T1.utilities.cookies.getCookie("btpstkn")||b.checkBrighttagPrivacy(),b.enabled&&(PubSub.subscribe(c.PAGEOVERLAYER_RESIZE,b.setSpecsFooterPosition),PubSub.subscribe(c.PAGEOVERLAYER_CLOSED,b.overlayerClosed),PubSub.subscribe(c.EPRIVACY_OPEN,b.open),PubSub.subscribe(c.PAGEOVERLAYER_LOAD,b.initOverlayer),b.ePrivacyDisclaimer.size()&&(PubSub.subscribe(c.EPRIVACY_AUTO_APPROVED,b.autoApprove),$(".ePrivacyOpenLink").click(function(a){a.preventDefault(),PubSub.publishSync(c.EPRIVACY_OPEN,{url:$(this).attr("href")})}),$(".ePrivacyAutoApproveLink").on("click",function(a){a.preventDefault(),PubSub.publishSync(c.EPRIVACY_AUTO_APPROVED)}),b.isLevelSet()||$(window).load(b.showDisclaimer)))},initOverlayer:function(){!b.overlayerOpen&&$("#ePrivacy").size()&&($("#eprivacyCancel").click(b.cancel),$("#eprivacySave").click(b.save),$("#functionalBox").click(b.functionalChanged),$("#targetingBox").click(b.targetingChanged),b.applyCurrentLevel(),b.overlayerOpen=!0,PubSub.publish(c.PAGEOVERLAYER_RESIZE),b.setOverlayerClass())},switchMobile:function(){b.switchDevice(!0)},switchDesktop:function(){b.switchDevice(!1)},switchDevice:function(a){b.isMobile=a,b.ePrivacyDisclaimer.is(":visible")&&b.applyStyles(b.getDisclaimerAnimations().show)},open:function(a,c){b.overlayerOpen||PubSub.publish(T1.constants.HASH_CHANGE,"/publish/pageoverlayer_open/url="+encodeURIComponent(c.url)+"/ajax=true")},setOverlayerClass:function(){$("#ePrivacy").parents(".overlayerWrapper").addClass("ePrivacy")},checkBrighttagPrivacy:function(){window.BTPrivacy&&BTPrivacy.getPrivacySettings(b.setBrighttagPrivacy)},setBrighttagPrivacy:function(a){if(a&&!a.doNotTrack){var c=b.getCurrentLevel();c&&c>"20"?BTPrivacy[c>"30"?"optIn":"functional"]():BTPrivacy.optOut()}},getDisclaimerAnimations:function(){return{hide:[{objects:$("body"),style:{name:"padding-bottom",value:"0px"}}],show:[{objects:$("body"),style:{name:"padding-bottom",value:b.ePrivacyDisclaimer.innerHeight()+"px"}},{objects:b.ePrivacyDisclaimer,style:{name:"bottom",value:"0px"}}]}},removeAnimationsStyles:function(){for(var a=b.getDisclaimerAnimations().hide,c=0;c<a.length;c++){var d={};d[a[c].style.name]="",a[c].objects.css(d)}},setSpecsFooterPosition:function(){if(b.overlayerOpen){var a=b.getObjectsMaxHeight($("#cookie-specs > li > footer"),!0);$("#cookie-specs > li > footer").each(function(){var b=$(this);b.css("margin-top","").css("min-height",a+"px"),b.hasClass("fixed-line-height")&&b.css("line-height",a+"px")});var c=b.getObjectsMaxHeight($("#cookie-specs > li"));$("#cookie-specs > li > footer").each(function(){var b=$(this);b.css("margin-top",c-b.position().top-a+"px")})}},getObjectsMaxHeight:function(a,b){var c=0;return a.each(function(){var a=$(this),d=b?a.innerHeight():a.height();c=d>c?d:c}),c},cancel:function(a){a.preventDefault(),b.setHash(),PubSub.publish(c.EPRIVACY_CANCELED)},save:function(a){a.preventDefault(),b.saveCurrentLevel(),b.reviewComponents(),b.setHash(),PubSub.publish(c.EPRIVACY_SAVED)},autoApprove:function(){b.ePrivacyDisclaimer.size()&&(b.isLevelSet()||(b.applyCurrentLevel(!0),b.saveCurrentLevel(!0)),b.hideDisclaimer())},showDisclaimer:function(){b.ePrivacyDisclaimer.show(),b.ePrivacyDisclaimer.size()&&$(function(){b.ePrivacyDisclaimer.css("bottom",-b.ePrivacyDisclaimer.innerHeight()).show();for(var a=$([]),c=b.getDisclaimerAnimations().show,d=0;d<c.length;d++)a=a.add(b.playAnimation(c[d]));a.promise().done(function(){"implicit"===T1.settings.eprivacy.type&&(b.ePrivacyDisclaimer.mouseenter(b.stopDisclaimerTimeout).mouseleave(b.startDisclaimerTimeout),b.startDisclaimerTimeout()),b.startSurveyDisclaimerSize()})})},hideDisclaimer:function(){b.ePrivacyDisclaimer.size()&&(b.stopDisclaimerTimeout(),$(function(){for(var a=$([]),c=b.getDisclaimerAnimations().hide,d=0;d<c.length;d++)a=a.add(b.playAnimation(c[d]));a.promise().done(function(){b.removeDisclaimer()})}))},overlayerClosed:function(){b.overlayerOpen&&(b.overlayerOpen=!1,b.hideDisclaimer())},setHash:function(a){PubSub.publish(a?c.HASH_ADD:c.HASH_REMOVE,a||"")},removeDisclaimer:function(){b.stopSurveyDisclaimerSize(),b.ePrivacyDisclaimer.remove(),b.removeAnimationsStyles()},playAnimation:function(a){var b={};return b[a.style.name]=a.style.value,a.objects.animate(b)},applyStyles:function(a){for(i=0;i<a.length;i++){var b={};b[a[i].style.name]=a[i].style.value,a[i].objects.css(b)}},startDisclaimerTimeout:function(){b.stopDisclaimerTimeout(),b.ePrivacyDisclaimerTimeoutId=setTimeout(b.autoApprove,T1.settings.eprivacy.delay||7e3)},stopDisclaimerTimeout:function(){clearTimeout(b.ePrivacyDisclaimerTimeoutId),b.ePrivacyDisclaimerTimeoutId=null},startSurveyDisclaimerSize:function(){$(window).on("load resize",b.resetDisclaimerSize)},stopSurveyDisclaimerSize:function(){$(window).off("load resize",b.resetDisclaimerSize)},resetDisclaimerSize:function(){var a=b.ePrivacyDisclaimer.innerHeight(),c=b.getDisclaimerAnimations().hide;for(i=0;i<c.length;i++){var d={};d[c[i].style.name]=parseInt(c[i].style.value,10)+a+"px",c[i].objects.css(d)}},functionalChanged:function(){var a=$("#functionalBox"),c=$("#targetingBox");a.prop("checked")||c.prop("checked",!1);var d=b.getVirtualLevel();a.prop("checked",d>=T1.settings.eprivacy.levels[1]),b.fadeSettings(a,c)},targetingChanged:function(){var a=$("#functionalBox"),c=$("#targetingBox");c.prop("checked")&&a.prop("checked",!0);var d=b.getVirtualLevel();c.prop("checked",d>=T1.settings.eprivacy.levels[2]),b.fadeSettings(a,c)},fadeSettings:function(a,b){a.closest("li").fadeTo(400,a.prop("checked")?1:.5),b.closest("li").fadeTo(400,b.prop("checked")?1:.5)},isLevelSet:function(){return T1.utilities.cookies.getCookie(c.EPRIVACY_COOKIE_NAME)?!0:!1},getCurrentLevel:function(a){if(b.enabled){var d=T1.utilities.cookies.getCookie(c.EPRIVACY_COOKIE_NAME),e="explicit"!==T1.settings.eprivacy.type||a?T1.settings.eprivacy.defaultLevel:T1.settings.eprivacy.levels[0];return d?d.replace(/#.*/g,""):e}return Number.MAX_VALUE},getVirtualLevel:function(a){if($("#ePrivacy").size()){var c=$("#functionalBox").prop("checked")?1:0;return T1.settings.eprivacy.levels[$("#targetingBox").prop("checked")?2:c]}return b.getCurrentLevel(a)},saveCurrentLevel:function(a){var d=b.getVirtualLevel(a);T1.utilities.cookies.setCookie(c.EPRIVACY_COOKIE_NAME,d+"#"+T1.settings.eprivacy.version,365),b.checkBrighttagPrivacy()},applyCurrentLevel:function(a){if($("#ePrivacy").size()){var c=$("#functionalBox"),d=$("#targetingBox"),e=b.getCurrentLevel(a);c.prop("checked",e>=T1.settings.eprivacy.levels[1]),d.prop("checked",e>=T1.settings.eprivacy.levels[2]),b.fadeSettings(c,d)}},validateLevel:function(a){return a<=b.getCurrentLevel()},loadComponent:function(a,c){if(b.figures=b.figures.add(c.figures||(c.root?c.root.find("figure."+b.CLASS_FIGURE):null)),!c.defer){var d=b.groupComponents(b.figures),e=[];for(var f in d){var g=d[f][0].data();b.validateLevel(g.level)&&e.push($.get(g.url,b.loadGroup(d[f],g)))}$.when.apply($,e).done(function(){b.figures=$([]),c.callback&&c.callback()})}},loadGroup:function(a,c){return function(d){for(var e=0;e<a.length;e++){var f=a[e],g=b.registerComponent($(d),f,c.level),h=Object.resolve(c.namespace,T1);f.replaceWith(g),h&&h.init&&h.init(g)}}},unloadComponent:function(a){a.replaceWith(a.data("figure"))},reviewComponents:function(){$("."+b.CLASS_FIGURE).filter(function(){return parseInt($(this).attr("data-eprivacy"),10)>b.getCurrentLevel()}).each(function(){b.unloadComponent($(this))}),PubSub.publishSync(T1.constants.FIGURE_LOAD)},registerComponent:function(a,c,d){return a.data("figure",c).attr("data-eprivacy",d).addClass(b.CLASS_FIGURE).addClass(c.attr("class"))},groupComponents:function(a){var b={};return a.each(function(){var a=$(this);b[a.data("url")]||(b[a.data("url")]=[]),b[a.data("url")].push(a)}),b}},b=a,c=T1.constants;return{init:a.init,getCurrentLevel:a.getCurrentLevel,validateLevel:a.validateLevel,registerComponent:a.registerComponent,switchMobile:a.switchMobile,switchDesktop:a.switchDesktop}}();var T1=T1||{};T1.video=function(){"use strict";var a={_player:null,_playerVideoNode:null,_playerNode:null,_playerId:"videoWrapper",_posterImage:null,_evPlay:null,_evFull:null,_flashFallback:!1,_autoplayToken:null,isIeMobile:T1.utilities.isIeMobile,init:function(){var b=a;PubSub.subscribe(T1.constants.VIDEO_CLICK,b.loadVideo),PubSub.subscribe(T1.constants.VIDEO_STOP,b.stop),PubSub.subscribe(T1.constants.PAGEOVERLAYER_CLOSE,b.stop),PubSub.subscribe(T1.constants.VIDEO_CREATEPLAYER,b.addVideoPlayer),PubSub.subscribe(T1.constants.VIDEO_RESET,b.reset),b._flashFallback=T1.utilities.ieVersion<=10&&!b.isIeMobile,$("body").on("click",".video-overlayer",b.showVideoOverlayer)},createPlayer:function(b){var c=a;return c._flashFallback&&(vjs.options.techOrder=["flash","html5","links"]),c._playerNode||(c._playerNode=c._playerVideoNode=$("<video id="+c._playerId+" poster="+b+" preload='auto'></video>").addClass("video-js vjs-default-skin t1-skin"),c._playerNode.appendTo($("body")),window.vjs?c._player=vjs(c._playerId,{controls:!0,autoplay:!1,preload:"auto"}):(c._player=c._playerNode.get(0),c._playerNode.on("touchend",c.togglePlay)),c._playerNode=$("#"+c._playerId).css({width:"100%",height:"100%"})),PubSub.publish(T1.constants.VIDEO_CREATEDPLAYER,{}),c._player},loadVideo:function(b,c){var d=a,e=$(c)||$(".item.active .posterWrapper"),f={mp4:e.data("video-mp4"),webm:e.data("video-webm"),ogv:e.data("video-ogv"),flv:e.data("video-flv")},g=e.data("video-vtt"),h=e.data("video-vtt-lang"),i=[];d._autoplayToken&&PubSub.unsubscribe(d._autoplayToken),f.mp4&&!d._flashFallback&&i.push({type:"video/mp4",src:f.mp4}),f.webm&&!d._flashFallback&&i.push({type:"video/webm",src:f.webm}),f.ogv&&!d._flashFallback&&i.push({type:"video/ogg",src:f.ogv}),f.flv&&i.push({type:"video/flv",src:f.flv});var j=e.find("img").attr("src")||e.find("img").attr("data-lazy-load");d._player||(d._player=d.createPlayer(j)),e.parent().prepend(d._playerNode),e.stop(),$(".posterWrapper").css({display:"block"}),e.css({display:"none"}),window.vjs?$("#videoWrapper_html5_api").attr("poster",j):d._playerNode.attr("poster",j),d.switchSource(i),g&&d.loadSubs(g,h),d.play()},switchSource:function(b){var c=a;window.vjs?c._player.src(b):"video/mp4"===b[0].type?c._playerNode.attr("src",b[0].src):(c._playerNode.attr("src",""),c.showError(T1.labels?T1.labels.videoSourceNotSupported:"Not supported source"))},showError:function(b){var c=a,d=c._playerNode.parent(),e=d.find(".error-inner");if(0===e.length){var f=$("<div></div>").addClass("error").appendTo(d);e=$("<div></div>").addClass("error-inner").appendTo(f)}e.html(b)},stop:function(){var b=a;b._player&&(b._player.pause(),b.removeSubs(),(b._flashFallback||b._playerNode.find("> object").length>0)&&(b._playerNode.prev(".posterWrapper").css({display:"block"}),b._player.dispose(),b._playerNode.remove(),b._playerNode=null,b._player=null))},loadSubs:function(b,c){var d=a;d.removeSubs();var e=c||"en",f=d._player.addTextTrack("Captions"," ",e,{src:b});f.show()},removeSubs:function(){var b=a;void 0!==b._player.textTracks()[0]&&(b._player.textTracks()[0].disable(),b._player.textTracks()[0].hide(),b._playerNode.find(".vjs-captions").remove(),b._player.textTracks().splice(0,1))},play:function(){var b=a;b._player&&b._player.play()},togglePlay:function(){var b=a;b._player&&(b._player.paused?b._player.play():b._player.pause())},reset:function(){var b=a;b._playerNode&&(b.stop(),$(".posterWrapper").css({display:"block"}),b._playerNode.remove())},addVideoPlayer:function(b,c){var d=a,e=$('<div class="posterWrapper"></div>'),f=c.target||$("body"),g=c.autoplay||!1,h=$("<img>"),i=T1.utilities.hasFlash(),j=(T1.utilities.ieVersion,"https://get.adobe.com/flashplayer/"),k=c.lazyLoadPoster||!1,l=$('<div class="sprite-videoplayer-start-button" style="display:block;" onclick=""></div>'),m=function(a){a.preventDefault(),PubSub.publish(T1.constants.VIDEO_CLICK,$(this).parent())},n={};if(d._flashFallback&&!i)return e=$("<div class=noflash ><h2>"+T1.labels.FLASH_ERROR+"</h2><p>"+T1.labels.FLASH_YOU_NEED+" <a href="+j+" >"+T1.labels.FLASH_FLASHPLAYER+"</a> "+T1.labels.FLASH_TO_PLAY+"</p></div>"),!1;var o={};o[k?"data-lazy-load":"src"]=c.poster,h.attr(o),c.srcMp4&&(n["data-video-mp4"]=c.srcMp4),c.srcWebm&&(n["data-video-webm"]=c.srcWebm),c.srcOgv&&(n["data-video-ogv"]=c.srcOgv),c.srcFlv&&(n["data-video-flv"]=c.srcFlv),c.srcVtt&&(n["data-video-vtt"]=c.srcVtt),c.srcVttLang&&(n["data-video-vttLang"]=c.srcVttLang),e.attr(n),e.append(l),e.append(h),c.figure?c.figure.replaceWith(e):f.append(e);var p=T1.utilities.hasEvent("ontouchend")?"touchend":"click";l.off(p,m).on(p,m),g&&window.vjs&&!d.isIeMobile&&(d._autoplayToken=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,function(){PubSub.publish(T1.constants.VIDEO_CLICK,e)}))},showVideoOverlayer:function(a){a.preventDefault(),location.hash="/video/"+$(this).attr("id")}};return{init:a.init,loadVideo:a.loadVideo,stop:a.stop,play:a.play,createPlayer:a.createPlayer}}();var T1=T1||{};T1.promotions=function(){"use strict";var a={FILTER_MODEL:"model",FILTER_OFFER:"offer",FILTER_TYPE:"type",LABEL_HYBRID:"hybrid",LABEL_NON_HYBRID:"standard",CLASS_HYBRID:"active",CLASS_ACTIVE_SELECT:"select",CLASS_EXPANDED:"open",CLASS_CLEAR:"clear",isRefreshable:!0,mustCheck:!1,init:function(){PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,function(a,b){var c="";switch(b){case"xs":c="SCREEN_XTRASMALL";break;case"sm":c="SCREEN_SMALL";break;case"md":c="SCREEN_MEDIUM";break;case"lg":c="SCREEN_LARGE"}$(".offer-header > img").attr("width",T1.constants[c])}),b.container=$(".promotions"),b.container.length>0&&(b.filterableWrapper=b.container.find(".filterable-wrapper"),b.filterable=b.filterableWrapper.find(".filterable"),b.checkBoxes=b.container.find('input[type="checkbox"]'),b.checkBoxModels=b.checkBoxes.not(".select-all"),b.checkBoxAll=b.checkBoxes.filter(".select-all"),b.radios=b.container.find('input[type="radio"]'),b.typeButton=b.container.find(".btn-type-toggle"),b.typeAllButton=b.container.find(".btn-type-all"),b.typeHybridButton=b.container.find(".btn-type-hybrid"),b.toggleAllModelsButton=b.container.find(".btn-select-all"),b.resetButton=b.container.find(".btn-reset"),b.collapseButton=b.container.find(".btn-circle"),b.typeFilter=b.container.find(".filter-wrapper-type"),b.setModelBinding(),b.setOfferBinding(),b.setTypeBinding(),b.setAllModelsFiltering(),b.setResetFiltering(),b.clearFloatDisplay())},switchDesktop:function(){b.container.length>0&&"auto"!=b.typeFilter.height()&&b.typeFilter.css("height","auto")},setModelBinding:function(){b.checkBoxModels.on("change",b.refreshDisplay),b.checkBoxAll.on("change",b.showAll)},showAll:function(){b.refreshDisplay({models:[]})},setOfferBinding:function(){b.radios.on("change",b.radioChange),b.collapseButton.on("click",b.offerCollapse)},radioChange:function(){this.checked=!0,b.refreshDisplay()},setTypeBinding:function(){b.typeButton.on("click",function(){b.toggleTypeButton(),b.refreshDisplay()});var a=b.typeAllButton.add(b.typeHybridButton);a.on("click",function(){b.toggleTypeAllHybridButton($(this)),b.refreshDisplay()})},setAllModelsFiltering:function(){b.toggleAllModelsButton.on("click",b.toggleAllModels)},setResetFiltering:function(){b.resetButton.on("click",b.resetFiltering)},refreshDisplay:function(a){if(a||(a={}),b.isRefreshable){var c=a.models||b.getModel(),d=b.getOffer(),e=b.getType()||b.LABEL_NON_HYBRID,f=!1,g=null,h=null,i=0===c.length;b.filterable.each(function(){g=$(this),g.removeClass(b.CLASS_CLEAR),h=i||b.isModelIncluded(g.data(b.FILTER_MODEL),c),!h||g.data(b.FILTER_OFFER)!==d&&"all"!==d||e!=b.LABEL_NON_HYBRID&&g.data(b.FILTER_TYPE)!==e?g.hide():(g.show(),f=!0)}),f===!0?(b.filterableWrapper.show(),b.clearFloatDisplay()):b.filterableWrapper.hide()}},isModelIncluded:function(a,b){if(!a)return!0;for(var c=a.replace(/\s/g,"").split(","),d=0;d<b.length;d++)for(var e=0;e<c.length;e++)if(b[d]&&c[e]&&b[d].toLowerCase()===c[e].toLowerCase())return!0;return!1},clearFloatDisplay:function(){var a=b.filterable.filter(":visible");a.each(function(a){a%2===0&&$(this).addClass(b.CLASS_CLEAR)})},offerCollapse:function(){$(this).toggleClass(b.CLASS_EXPANDED)},getModel:function(){var a=[];return b.checkBoxes.each(function(){$(this).is(":checked")&&a.push($(this).data(b.FILTER_MODEL))}),a},getOffer:function(){var a="";return b.radios.each(function(){return $(this).is(":checked")?(a=$(this).val(),!1):void 0}),a},getType:function(){var a,c=null;return b.typeButton.is(":visible")?a=b.typeButton:b.typeHybridButton.each(function(){return $(this).is(":visible")?(a=$(this),!1):void 0}),a&&(c=a.hasClass(b.CLASS_HYBRID)?b.LABEL_HYBRID:b.LABEL_NON_HYBRID),c},toggleTypeButton:function(){var a=b.typeButton,c="";a.toggleClass(b.CLASS_HYBRID),a.hasClass(b.CLASS_HYBRID)?(c=T1.labels.viewAllModels,a.addClass("btn-grey").removeClass("btn-blue")):(c=T1.labels.viewOnlyHybridModels,a.addClass("btn-blue").removeClass("btn-grey")),a.text(c)},toggleTypeAllHybridButton:function(a){if(!a.hasClass(b.CLASS_HYBRID)){var c=a.is(b.typeAllButton)?b.typeHybridButton:b.typeAllButton;a.toggleClass(b.CLASS_HYBRID),c.toggleClass(b.CLASS_HYBRID)}},toggleAllModels:function(a){a&&a.preventDefault(),b.isRefreshable=!1;var c=b.toggleAllModelsButton,d=b.mustCheck===!0||c.hasClass(b.CLASS_ACTIVE_SELECT)?!0:!1;if(b.checkBoxes.each(function(){(!d&&$(this).is(":checked")||d&&!$(this).is(":checked"))&&$(this).prop("checked",d).trigger("change")}),b.mustCheck!==!0||c.hasClass(b.CLASS_ACTIVE_SELECT)){var e="";e=c.hasClass(b.CLASS_ACTIVE_SELECT)?T1.labels.deselectAll:T1.labels.selectAll,c.text(e),c.toggleClass(b.CLASS_ACTIVE_SELECT),b.isRefreshable=!0,b.refreshDisplay()}},resetFiltering:function(a){a.preventDefault(),b.isRefreshable=!1,b.mustCheck=!0,b.toggleAllModels(),b.mustCheck=!1,b.resetOfferFilter(),b.resetTypeFilter(),b.isRefreshable=!0,b.refreshDisplay()},resetOfferFilter:function(){b.radios.not(":first").prop("checked",!1).trigger("change"),b.radios.eq(0).prop("checked",!0).trigger("change")},resetTypeFilter:function(){b.typeButton.hasClass(b.CLASS_HYBRID)&&b.toggleTypeButton()}},b=a;return{init:a.init,switchDesktop:a.switchDesktop}}();var T1=T1||{};T1.carconfig=function(){"use strict";var a={params:{},tokens:{},urlContent:null,viewportMeta:null,init:function(){var b=a;b.urlContent=T1.settings.carconfig.urlContent||"/mockups/carconfig/index.html",b.tokens.load=PubSub.subscribe(T1.constants.CARCONFIG_LOAD,b.openCarConfig)},setCarConfigParams:function(){var b=a,c=$('.overlayerContent iframe[src="'+b.urlContent+'"]'),d=c[0].contentWindow;d.PubSub.publish(T1.constants.OVERLAY_READY,b.params),PubSub.unsubscribe(b.tokens.overlay)},openCarConfig:function(b,c){var d=a;if(d.params=c,Modernizr.touch&&(d.scale(),d.tokens.overlayclose=PubSub.subscribe(T1.constants.PAGEOVERLAYER_REOPEN_MAINCONTENT,d.resetScale)),"xs"===T1.utilities.currentBreakpoint())if(d.tokens.openMobile=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,d.openCarConfigMobile),0===$("#minicarconfig").length){var e=d.getCarconfigMiniHtm();PubSub.publishSync(T1.constants.MOBILE_OPEN,{section:$(e)})}else PubSub.publishSync(T1.constants.MOBILE_OPEN,{id:"minicarconfig"});else d.tokens.overlay=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,d.setCarConfigParams),PubSub.publishSync(T1.constants.PAGEOVERLAYER_OPEN,{iframe:!0,url:d.urlContent,sync:!0,noScroll:!T1.utilities.isIOS()})},getCarconfigMiniHtm:function(){var a=$.ajax({async:!1,url:"/assets/carconfig-mini-inject.htm"});return a.responseText},openCarConfigMobile:function(){var b=a;PubSub.unsubscribe(b.tokens.openMobile),PubSub.publish(T1.constants.CARCONFIG_MINI_INIT,{repositionImage:!0}),PubSub.publish(T1.constants.CARCONFIG_MINI_LOAD,b.params)},scale:function(){if("xs"!==T1.utilities.currentBreakpoint()){var b=a,c=$("head").find("meta[name=viewport]");b.viewportMeta||(b.viewportMeta=c.attr("content")),c.attr("content","width=1100px;")}},resetScale:function(){if("xs"!==T1.utilities.currentBreakpoint()){var b=a,c=$("head").find("meta[name=viewport]");c.attr("content",b.viewportMeta),PubSub.unsubscribe(b.tokens.overlayclose)}},nlOffer:function(a){var b=T1.settings.mock?"http://t1-preview-proxy.herokuapp.com":T1.settings.loadSaveServer;$.ajax({url:b+"/config/"+a+"/xml/full"}).done(function(a,b,c){PubSub.publish(T1.constants.FORM_CROSS_DOMAIN_POST,{action:"http://taxatiemodule.toyota.nl/",target:"_blank",fields:{configuration:c.responseText}})})},nlFinance:function(a){var b=T1.settings.mock?"http://t1-preview-proxy.herokuapp.com":T1.settings.loadSaveServer;$.ajax({url:b+"/config/"+a+"/xml/legacy"}).done(function(a,b,c){PubSub.publish(T1.constants.FORM_CROSS_DOMAIN_POST,{action:"http://calculator.toyotafs.nl/asp/carconfig.asp?countrycode=&lnksrc=3948cd6a55c4f1b225cfc1f6c1a50845",target:"_blank",fields:{configuration:c.responseText}})})}};return{init:a.init,openCarConfig:a.openCarConfig,nlOffer:a.nlOffer,nlFinance:a.nlFinance}}();var T1=T1||{};T1.carconfigMini=function(){"use strict";var a={jsonData:null,dropdowns:null,dropdownIndex:0,step:0,steps:{},selectedItems:[],selectedSteps:{},selectedLists:{},iconChevron:$("<i>"),wasStartedMobile:!1,wasStartedDesktop:!1,isMobile:!1,hasMobileInit:!1,isFinalized:!1,CLASS_HIDE:"hide",CLASS_HIDDEN_XS:"hidden-xs",CLASS_DROPDOWN_MENU:"dropdown-menu",CLASS_DISABLED:"disabled",tokens:{},init:function(){var b=a;PubSub.subscribe(T1.constants.CARCONFIG_MINI_INIT,b.initModuleVariables),PubSub.publish(T1.constants.CARCONFIG_MINI_INIT,{}),PubSub.subscribe(T1.constants.CARCONFIG_END,b.requestCarCode),PubSub.subscribe(T1.constants.CARCONFIG_MINI_END,b.requestCarCode),PubSub.subscribe(T1.constants.FINANCE_RATES_ON,a.loadConfigFinanceData),PubSub.subscribe(T1.constants.FINANCE_RATES_OFF,a.hideFinance)},initModuleVariables:function(a,c){if(c||(c={}),b.miniConfig=c.el||$(".carconfig-mini"),b.miniConfig.length>0){var d=$(".carconfig-mini-cta");b.isTrackingEnabled="object"==typeof window.t1DataLayer,b.dropdownWrapper=b.miniConfig.find(".carconfig-mini-select"),b.dropdowns=b.dropdownWrapper.find(".dropdown"),b.preSelectedLink=b.dropdowns.find("."+b.CLASS_DROPDOWN_MENU+" a[data-selected]"),b.previewWrapper=b.miniConfig.find(".carconfig-mini-preview"),b.ecoLabels=$(".carconfig-mini-ecolabels"),b.ecoLabelsTitle=b.ecoLabels.find("h3"),b.ecoLabelsSubtitle=b.ecoLabels.find("h4"),b.ecoLabelsImage=b.ecoLabels.find(".eco-grade"),b.ecoLabelsTable=b.ecoLabels.find(".eco-table"),b.ecoLabelsDisclaimer=b.ecoLabels.find(".ecolabels-disclaimer"),b.ecoLabelsSpecsCondition=b.ecoLabels.find(".ecolabels-specs-condition"),b.configObj=null,b.summary=b.miniConfig.find(".carconfig-mini-summary"),b.summaryList=b.summary.find(".summary-selection"),b.priceTable=b.summary.find(".summary-price"),b.imageResult=b.miniConfig.find(".image-result"),b.dropdownWrapper.on("click","a[data-id]",b.handleSelection),b.financeBtn=d.find(".btn-finance"),b.financeBtn.on("click",b.postFinanceData),b.btnInsurance=d.find(".btn-insurance"),b.btnInsurance.on("click",b.postInsuranceData),b.configBtn=d.find(".btn-car-configurator"),c.repositionImage&&b.positionCarImage(),b.modelPreselect(),b.steps=T1.constants.CARCONFIG_STEPS}},initMobile:function(){b.setMobile(!0),b.miniConfig.length>0&&(b.wasStartedDesktop||(b.wasStartedMobile=!0),b.resetButton=b.summary.find(".btn-reset"),b.resetButton.on("click",b.reset)),b.tokens.load=PubSub.subscribe(T1.constants.CARCONFIG_MINI_LOAD,b.handleCarConfigLoad)},handleCarConfigLoad:function(b,c){var d=a;if(c.tyCode){var e=$.ajax({type:"GET",dataType:"JSON",url:d.getCarInfoUrl({configCode:c.tyCode})});e.done(d.handleRequestCarInfoSuccess),e.fail(d.handleRequestCarInfoError)}},getCarInfoUrl:function(a){var b=T1.settings.loadSaveServer+"/config/";
return a.configCode?b+=a.configCode+"/full":a.modelId?(b+="toyota/"+T1.settings.country+"/"+T1.settings.language+"/",b+=a.modelId+"/"+a.carId+"/"+a.colourId+"/full/"):a.ConfigurationID&&(b+=a.ConfigurationID+"/full"),b},handleRequestCarInfoSuccess:function(c){var d=T1.labels.carconfigMini;$("ul.carconfig-mini-select, a.btn-reset").css("display","none"),$("ul.summary-selection li").remove();var e,f,g;b.selectedSteps.grades={},b.jsonData={};for(f in c.guids)"prototype"!==f&&"car"===f.toLowerCase()&&(b.selectedSteps.grades.carId=c.guids[f]);b.jsonData.modelId=c.car.model;for(f in c.car)if("prototype"!==f){if(e=c.car[f],f=f.toLowerCase(),g=null,"model"===f)g=d.selectedModel;else if("body"===f)g=d.selectedBodyType;else if("engine"===f)g=d.selectedEngine;else if("transmission"===f)g=d.selectedTransmission;else if("wheeldrive"===f)g=d.selectedWheelDrive;else if("grade"===f)g=d.selectedGrade;else if("colour"===f){var h=e.exterior;g=d.selectedColour,e=h.name,b.selectedSteps.colours={},b.selectedSteps.colours.code=h.code}g&&a.addToSummary({key:f,value:e})}if(b.finalize(),c.price){var i=c.price.colour?c.price.colour.listWithDiscount:0;b.showPrices(c.price.listWithDiscount,i)}else console.log("no price defined")},handleRequestCarInfoError:function(a,b,c){console.log(b+": "+c)},initDesktop:function(){b.setMobile(!1),b.miniConfig.length>0&&(b.wasStartedMobile||(b.wasStartedDesktop=!0),b.niceSummary=b.miniConfig.find(".summary-selection-nice"),b.actionsWrapper=b.miniConfig.find(".carconfig-mini-actions"),b.btnMoreAbout=b.actionsWrapper.find(".btn-more-about"),b.changeCarButton=b.actionsWrapper.find(".btn-reset"),b.myToyotaButton=b.actionsWrapper.find(".btn-my-toyota"),b.cta=$(".carconfig-mini-cta"),b.iconChevron.addClass("icon-chevron-down"),b.dropdownWrapper.on("click","a."+b.CLASS_DISABLED,function(a){a.preventDefault()}),b.changeCarButton.on("click",b.reset),b.myToyotaButton.on("click",b.save))},switchMobile:function(){b.setMobile(!0),b.miniConfig.length>0&&(b.hasMobileInit=b.isMobile?!0:!1,b.setButtonLook(),b.hideDropdowns(),b.positionCarImage(),b.ecoLabelsDisplay(!0))},switchDesktop:function(){b.setMobile(!1),b.miniConfig.length>0&&(b.setButtonLook(),b.showDropdowns(),b.positionCarImage(),b.ecoLabelsDisplay(!1),b.isFinalized&&(b.hideDropdownsWrapper(),b.showNiceOptions(),b.showActions(),b.showCTA()))},setMobile:function(a){b.isMobile=a},setButtonLook:function(){var a="btn btn-grey btn-full-width",c=b.dropdowns.find("ul a");b.isMobile?c.addClass(a):c.removeClass(a)},hideDropdowns:function(){if(b.dropdowns.addClass(b.CLASS_HIDE),!b.isFinalized)if(b.hasMobileInit&&!b.wasStartedDesktop&&b.preSelectedLink.length>0){b.hasMobileInit=!1;var a=b.dropdowns.eq(1);a.removeClass(b.CLASS_HIDE)}else{var c=b.dropdowns.find(".dropdown-toggle").not("."+b.CLASS_DISABLED).last();c.parent().removeClass(b.CLASS_HIDE)}},showDropdowns:function(){b.dropdowns.removeClass(b.CLASS_HIDE)},showDropdownsWrapper:function(){b.dropdownWrapper.show()},hideDropdownsWrapper:function(){b.dropdownWrapper.hide()},positionCarImage:function(){b.isMobile?b.imageResult.parent().is(b.previewWrapper)&&b.summaryList.before(b.imageResult):b.imageResult.next().is(b.summaryList)&&b.previewWrapper.prepend(b.imageResult)},dropdownSwitch:function(a){b.isMobile&&(a.addClass(b.CLASS_HIDE),a.next().removeClass(b.CLASS_HIDE))},modelPreselect:function(){b.preSelectedLink.length>0&&(b.handleSelection({target:b.preSelectedLink}),b.preSelectedLink.parents(".dropdown").find(".dropdown-toggle").addClass(b.CLASS_DISABLED))},addToSummary:function(a){if(a){var c,d,e,f=$("<li>");a.parents?(c=a.parents(".dropdown").data("step"),e=a.text()):(c=a.key,e=a.value),d=b.getStepLabel(c),f.html("<strong>"+d+": </strong>"+e),b.summaryList.append(f)}},getStepLabel:function(a){var b={models:T1.labels.carconfigMini.selectedModel,bodyType:T1.labels.carconfigMini.selectedBodyType,engine:T1.labels.carconfigMini.selectedEngine,transmission:T1.labels.carconfigMini.selectedTransmission,wheelDrives:T1.labels.carconfigMini.selectedWheelDrive,grades:T1.labels.carconfigMini.selectedGrade,colours:T1.labels.carconfigMini.selectedColour},c=b[a];return c||a},reset:function(a){if(a.preventDefault(),b.step=0,0===b.preSelectedLink.length&&(b.jsonData=null),b.resetSummary(),b.configObj=null,b.resetDropdowns(b.step+1),b.isMobile){b.hideDropdowns();var c=b.dropdowns.eq(0);c.removeClass(b.CLASS_HIDE)}0===b.preSelectedLink.length&&b.resetDropdownLabel(0),b.showDropdownsWrapper(),b.priceTable.hide(),b.hideResultImage(),b.hideFinance(),b.hideEcoLabels(),b.hideNiceOptions(),b.hideActions(),b.hideCTA(),b.resetCarCode(),b.isFinalized=!1,b.preSelectedLink.length>0&&b.handleSelection({target:b.preSelectedLink})},save:function(a){a.preventDefault(),b.myToyotaButton.attr("data-car-config-code")&&PubSub.publish(T1.constants.CARCONFIG_SAVE_CONFIG,{configCode:b.myToyotaButton.attr("data-car-config-code")})},handleSelection:function(a){a.preventDefault&&a.preventDefault();var c=T1.constants,d=$(a.target),e=d.data("id"),f=d.parents(".dropdown"),g=f.data("step"),h=d.html();if(d.addClass("selected"),b.selectedItems.push(d),b.setDropdownLabel(f,h),b.dropdownSwitch(f),b.addToSummary(d),b.dropdownIndex=b.dropdowns.index(f),b.dropdownIndex<b.step?(b.step=b.dropdownIndex+1,d!==b.selectedItems[b.dropdownIndex]&&(b.resetDropdowns(b.step),b.resetSummary(b.step))):b.dropdownIndex===b.step&&b.step++,b.isTrackingEnabled&&"click"===a.type){if(!b.indexFirstUserSelectableDropdown){b.indexFirstUserSelectableDropdown=b.dropdownIndex;var i,j=f;do i=j.data("bt-workflowname"),i?b.workflowName=i:"BODY"===j.prop("tagName")?b.workflowName="":j=j.parent();while("string"!=typeof b.workflowName)}b.indexFirstUserSelectableDropdown===b.dropdownIndex?PubSub.publish(T1.constants.STATS_TRACK,{node:f,extraData:{event:{workflowname:b.workflowName+";"+b.workflowName,workflowstep:"0;"+f.data("bt-workflowstep")}}}):PubSub.publish(T1.constants.STATS_TRACK,{node:f})}1===b.step?b.jsonData&&b.preSelectedLink.length>0?b.handleDataResponse(b.jsonData,e):$.getJSON(c.URI_MINI_CARCONFIG_DATA+e,b.handleDataResponse):b.step>1&&(b.selectedSteps[g]=b.selectedLists[b.step-1][e],b.step===b.dropdowns.length?b.finalize():b.handleDataResponse(b.jsonData,e))},handleDataResponse:function(a,c){var d=$(b.dropdowns[b.step]),e=0===b.step||1===b.step?a:b.selectedLists[b.step-1][c],f=d.data("step");if(b.selectedLists[b.step]=e[f],b.jsonData!==a){b.jsonData=a;var g=b.dropdownWrapper.find('.dropdown[data-step="wheelDrives"]');a.hasWheeldrives&&a.hasWheeldrives!==!1?g.show():g.hide()}b.populateDropdown(d,b.selectedLists[b.step])},populateDropdown:function(a,c){function d(a,c){var d=$("<li>"),f=$("<a>");if(0===b.step?f.attr("data-id",c.code):f.attr("data-id",a),b.step===b.dropdowns.length-1){var g=c.rgb;if(1===g.length){for(var h="",i=0;6>i;i++)h+=g;g=h}var j,k=T1.utilities.contrastYIQ(g);j="white"===k?"color:"+k+" !important":!1;var l=b.getInlineBackground(g);j?f.attr("style",l+j):f.attr("style",l)}f.html(c.name||c.gradeName),d.append(f),e.append(d)}var e=$("<ul>");b.clearDropdown(a),e.addClass(b.CLASS_DROPDOWN_MENU),e.attr("role","menu"),c&&c.length>1?($.each(c,d),a.append(e),b.toggleDropdown(a,!1)):c&&1===c.length&&(a.find(".dropdown-toggle > span").html(c[0].name||c[0].gradeName),b.toggleDropdown(a,!0),d(0,c[0]),a.append(e),b.handleSelection({target:a.find("ul li:first > a")})),b.setButtonLook()},getInlineBackground:function(a){if(a){var b=T1.utilities.isTooDark(a,30)===!0?60:15,c=T1.utilities.lightenDarken(a,b),d="background: -moz-linear-gradient(20deg, #"+a+" 0%, #"+a+" 60%, #"+c+" 64%, #"+c+" 100%);",e="-webkit-gradient(left bottom, right top, color-stop(0%, #"+a+"), color-stop(60%, #"+a+"), color-stop(64%, #"+c+"), color-stop(100%, #"+c+"));",f=" -webkit-linear-gradient(20deg, #"+a+" 0%, #"+a+" 60%, #"+c+" 64%, #"+c+" 100%);",g="-o-linear-gradient(20deg, #"+a+" 0%, #"+a+" 60%, #"+c+" 64%, #"+c+" 100%);",h="-ms-linear-gradient(20deg, #"+a+" 0%, #"+a+" 60%, #"+c+" 64%, #"+c+" 100%);",i="background: linear-gradient(20deg, #"+a+" 0%, #"+a+" 60%, #"+c+" 64%, #"+c+" 100%);",j="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#"+a+"', endColorstr='#"+c+"', GradientType=1 );",k="background: -webkit-linear-gradient(20deg, #"+a+" 0%, #"+a+" 60%, #"+c+" 64%, #"+c+" 100%);",l=d+e+f+g+h+i+j+k;return l}},clearDropdown:function(a){a.children().length>1&&a.children("."+b.CLASS_DROPDOWN_MENU).remove()},resetDropdowns:function(a){for(var c=a;c<=b.dropdowns.length;c++){var d=$(b.dropdowns[c]);d.children().length>1&&(b.clearDropdown(d),b.toggleDropdown(d,!0),b.resetDropdownLabel(c))}},resetDropdownLabel:function(a){var c=$(b.dropdowns[a]),d=[T1.labels.carconfigMini.chooseModel,T1.labels.carconfigMini.chooseBodytype,T1.labels.carconfigMini.chooseEngine,T1.labels.carconfigMini.chooseTransmission,T1.labels.carconfigMini.chooseWheeldrive,T1.labels.carconfigMini.chooseGrade,T1.labels.carconfigMini.chooseColour];b.setDropdownLabel(c,d[a])},setDropdownLabel:function(a,b){var c=a.children("a.dropdown-toggle").find("> span");c.html(b)},toggleDropdown:function(a,c){var d=a.children("a.dropdown-toggle");c===!0?d.addClass(b.CLASS_DISABLED):d.removeClass(b.CLASS_DISABLED)},resetSummary:function(a){if(a)for(var c=b.summaryList.find("li"),d=a-1,e=c.length-2;e>=d;e--){var f=c.eq(e);f.length>0&&f.remove()}else b.summaryList.empty()},finalize:function(){if(b.isTrackingEnabled){var a={configuration:{type:b.workflowName,modelid:b.jsonData.code,carid:b.selectedSteps.grades.carId+"_"+T1.settings.country+T1.settings.language,extcolorid:b.jsonData.modelId+"_"+b.selectedSteps.colours.id+"_"+T1.settings.country+T1.settings.language}};PubSub.publish(T1.constants.STATS_TRACK,{node:b.summary,extraData:a})}b.isFinalized=!0,b.showResultImage(),b.showPrices(),b.resetCarCode(),b.loadConfigFinanceData(),b.showEcoLabels(),b.isMobile||(b.hideDropdownsWrapper(),b.showNiceOptions(),b.showActions(),b.showCTA());try{PubSub.publish(b.isMobile?T1.constants.CARCONFIG_MINI_END:T1.constants.CARCONFIG_END,{modelId:b.jsonData.modelId,carId:b.selectedSteps.grades.carId,colourId:b.selectedSteps.colours.id})}catch(c){console.log(c.message)}},loadConfigFinanceData:function(){b.isFinalized&&(b.hideFinance(),b.createConfigObj(),b.handleFinanceData())},requestCarCode:function(a,c){T1.myToyota.requestCarInfo(c,b.setCarCode,function(a,c,d){console.log(c+": "+d),b.resetCarCode()})},createConfigObj:function(){try{b.configObj=b.selectedSteps.grades.config,b.configObj.ExteriorColourID=b.selectedSteps.colours.id}catch(a){console.log(a.message)}},showResultImage:function(a,c,d){b.imageResult.data("orig")||b.imageResult.data("orig",b.imageResult.attr("src"));var e=b.getResultImageUrl(a,c,d);e&&b.imageResult.attr("src",e)},getResultImageUrl:function(a,c,d){var e=T1.settings.CCISHost+T1.constants.URL_MINI_CARCONFIG_IMG,f=a||b.jsonData.modelId,g=c||b.selectedSteps.grades.carId,h=d||b.selectedSteps.colours.code;if(g)return console.log("------------"+e),e=e.replace(/\[MODEL\]/g,f),e=e.replace(/\[GRADE\]/g,g),e=e.replace(/\[COLOUR\]/g,h)},hideResultImage:function(){b.imageResult.attr("src",b.imageResult.data("orig"))},showPrices:function(a,c){try{var d="number"==typeof a?a:parseInt(b.selectedSteps.grades.price.listWithDiscount,10),e="number"==typeof c?c:parseInt(b.selectedSteps.colours.price.listWithDiscount,10),f=b.priceTable.find(".color td:nth-child(2)");isNaN(e)&&(e=0);var g=d+e;console.log("price="+g),f.text(globalize.format(e,"c")),b.priceTable.find(".price td:nth-child(2)").text(globalize.format(d,"c")),b.priceTable.find(".price-total td:nth-child(2)").text(globalize.format(g,"c")),b.priceTable.show()}catch(h){console.log(h.message)}},setCarCode:function(a){if(b.isFinalized)try{a&&null!==a.code&&void 0!==a.code?(b.priceTable.find(".code td:nth-child(2)").text(globalize.format(a.code,"c")),b.priceTable.find(".code").show(),b.configBtn.attr("href","#"+T1.constants.URL_CAR_CONFIG_OVERLAYER+"tyCode="+globalize.format(a.code,"c")).show(),b.myToyotaButton.attr("data-car-config-code",globalize.format(a.code,"c")).show().css("display","inline-block")):b.resetCarCode()}catch(c){console.log(c.message)}},resetCarCode:function(){b.priceTable.find(".code td:nth-child(2)").empty(),b.priceTable.find(".code").hide(),b.configBtn&&b.configBtn.removeAttr("href").hide(),b.myToyotaButton&&b.myToyotaButton.removeAttr("data-car-config-code").hide()},handleFinanceData:function(){"true"===T1.settings.carconfigMini.showMonthlyRateMiniConfig&&T1.financeRates.enabled()&&T1.financeService.requestFinanceData({configs:b.configObj,success:b.showFinance,source:"MiniCarConfig"})},hideFinance:function(){var a=b.miniConfig.find(".price-monthly"),c=b.miniConfig.find(".finance-rates"),d=b.miniConfig.find(".finance-quote");a.removeClass("visible").addClass("hidden"),c.removeClass("visible").addClass("hidden"),d.removeClass("visible").addClass("hidden"),a.find(".price-monthly-value").empty(),c.find(".finance-rates-value").empty(),d.empty(),b.financeBtn&&b.financeBtn.removeClass("visible").addClass("hidden")},showFinance:function(a){if(a.error)return void console.log(a.message);if(b.isFinalized){var c=a.show||(a.query&&a.query.results?a.query.results.json:null)||a||{},d=b.miniConfig.find(".price-monthly"),e=b.miniConfig.find(".finance-quote"),f=b.miniConfig.find(".finance-rates"),g=T1.settings.carconfigMini;try{if(c.miniccRate){a.rate.monthlyPayment&&(d.find(".price-monthly-value").html(a.rate.monthlyPayment.formatted),d.addClass("visible").removeClass("hidden"));var h=T1.financeService.formatFinanceString(T1.labels.carconfigMini.priceRates,a.rate,a.show);h&&(f.find(".finance-rates-value").html(h),f.addClass("visible").removeClass("hidden"))}if(a.show&&(a.show.miniccRate||a.show.miniccFinance)){var i=T1.labels.viewFinanceDisclaimer||T1.labels.viewDisclaimer,j=a.rate.productName?a.rate.productName.formatted:i,k=T1.financeService.getDisclaimer(a.rate,!0,"true"===T1.settings.carconfigMini.showFinanceDisclaimerInOverlayMiniConfig?j:null);k&&("true"===T1.settings.carconfigMini.showFinanceDisclaimerInOverlayMiniConfig?(f.find(".finance-rates-value").append($('<a href="#" class="readMore"/>').html(i).attr("data-tooltip-selector","#miniCCDisclaimer")),f.find("#miniCCDisclaimer .expansion-inner").empty().append(k),f.addClass("visible").removeClass("hidden")):(e.html(k),e.addClass("visible").removeClass("hidden")))}g.showFinanceButtonMiniConfig&&c.miniccFinance&&(b.financeBtn.addClass("visible").removeClass("hidden"),b.financeBtn.parent().hide(),b.financeBtn.parent().fadeIn()),g.showInsuranceButtonMiniConfig&&c.miniccInsurance&&(b.btnInsurance.addClass("visible").removeClass("hidden"),b.btnInsurance.parent().hide(),b.btnInsurance.parent().fadeIn())}catch(l){console.log("error showing finance information "+l)}}},postFinanceData:function(a){a.preventDefault();try{PubSub.publish(T1.constants.FINANCE_EXTERNAL_POST_REQUEST,b.configObj)}catch(c){console.log("Error while trying to open the finance link "+c)}},postInsuranceData:function(a){a.preventDefault();try{PubSub.publish(T1.constants.INSURANCE_EXTERNAL_POST_REQUEST,b.configObj)}catch(c){console.log("Insurance link error: "+c)}},showNiceOptions:function(){var a=b.getNiceOptions();b.niceSummary.html(a),b.niceSummary.append('<div class="bg-gradient"><img src="/assets/images/carconfig-mini-gradient.png"/></div>'),b.niceSummary.show()},getNiceOptions:function(){var a="";return b.summaryList.find("li").each(function(b){var c=$(this).clone().children().remove().end().text();0!==b&&2!==b&&(a+=", "),0===b&&(a+="<h3>"),a+=c,1===b&&(a+="</h3>")}),a},hideNiceOptions:function(){b.niceSummary&&(b.niceSummary.hide(),b.niceSummary.html())},showActions:function(){if(b.preSelectedLink.length>0)b.btnMoreAbout.hide();else{var a=b.summaryList.find("li").eq(0).clone().children().remove().end().text();b.btnMoreAbout.text(T1.labels.moreAbout+" "+a);var c=b.jsonData.links.CarChapter;b.btnMoreAbout.attr("href",c),b.btnMoreAbout.show()}b.actionsWrapper.show()},hideActions:function(){b.actionsWrapper&&(b.actionsWrapper.hide(),b.btnMoreAbout.text(""))},showCTA:function(){b.cta.show()},hideCTA:function(){b.cta&&b.cta.hide()},showEcoLabels:function(){try{var a=b.selectedSteps.grades.energy,c=a&&"true"===T1.settings.useEcoLabels?a.value.toLowerCase():!1;if(c){b.ecoLabelsTitle.html(T1.settings.ecoLabel.title),b.ecoLabelsSubtitle.html(T1.settings.ecoLabel.intro),b.ecoLabelsDisclaimer.html(T1.settings.ecoLabel.disclaimer),b.ecoLabelsSpecsCondition.html(T1.settings.ecoLabel.specsCondition),c=c.replace("+","Plus");var d=T1.settings.ecoLabel.images,e="";for(var f in d)if(d.hasOwnProperty(f)&&f===c){e=d[f];break}b.ecoLabelsImage.attr("src",e);for(var g in a)if(a.hasOwnProperty(g)&&a[g]!==c){var h=a[g].name,i=a[g].value,j=a[g].unit;if(j&&i){var k=$("<tr/>"),l=$("<td/>");l.text(h);var m=$("<td/>");m.text(i+" "+j),k.append(l),k.append(m),b.ecoLabelsTable.find("tbody").prepend(k)}}b.ecoLabels.show()}}catch(n){console.log(n.message)}},hideEcoLabels:function(){b.ecoLabelsTable.find("tr").not(":last").remove(),b.ecoLabels.hide()},ecoLabelsDisplay:function(a){a?b.ecoLabels.addClass(b.CLASS_HIDDEN_XS):b.ecoLabels.removeClass(b.CLASS_HIDDEN_XS)}},b=a;return{init:a.init,initMobile:a.initMobile,initDesktop:a.initDesktop,switchMobile:a.switchMobile,switchDesktop:a.switchDesktop,showFinance:a.showFinance}}();var T1=T1||{};T1.integrator=function(){"use strict";var a={urlContent:"",tokens:{},init:function(){var b=a;b.tokens.load=PubSub.subscribe(T1.constants.IFRAME_REQUEST,b.load),$(window).on("message",b.handleMessage)},handleMessage:function(a){if(a&&"message"===a.type)try{var b=a.originalEvent;if(console.log('------ integrator : handleMessage "'+b.data+'" from '+b.origin),!b.data)return console.log("no data posted"),!0;var c=JSON.parse(b.data),d=c.eventName;d&&(c.sync?PubSub.publishSync(d,c.arg):PubSub.publish(d,c.arg))}catch(e){return console.log("postMessage error: "+a.type),!0}},load:function(b,c){var d=a,e="?";c.url&&(d.urlContent=c.url),c.content&&("osb"===c.content?d.urlContent=T1.settings.osb?T1.settings.osb.urlContent:"http://osb-b2c-ui-dev.s3.amazonaws.com/":"cus"===c.content&&(d.urlContent=T1.settings.cpo.urlContent||""),delete c.content),$.each(c,function(a,b){e+=a+"="+b+"&"}),e.length>0&&(e=e.slice(0,-1),d.urlContent+=e),PubSub.publishSync(T1.constants.PAGEOVERLAYER_OPEN,{iframe:!0,url:d.urlContent,sync:!0,noScroll:!T1.utilities.isIOS()})}};return{init:a.init,show:a.show}}();var T1=T1||{};T1.reviews=function(){"use strict";var a={revCar:$(".car-model").attr("data-car-model"),bvAPI:null,allRevs:[],avgRating:0,secRatingAvgs:{},textValues:{},starsPromo:$(".review-summary-promo, .big-rating"),revAutoFill:$(".review-auto-fill"),driversReviewsLoadedFromBazar:!1,isMobile:!1,init:function(){a.bvAPI=T1.settings.bazaarVoiceJsonLink;var b=a,c=!1,d=!1;if(T1.labels||(T1.labels={}),b.textValues={by:T1.labels?T1.labels.by:"",timestamp_separator:T1.labels?T1.labels.on:"",read_more:T1.labels?T1.labels.readMore:"",outOf:T1.labels.reviews.outOfFive,aged:T1.labels?T1.labels.reviews.age:"",byPoster:T1.labels?T1.labels.reviews.by:"",from:T1.labels?T1.labels.reviews.from:"",gender:T1.labels?T1.labels.reviews.gender:"",new_review:T1.labels.reviews["new"],OverallRating:T1.labels.reviews.OverallRating,feedback:T1.labels.reviews.feedback,feedbackPos:T1.labels?T1.labels.yes:"",feedbackNeg:T1.labels?T1.labels.no:"",feedbackVoteSuccess:T1.labels.reviews.voteSuccess,feedbackVoteFailure:T1.labels.reviews.voteFailure,feedbackReport:T1.labels.reviews.report,feedbackReported:T1.labels.reviews.reported,recommend:T1.labels.reviews.recommend,reviewsPageName:T1.labels.reviews.pageName,alreadyVoted:T1.labels.reviews.alreadyVoted,createnewrev:T1.labels.reviews.createNew},PubSub.subscribe(T1.constants.REVIEW_AVARAGE_RATING,b.setStars),PubSub.subscribe(T1.constants.REVIEW_LOADBAZAR,b.loadBazar),PubSub.subscribe(T1.constants.REVIEW_SEE_REVIEWS,b.seeReviews),PubSub.subscribe(T1.constants.REVIEW_OPENREVIEWS,b.openReviews),PubSub.subscribe(T1.constants.REVIEW_GETREVFORM,b.getReviewForm),b.revCar&&b.bvAPI){b.bvAPI=b.bvAPI.replace(/<id>/g,b.revCar);var e=b.revAutoFill.length>0;if(e&&(c=b.revAutoFill.attr("data-limit-reviews")?b.revAutoFill.attr("data-limit-reviews"):!1),b.starsPromo.length>0)d=!0;else{var f=$(".big-rating");f.length>0&&(d=!0,b.starsPromo=f)}b.loadBazarVoiceApi(),PubSub.publish(T1.constants.REVIEW_LOADBAZAR,{setStars:d,autoFill:e,limitReviews:c})}},switchDesktop:function(){var b=a;b.isMobile=!1},switchMobile:function(){var b=a;b.isMobile=!0},initDesktop:function(){var b=a;b.isMobile=!1},initMobile:function(){var b=a;b.isMobile=!0},loadBazarVoiceApi:function(){var a=T1.settings.bazaarVoiceApiLink;a.length>0&&(window.loadBazaarvoiceApi=function(b){window.$BV?b():$.ajax({url:a,cache:!0,dataType:"script",success:function(){$($BV.docReady),b()}})})},loadBazar:function(b,c){{var d=a,e=null;$.getJSON(d.bvAPI,function(a){var b=a.Includes.Products,f=a.Results;"undefined"!=typeof b?(d.secRatingAvgs=b[Object.keys(b)[0]].ReviewStatistics.SecondaryRatingsAverages,d.avgRating=b[Object.keys(b)[0]].ReviewStatistics.AverageOverallRating,c.setStars&&PubSub.publish(T1.constants.REVIEW_AVARAGE_RATING,d.avgRating),$.each(f,function(a,b){var c={};b.Title&&(c.title=b.Title),b.Rating&&(c.rating=b.Rating),b.UserNickname&&(c.nickname=b.UserNickname),b.SubmissionTime&&(c.timestamp=b.SubmissionTime),b.Id&&(c.id=b.Id),b.ReviewText&&(c.text=b.ReviewText,c.text.length>350&&(c.text=b.ReviewText.slice(0,346),c.text=c.text+" ...")),b.IsRecommended&&(c.recommended=b.IsRecommended),b.ContextDataValues&&(b.ContextDataValues.Age&&(c.aged=b.ContextDataValues.Age.ValueLabel),b.ContextDataValues.LengthOfOwnership&&(c.ownerlength=b.ContextDataValues.LengthOfOwnership.ValueLabel),b.ContextDataValues.Gender&&(c.gender=b.ContextDataValues.Gender.ValueLabel),b.ContextDataValues.DriverType&&(c.driver=b.ContextDataValues.DriverType.ValueLabel)),b.SecondaryRatings&&(c.secratings=b.SecondaryRatings),b.TotalPositiveFeedbackCount&&(c.feedbackpositive=b.TotalPositiveFeedbackCount),b.TotalNegativeFeedbackCount&&(c.feedbacknegative=b.TotalNegativeFeedbackCount),0===Object.keys(c.secratings).length&&(e||(e=$.extend(!0,{},d.secRatingAvgs),$.each(e,function(a){e[a].AverageRating=0})),c.secratings=e),d.allRevs.push(c)}),c.autoFill===!0&&d.seeReviews("byHand",{limitReviews:c.limitReviews})):(d.avgRating=0,c.setStars&&PubSub.publish(T1.constants.REVIEW_AVARAGE_RATING,d.avgRating))})}},getReviewForm:function(){var b=a,c=T1.settings.bazaarVoiceApiLink,d=b.textValues.reviewsPageName,e=!1;if(c){var f={productId:b.revCar,doShowSubmission:function(){b.isMobile&&(e=!0),PubSub.publishSync(T1.constants.PAGEOVERLAYER_DESTROY,{}),PubSub.publishSync(T1.constants.PAGEOVERLAYER_OPEN,{html:$('<div id="BVSubmissionContainer" class="container"></div>'),styleClass:"rev-show",pageName:d,inPage:e})},allowSamePageSubmission:!0};b.isMobile&&(f.displayType="mobile"),loadBazaarvoiceApi(function(){$BV.ui("rr","submit_review",f)})}},openReviews:function(){var b=a,c=($(".review"),b.textValues.reviewsPageName),d=!1,e={productId:b.revCar,onSubmissionReturn:function(){PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:$("body"),customText:T1.labels.reviews.submissionReturn,timeout:2e3,centerScreen:!0})},onEvent:function(a){"Display"==a.eventSource&&($("#BVRRDisplayContentLinkWriteID a").removeAttr("onclick").removeAttr("data-bvjsref").click(function(){PubSub.publish(T1.constants.REVIEW_GETREVFORM,{}),b.driversReviewsLoadedFromBazar=!0}),$(".overlayerContent").find("#BVRRContainer").parent().removeClass("rev-hide"))}};b.isMobile&&(e.displayType="mobile"),$("#BVRRContainer").length<1&&$("body").append($('<div class="rev-hide"><div id="BVRRContainer" class="container"></div></div>')),b.driversReviewsLoadedFromBazar===!1&&loadBazaarvoiceApi(function(){$BV.ui("rr","show_reviews",e)}),"mobile"==e.displayType&&(d=!0),PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{html:$("#BVRRContainer"),styleClass:"rev-show",pageName:c,preserveContent:!0,inPage:d})},seeReviews:function(b,c){var d=a,e=!1,f=$(".reviews-summary"),g=d.revAutoFill.length>0?d.revAutoFill:!1,h="col-xs-12 col-sm-4 col-md-4 col-lg-4",i=!1,j=($(".review-avg-rating").length>0?!0:!1,$('<div class="'+h+'"><h5 class="review-title"></h5><h5 class="review-recommended rev-hide"></h5><div class="progress star-gray"><div class="progress-bar star-yellow star" role="progressbar"></div></div><div class="review-container"></div><div class="review-details"><a href="#/publish/review_openreviews" data-bt-track="" class="read-more"></a><div class="poster-name"></div></div></div>'));if(f.length>0&&d.secRatingAvgs){var k=$('<div class="col-xs-6 col-sm-12"><h5></h5><div class="progress star-gray">	<div class="progress-bar star-yellow star" role="progressbar"></div></div></div>');f.children().length<Object.keys(d.secRatingAvgs).length+1&&$.each(d.secRatingAvgs,function(a,b){var c=k.clone(),d=2*Math.floor(b.AverageRating)*10/100*100;$("h5",c).text(a),$(".star",c).css({width:d+"%"}),f.append(c)})}isNaN(parseFloat(c.limitReviews))||(e=c.limitReviews-1),$.each(d.allRevs,function(a,b){var c=j.clone(),f=2*Math.floor(b.rating)*10/100*100;if(!(e&&a>e)){$(".review-title",c).text(b.title),b.recommended&&$(".review-recommended",c).text(d.textValues.recommend).removeClass("rev-hide"),$(".star",c).css({width:f+"%"}),$(".review-container",c).text(b.text);var h=d.textValues.by+" "+b.nickname+" "+d.textValues.timestamp_separator+" "+b.timestamp.replace(/T.*/g,"");$(".poster-name",c).text(h),i||$(".read-more",c).text(d.textValues.read_more),g.append(c)}})},setAvgRating:function(b){var c=a,d=$('<div class="col-xs-12"><h5 class="review-sec-rating-label">'+c.textValues.OverallRating+'</h5><div class="progress star-gray"><div class="progress-bar star-yellow star" role="progressbar"></div></div></div>'),e=$(".star",d),f=2*Math.floor(c.avgRating)*10/100*100;return e.css({width:f}),d.appendTo(b),b},setSecAvgRating:function(b){var c=a;if(Object.keys(c.secRatingAvgs).length>0){var d=$('<div class="col-xs-3 col-sm-3 col-xs-center"><h5></h5><div class="progress star-gray">	<div class="progress-bar star-yellow star" role="progressbar"></div></div></div>');$.each(c.secRatingAvgs,function(a,c){var e=d.clone(),f=2*Math.floor(c.AverageRating)*10/100*100;$("h5",e).text(a),$(".star",e).css({width:f+"%"}),b.append(e)})}return b},setStars:function(b,c){var d=a,e=!1;if(d.avgRating||(d.avgRating=0),d.starsPromo.length>0&&(e=d.starsPromo),e!==!1){var f=e.find(".star, .bigStar"),g=2*c*10/100*100,h=f.parent().parent().find(".rating-text");if(f.css({width:g+"%"}),d.avgRating>0){if(h){var i=c.toFixed(2).toString().replace(".",",");h.text(i+" "+d.textValues.outOf)}}else h.text(""),h.parent().find("a").text(d.textValues.createnewrev).attr("href","#/publish/review_getrevform")}}};return{init:a.init,initMobile:a.initMobile,initDesktop:a.initDesktop,switchDesktop:a.switchDesktop,switchMobile:a.switchMobile}}();var T1=T1||{};T1.prices=function(){"use strict";var a={init:function(){$("body").on("click",".view-prices",a.showOverlayer)},showOverlayer:function(a){a.preventDefault();var b=$(this),c=b.attr("href");location.hash="/publish/pageoverlayer_open/url="+encodeURIComponent(c)+"/ajax=true/pageName="+b.closest("section").data("section-title")}},b={init:a.init};return b}();var T1=T1||{};T1.flipBook=function(){"use strict";jQuery.cachedScript=function(a,b){return b=$.extend(b||{},{dataType:"script",async:!1,cache:!0,url:a}),jQuery.ajax(b)};var a={init:function(){$("#fb5").size()&&(Modernizr.csstransforms?$.cachedScript("/scripts/flipbook/turn.min.js").done(function(){a.loadFlipbook()}):$.cachedScript("/scripts/flipbook/turn.html4.min.js").done(function(){a.loadFlipbook()}))},loadFlipbook:function(){$.cachedScript("/scripts/flipbook/flipbook.js")}};return{init:a.init}}();var T1=T1||{};T1.filterbar=function(){"use strict";var a={init:function(){$("body").on("click",".filter-bar a.btn",function(b){$(this).data("nopreventdefault")||(b.preventDefault(),a.setButtonFocus($(this)))})},setButtonFocus:function(a){var b=a.parents(".filter-bar");1===$("a.btn",b).length||a.hasClass("fb-toggle")||(a.closest("section").find(".filter-bar a.btn").removeClass("active"),a.addClass("active"))}},b={init:a.init};return b}();var T1=T1||{};T1.statistics=function(){"use strict";var a={statsTracked:[],currentObject:{},base:{},ignoreBtTags:"%track%scroll%collapse%state%",settings:{},scrollingElements:null,brightTagPrefix:"bt",init:function(){var b=a,c=T1.constants;window.t1DataLayer&&(b.settings=window.t1DataLayer.settings||{},b.updateBaseObject(),b.base=b.extendObject({},window.t1DataLayer),b.updateCTAElements(),$("body").on("click","[data-bt-track]",b.trackLinkData),b.settings.trackScroll&&(PubSub.subscribe(c.STATS_TRACK_SECTIONSCROLL,b.trackScroll),PubSub.publish(c.SCROLL_TRACK_ADD,{elements:$("[data-bt-scroll]"),options:{once:!0,event:c.STATS_TRACK_SECTIONSCROLL,threshold:"-25%"}})),PubSub.subscribe(c.STATS_TRACK,b.track),PubSub.subscribe(c.STATS_TRACK_CAROUSEL,b.trackCarousel),PubSub.subscribe(c.MY_TOYOTA_STORED_CAR,b.trackMyToyotaEvents),PubSub.subscribe(c.GALLERY_SCROLL,b.trackGalleryScroll),PubSub.subscribe(c.SOCIAL_SHARED,b.trackShare),PubSub.subscribe(c.FORM_LOAD,b.trackFormLoad),PubSub.subscribe(c.MY_TOYOTA_TAB_SWITCH,b.trackMyToyotaTabSwitch),PubSub.subscribe(c.MY_TOYOTA_SAVED_CAR,b.trackMyToyotaSavedCar),PubSub.subscribe(c.FORM_VALIDATION_FAILED,b.trackFormValidationFailed),PubSub.subscribe(c.SUBMIT_FORM_RETURN,b.trackSubmitFormReturn),PubSub.subscribe(c.MY_TOYOTA_CAR_ALREADY_SAVED,b.trackMyToyotaCarAlreadySaved),PubSub.subscribe(c.SEARCH,b.trackSearch),PubSub.subscribe(c.TABS_SWITCH,b.trackTabsSwitch))},updateBaseObject:function(){var b=window.t1DataLayer;if(b){var c=(T1.constants,location.href);b.userinfo||(b.userinfo={}),T1.mypage&&T1.mypage.user&&(b.userinfo.status="loggedin"),b.userinfo.platform||(b.userinfo.platform=a.getPlatform()),"string"==typeof c&&-1!==c.indexOf("#")&&(b.page||(b.page={}),b.page.entrycomponent=c.substr(c.indexOf("#")+1))}},getPlatform:function(){var a=navigator.userAgent?navigator.userAgent:"",b=a.toLowerCase();if(/phone/.test(b))return"mobile";if(/tablet|(pad(\d|\b))/.test(b))return"tablet";if(/tv\b/.test(b))return"smart-tv";var c=navigator.appVersion?navigator.appVersion:"",d=b+" "+c.toLowerCase();if(/mobile/.test(d))return"mobile";if(/android|blackberry/.test(d)){var e=window.innerWidth||$(window).innerWidth(),f=window.innerHeight||$(window).innerHeight(),g=e>f?e:f;return 770>g?"mobile":"tablet"}return"pc"},updateCTAElements:function(){for(var a=$(".inpage-cta"),b=null,c=null,d=0;d<a.length;d++)b=a.eq(d),c=b.prev(),b.attr("data-bt-componentname",c.attr("data-bt-componentname")||""),b.attr("data-bt-category",c.attr("data-bt-category")||"")},trackGalleryScroll:function(a,b){PubSub.publish(T1.constants.STATS_TRACK,{node:$(b),extraData:{event:{eventclass:"componentevent",action:"click_function",value:"own_toyota"===$(b).closest("section").data("bt-componentname")?"browse":"scroll_gallery"}}})},trackShare:function(a,b){PubSub.publish(T1.constants.STATS_TRACK,{node:b.node,extraData:{event:{href:b.href,value:b.url}}})},trackSearch:function(a,b){var c=T1.constants;b&&b.origin&&"menu"===b.origin&&PubSub.publish(c.STATS_TRACK,{node:$("#menu-search"),extraData:{event:{value:b.q}}})},trackMyToyotaTabSwitch:function(a,b){var c=T1.constants,d=$("#"+b);switch(b){case"pane-save-car":d.closest(".authenticated").length?PubSub.publish(c.STATS_TRACK,{node:d.find("#form-save-car")}):PubSub.publish(c.STATS_TRACK,{node:d});break;case"pane-login":case"pane-register":case"pane-forgotten-password":case"pane-my-cars":case"pane-my-dealer":case"pane-owners-area":PubSub.publish(c.STATS_TRACK,{node:d})}},trackTabsSwitch:function(a,b){var c=T1.constants,d=$("#"+b);switch(b){case"pane-search":PubSub.publish(c.STATS_TRACK,{node:d})}},trackFormValidationFailed:function(a,b){var c=T1.constants,d=$(b.form),e=d.attr("id");switch(e){case"form-my-cars":case"form-login":case"form-register":case"form-forgotten-password":case"form-save-car":case"form-login-save-car":d.attr("data-bt-state","fail"),PubSub.publish(c.STATS_TRACK,{node:d.find(".btn-submit")})
}},trackSubmitFormReturn:function(a,b){var c,d=T1.constants,e=$(b.form),f=e.attr("id");switch(f){case"form-my-cars":c="success"===b.status?"success":"fail",e.attr("data-bt-state",c),PubSub.publish(d.STATS_TRACK,{node:e.find(".btn-submit")});break;case"form-login":case"form-register":case"form-forgotten-password":case"form-login-save-car":case"form-save-car":c="success"===b.status&&b.data&&b.data.success?"success":"fail","success"===c&&"form-save-car"===f||(e.attr("data-bt-state",c),PubSub.publish(d.STATS_TRACK,{node:e.find(".btn-submit")}));break;case"form-contact":"success"===b.status&&b.data&&b.data.success&&PubSub.publish(d.STATS_TRACK,{node:e.find(".btn-submit")});break;case"form-brochure":case"form-testdrive":if("success"===b.status&&b.data&&b.data.success){var g,h="",i="";e.find('input[name="model"]:checked').each(function(a,b){i+=";"+b.value,g=$(b).data("code"),g&&(h+=";"+g)}),PubSub.publish(d.STATS_TRACK,{node:e.find(".btn-submit"),extraData:{event:{modelid:h.substr(1),modelname:i.substr(1)}}})}}},trackMyToyotaCarAlreadySaved:function(){var a=T1.constants,b=$("#form-save-car"),c=b.find(".btn-submit");b.attr("data-bt-state","fail"),PubSub.publish(a.STATS_TRACK,{node:c})},trackMyToyotaSavedCar:function(a,b){var c=T1.constants,d=$("#form-save-car"),e=d.find(".btn-submit"),f=b&&b.car&&b.car.code?b.car.code:"",g={type:"saveconfig",configcode:f},h=$.ajax({type:"GET",dataType:"JSON",url:T1.settings.loadSaveServer+"/config/"+f+"/json",crossDomain:!0});d.attr("data-bt-state","success"),h.done(function(a){var b,d,h,i,j,k;if(a){if(b="_"+T1.settings.country+T1.settings.language,d=a.ModelID?a.ModelID:"",g.modelid=d,g.carid=(a.CarID?a.CarID:"")+b,g.extcolorid=d+"_"+(a.ExteriorColourID?a.ExteriorColourID:"")+b,g.intcolorid=d+"_"+(a.UpholsteryID?a.UpholsteryID:"")+b,h=a.Options&&$.isArray(a.Options)?a.Options:[],h.length>0){for(i="",j=0;j<h.length;j++)i+=";"+d+"_"+h[0]+b;i=i.substr(1)}else i="no_option";if(g.optionlist=i,h=a.Accessories&&$.isArray(a.Accessories)?a.Accessories:[],h.length>0){for(i="",j=0;j<h.length;j++)i+=";"+d+"_"+h[0]+b;i=i.substr(1)}else i="no_accessory";if(g.accessorylist=i,h=a.Packs&&$.isArray(a.Packs)?a.Packs:[],h.length>0)for(g.packs={},j=0;j<h.length;j++)g.packs[h[0]+b]={};else g.packs="no_pack"}k=$.ajax({type:"GET",dataType:"JSON",url:T1.settings.loadSaveServer+"/config/"+f+"/json/full",crossDomain:!0}),k.done(function(a){if(a&&a.price){var b,d=$.isArray(a.price.spotlights)?a.price.spotlights:[],f=$.isArray(a.price.discounts)?a.price.discounts:[],h=$.merge(d,f),i="";for(b=0;b<h.length;b++)h[b].promoId&&(i+=";"+h[b].promoId);i=i.length>0?i.substr(1):"no_promotion",g.promotionlist=i}PubSub.publish(c.STATS_TRACK,{node:e,extraData:{configuration:g}})}),k.fail(function(){PubSub.publish(c.STATS_TRACK,{node:e,extraData:{configuration:g}})})}),h.fail(function(){PubSub.publish(c.STATS_TRACK,{node:e,extraData:{configuration:g}})})},trackMyToyotaEvents:function(a){var b=T1.constants;a===b.MY_TOYOTA_DELETED_CAR&&PubSub.publish(b.STATS_TRACK,{extraData:{}})},trackFormLoad:function(a,b){if(b){var c=$(b),d=c.attr("id");switch(d){case"form-contact":case"form-brochure":case"form-testdrive":PubSub.publish(T1.constants.STATS_TRACK,{node:c})}}},trackCarousel:function(a,b){var c=$(b.el).closest(".carousel"),d=c.find(".item.active"),e=d.data("dataNode"),f=d.data("type"),g=null,h={event:{}};if(c.is(":visible")&&c.inView()>25){switch(f){case"image":h.event.assettype=f,h.event.value=d.find("img").data("lazy-load"),h.event.assetname=h.event.value,h.event.eventclass="assetevent";break;case"video":g=d.find(".posterWrapper"),h.event.assettype=f,h.event.value=g.data("video-mp4")||g.data("video-flv")||g.data("video-ogv")||g.data("video-webm"),h.event.assetname=h.event.value,h.event.eventclass="assetevent";break;case"external-video":h.event.assettype="video",h.event.value=d.find("iframe").prop("href"),h.event.assetname=h.event.value,h.event.eventclass="assetevent"}PubSub.publish(T1.constants.STATS_TRACK,{node:e||d,extraData:h})}},trackScroll:function(a,b){PubSub.publish(T1.constants.STATS_TRACK,{node:b.element,extraData:{event:{eventclass:"scrollevent",action:"view_scroll",value:b.element.data("bt-componentname")}}})},trackLinkData:function(){PubSub.publish(T1.constants.STATS_TRACK,{node:$(this)})},trackCallback:function(a){PubSub.publish(T1.constants.STATS_TRACK,{node:$(a.target)})},track:function(b,c){var d=c.node||$("body"),e=c.extraData||null;a.trackNodeData(d,e)},trackNodeData:function(b,c){{var d,e,f,g=a;T1.constants}("undefined"==typeof b||0===b.length)&&(b=$("body"));var h=g.getState(b);if("no-tracking"!==h&&(g.currentObject=c||{},d=g.crawlData(b,h),g.extendDataLayer(d),d.event))if(e=d.event.eventclass,"string"==typeof e&&e.length>0){if(f=e.substr(0,e.indexOf("event")),g.settings["track"+f.charAt(0).toUpperCase()+f.substr(1)]!==!1)try{d.event.workflowname&&!d.event.workflowconversion&&(window.t1DataLayer.event.workflowconversion="0"),console.log("TRIGGER "+e+" STATE "+(h||"default")+" DATA "+JSON.stringify(window.t1DataLayer)),$(window).trigger(e)}catch(i){console.log(i.message)}}else console.log("TRIGGER cancelled because eventclass not defined!")},crawlData:function(b,c){var d=a,e=b.parent();return d.extendObject(d.currentObject,d.nodeDataToJSON(b,c)),d.isTrackChildNode(e)&&"BODY"!==b.prop("tagName").toUpperCase()?d.crawlData(e):d.extendObject(d.currentObject,d.nodeDataToJSON(e,c))},isTrackChildNode:function(a){if("BODY"===a.prop("tagName")||0===a.length)return!1;var b=void 0===a.data("bt-category");return b},nodeDataToJSON:function(b,c){var d,e=a;return d=e.filterData(b,c)},filterData:function(b,c){for(var d=a,e={},f=b.get?b.get(0):b,g=0===b.length?[]:f.attributes,h=null,i=0;i<g.length;i++)h=d.getAttrValues(g[i]),h&&(e[h.category]||(e[h.category]={}),c&&""!==c&&h.state.toLowerCase()===c.toLowerCase()?e[h.category][h.key]=h.value:e[h.category][h.key]||""!==h.state||(e[h.category][h.key]=h.value));return e},getAttrValues:function(b){var c=a,d=T1.constants,e=b.nodeName.toLowerCase(),f="data-"+c.brightTagPrefix+"-",g=[],h="",i={category:d.STATS_CATEGORY_EVENT,key:"",state:"",value:""};return e.indexOf(f)>-1?(h=e.substring(f.length),-1!==c.ignoreBtTags.indexOf("%"+h+"%")?null:(g=h.split("-"),1===g.length?i.key=g[0]:2===g.length?(i.state=g[0],i.key=g[1]):g.length>2&&(i.state=g[0],i.category=g[1],i.key=g[2]),i.value=c.translateValuePlaceholders(b.nodeValue),i)):void 0},translateValuePlaceholders:function(a){return-1!==a.indexOf("[URL]")&&(a=a.replace("[URL]",location.href+location.hash)),-1!==a.indexOf("[TITLE]")&&(a=a.replace("[TITLE]",window.title)),"string"==typeof a?a:a.toString()},getState:function(b){var c=a,d=b.attr("data-bt-state");return d?d:c.isTrackChildNode(b)&&"BODY"!==b.prop("tagName").toUpperCase()?c.getState(b.parent()):""},extendDataLayer:function(b){var c=a,d=a.extendObject({},this.base);window.t1DataLayer=d,c.extendObject(window.t1DataLayer,b,!0)},extendObject:function(a,b,c){for(var d in b)if(a[d])for(var e in b[d])(!a[d][e]||c)&&(a[d][e]=b[d][e]);else"settings"!==d&&(a[d]=b[d]);return a}};return{init:a.init,trackCallback:a.trackCallback,updateBaseObject:a.updateBaseObject,getPlatform:a.getPlatform}}();var T1=T1||{};T1.html5=function(){var a={init:function(){$("body").on("click",".html5-overlayer",a.openHtml5)},openHtml5:function(a){a.preventDefault();var b=$(this).data("html5id");b&&(location.hash="/publish/pageoverlayer_open/html5id="+b+"/el=.html5-overlayer/noScroll=true")}};return{init:a.init}}(),T1.section=function(){"use strict";var a={childOptionTemplate:null,topicsCountTemplate:null,bigChildOptionTemplate:null,keepRequesting:!0,currentBreakpoint:""},b={init:function(){var c=$("#section-childpage-option-template"),d=$("#section-childpage-big-option-template"),e=$("#section-filter-topics-count"),f=$(".section-latest-articles"),g=f.find(".dropdown"),h=f.find(".dropdown-menu .btn-update"),i=f.find(".dropdown-menu .close-filters"),j=f.find('.spotlights-filter .types-checkboxes input[type="checkbox"]'),k=f.find(".input-search > a"),l=f.find('.input-search > input[type="text"]'),m=f.find(".list-buttons .show-more"),n=$(".jump-top");c.length>0&&d.length>0&&e.length>0&&f.length>0&&(a.childOptionTemplate=c.html(),c.remove(),a.topicsCountTemplate=e.html(),e.remove(),a.bigChildOptionTemplate=d.html(),d.remove(),j.on("change",b.filter.onTypesChange),h.on("click",b.filter.onUpdateClick),i.on("click",b.filter.onCloseFiltersClick),k.on("click",b.filter.onFilterChange),l.on("keypress",b.filter.onSearchTextKeypress),g.on("click",b.filter.dropdown.onClick),PubSub.subscribe(T1.constants.ON_DOC_CLICK,b.filter.dropdown.onDOCClick),m.on("click",b.buttons.showMore.onClick),b.buttons.showMore.set(),PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,b.buttons.showMore.set),n.on("click",b.buttons.jumpToClick),PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,b.onBreakPointChange))},buttons:{showMore:{set:function(){var a=$(".section-latest-articles"),b=null,c=null,d=null,e=a.length,f=0;a.each(function(){f++,b=$(this),c=b.find(".section-sub-spotlights .element").not(":visible"),d=b.find(".list-buttons .show-more"),c.length>0?(d.show(),b.find(".list-buttons").show()):(d.hide(),f===e&&b.find(".list-buttons").hide())})},onClick:function(c){function d(){i=!0,$.ajax({dataType:"jsonp",url:T1.constants.SECTION_HOMEPAGE_CHILD_PAGES,data:j,success:function(a){b.fillHTML(a,e,!0)},timeout:T1.constants.SECTION_HOMEPAGE_CHILD_FILTERING_REQ_TIMEOUT,error:function(){b.buttons.showMore.hide(e)}})}c.preventDefault();var e=$(this).parents(".section-latest-articles"),f=e.find(".section-sub-spotlights .element").not(":visible"),g=e.find(".list-buttons .jump-top"),h=e.find("input.filter"),i=!1,j=null,k=0,l="";h.length>0&&(j=b.getRequestData(e,!1)),k=T1.constants.SECTION_HOMEPAGE_CHILD_SHOW_MORE_OPTIONS,l="SECTION_HOMEPAGE_CHILD_SHOW_MORE_OPTIONS_"+a.currentBreakpoint.toUpperCase(),T1.constants[l]&&(k=T1.constants[l]),f=$(f.slice(0,k)),e.find(".section-sub-spotlights .element:visible").css("display","block"),f.slideDown(T1.constants.ANIMATION_SPEED_SCROLL,function(){i||(g.is(":visible")||g.css({opacity:0,display:"inline-block"}).animate({opacity:1},T1.constants.ANIMATION_SPEED_FADE),a.keepRequesting&&j?d():b.buttons.showMore.hide(e))})},hide:function(a){0===a.find(".section-sub-spotlights .element").not(":visible").length&&a.find(".list-buttons .show-more").fadeOut(T1.constants.ANIMATION_SPEED_FADE)}},jumpToClick:function(a){a.preventDefault()}},filter:{dropdown:{toggle:function(b){if("xs"===a.currentBreakpoint)b.slideToggle(666);else{var c=b.find(".dropdown-menu"),d=b.find(".dropdown-border");c.is(":visible")?$("html").hasClass("lt-ie9")?(d.hide(),b.removeClass("open")):c.slideUp(400,function(){d.slideUp(50,"linear")}):$("html").hasClass("lt-ie9")?(d.show(),b.addClass("open")):d.slideDown(50,"linear",function(){c.slideDown(400)})}},onClick:function(a){var c=$(this),d=c.parents(".section-latest-articles"),e=d.find(".spotlights-filter .collapsed-menu"),f=c.find("a i");a.preventDefault(),f.hasClass("icon-chevron-down")?f.addClass("icon-chevron-up").removeClass("icon-chevron-down"):f.removeClass("icon-chevron-up").addClass("icon-chevron-down"),b.filter.dropdown.toggle(e)},onDOCClick:function(a,c){var d=null,e=null,f=$(c.target);0===f.parents(".collapsed-menu").length&&0===f.parents(".dropdown-container").length&&(d=$(".collapsed-menu"),d.find(".dropdown-menu").is(":visible")&&(e=d.parents(".dropdown-container").find(".dropdown a i"),e.addClass("icon-chevron-down").removeClass("icon-chevron-up"),b.filter.dropdown.toggle(d)))}},onSearchTextKeypress:function(a){return 13==a.keyCode?(b.filter.onFilterChange(null,this),!1):void 0},onCloseFiltersClick:function(){var a=$(this),c=a.parents(".collapsed-menu");b.filter.dropdown.toggle(c)},onUpdateClick:function(){var a=$(this).closest(".dropdown-container").find("a i"),c=$(this).parents(".collapsed-menu");a.removeClass("icon-chevron-up").addClass("icon-chevron-down"),b.filter.dropdown.toggle(c),b.filter.onFilterChange(null,this)},onTypesChange:function(){var a=$(this),c=a.parents(".category-tag");a.prop("checked")===!0?c.removeClass("unchecked"):c.addClass("unchecked"),b.filter.onFilterChange(null,this)},onFilterChange:function(a,c){a&&a.preventDefault();var d=$(c?c:this),e=d.parents(".section-latest-articles"),f=b.getRequestData(e,!0);e.showT1Loader(),$.ajax({dataType:"jsonp",url:T1.constants.SECTION_HOMEPAGE_CHILD_PAGES,data:f,success:function(a){b.fillHTML(a,e,!1),e.hideT1Loader()},timeout:T1.constants.SECTION_HOMEPAGE_CHILD_FILTERING_REQ_TIMEOUT,error:function(){b.buttons.showMore.hide(e),e.hideT1Loader()}})}},onBreakPointChange:function(b,c){a.currentBreakpoint=c},fillHTML:function(c,d,e){if(c.pages){var f=d.find(".spotlights-filter .topics-count"),g=d.find(".section-sub-spotlights .row.big"),h=d.find(".section-sub-spotlights .row.small"),i=d.find(".list-buttons .show-more"),j=d.find(".list-buttons .jump-top"),k=null,l=[],m=[],n=c.pages,o=c.counters,p=0,q="";if(e===!0)n.length>0?(p=h.find(".element").length,h.append(_.template(a.childOptionTemplate,{options:n,count:p}))):b.buttons.showMore.hide(d);else if(n.length>0){n.length>T1.constants.SECTION_HOMEPAGE_CHILD_NUM_BIG_OPTIONS?(l=n.slice(0,T1.constants.SECTION_HOMEPAGE_CHILD_NUM_BIG_OPTIONS),m=n.slice(T1.constants.SECTION_HOMEPAGE_CHILD_NUM_BIG_OPTIONS)):(l=n,m=null),g.html(_.template(a.bigChildOptionTemplate,{options:l})),h.html(m?_.template(a.childOptionTemplate,{options:m,count:p}):""),j.hide(),a.isJumpVisible=!1,k=d.find(".section-sub-spotlights .element"),k.not(":visible").length>0?i.show():i.hide(),q=_.template(a.topicsCountTemplate,{counters:o});try{q=q.trim()}catch(r){}q.length>0?(f.show(),f.html(q)):f.hide()}else f.hide(),g.html(""),h.html(""),b.buttons.showMore.hide(d);a.keepRequesting=n.length<T1.constants.SECTION_HOMEPAGE_CHILD_FILTERING_COUNT?!1:!0}},getRequestData:function(b,c){var d=b.find("input.filter"),e=b.find(".section-sub-spotlights .element"),f=null,g=b.find('.spotlights-filter .dropdown-menu input[type="checkbox"]'),h=c===!0?0:e.length,i=c===!0?T1.constants.SECTION_HOMEPAGE_CHILD_FILTERING_COUNT_NEW_FILTER:T1.constants.SECTION_HOMEPAGE_CHILD_FILTERING_COUNT,j="",k="",l=[],m=[];return f=b.find("xs"===a.currentBreakpoint?'.spotlights-filter .types-checkboxes.mobile input[type="checkbox"]':'.spotlights-filter .types-checkboxes.desktop input[type="checkbox"]'),f.each(function(){var a=$(this);a.prop("checked")===!0&&l.push(a.val())}),g.each(function(){var a=$(this);a.prop("checked")===!0&&m.push(a.val())}),l.length<f.length&&(j=0===l.length?"null":l.join("|")),m.length<g.length&&(k=m.join("|")),{filter:encodeURIComponent(d.val()),keywords:k,types:j,count:i,start:h,includePromos:T1.constants.SECTION_HOMEPAGE_CHILD_FILTERING_PROMOS}}};return{init:b.init}}();var T1=T1||{};T1.homepage=function(){var a={init:function(){$(".content-navigation").length>0},showInPageContent:function(a){a.preventDefault();var b=$(this),c=b.data("contentid");b.length>0&&(location.hash="/publish/pageoverlayer_open/inPage=true/preserveContent=true/html=%23"+c+"%3E*/styleClass="+c)}};return{init:a.init}}();var T1=T1||{};T1.mainSearch=function(){"use strict";var a={mainContainer:null,searchAPI:"/api/search/",filterToggle:null,filterPane:null,optionTagHolder:null,optionCheckboxes:null,updateButton:null,searchButton:null,searchField:null,searchLegend:null,results:null,pagination:null,options:[],phrase:null,pageSize:10,startIndex:0,endIndex:10,pagLimit:10,total:null,inOverlayer:!1,initialQuery:null,init:function(){PubSub.subscribe(T1.constants.SEARCH,a.search);var b=$("#searchcomponent").length>0;b&&a.updateGlobalProperties(),PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,function(b,c){a.fixLayout(c)}),b&&(a.subscribeButtonEvents(),a.optionCheckboxes.prop("checked",!1).trigger("change"),a.searchLegend.hide()),PubSub.subscribe(T1.constants.PAGEOVERLAYER_CLOSED,function(){a.inOverlayer=!1,a.initialQuery=null}),PubSub.subscribe(T1.constants.TABS_SWITCH,function(b,c){"pane-search"===c&&a.updateGlobalProperties()})},search:function(b,c){if(c?a.initialQuery=c:c={},!a.inOverlayer){a.inOverlayer=!0;var d=T1.settings.mock?"/mockups/forms/forms.html":"/forms/forms.json";PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{ajax:!0,url:d,sync:!0});var e=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,function(){PubSub.publish(T1.constants.TABS_SWITCH,"pane-search"),a.updateGlobalProperties(),a.subscribeButtonEvents(),c.q&&(a.searchField.val(c.q),a.phrase=c.q,a.performSearch()),a.optionCheckboxes.prop("checked",!1).trigger("change"),a.searchLegend.hide(),PubSub.unsubscribe(e),a.toggleFilterPrefix()})}},updateGlobalProperties:function(){a.mainContainer=$(".search-component"),a.filterToggle=$(".filter-pane-button",a.mainContainer),a.filterPane=$(".search-filter-options",a.mainContainer),a.optionTagHolder=$(".search-result-selected-filters",a.mainContainer),a.optionCheckboxes=$("input[type='checkbox']",a.filterPane),a.updateButton=$(".btn-update",a.filterPane),a.searchButton=$(".perform-search-button",a.mainContainer),a.searchField=$(".main-search-field",a.mainContainer),a.searchLegend=$(".search-result-counts",a.mainContainer),a.searchNoResults=$(".search-no-results",a.mainContainer),a.results=$(".search-results-inner",a.mainContainer),a.pagination=$(".search-pagination",a.mainContainer),a.optionCheckboxes.prop("checked",!1).trigger("change"),a.subscribeButtonEvents(),T1.breakpoints.returnCurrentBreakPoint&&a.fixLayout(T1.breakpoints.returnCurrentBreakPoint)},subscribeButtonEvents:function(){a.filterToggle.unbind("click").on("click",a.onFilterToggle),a.updateButton.unbind("click").on("click",function(b){a.onFilterToggle(b),a.phrase&&(a.performSearch(),a.publishFullSearchEvent())}),a.optionCheckboxes.unbind("change").on("change",a.onFilterCheckboxChange),a.searchButton.unbind("click").on("click",a.onSearchButtonClick),a.searchField.unbind("keydown").on("keydown",function(b){13===b.which&&$(this).val().length>0&&(a.performSearch(),a.publishFullSearchEvent())})},fixLayout:function(a){switch(a){case"lg":case"md":$(".search-filter-options-inner").css({width:"206%"});break;case"sm":$(".search-filter-options-inner").css({width:"100%"})}},onFilterToggle:function(b){b.preventDefault();var c=$(".dropdown-border",a.filterPane),d=$(".search-filter-options-inner",a.filterPane),e=$("i",a.filterToggle);a.filterPane.hasClass("expanded")?(e.removeClass("icon-chevron-up").addClass("icon-chevron-down"),a.filterPane.removeClass("expanded"),a.expandCollapse(d,c)):(e.removeClass("icon-chevron-down").addClass("icon-chevron-up"),a.filterPane.addClass("expanded"),a.expandCollapse(c,d))},onFilterCheckboxChange:function(){$(this).is(":checked")?a.addOption($(this).val()):a.removeOption($(this).val())},onSearchButtonClick:function(b){b.preventDefault(),0!==a.searchField.val().length&&(a.performSearch(),a.publishFullSearchEvent())},publishFullSearchEvent:function(){PubSub.publish(T1.constants.FULL_SEARCH,{origin:a.initialQuery?"overlayer":"empty-overlayer",q:a.phrase,options:a.options,initialQuery:a.initialQuery,pageIndex:a.startIndex})},onPaginationClick:function(b,c,d,e){switch(d){case"page":a.startIndex=e-1;break;case"first":a.startIndex=0;break;case"last":a.startIndex=Math.floor(a.total/a.pageSize);break;case"prev":a.startIndex--;break;case"next":a.startIndex++}a.performSearch(!0),a.publishFullSearchEvent()},buildURL:function(b){"undefined"==typeof b&&(b=!1);var c=a.searchAPI+a.phrase;a.options.length>0&&!b&&(a.startIndex=0);var d=a.startIndex*a.pageSize,e="?count="+a.pageSize+"&start="+d;return a.options.length>0&&(e+="&keywords=",e+=a.options.join("|")),c+e},concatDesc:function(a){for(var b="",c=0;c<a.length;c++)c>0&&(b+=". "),b+=a[c];return b},performSearch:function(b){if(a.searchField.val().length>0&&a.phrase!==a.searchField.val()&&(a.startIndex=0,a.phrase=a.searchField.val()),a.phrase){var c=a.buildURL(b);$.getJSON(c,a.onGetSearchData)}},onGetSearchData:function(b){if(b){b.pages||a.handleEmptyResult(),$(".empty-result-holder").hide(),a.total=0===b.pages.length?b.pages.length:b.total,a.endIndex=a.startIndex*a.pageSize+a.pageSize,a.generateLegend(),a.total>a.pageSize?a.generatePagination():a.pagination.empty(),a.results.empty(),0===a.total?a.handleEmptyResult():(a.searchLegend.show(),a.searchNoResults.hide());for(var c=0;c<b.pages.length;c++){var d=b.pages[c],e=d.content?a.concatDesc(d.content):"",f=a.generateResultNode(d.url,d.title,d.date,e,!1);a.results.append(f)}$(".overlayerContent").animate({scrollTop:a.mainContainer.offset().top},T1.constants.ANIMATION_SPEED_SCROLL)}},handleEmptyResult:function(){a.searchLegend.hide(),a.pagination.empty(),a.searchNoResults.show()},expandCollapse:function(a,b){var c=a.parent(),d=a.is(".dropdown-border")?a:b,e=a.is(".dropdown-border")?b:a;e.is(":visible")?$("html").hasClass("lt-ie9")?(d.hide(),c.removeClass("open")):e.slideUp(400,function(){d.slideUp(50,"linear")}):$("html").hasClass("lt-ie9")?(d.show(),c.addClass("open")):d.slideDown(50,"linear",function(){e.slideDown(400)})},toggleFilterPrefix:function(){var b=a.optionTagHolder.find(".filter-prefix");b.length>0&&(1===a.optionTagHolder.children().length?a.optionTagHolder.find(".filter-prefix").hide():a.optionTagHolder.find(".filter-prefix").show())},addOption:function(b){a.options.push(b);var c=$("<span/>").attr("data-filter-keyword",b).addClass("search-result-selected-filter").text(b).appendTo(a.optionTagHolder),d=$("<i/>").addClass("icon-remove search-result-remove-filter").appendTo(c);d.on("click",function(){$("input[value='"+b+"']",a.filterPane).prop("checked",!1).trigger("change"),a.removeOption(b),a.performSearch(),a.publishFullSearchEvent()}),a.toggleFilterPrefix()},removeOption:function(b){var c=a.options.indexOf(b);-1!==c&&(a.options.splice(c,1),$(".search-result-selected-filter[data-filter-keyword='"+b+"']").remove(),a.toggleFilterPrefix())},generatePagination:function(){var b=Math.ceil(a.total/a.pageSize);a.pagination.empty().bootstrapPaginator({numberOfPages:b,currentPage:a.startIndex+1,totalPages:b>a.pagLimit?a.pagLimit:b,onPageClicked:a.onPaginationClick,alignment:"center"})},generateLegend:function(){var b=a.startIndex*a.pageSize;0===b&&b++,$(".search-start-index",a.searchLegend).text(b),$(".search-end-index",a.searchLegend).text(a.total<a.pageSize||a.endIndex>a.total?a.total:a.endIndex),$(".search-total-count",a.searchLegend).text(a.total),$(".search-count-phrase",a.searchLegend).text(a.phrase),a.searchLegend.show()},generateResultNode:function(a,b,c,d,e){"undefined"==typeof e&&(e=!1);var f=Globalize.parseDate(c.replace(/\.[0-9]+/,""),"yyyy-MM-ddTHH:mm:ss"),g=$("<a/>").attr("href",a).addClass("search-result-node").append($("<div/>").addClass("search-result-title").text(b));return $("<div/>").addClass("search-result-date").text(globalize.format(f,"d")).appendTo(g),$("<div/>").addClass("search-result-body").html(d).appendTo(g),g}};return{init:a.init}}();var T1=T1||{};T1.dealerFinder=function(){"use strict";var a={currentLocation:{},currentDealer:{},currentDealerData:{},eventTokens:{},currentMap:null,currentStep:-1,currentSearchAddress:null,currentSearchOptions:[],searchOptions:"",googleMapsLoaded:!1,isSearch:!1,amountOfDealers:0,init:function(){PubSub.subscribe(T1.constants.DEALERS_FOUND,a.trackDisplayDealerResultsScreen)},initDesktop:function(){var b=a,c=T1.constants;b.isTrackingEnabled="object"==typeof window.t1DataLayer,PubSub.subscribe(c.DEALER_LOAD,b.initOnDemand),PubSub.subscribe(c.TABS_SWITCH,b.initOnDemand),PubSub.subscribe(c.PAGEOVERLAYER_CLOSE,b.destroyOverlayer),a.initInPage()},initMobile:function(){var b=a;b.isTrackingEnabled="object"==typeof window.t1DataLayer,b.initOnDemand()},initOnDemand:function(c){var d=a,e=b;d.resetView(),e.container=$("#pane-dealer"),d.currentStep<1&&(d.currentStep=1),d.setStep(d.currentStep),(c===T1.constants.DEALER_LOAD||d.isMobile())&&d.currentStep<2&&d.trackDisplayDealerForm(),e.showGeoLink(),d.setEvents()},initOverlayerGUI:function(a,b){$('#pane-dealer .input-search input[type="text"]').val(a),$('#pane-dealer input[name="options"]').each(function(){b[$(this)[0].value]&&($(this)[0].checked=!0)})},trackDisplayDealerForm:function(){$("#pane-dealer").length&&a.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{value:"search-form",workflowname:"dealerfinder",workflowstep:"1"}}})},trackDisplayDealerResultsScreen:function(){var c=a;c.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{eventclass:"searchevent",value:"search-results",workflowname:"dealerfinder",workflowstep:"2",workflowconversion:"1"},search:{type:c.tagSearchType,query:c.tagSearchQuery,results:c.amountOfDealers>0?"1":"0",category:c.tagSearchCategory}}})},trackClickDealerDetail:function(c){a.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{eventclass:"dealerevent",value:"view-dealer",workflowname:"dealerfinder",workflowstep:"3"},dealer:{dealerid:c.guid}}})},trackClickDealerSite:function(){var c=a;c.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{eventclass:"dealerevent",value:"open-dealer-site",workflowname:"open-dealer-site",workflowstep:"4",workflowconversion:"1"},dealer:{dealerid:c.currentDealerData.guid}}})},trackClickDealerSave:function(){var c=a;c.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{eventclass:"dealerevent",value:"save-dealer",workflowname:"save-dealer",workflowstep:"4",workflowconversion:"1"},dealer:{dealerid:c.currentDealerData.guid}}})},trackRequestDealerDirections:function(){var c=a;c.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{value:"direction-start",workflowname:"dealerfinder",workflowstep:"5"},dealer:{dealerid:c.currentDealerData.guid}}})},trackCallDealer:function(){var c=a;c.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{eventclass:"dealerevent",value:"call-dealer",workflowname:"call-dealer",workflowstep:"4",workflowconversion:"1"},dealer:{dealerid:c.currentDealerData.guid}}})},trackDisplayResultsRequestDealerDirections:function(){var c=a;c.isTrackingEnabled&&PubSub.publish(T1.constants.STATS_TRACK,{node:b.container,extraData:{event:{eventclass:"dealerevent",value:"direction-results",workflowname:"dealerfinder",workflowstep:"6"},dealer:{dealerid:c.currentDealerData.guid}}})},initInPage:function(){var c=a,d=b;d.container=$(".dealer-finder.in-page"),d.showGeoLink(),c.setEvents()},initMaps:function(){var b=a,c=T1.constants;if(b.googleMapsLoaded)b.isSearch?b.handleSearch(e):b.handlePosition(e);else{var d,f=T1.settings.dealer,g=T1.settings.country;d=f.googleClientId&&f.googleClientId.length>0?c.URL_GOOGLE_MAPS_API.replace("{CLIENT_ID}",f.googleClientId):c.URL_GOOGLE_MAPS_API_DEV.replace("{API_KEY}",f.googleAPIKey),g&&(d+="&region="+g),d+="&callback=T1.dealerFinder.handleAPILoad",$.ajax({type:"GET",url:d,dataType:"script",cache:!0}),b.googleMapsLoaded=!0}},destroyOverlayer:function(){a.currentSearchAddress="",a.currentSearchOptions=[],a.currentLocation={},a.currentStep=-1;var b=a.eventTokens;for(var c in b)b[c]&&PubSub.unsubscribe(b[c]),b[c]=null;a.resetView()},resetView:function(){var a=b;a.container=null,a.buttonBack=null,a.buttonSearch=null},getGeoForAddress:function(b,c){var d=a,e=new google.maps.Geocoder;e.geocode({address:b,componentRestrictions:{country:T1.settings.country}},function(a,b){d.handleGeoCoding(a,b,c)})},getDealersOrGeo:function(){{var d,e,f=a,g=c,h=b;T1.settings.country}if(h.setContainer("#pane-dealer"),d=h.getOptions(),f.currentStep<3&&(f.tagSearchCategory="",d.size()>0&&d.each(function(){e=$(this)[0].value.toLowerCase(),"selectall"!==e&&("prius"===e&&(e+="dealer"),f.tagSearchCategory.length>0&&(f.tagSearchCategory+=";"),f.tagSearchCategory+=e)})),h.buttonSearch&&h.buttonSearch.hasClass("btn-search-dealers"))if(f.currentLocation&&f.currentLocation.address===f.currentSearchAddress){if(f.currentStep<3){f.tagSearchType="dealer-search-gps";var i=f.currentLocation.position;f.tagSearchQuery=i&&i.d&&i.e?i.d+","+i.e:""}g.getDealersByLocation(f.currentLocation,h.serializeOptions(d))}else f.currentStep<3&&(f.tagSearchType="dealer-search-address",f.tagSearchQuery=f.currentSearchAddress),f.getGeoForAddress(f.currentSearchAddress,h.serializeOptions(d));else f.currentStep<3&&(f.tagSearchType="dealer-search-address",f.tagSearchQuery=f.currentSearchAddress),f.getGeoForAddress(f.currentSearchAddress,h.serializeOptions(d))},getMapForDealers:function(b,c){var d=a,e={center:d.currentLocation.position,zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP};d.currentMap=new google.maps.Map(b[0],e),$.each(c,d.setMarker)},getMapForDealer:function(b,c){var d=a,e={center:c.position,zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP};d.currentMap=new google.maps.Map(b[0],e),d.setMarker(-1,c)},getDealerDetail:function(c,d){var e,f,g,h,i,j,k,l,m=a,n=b,o=T1.labels,p=n.getElement(".form-label").filter(":first"),q=n.getElement(".detail-dark"),r=n.getElement(".dealer-CTA"),s=$("<ul>"),t=$("<ul>"),u=$("<ul>"),v=$("<div>"),w="",x="",y="",z=d.services,A=" ",B=":",C="<li>",D="</li>";m.currentDealerData=d,m.currentDealer.position=new google.maps.LatLng(d.address.geo.lat,d.address.geo.lon),m.currentDealer.address=d.address,m.currentMap&&m.currentMap.setCenter(m.currentDealer.position),m.isMobile()?(m.setStepForward(),m.getMapForDealer(n.getMapDealers(m.currentStep),m.currentDealer)):n.setDealerActive(c),p.html(o.dealer.dealerDirections),n.setDealerName(m.htmlDecode(d.name));var E=d.images;$.isEmptyObject(E)&&n.getElement(".dealer-image").hide(),w+=C+d.address.address1+D,f=d.address.region,f&&f.length>0&&(f=" ("+f+")"),w+=C+d.address.zip+A+d.address.city+f+D,s.html(w),d.phone&&(l=m.convertPhoneToInternationalFormat(d.phone),$(C+D).text(B+A+l.text).prepend($("<b/>").text(o.tel)).appendTo(t)),d.fax1&&$(C+D).text(B+A+m.convertPhoneToInternationalFormat(d.fax1).text).prepend($("<b/>").text(o.fax)).appendTo(t);var F=d.url,G="";if(F&&F.length>0){-1===F.indexOf("http://")&&(G="http://");var H=$("<a/>").attr("href",G+F).attr("target","_blank").addClass("inline").text(F);H.on("click",m.trackClickDealerSite),$(C+D).text(B+A).prepend($("<b/>").text(o.website)).append(H).appendTo(t)}if(e=m.htmlDecode(d.openingHours),v.addClass("dealer-hours"),v.html(e),q.empty(),q.append(s),q.append(t),q.append(v),n.setDealerAddress(s[0].outerHTML),n.setDealerContact(t),n.setDealerHours(e),z.length>0){for(var I=0;I<z.length;I++){var J=z[I].label,K='<div class="col-xs-6 col-md-4"><i class="hidden-xs icon-car2"></i>'+J+"</div>";x+=C+J+D,y+=K}u.html(x),q.append(u),n.setDealerServices(y)}h=r.find(".btn-phone"),d.phone?(h.attr("href","tel:"+l.tel),h.unbind("click",m.trackCallDealer).bind("click",m.trackCallDealer),h.css("display","block")):h.css("display","none"),g=r.find(".btn-directions"),g.unbind("click",m.handleCTADirections).bind("click",m.handleCTADirections),i=r.find(".btn-website"),i.attr("href",G+F),i.unbind("click",m.trackClickDealerSite).bind("click",m.trackClickDealerSite),i.attr("target","_blank"),j=r.find(".btn-print"),j.unbind("click",m.handleCTAPrint).bind("click",m.handleCTAPrint),k=n.getElement(".cta-save .btn"),k.unbind("click",m.handleCTASave).bind("click",m.handleCTASave),PubSub.publish(T1.constants.DEALER_SELECTED,d)},convertPhoneToInternationalFormat:function(a){var b,c,d,e={text:"",tel:""},f=T1.settings.phoneCountryCode;if("string"==typeof a?b=a:a instanceof String?b.toString():b="","string"==typeof f&&f.length>0){for(c=0;c<b.length;c++)d=b.charAt(c),"1234567890+".indexOf(d)>-1&&("0"===d&&0===e.text.length?e.text+="(0)":(e.text+=d,e.tel+=d));e.text.length>0&&"+"!==e.text.charAt(0)&&(e.text=f+e.text,e.tel=f+e.tel)}else{for(c=0;c<b.length;c++)d=b.charAt(c),"1234567890+".indexOf(d)>-1&&(e.tel+=d);e.text=b}return e},getDealerDirections:function(b,c){var d=a,e={center:d.currentLocation.position,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP},f=c[0];d.currentMap=new google.maps.Map(b[0],e);var g={map:d.currentMap,suppressMarkers:!0},h=new google.maps.DirectionsRenderer(g),i=new google.maps.DirectionsService,j={origin:d.currentLocation.position,destination:d.currentDealer.position,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC};
f.innerHTML="",h.setPanel(f),i.route(j,function(a,b){b===google.maps.DirectionsStatus.OK&&h.setDirections(a)}),d.setMarker(98,d.currentLocation),d.setMarker(-1,d.currentDealer),d.trackDisplayResultsRequestDealerDirections()},handleSearch:function(b){b.preventDefault();var c=a,d=PubSub.subscribe(T1.constants.GOOGLE_MAP_LOAD,function(){c.search(b),PubSub.unsubscribe(d)});c.googleMapsLoaded?PubSub.publishSync(T1.constants.GOOGLE_MAP_LOAD):c.initMaps()},handleCurrentLocation:function(b){var c=a,d=navigator.geolocation;b.preventDefault(),d?d.getCurrentPosition(c.handlePosition,c.handlePositionFail):c.setError(T1.labels.dealer.errorGeoNotFound)},handlePosition:function(b){var c=a,d=PubSub.subscribe(T1.constants.GOOGLE_MAP_LOAD,function(){c.convertPositionToAddress(b),PubSub.unsubscribe(d)});c.googleMapsLoaded?PubSub.publishSync(T1.constants.GOOGLE_MAP_LOAD):c.initMaps()},handlePositionFail:function(){var b=a,c=navigator.geolocation,d={maximumAge:3e4,timeout:5e3,enableHighAccuracy:!1};c.getCurrentPosition(b.handlePosition,d)},handleAPILoad:function(){PubSub.publishSync(T1.constants.GOOGLE_MAP_LOAD),Modernizr.geolocation&&b.showGeoLink()},handleDealersByLocation:function(c){var d,e,f=a,g=b,h=T1.settings,i=T1.labels.dealer,j=$("<ul></ul>");try{d=$.parseJSON(c)}catch(k){d=c}e=d.dealers,f.amountOfDealers=e.length,0===f.amountOfDealers?(f.setError(i.errorDealersNotFound),1!==f.currentStep&&f.setStepBack()):(1===f.currentStep&&f.setStepForward(),$.each(e,function(a,b){{var c=$("<li></li>"),d=$('<a href="#"></a>'),e="<span>"+(a+1)+"</span>",g=f.htmlDecode(b.name);b.address.geo}e+="<span>"+g+"</span>",e+=b.drive&&b.drive.length>0?"<b>"+b.drive[0].distance.text+"</b>":"<b>"+Math.round(10*b.distance)/10+" "+h.dealer.distanceUnit+"</b>",e+='<i class="icon-chevron-right"></i>',d.html("<div>"+e+"</div>"),d.click(function(c){c.preventDefault(),f.getDealerDetail(a,b),f.trackClickDealerDetail(b)}),0!==a||f.isMobile()||(c.addClass("active"),f.getDealerDetail(a,b)),c.append(d),j.append(c)}),g.setListDealers(j),f.getMapForDealers(g.getMapDealers(f.currentStep),e),g.setSubHeader(f.currentStep,i.dealersFound.replace("{%0}",f.amountOfDealers)),PubSub.publish(T1.constants.DEALERS_FOUND,e))},handleDealersByLocationError:function(b){var c=a;c.setError(b.responseText),c.setStepBack()},handleKeyPress:function(b){13===b.keyCode&&(b.preventDefault(),PubSub.publish(T1.constants.STATS_TRACK,{node:$(this).parent().find(".btn-search-dealers")}),a.handleSearch(b))},handleCTADirections:function(c){var d=a,e=b;c.preventDefault(),d.isMobile()&&(e.mobileCTADirections=$(c.target).parent(),e.mobileDefaultHeaderStep3=e.getHeader(3),e.setMobileStep3(!0)),d.trackRequestDealerDirections()},handleCTAPrint:function(b){var c="/dealer-print.html",d=window.open(c,"Print dealer","width=600,height=800");b.preventDefault(),d.dealer=a.currentDealerData,d.labels=T1.labels},handleCTASave:function(b){var c=a,d=T1.constants;b.preventDefault(),PubSub.publish(d.DEALER_SAVE,{search:{query:c.currentSearchAddress,options:c.currentSearchOptions},dealer:c.currentDealerData}),c.eventTokens.savedDealerDone=PubSub.subscribe(d.MY_TOYOTA_SAVED_DEALER,function(){PubSub.publish(T1.constants.TOAST_CUSTOM,{customText:T1.labels.mytoyota.dealerSaved,customContainer:$("#pane-dealer"),timeout:2e3}),c.clearSaveDealerEvents()}),c.eventTokens.dealerAlreadySaved=PubSub.subscribe(d.MY_TOYOTA_DEALER_ALREADY_SAVED,function(){PubSub.publish(T1.constants.TOAST_CUSTOM,{customText:T1.labels.mytoyota.dealerAlreadySaved,customContainer:$("#pane-dealer"),timeout:2e3}),c.clearSaveDealerEvents()}),c.eventTokens.savedDealerFail=PubSub.subscribe(d.MY_TOYOTA_SAVE_DEALER_FAILED,function(a,b){PubSub.publish(T1.constants.TOAST_CUSTOM,{customText:b.error,customContainer:$("#pane-dealer"),timeout:2e3}),c.clearSaveDealerEvents()}),c.trackClickDealerSave()},clearSaveDealerEvents:function(){PubSub.unsubscribe(a.eventTokens.savedDealerDone),PubSub.unsubscribe(a.eventTokens.savedDealerFail),PubSub.unsubscribe(a.eventTokens.dealerAlreadySaved)},search:function(c){var d=a,e=b,f=T1.constants;if(c.preventDefault(),d.setValid(),d.isSearch=!0,e.buttonSearch="click"===c.type?$(c.target).parent():$(c.target).siblings(".btn-search"),d.currentSearchAddress=e.getSearchField(!1).val(),d.currentSearchOptions=[],e.buttonSearch.hasClass("btn-search-in-page")){var g=d.currentSearchAddress,h={},i="/ajax/",j=T1.settings.dealer.formUrl+"?tab=pane-dealer",k=$(".search-options",e.buttonSearch.closest("section")),l=$("input[name='options']",k);l.each(function(){var a=$(this);a.is(":checked")&&(h[a.val()]=a.val(),a.val().length>0&&d.currentSearchOptions.push(this))}),d.currentSearchAddress.length>0?(d.currentStep=2,d.eventTokens.getDealersOrGeo||(d.eventTokens.getDealersOrGeo=PubSub.subscribe(f.PAGEOVERLAYER_LOAD,function(){d.initOverlayerGUI(g,h),d.getDealersOrGeo(d.currentSearchOptions)}))):(d.currentStep=1,d.eventTokens.getDealersOrGeo||(d.eventTokens.getDealersOrGeo=PubSub.subscribe(f.PAGEOVERLAYER_LOAD,function(){d.initOverlayerGUI(g,h),d.setError(T1.labels.dealer.errorNoValue)}))),e.setButtonBackDisplay(!0),PubSub.publish(f.HASH_ADD,i+encodeURIComponent(j))}else{if(d.currentSearchAddress.length<1)return void d.setError(T1.labels.dealer.errorNoValue);1!==d.currentStep&&d.setStepForward(),d.getDealersOrGeo()}},convertPositionToAddress:function(b){var c=a,d=new google.maps.Geocoder,e=b.coords.latitude,f=b.coords.longitude,g=new google.maps.LatLng(e,f);c.currentLocation.position=g,d.geocode({latLng:g},c.handleGeoCodingReverse)},handleGeoCoding:function(d,e,f){var g,h=a,i=c,j=b,k=T1.labels.dealer;return e!==google.maps.GeocoderStatus.OK&&e!==google.maps.GeocoderStatus.ZERO_RESULTS?(h.setStep(1),void h.setError(k.errorGeoFailed)):e===google.maps.GeocoderStatus.ZERO_RESULTS?((3===h.currentStep||4===h.currentStep&&h.isMobile())&&h.setStep(2),void h.setError(k.errorGeoNotFound)):(g=d[0].geometry.location,h.currentLocation.position=new google.maps.LatLng(g.lat(),g.lng()),h.currentLocation.address=d[0].formatted_address,void(h.currentStep<3?i.getDealersByLocation(h.currentLocation,f):(3!==h.currentStep||h.isMobile()||h.setStepForward(),h.getDealerDirections(j.getMapDealers(h.currentStep),j.getElement(".directions")))))},handleGeoCodingReverse:function(c,d){var e,f=a,g=b,h=T1.labels.dealer;return d!==google.maps.GeocoderStatus.OK?(f.setStepBack(),void f.setError(h.errorGeoFailed)):(c[1]?f.currentLocation.address=e=c[1].formatted_address:f.setError(h.errorGeoNotFound),void g.setSearchField(e))},setEvents:function(){var c=a,d=b,e=d.getSearchField();e.off("keydown",c.handleKeyPress).on("keydown",c.handleKeyPress),d.getElement(".btn-search").off("click",c.handleSearch).on("click",c.handleSearch),d.getElement(".btn-back").off("click",c.setStepBack).on("click",c.setStepBack),d.getLinkLocation().off("click",c.handleCurrentLocation).on("click",c.handleCurrentLocation)},setMarker:function(b,c){var d,e=a,f=9>b?"0"+(b+1):b+1,g=T1.settings.dealer.markerPath+"marker"+f+".png",h=c.position||c.address.geo;h.lat&&"number"==typeof h.lat&&(h=new google.maps.LatLng(h.lat,h.lon)),d=new google.maps.Marker({position:h,icon:g,map:e.currentMap}),e.currentStep<3&&google.maps.event.addListener(d,"click",function(){e.getDealerDetail(b,c),e.trackClickDealerDetail(c)})},setStepForward:function(b){var c=a;b&&b.preventDefault(),c.setStep(1*c.currentStep+1)},setStepBack:function(c){var d=a,e=b,f=T1.labels.dealer;c&&c.preventDefault(),d.isMobile()||4!==d.currentStep||d.currentStep--,e.mobileCTADirections&&(e.setMobileStep3(!1),delete e.mobileCTADirections,3===d.currentStep&&d.currentStep++),d.setStep(1*d.currentStep-1),1===d.currentStep&&(e.setSubHeader(d.currentStep,f.dealerSearchBy,0),e.setSubHeader(d.currentStep,f.dealerSearchOptions,1)),1===d.currentStep?d.trackDisplayDealerForm():2===d.currentStep?d.trackDisplayDealerResultsScreen():3===d.currentStep&&d.trackClickDealerDetail(d.currentDealerData)},setStep:function(c){var d=a,e=b,f=T1.constants,g=".dealer-step",h=e.container.find(g);d.currentStep=c,e.setButtonBackDisplay(c>1),h.removeClass(f.CLASS_ACTIVE),h.filter(g+"-"+c).addClass(f.CLASS_ACTIVE)},setError:function(a){console.log("dealerfinder error: "+a),PubSub.publish(T1.constants.FORM_ERROR,a)},setValid:function(){b.getElement(".error-message").html("")},htmlDecode:function(a){return $("<div/>").html(a).text()},isMobile:function(){return window.innerWidth<T1.constants.SCREEN_SMALL}},b={container:null,buttonBack:null,buttonSearch:null,linkLocation:null,mapDealers:null,listDealers:null,searchField:null,getElement:function(a){var c=b;return c.getContainer().find(a)},setElement:function(a,c){b.getElement(a).val(c)},getContainer:function(){var a=b;return(!a.container||a.container.length<1)&&(a.container=$("#pane-dealer,.dealer-finder.in-page")),a.container},setContainer:function(a){b.container=$(a)},getButtonBack:function(){var a=b;return(!a.buttonBack||a.buttonBack.length<1)&&(a.buttonBack=a.getElement(".btn-back")),a.buttonBack},getLinkLocation:function(a){var c=b;return a||(c.linkLocation=c.getElement(".geo-location")),c.linkLocation},getMapDealers:function(a){var c,d=b;return a?(c=d.getElement(".dealer-step-"+a),d.mapDealers=c.find(".map-dealers")):d.getElement(".map-dealers"),d.mapDealers},getSearchField:function(a){var c=b;return a||(c.searchField=c.buttonSearch&&c.buttonSearch.length>0?c.buttonSearch.siblings('input[type="text"]'):c.getElement('.input-search input[type="text"]')),c.searchField},setSearchField:function(a){var c=b;c.getSearchField().val(a),c.getElement('.input-search input[type="text"]').val(a)},setButtonBackDisplay:function(a){var c=a?"block":"none";b.getButtonBack().css("display",c)},showGeoLink:function(){Modernizr.geolocation&&b.getLinkLocation().css("display","block")},getOptions:function(){var a,c=b;return a=c.searchField.length>0?c.searchField.parents("form, .form").find('.search-options input[name="options"][value!="selectall"]:checked'):c.getElement('input[name="options"][value!="selectall"]:checked')},serializeOptions:function(a){var b="&services=",c="|";return a=$(a),a.size()<1?"":(a.each(function(){var a=$(this),d=a[0].value.toLowerCase();"prius"===d&&(d+="dealer"),b+=d+c}),b.slice(0,-1))},setMobileStep3:function(a){var c=b,d=c.mobileCTADirections,e=c.mobileDefaultHeaderStep3;d&&e&&(c.setHeader(3,a?T1.labels.dealer.dealerDirections||"Dealer Directions":e),c.getElement(".dealer-step-3 .search-form").css("display",a?"block":"none"),c.getElement(".dealer-step-3 .detail-dealer").css("display",a?"none":"block"),d.css("display",a?"none":"block"))},getHeader:function(a){var c=b,d=c.getElement(".dealer-step-"+a),e=d.find("header h2");return e.text()},setHeader:function(a,c){var d=b,e=d.getElement(".dealer-step-"+a),f=e.find("header h2");f.html(c)},setSubHeader:function(a,c,d){var e=b,f=e.getElement(".dealer-step-"+a),g=f.find("h5.form-label"),h=d||0;g[h].innerHTML=c},setDealerName:function(a){var c=b,d=c.container.find(".dealer-name");d.html(a)},setDealerAddress:function(a){var c=b,d=c.container.find(".dealer-address");d.html(a)},setDealerServices:function(a){var c=b,d=c.container.find(".dealer-services");d.html(a)},setDealerContact:function(a){var c=b,d=c.container.find(".dealer-contact");d.empty(),d.append(a)},setDealerHours:function(a){var c=b,d=c.container.find(".dealer-hours");d.html(a)},getListDealers:function(a){var c=b;return(!c.listDealers||c.listDealers.length<1||!a)&&(c.listDealers=c.getElement(".list-dealers")),c.listDealers},setListDealers:function(a){var c=b;c.getListDealers(!1).empty(),c.listDealers.append(a)},setDealerActive:function(a){var c=b.getListDealers().find("li");c.removeClass("active"),$(c[a]).addClass("active")}},c={getDealersByLocation:function(b,c){var d=a,e=T1.constants,f=T1.settings.mock?"http://t1-dev-"+T1.settings.country+".herokuapp.com"+e.URL_DEALERS_DRIVE:e.URL_DEALERS_DRIVE,g="/",h=b.position.lat(),i=b.position.lng(),j=10;f+=i+g+h+"?count="+j,c.length>0&&(f+=c);var k=$.ajax({url:f});k.done(d.handleDealersByLocation),k.fail(d.handleDealersByLocationError)}};return{init:a.init,initDesktop:a.initDesktop,initMobile:a.initMobile,initMaps:a.initMaps,handleAPILoad:a.handleAPILoad,handleGeoCoding:a.handleGeoCoding,handleGeoCodingReverse:a.handleGeoCodingReverse}}();var T1=T1||{};T1.dropdown=function(){"use strict";var a={currentForm:null,originalValue:"",dropdownValues:{},comboRegionName:null,init:function(){var b=a,c=T1.constants;PubSub.subscribe(c.FORM_LOAD,b.initDropdowns)},initDropdowns:function(b,c){var d=a,e=c.find(".dropdown[data-select]");d.currentForm=c,e.each(d.initDropdown)},initDropdown:function(){var b=a,c=$(this),d=c.find(".dropdown-menu"),e=d.find("li a"),f=c.attr("data-select");("dealerregion"===f||"dealercity"===f)&&(d.children("li").remove(),b.comboRegionName=f,b.getRegions({services:c.data("services")})),e.off("click").on("click",b.handleSelect)},populateDropdown:function(b,c){var d=a,e=d.currentForm.find(".dropdown[data-select="+b+"]"),f=e.children(".dropdown-menu"),g=e.find(".dropdown-toggle span");f.empty(),d.originalValue.length>0&&(g.html(d.originalValue),d.originalValue=""),$.each(c,function(a,b){var c=$("<li></li>"),e=$("<a></a>");"object"==typeof b?(e.attr("data-value",b.id),d.dropdownValues[b.id]=b,e.html(d.htmlDecode(b.name)),e.off("click").on("click",d.handleSelect)):(e.attr("data-value",b),e.html(d.htmlDecode(b)),e.off("click").on("click",d.handleSelectRegion)),e.attr("href","#"),c.append(e),f.append(c)})},handleSelect:function(b){var c=a,d=$(b.target),e=d.data("value"),f=d.html(),g=d.parents(".dropdown"),h=g.find(".dropdown-toggle span");if(b.preventDefault(),e){c.originalValue=h.html();var i=$("<input>"),j=c.currentForm.find(".label-contact-data"),k=$("<ul></ul>");if(i.attr("type","hidden"),i.attr("name",g.data("select")),i.attr("value",e),g.find('input[type="hidden"]').remove(),g.append(i),h.html(f),j.length>0&&"dealer"===g.attr("data-select")){j.children("ul").remove();var l=c.dropdownValues[e];k.append($("<li>"+l.name+"</li>")),k.append(""!==l.address.address?$("<li>"+l.address.address+"</li>"):$("<li>"+l.address.address1+"</li>")),k.append($("<li>"+l.address.zip+" "+l.address.city+"</li>")),k.append($("<li>"+l.phone+"</li>")),j.append(k),j.addClass("active")}}},handleSelectRegion:function(b){var c=$(b.target),d=c.data("value"),e=c.html(),f=c.parents(".dropdown"),g=f.find(".dropdown-toggle span");if(b.preventDefault(),d){var h=$("<input>");h.attr("type","hidden"),h.attr("name",f.data("select")),h.attr("value",d),f.find('input[type="hidden"]').remove(),f.append(h),g.html(e)}a.getDealersByRegion(d,f.data("services"))},destroy:function(){var b=a,c=T1.constants;PubSub.unsubscribe(c.PAGEOVERLAYER_CLOSED,b.initDropdowns)},getRegions:function(b){b||(b={});var c,d=a,e=T1.constants,f="dealercity"===d.comboRegionName?!0:!1,g=T1.settings.mock?"http://t1-dev-"+T1.settings.country+".herokuapp.com"+e.URL_DEALERS_REGIONS:e.URL_DEALERS_REGIONS,h=T1.settings.mock?"http://t1-dev-"+T1.settings.country+".herokuapp.com"+e.URL_DEALERS_CITIES:e.URL_DEALERS_CITIES,i=b.services?"?services="+b.services:"",j=(f?h:g)+i;c=$.ajax({type:"GET",dataType:"JSON",url:j}),c.done(d.handleRegionsSuccess),c.fail(d.handleError)},getDealersByRegion:function(b,c){c=c?"?services="+c:"";var d,e=a,f=T1.constants,g=T1.settings.mock?"http://t1-dev-"+T1.settings.country+".herokuapp.com"+f.URL_DEALERS_LOCAL:f.URL_DEALERS_LOCAL,h=T1.settings.mock?"http://t1-dev-"+T1.settings.country+".herokuapp.com"+f.URL_DEALERS_REGIONAL:f.URL_DEALERS_REGIONAL,i="dealercity"===e.comboRegionName?g:h;d=$.ajax({type:"GET",dataType:"JSON",url:i+encodeURIComponent(b)+c}),d.done(e.handleDealersSuccess),d.fail(e.handleError)},handleRegionsSuccess:function(b){var c=a,d=c.comboRegionName||"dealerregion";a.populateDropdown(d,b)},handleDealersSuccess:function(b){a.populateDropdown("dealer",b.dealers)},handleError:function(a){console.log(a.responseText)},htmlDecode:function(a){return $("<div/>").html(a).text()}};return{init:a.init,destroy:a.destroy}}();var T1=T1||{};T1.formInput=function(){"use strict";var a={datePickerOptions:{},init:function(){var b=a,c=T1.constants;$("form, .form").filter(":visible").each(function(){b.initInputs("",$(this))}),PubSub.subscribe(c.FORM_LOAD,b.initInputs)},initOnDemand:function(b){b&&b.each(function(){a.initInputs(null,$(this))})},initInputs:function(b,c){if(c.length>0){var d=a,e=c.find('input[type="checkbox"]'),f=c.find('input[type="radio"]'),g=e.siblings("label").add(f.siblings("label")),h=c.find(".input-group.date"),i=c.find(".compare-btn");e.off("click",d.handleCheck).on("click",d.handleCheck),f.off("click",d.handleRadioSelect).on("click",d.handleRadioSelect),g.off("click",d.handleLabelClick).on("click",d.handleLabelClick),h.length>0&&h.datepicker(d.getDatePickerOptions()),c.off("tap click",".checkbox-btn",d.handleCheckboxButton).on("tap click",".checkbox-btn",d.handleCheckboxButton),i.off("click",d.handleButtonSelect).on("click",d.handleButtonSelect)}},getDatePickerOptions:function(){return{format:T1.settings.culture.calendar.patterns.d,startDate:"+1d",language:T1.settings.language,todayHighlight:!0}},handleCheck:function(a){var b=$(a.target),c=b.closest(".form, form").find('input[name="'+b.attr("name")+'"]'),d=c.filter(".select-all"),e="checked";if(b.hasClass("select-all"))c.prop(e,d.is(":"+e));else{var f=c.filter(":"+e).length;d.is(":"+e)?d.prop(e,!1):f===c.length-1&&d.prop(e,!0)}},handleLabelClick:function(a){var b=$(a.target),c=b.attr("for");if(a.preventDefault(),c){var d=b.closest("form, .form").find("#"+c),e=d.attr("type");("checkbox"===e||"radio"===e)&&d.trigger("click")}},handleRadioSelect:function(a){var b=$(a.target),c=b.siblings('input[type="radio"][name="'+b.attr("name")+'"]');c.removeAttr("checked")},handleButtonSelect:function(a){var b=$(a.target),c=b.prop("tagName"),d=b.closest('[data-validation^="select-"]'),e="A"===c?b:b.closest(".compare-btn"),f=e.children('input[type="checkbox"]'),g=f.prop("checked"),h=d.attr("data-validation");if(b.hasClass("toast"))return void a.preventDefault();if("A"===c&&a.preventDefault(),h){var i=1*h.replace("select-",""),j=d.find('input[type="checkbox"]:checked');if(!g&&j.length>i-1)return void PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:e,customText:T1.labels.forms.selectItemsRestriction.replace("[0]",i),timeout:3e3})}g?(e.removeClass("btn-dark"),e.addClass("btn-grey"),f.prop("checked",!1)):(e.removeClass("btn-grey"),e.addClass("btn-dark"),f.prop("checked",!0))},handleCheckboxButton:function(a){a.preventDefault();var b=$(this),c=b.find('input[type="checkbox"]');c.prop("checked",!c.is(":checked")).change(),b.toggleClass(b.attr("data-on-class"),c.is(":checked")),b.toggleClass(b.attr("data-off-class"),!c.is(":checked"))},destroy:function(){var b=a,c=T1.constants;PubSub.unsubscribe(c.PAGEOVERLAYER_CLOSED,b.initInputs)}};return{init:a.init,initOnDemand:a.initOnDemand,destroy:a.destroy}}();var T1=T1||{};T1.forms=function(){"use strict";var a={currentForm:null,formValid:!0,hasEvents:!1,isFormInstantiated:!1,showResults:!1,formUrls:{},resultData:{},init:function(){var b=a,c=T1.constants;b.initUrls(),PubSub.subscribe(c.FORM_ERROR,b.triggerError),PubSub.subscribe(c.TABS_SWITCH,b.initOnDemand)},initOnDemand:function(b,c){var d,e=a,f=T1.constants,g=$("#forms");d=c?$("#"+c+" form"):g.find(".tab-pane.active form"),g.length<1||d.is(e.currentForm)||(e.currentForm=d,e.setEvents(),PubSub.publish(f.FORM_LOAD,e.currentForm),"form-dealer"===e.currentForm.attr("name")&&b===f.TABS_SWITCH&&PubSub.publish(f.DEALER_LOAD),e.isFormInstantiated=!0)},initUrls:function(){var b=a,c=T1.settings.mock?"http://t1-dev-glen.herokuapp.com":T1.request.getDomainName(),d=T1.settings.mock?"http://t1-dev-proxy.herokuapp.com":T1.settings.loadSaveServer;b.formUrls={"form-contact":c+T1.constants.URL_SUBMIT_FORM_CONTACT,"form-contact-dealer":c+T1.constants.URL_SUBMIT_FORM_CONTACT_DEALER,"form-brochure":c+T1.constants.URL_SUBMIT_FORM_BROCHURE,"form-my-cars":d+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_SEARCH_CAR,"form-login":c+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_LOGIN,"form-login-save-car":c+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_LOGIN,"form-save-car":c+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_SAVE_CAR,"form-register":c+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_REGISTER,"form-forgotten-password":c+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_PASSWORD,"form-reset-password":c+T1.constants.URL_SUBMIT_FORM_MY_TOYOTA_RESET_PASSWORD,"form-testdrive":c+T1.constants.URL_SUBMIT_FORM_TESTDRIVE}},setTabIndices:function(){for(var b=a,c=b.currentForm.elements,d=0;d<c.length;d++)c[d].tabIndex=d},setEvents:function(){var b=a,c=b.currentForm.find(".form-btn"),d=c.children(".btn-submit"),e=c.children(".btn-cancel");b.currentForm.hasClass("form-dynamic")&&b.setEventsDynamic(),b.currentForm.data("submitonenter")&&b.currentForm.find("input").off("keydown",b.formKeyPress).on("keydown",b.formKeyPress),d.off("click",b.submit).on("click",b.submit),e.off("click",b.cancel).on("click",b.cancel),b.hasEvents=!0},formKeyPress:function(b){(13===b.keyCode||13===b.which)&&(b.preventDefault(),a.submit(b))},setEventsDynamic:function(){var b=a,c=b.currentForm.find(".select-dynamic [data-activate]");c.off("click",b.switchElementDynamic).on("click",b.switchElementDynamic)},switchElementDynamic:function(){var b=a,c=$(this),d=c.attr("data-activate"),e=c.attr("data-extra-info"),f=b.currentForm.find("#"+d),g=f.siblings(".element-dynamic");if(g.removeClass("active"),f.addClass("active"),e){var h=$("#extra-info");h.attr("value",e)}},validate:function(){var b=a,c=T1.constants,d=T1.labels;if(b.currentForm&&b.currentForm.length>0){var e=b.currentForm.find("[data-validation]");return b.setFormValid(),$.each(e,b.validateElement),b.formValid||(b.setError(d.forms.errorInValid),PubSub.publish(c.FORM_VALIDATION_FAILED,{form:b.currentForm,fields:b.currentForm.find("."+c.CLASS_ERROR)})),b.formValid}return b.currentForm=$("form"),b.validate(),!1},validateElement:function(){var b=a,c=T1.constants,d=$(this),e=d.data("validation").split(" "),f=d[0].value;if(d.hasClass("input-dynamic")){var g=d.parents(".element-dynamic");if(!g.hasClass("active"))return}for(var h=0;h<e.length;h++)if(e[h]===c.FORM_VALIDATION_RULE_SELECT)d.siblings('input[type="hidden"]').length<1&&(b.setElementInvalid(d),console.log(d.attr("name")+": no selection"));else if(e[h]===c.FORM_VALIDATION_RULE_LENGTH){var i=d.attr("minlength")||d.attr("min-length");f.length<i&&(b.setElementInvalid(d),console.log(d.attr("name")+": minimum length not met"))}else if(e[h]===c.FORM_VALIDATION_RULE_NUMBER)f.isNumeric||(b.setElementInvalid(d),console.log(d.attr("name")+": value not numeric"));else if(e[h]===c.FORM_VALIDATION_RULE_EMAIL)b.validateEmail(f)||(b.setElementInvalid(d),console.log(d.attr("name")+": not a valid email address"));else if(e[h]===c.FORM_VALIDATION_RULE_PHONE)b.validatePhone(f)||(b.setElementInvalid(d),console.log(d.attr("name")+": not a valid phone number"));else if(e[h]===c.FORM_VALIDATION_RULE_PARITY)b.validateParity(d)||(b.setElementInvalid(d),console.log(d.attr("name")+": parity check failed"));else if(e[h]===c.FORM_VALIDATION_RULE_REGEXP){var j=d.attr("data-regexp");new RegExp(j,"i").test(f)||(b.setElementInvalid(d),console.log(d.attr("name")+": did not match its criteria /"+j+"/i"))}},validateEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c=b.test(a);return c},validatePhone:function(a){var b=/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i,c=a.length>2&&b.test(a);return c},validateParity:function(b){var c=a.currentForm.find('input[name="'+b.data("parity-target")+'"]');return c.size()&&c.val()===b.val()},setElementInvalid:function(b){var c=a,d=T1.constants,e=b.hasClass("dropdown-toggle")?b.parent().prev(".form-label"):b.prev(".form-label");b.addClass(d.CLASS_ERROR),e.addClass(d.CLASS_ERROR),c.formValid=!1},setFormValid:function(){var b=a,c=T1.constants;b.formValid=!0,b.currentForm.removeClass(c.CLASS_ERROR_FORM),b.currentForm.find("."+c.CLASS_ERROR).removeClass(c.CLASS_ERROR)},submit:function(b){var c=a;if(b.preventDefault(),c.currentForm=$(b.target).parents("form"),c.validate()){var d=c.currentForm.attr("id");if("form-testdrive"===d||"form-brochure"===d){c.showResults=!0;var e=c.currentForm.find('input[name="model"]:checked');c.resultData.models={};for(var f=0;f<e.length;f++){var g=$(e[f]).closest(".modelitem");c.resultData.models[f]=g}c.resultData.name=c.currentForm.find('input[name="firstname"]').val()+" "+c.currentForm.find('input[name="lastname"]').val(),c.resultData.date=c.currentForm.find('input[name="date"]').val();var h=c.currentForm.find('.dropdown[data-select="time"] .dropdown-toggle span');c.resultData.time=h.html(),c.resultData.address=c.currentForm.find('input[name="street"]').val()+" "+c.currentForm.find('input[name="housenr"]').val()+"<br/>"+c.currentForm.find('input[name="postcode"]').val()+" "+c.currentForm.find('input[name="city"]').val();var i=c.currentForm.find('input[name="dealer"]');i&&i.length>0&&(c.resultData.dealer=i.data("item"))}c.submitAsync(),c.currentForm.data("preserve")||c.resetForm("",d)}else c.currentForm.addClass("error-form")},submitAsync:function(){var b,c=a,d={form:c.currentForm,data:$(c.currentForm).serialize(),url:c.getCurrentFormUrl(),cancel:!1,json:!1};PubSub.publishSync(T1.constants.BEFORE_FORM_SUBMIT,d),d.cancel||(console.log(d.data),b=$.ajax({type:c.currentForm.attr("method")||"POST",dataType:c.currentForm.data("type")||"json",beforeSend:d.json?a.xhrBeforeSend:null,url:d.url,data:d.data}),b.done(c.submitSuccess),b.fail(c.submitError),b.always(c.setEventsAfter))},xhrBeforeSend:function(a){a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Accept","application/json")},getCurrentFormUrl:function(){var b=a,c=b.currentForm.attr("id");return b.currentForm.attr("data-url")||b.formUrls[c]},submitSuccess:function(b,c,d){var e=a,f=T1.constants,g=e.currentForm.parents(".tab-pane"),h=$("#"+g.attr("id")+"-result"),i={form:e.currentForm,status:c,data:b,validated:!0};if(b.success||"success"===c){if(PubSub.publishSync(f.VALIDATE_FORM_RETURN,i),i.validated&&h.size()){if(e.showResults&&(h.find(".result-name").html(e.resultData.name),e.resultData.date?h.find(".result-date").html(e.resultData.date):h.find(".result-date").parent().remove(),e.resultData.date?h.find(".result-time").html(e.resultData.time):h.find(".result-time").parent().remove(),h.find(".result-address").html(e.resultData.address),e.resultData.dealer?h.find(".result-dealer").html(e.resultData.dealer.phone):h.find(".result-dealer").parent().remove(),e.resultData.models)){var j=h.find(".result-car"),k=null;j.empty(),$.each(e.resultData.models,function(a,b){k=b.clone(),k.find("a.btn").remove(),j.append(k)})}h.addClass(f.CLASS_ACTIVE),g.removeClass(f.CLASS_ACTIVE)}PubSub.publish(f.SUBMIT_FORM_RETURN,i)}else e.submitError(d,c,b.error)},submitError:function(b,c,d){var e=a,f=T1.labels,g=d.message||b.responseText||f.forms.errorSubmit,h={form:e.currentForm,code:b.status,status:c,message:d?d.message:f.forms.errorSubmit,showError:!0};console.log(c+": "+g),PubSub.publishSync(T1.constants.SUBMIT_FORM_RETURN,h),h.showError&&e.setError(g)},setEventsAfter:function(){var b=a,c=T1.constants;PubSub.subscribe(c.TABS_SWITCH,b.resetForm),PubSub.subscribe(c.PAGEOVERLAYER_CLOSE,b.resetForm)},setError:function(b){var c=a,d=T1.constants;c.formValid=!1,c.currentForm.addClass(d.CLASS_ERROR_FORM),c.currentForm.find(".error-message").html(b)},triggerError:function(b,c){var d=a;d.setError(c)},resetForm:function(b,c){var d=a,e=T1.constants,f=d.currentForm.parents(".tab-pane"),g=f.attr("id"),h=$("#"+g+"-result");d.setFormValid(),h.removeClass(e.CLASS_ACTIVE),g===c&&f.addClass(e.CLASS_ACTIVE)},cancel:function(a){PubSub.publish(T1.constants.HASH_REMOVE,""),a.preventDefault()}};return{init:a.init,initOnDemand:a.initOnDemand,validate:a.validate,submit:a.submit,cancel:a.cancel}}();var T1=T1||{};T1.dealerForm=function(){"use strict";var a={formId:"#form-contact-dealer",carsImageSize:{width:300,height:95},init:function(){PubSub.subscribe(c.FORM_LOAD,b.formLoad)},formLoad:function(a,d){a===c.FORM_LOAD&&d.is($(b.formId))&&b.searchCar($.trim(T1.request.getQueryStringParameter("car")))},searchCar:function(a){if(a){var d=$.ajax({type:"GET",dataType:"JSON",url:T1.settings.loadSaveServer+c.URL_SUBMIT_FORM_MY_TOYOTA_SEARCH_CAR+"/"+a+"/short/"});d.done(b.loadCar),d.fail(b.showError)}},loadCar:function(a){var d=$(b.formId).find(".selected-car").first(),e={id:a.id};PubSub.publishSync(c.MY_TOYOTA_GET_CAR,e);var f=e.out.car||a;d.size()&&(d.find("#carId").val(f.id),d.find(".obj-desc").attr("data-obj-code",f.id),d.find("img").attr("src",b.getCarImagePath(f.ids)),d.find(".hybrid").toggle(f.hybrid||!1),d.find(".title").html(b.htmlDecode(f.customName||f.car)),f.price&&d.find(".price").html(b.htmlDecode(globalize.format(f.price.listWithDiscount,"c"))),d.find(".desc").hide(),d.find(".code i").html(b.htmlDecode(f.code)),d.find(".date").text(f.storeDate).toggle(void 0!==f.storeDate),d.find(".saved").toggle(f.saved||!1),d.show())},getCarImagePath:function(a){return T1.settings.CCISHost+"vehicle/"+a.model+"/"+a.car+"/exterior-32_"+a.colour+".png?width="+b.carsImageSize.width+"&height="+b.carsImageSize.height},htmlDecode:function(a){return $("<div/>").html(a).text()},showError:function(a,c,d){var e=$(b.formId).find(".selected-car");e.find(">div:not(.error)").remove(),e.find(">div.error h3").html(b.htmlDecode(d||T1.labels.forms.errorSubmit)),e.show()}},b=a,c=T1.constants;return{init:a.init}}();var T1=T1||{};T1.tabs=function(){"use strict";var a={currentTabs:null,currentTabContent:null,init:function(){PubSub.subscribe(T1.constants.TABS_SWITCH,a.setTabActive)},initDesktop:function(){var b=a,c=T1.constants;PubSub.subscribe(c.PAGEOVERLAYER_LOAD,b.initOnDemand),b.initOnDemand()},initMobile:function(){a.initOnDemand()},initOnDemand:function(b,c){c||(c={});var d=a,e=T1.constants,f=c.el?$(c.el).find(".toyota-tabs"):$(".toyota-tabs");f.each(d.initTabGroup),PubSub.publish(e.TABS_LOAD)},initTabGroup:function(){var b=a,c=T1.request,d=$(this);if(b.currentTabs=d.find(".toyota-tabs-select a[data-tab]"),b.currentTabContent=d.find(".toyota-tabs-content"),b.setTabEvents(),c){var e=c.getQueryStringParameter("tab");e&&e.length>0&&PubSub.publish(T1.constants.TABS_SWITCH,e)}},setTabComponentActive:function(b){if(b){var c=a,d=$(b),e=d.closest(".toyota-tabs-content"),f=null;e.hasClass("active")||(f=e.parent(),$(".toyota-tabs-content").removeClass("active"),e.addClass("active"),c.currentTabs=f.find(".toyota-tabs-select a[data-tab]"),c.currentTabContent=f.find(".toyota-tabs-content"))}},setTabEvents:function(){var b=a;b.currentTabs.on("click",b.switchTab)},switchTab:function(a){var b;"object"==typeof a?(a.preventDefault(),b=$(a.target).data("tab")):b=a,PubSub.publish(T1.constants.TABS_SWITCH,b)},setTabActive:function(b,c){var d=a,e=T1.constants,f=$("#"+c);d.setTabComponentActive(f);var g=d.currentTabs.filter('a[data-tab="'+c+'"]');d.resetAll(),g.addClass(e.CLASS_ACTIVE),f.addClass(e.CLASS_ACTIVE)},setTabContent:function(b,c){var d=a,e=T1.constants,f=d.currentTabContent.find(".tab-pane.active");c.hasClass(e.CLASS_ACTIVE)||c.addClass(e.CLASS_ACTIVE),f.replaceWith(c),PubSub.unsubscribe(d.setTabContent)},resetItem:function(){var a=$(this);a.removeClass("active")},resetAll:function(){var b=a;b.currentTabs.each(b.resetItem),b.currentTabContent.find(".tab-pane").each(b.resetItem)}};return{init:a.init,initDesktop:a.initDesktop,initMobile:a.initMobile,setTabActive:a.setTabActive,setTabContent:a.setTabContent}}();var T1=T1||{};T1.mediaOverlayer=function(){"use strict";var a={carouselId:"mediaOverlayerCarousel",data:null,galleryContainer:null,detachedIframes:[],init:function(){var b=a;PubSub.subscribe(T1.constants.GALLERY_ITEM_CLICK,b.show),PubSub.subscribe(T1.constants.IFRAME_DESTROY,b.destroyIframe)},getMediaData:function(b){var c=a,d=$(b),e=d.find(".gallery-item"),f=null,g="",h=$(window).width()>T1.constants.SCREEN_SMALL?"desktop":"mobile",i="",j=[];
return 0===e.length&&(e=d.find("a")),c.galleryContainer!==d&&(c.galleryContainer=d,e.each(function(a,b){switch(b=$(b),f=b.hasClass("item-link")?b:b.find(".item-link"),f&&0!==f.length||(f=b),g=b.data("type")){case"image":i=f.data("src-"+h)||f.attr("href"),j.push({type:g,src:i,isLazyLoad:!0,dataNode:b});break;case"video":j.push({type:g,srcMp4:f.data("media-sourcemp4"),srcOgv:f.data("media-sourceogv"),srcWebm:f.data("media-sourcewebm"),srcFlv:f.data("media-sourceflv"),srcVtt:f.data("media-sourcevtt"),srcVttLang:f.data("media-sourcevttlang"),poster:f.data("media-poster"),isLazyLoad:!0,dataNode:b});break;case"iframe":j.push({type:g,link:f.attr("href"),isLazyLoad:!0,dataNode:b});break;case"external-video":j.push({type:g,youtubeId:T1.utilities.youtube.getYouTubeId(f.attr("href")),isLazyLoad:!0,dataNode:b})}}),c.data=j),c.data},hide:function(){var b=a;return $("body").off("onkeydown",b.captureKeys),PubSub.publish(T1.constants.PAGEOVERLAYER_CLOSE),PubSub.publish(T1.constants.MEDIAOVERLAYER_HIDE),!0},show:function(b,c){{var d=a,e=c.index||0,f=$(c.el).closest(".gallery")||$(".gallery"),g=$(c.el).closest("section").attr("data-section-title")||c.pageName;"video"===$(c.el).parent().attr("data-type")?!0:!1}$("body").on("keydown",d.captureKeys);var h=$("<div></div>");PubSub.publishSync(T1.constants.CAROUSEL_CREATE,{targetNode:h,slides:d.getMediaData(f),activeSlide:e,id:d.carouselId,type:"slide",options:{interval:!1},enableSwipe:!0});var i=null;if($(".social-tools").length>0){var j=$(".social-tools").find(".share-button.clean").clone(!0);j.find(".sprite-share-arrow").attr("class","sprite-share-arrow-inverted"),i=$('<div id="social-tools-gallery"></div>'),j.appendTo(i),i.appendTo(h)}PubSub.publishSync(T1.constants.PAGEOVERLAYER_OPEN,{html:h,styleClass:"mediaOverlayer",pageName:g,fitImages:!0});var k=function(){var a=$("#"+d.carouselId+" .carousel-inner .item.active");if(1==a.find("img").length?d.loadImage($("#"+d.carouselId+" .carousel-inner .item.active img")):1==a.find("iframe").length||a.attr("data-detachedIframe")?(d.attachIframe(),d.loadIframe(a.find("iframe"))):a.find("iframe")&&($("#"+d.carouselId+" .item").not(".active").find("iframe").css({display:"none"}),PubSub.publish(T1.constants.IFRAME_DESTROY)),i){var b=$(".item.active").index();i.attr("data-link",location.href.replace(/[^/]+$/,b))}},l=function(){$("#"+d.carouselId+" .item").not(".active").find("img").css({display:"none"}),d.detachIframe(),PubSub.publish(T1.constants.VIDEO_STOP,{})},m=function(){k();var a=$("#"+d.carouselId);a.on("slid.bs.carousel",k),a.on("slide.bs.carousel",l),PubSub.unsubscribe(n)},n=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,m)},captureKeys:function(b){var c=a,d=window.event||b;if(d)switch(d.keyCode){case T1.constants.KEYCODE_ESC:c.hide()}},loadImage:function(b){var c=a,d=[b,b.parent().next(".item").find("img"),b.parent().prev(".item").find("img")],e=0,f=function(){PubSub.publish(T1.constants.PAGEOVERLAYER_RESIZE_IMAGE,{}),c.hideLoader(),0===$(this).parent().find("video").length&&$(this).fadeIn("slow").css({display:"block",position:"absolute",top:0})};for(e in d){var g=b,h=g.data("lazy-load");g.attr("src",""),g.on("load",f),g.attr("src",h)}c.showLoader()},showLoader:function(){var b=a;if(0===$(".loaderLayer").length){$("<div></div>").addClass("loaderLayer").appendTo("#"+b.carouselId).show()}else $(".loaderLayer").show()},hideLoader:function(){$(".loaderLayer").hide()},loadIframe:function(b){var c=b,d=c.attr("data-lazy-load"),e=c.attr("sticky"),f=a;e||(d&&(c.attr("src",d),c.on("load",function(){f.hideLoader(),c.fadeIn("slow")})),f.showLoader())},attachIframe:function(){var b=a,c=$("#"+b.carouselId+" .item.active");if("external-video"==c.attr("data-type")&&c.attr("data-detachedIframe")){var d=parseInt(c.attr("data-detachedIframe"));void 0!==b.detachedIframes[d]&&(b.detachedIframes[d].appendTo(c),b.detachedIframes[d]=void 0,c.removeAttr("data-detachedIframe"))}},detachIframe:function(){var b=a,c=$("#"+b.carouselId+" .item.active");if("external-video"==c.attr("data-type")){var d=c.find("iframe");d.length>0&&(d=d.detach(),b.detachedIframes.push(d),c.attr("data-detachedIframe",b.detachedIframes.length-1))}},destroyIframe:function(){var b=a,c=$("#"+b.carouselId+" .item").not(".active").find("iframe"),d=c.attr("src");c&&(c.attr("sticky")||(c.data("lazy-load",d),c.attr("src","")))}};return{init:a.init,build:a.build,show:a.show,hide:a.hide}}();var T1=T1||{};T1.pageOverlayer=function(){"use strict";var a={pageStack:[],defaultHtml:"<div></div>",className:"overlayerWrapper",mainContentId:"pagecontent",animationDelay:10,scrollTop:0,disableScrollClass:"no-scroll",disableResizeClass:"no-resize",disableFitImageClass:"no-fit-image",youtubeUrl:"http://www.youtube.com/embed/<id>?rel=0&hd=1;autoplay=1;controls=0;modestbranding=1&wmode=opaque&html5=1",tokenOnResize:null,contentOnOverlay:$(".content-on-overlay"),init:function(){var b=a;PubSub.subscribe(T1.constants.PAGEOVERLAYER_OPEN,b.show),PubSub.subscribe(T1.constants.PAGEOVERLAYER_CLOSE,b.hide),PubSub.subscribe(T1.constants.PAGEOVERLAYER_RESIZE_IMAGE,b.fitImage),PubSub.subscribe(T1.constants.PAGEOVERLAYER_RESIZE,b.resize),PubSub.subscribe(T1.constants.PAGEOVERLAYER_DESTROY,b.destroy),b.contentOnOverlay.length>0&&PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{html:b.contentOnOverlay,fitImages:!0,noScroll:!0})},show:function(b,c){var d=a,e=c.html||d.defaultHtml,f=$(e),g=c.preserveContent||!1,h=null,i=c.backCaption||(T1.labels?T1.labels.backTo:"Back to "),j=c.pageName||$(c.el).closest("section").data("section-title"),k=c.backCaptionStrong||j||(T1.labels?T1.labels.page:"page"),l=" "+(c.styleClass||"")+(c.inPage?" inpage":""),m=$("<div></div>").addClass(d.className+l),n=c.inPage||!1,o=c.noScroll?" "+d.disableScrollClass:"",p=c.noResize?" "+d.disableResizeClass:"",q=c.fitImages?"":" "+d.disableFitImageClass,r=c.noFade||n||!1,s=c.noTransitions||!1,t=$("<div></div>").addClass("overlayerContent"+o+p+q),u=function(){PubSub.publish(T1.constants.PAGEOVERLAYER_RESIZE,{}),PubSub.publish(T1.constants.PAGEOVERLAYER_RESIZE_IMAGE,{})};if(d.tokenOnResize||(d.tokenOnResize=PubSub.subscribe(T1.constants.ON_WIN_RESIZE,u)),0===d.pageStack.length&&(d.scrollTop=$(document).scrollTop()),f.hasClass(d.className))m=f;else{if(0===f.find(".toolbar").length&&!n){var v=d.buildToolbar({backCaption:i,backCaptionStrong:k});v.appendTo(m)}n&&(d.removeBackButtons(),d.buildInPageToolbar().prependTo(t,m)),g&&(h=$("<figure data-type='pageoverlayer-placeholder'></figure>"),f.before(h)),f.appendTo(t),t.appendTo(m)}c.html5id&&(c.iframe=!0,c.url="/api/html/page"+location.pathname+"?id="+c.html5id),c.youtubeId&&d.addYouTube(f,c),c.iframe&&d.addIFrame(f,c),c.ajax&&d.addAjaxContent(f,c),c.video&&d.addVideo(f,c),m.find("> div").css({display:"none"}),d.pageStack.push({name:j,el:m,originalDataPosition:h,noTransitions:s,noFade:r}),m.appendTo($("body"));var w=!1,x=!1,y=!1;if(c.iframe&&c.sync)try{var z=t.find("iframe").get(0).contentWindow;$(z).load(function(){x=!0,w&&!y&&(PubSub.publish(T1.constants.PAGEOVERLAYER_LOAD,{el:m}),y=!0)})}catch(A){c.sync=!1}var B=function(){w=!0,t.scrollTop(0),(!c.iframe||!c.sync||x&&!y)&&(PubSub.publish(T1.constants.PAGEOVERLAYER_LOAD,{el:m}),y=!0)},C=function(){$("#"+d.mainContentId).css({display:"none"}),$("."+d.className+":not(:last)").css({display:"none"}),n&&(m.css({position:"static"}),$(window).scrollTop(0)),PubSub.publish(T1.constants.PAGEOVERLAYER_RESIZE,{el:m}),PubSub.publish(T1.constants.PAGEOVERLAYER_RESIZE_IMAGE,{el:m}),m.find(".toolbar").fadeIn(T1.constants.ANIMATION_SPEED_FADE),r||s?(m.find("> div").css({display:"block"}),B()):m.find(".overlayerContent").fadeIn(T1.constants.ANIMATION_SPEED_FADE,B)};s?(m.css({"margin-left":0}),C()):m.animate({"margin-left":0},T1.constants.ANIMATION_SPEED_SCROLL,C)},addIFrame:function(a,b){var c=$("<iframe></iframe>",{src:b.url||$("#"+b.el).prop("href"),width:"100%",height:"100%"});a.addClass("white"),a.append(c)},addAjaxContent:function(a,b){var c=b.url||$("#"+b.el).prop("href"),d=b.sync?!1:!0;a.addClass("white"),$.ajax({url:c,async:d,success:function(b){var c=$("<div>"+b+"</div>"),d=c.find(c.find("#pagecontent > *").length>0?"#pagecontent > *":"body > *");a.append(d),$(".overlayerContent #nav-primary").remove()}})},addYouTube:function(b,c){var d=a,e=$("<iframe></iframe>",{src:d.youtubeUrl.replace(/<id>/g,c.youtubeId)});b.addClass("youtubeWrapper"),b.append(e)},addVideo:function(a,b){b.video.figure=a,PubSub.publishSync(T1.constants.VIDEO_CREATEPLAYER,b.video)},buildToolbar:function(a){var b=$('<div onclick=""></div>'),c=$("<a></a>").addClass("close-link"),d=$("<span></span>").addClass("back-text").html(a.backCaption+" "),e=$("<strong></strong>").html(a.backCaptionStrong);b.addClass("toolbar"),c.append('<div class="logo-logo-lvl2"></div>'),c.append('<div class="btn-back" onclick=""><div class="btn-graphic" onclick=""><i class="icon-angle-left" onclick=""></i></div></div>'),d.append(e),c.append(d),b.append(c);var f=function(){PubSub.publish(T1.constants.HASH_REMOVE,"")};return b.on("click",f),b},buildInPageToolbar:function(){var a=$("<a/>").text(T1.labels.backTo+" "+T1.labels.page).addClass("btn btn-grey btn-full-width visible-xs page-overlayer-mobile-back").attr("href","#");return $("<i/>").addClass("icon-chevron-left").appendTo(a),a.on("click",function(a){a.preventDefault(),PubSub.publish(T1.constants.HASH_REMOVE,""),$(this).remove()}),a},hide:function(){if(0!==a.pageStack.length){var b=a,c=b.pageStack.length-1,d=b.pageStack[c],e=d.el.find(".overlayerContent").children(),f=d.noTransitions||!1,g=d.noFade||!1,h=function(){$(document).scrollTop(b.scrollTop)},i=function(){0===c&&(PubSub.unsubscribe(b.tokenOnResize),b.tokenOnResize=null),b.pageStack.splice(c,1),d.el.remove(),PubSub.publish(T1.constants.PAGEOVERLAYER_CLOSED,{overlayer:this,content:e})},j=function(){0!==c&&b.pageStack[c-1].el.css({display:"block"}),d.originalDataPosition&&d.originalDataPosition.replaceWith(e),0===c&&($("#"+b.mainContentId).css({display:"block"}),h(),PubSub.publish(T1.constants.PAGEOVERLAYER_REOPEN_MAINCONTENT)),f?(d.el.css({display:"none"}),i()):d.el.animate({"margin-left":"100%"},T1.constants.ANIMATION_SPEED_SCROLL,i)},k=d.el.find("> .toolbar"),l=d.el.find("> .overlayerContent");d.el.css({position:"fixed"}),f||g?(k.css({display:"block"}),l.css({display:"block"}),j()):(l.fadeOut(T1.constants.ANIMATION_SPEED_FADE,j),k.fadeOut(T1.constants.ANIMATION_SPEED_FADE))}},removeBackButtons:function(){$(".page-overlayer-mobile-back").remove()},fitImage:function(b,c){var d=a,e=$(".overlayerContent").last();if(!e.hasClass(d.disableFitImageClass)&&e.offset&&0!==e.length){var f=e.offset(),g=$(window).height()-f.top,h=$(window).width()-f.left,i=c.image||e.find(".item.active img");0===i.length&&(i=e.find("#content-on-overlay > img")),0===i.length&&(i=e.find("> .posterWrapper > img"));var j=i.height(),k=i.width(),l=h/g,m=k/j;0!==i.length&&i.css(m>l?{height:g,width:"auto","margin-top":0,"margin-left":-Math.floor(g*m-h)/2}:{height:"auto",width:h,"margin-top":-Math.floor(h/m-g)/2,"margin-left":0})}},resize:function(b,c){c||(c={});var d=a,e=c.el||$(".overlayerWrapper").last(),f=e.find(".overlayerContent");if(0!==f.length&&!f.hasClass(d.disableResizeClass)){var g=$(window),h=g.width(),i=h>=T1.constants.SCREEN_SMALL?"desktop":g.height()>h?"portrait":"landscape";e.removeClass("landscape portrait desktop"),e.addClass(i);var j={left:f[0].offsetLeft,top:f[0].offsetTop},k=h-j.left+"px",l=g.height()-j.top+"px";f.css({width:k,height:l})}},destroy:function(){for(var b=a,c=null,d=0;d<b.pageStack.length;d++)c=b.pageStack[d],c.originalDataPosition&&c.originalDataPosition.replaceWith(c.el.find(".overlayerContent").children()),c.el.remove();PubSub.publish(T1.constants.PAGEOVERLAYER_REOPEN_MAINCONTENT),b.pageStack=[],$("#"+b.mainContentId).css({display:"block"}),$(document).scrollTop(b.scrollTop)}};return{init:a.init,show:a.show,hide:a.hide,fitImage:a.fitImage,fitVideo:a.fitVideo}}();var T1=T1||{};T1.sitemap=function(){"use strict";var a={collapseContainer:$(".sitemap"),sitemapLink:$("li.sitemaplink"),init:function(){var b=a;b.collapseContainer.on("show.bs.collapse",b.openSitemap),$(".footer-collapsed-links a").on("click",function(a){a.preventDefault()})},openSitemap:function(){$("html, body").animate({scrollTop:$(document).height()},"slow")},switchDesktop:function(){a.sitemapLink.show()},switchMobile:function(){$(".row.sitemap");a.collapseContainer.removeClass("in"),a.collapseContainer.addClass("collapse"),a.sitemapLink.hide()}};return{init:a.init,switchMobile:a.switchMobile,switchDesktop:a.switchDesktop}}();var T1=T1||{};T1.expandItemsButton=function(){"use strict";var a={labels:{},init:function(){var b=a,c=$(".view-all-button");c.length>0&&(PubSub.subscribe(T1.constants.EXPANDITEMSBUTTON_CLICK,b.changeText),c.on("click",b.pub))},changeText:function(a,b){var c=$(b),d=$(c.attr("data-parent")),e=d.find(c.attr("data-itemclass")),f=T1.labels.viewLess,g=T1.labels.viewAll,h="";if(c.hasClass("collapsed")){h=" ("+e.length+")";var i=g+h;c.text(""+i)}else c.text(""+f)},pub:function(){PubSub.publish(T1.constants.EXPANDITEMSBUTTON_CLICK,this)}};return{init:a.init,changeText:a.changeText}}(),T1.dealerCards=function(){var a={container:$("#dealer-details"),map:null,markers:[],dealerLocation:null,currentLocation:null,breakpoints:{xs:T1.constants.SCREEN_XTRASMALL,sm:T1.constants.SCREEN_SMALL,md:T1.constants.SCREEN_MEDIUM,lg:T1.constants.SCREEN_LARGE},init:function(){b.container.size()&&(PubSub.subscribe(c.MY_TOYOTA_LOGIN_SUCCESS,b.myToyotaLoginSuccess),PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,b.breakpointChanged),PubSub.subscribe(c.GOOGLE_MAP_LOAD,b.initMap),T1.dealerFinder.initMaps(),b.container.find(".dealer-contact-details h4").click(function(){var a=$(this).parent().find(">.row"),c=b.container.find(".details-section.open >div >.row");c.is(a)||c.slideToggle(function(){c.parents(".details-section").toggleClass("open")}),a.slideToggle(function(){a.parents(".details-section").toggleClass("open")})}),b.container.find(".btn-save").toggle(T1.myToyota.isAuthenticated()).click(b.save),b.container.find(".input-search input").keypress(b.handleKeyPress),b.container.find(".btn-search").click(b.search),b.container.find(".btn-back").click(b.showDetails))},myToyotaLoginSuccess:function(){b.container.find(".btn-save").toggle(T1.myToyota.isAuthenticated())},save:function(a){var d=($.ajax(c.URL_DEALERS+"/"+b.container.data("id")),$.ajax({type:"GET",url:c.URL_DEALERS+"/"+b.container.data("id")}));d.done(function(a){PubSub.publish(T1.constants.DEALER_SAVE,{dealer:a}),PubSub.publish(T1.constants.HASH_ADD,"/publish/my_toyota_my_dealers")}),d.fail(function(a,b,c){alert(c||T1.labels.forms.errorSubmit)}),a.preventDefault()},search:function(a){var c=b.container.find(".input-search input").val();0!==c.length?(new google.maps.Geocoder).geocode({address:c},function(a,c){c===google.maps.GeocoderStatus.OK?a[0]?(b.currentLocation=new google.maps.LatLng(a[0].geometry.location.lat(),a[0].geometry.location.lng()),b.loadDirections()):b.showGeoError(T1.labels.dealer.errorGeoNotFound):b.showGeoError(T1.labels.dealer.errorGeoFailed)}):b.showGeoError(T1.labels.dealer.errorNoValue),a.preventDefault()},handleKeyPress:function(a){13===a.keyCode&&b.search(a)},showDetails:function(a){b.reset(),b.container.find(".directions").addClass("hidden"),b.container.find(".details").removeClass("hidden"),b.container.hasClass("small-view")&&b.moveMapForSmallView(),a.preventDefault()},loadDealerMap:function(a){if(a.size()){var c=$.parseJSON(a[0].getAttribute("data-location"));b.dealerLocation=new google.maps.LatLng(c.lat,c.lon),b.map=new google.maps.Map(a[0],{center:b.dealerLocation,zoom:10,mapTypeId:google.maps.MapTypeId.ROADMAP}),b.clearMarkers(),b.setMarker(0,b.dealerLocation,b.container.find(".dealer-name").text())}},loadDirections:function(){b.initMap();var a=new google.maps.DirectionsRenderer({map:b.map,suppressMarkers:!0}),c=new google.maps.DirectionsService,d={origin:b.currentLocation,destination:b.dealerLocation,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.DirectionsUnitSystem.METRIC};a.setPanel(b.container.find(".directions-content").empty()[0]),c.route(d,function(c,d){d===google.maps.DirectionsStatus.OK&&(a.setDirections(c),b.container.find(".details").addClass("hidden"),b.container.find(".directions").removeClass("hidden"),b.container.hasClass("small-view")&&b.moveMapForSmallView())}),b.clearMarkers(),b.setMarker(98,b.currentLocation,b.container.find(".input-search input").val()),b.setMarker(-1,b.dealerLocation,b.container.find(".dealer-name").text())},setMarker:function(a,c,d){var e=9>a?"0"+(a+1):a+1;b.markers.push(new google.maps.Marker({position:c,icon:T1.settings.dealer.markerPath+"marker"+e+".png",map:b.map,title:d}))},clearMarkers:function(){for(var a=0;a<b.markers.length;a++)b.markers[a].setMap(null);b.markers=[]},initMap:function(){b.map||(b.reset(),Modernizr.geolocation&&b.container.find(".geo-location").css("display","block").click(function(a){b.getLocation(),a.preventDefault()}))},reset:function(){b.container.find(".input-search input").val(""),b.container.find(".bubble-direction").removeClass("active"),b.loadDealerMap(b.container.find(".map-dealers"))},getLocation:function(){Modernizr.geolocation&&navigator.geolocation.getCurrentPosition(function(a){b.currentLocation=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),b.setCurrentAddress()})},setCurrentAddress:function(){(new google.maps.Geocoder).geocode({latLng:b.currentLocation},function(a,c){return c!==google.maps.GeocoderStatus.OK?void b.showGeoError(T1.labels.dealer.errorGeoFailed):void(a[1]?b.container.find(".input-search input").val(a[1].formatted_address):b.showGeoError(T1.labels.dealer.errorGeoNotFound))})},showGeoError:function(a){b.container.find(".geo-error").text(a).css({display:"block"})},breakpointChanged:function(a,d){b.breakpoints[d]<=c.SCREEN_SMALL&&!b.container.hasClass("small-view")?b.moveMapForSmallView():b.breakpoints[d]>c.SCREEN_SMALL&&b.container.hasClass("small-view")&&b.moveMapForLargeView()},moveMapForSmallView:function(){b.container.addClass("small-view"),b.container.find(".map-dealers").parents(".row:first").insertBefore(".dealer-contact-title:visible, .directions-content:visible")},moveMapForLargeView:function(){b.container.removeClass("small-view"),b.container.find(".map-dealers").parents(".row:first").appendTo("#map-col")}},b=a,c=T1.constants;return{init:a.init}}();var T1=T1||{};T1.financeRates=function(){"use strict";var a={blFinanceRates:null,cbFinanceRates:null,enabled:null,init:function(){b.blFinanceRates=$(".finance-rates").show(),b.cbFinanceRates=b.blFinanceRates.find('input[type="checkbox"]'),PubSub.subscribe(c.FINANCE_RATES_ON,b.enableFinanceRates),PubSub.subscribe(c.FINANCE_RATES_OFF,b.disableFinanceRates),b.cbFinanceRates.on("change",b.toggleFinanceRates),b.initState()},initState:function(){Modernizr.localstorage&&PubSub.publishSync(0===parseInt(localStorage.getItem("financeRates"))?c.FINANCE_RATES_OFF:c.FINANCE_RATES_ON)},toggleFinanceRates:function(){PubSub.publish($(this).is(":checked")?c.FINANCE_RATES_ON:c.FINANCE_RATES_OFF)},enableFinanceRates:function(){localStorage.setItem("financeRates",1),b.cbFinanceRates.prop("checked",!0),b.enabled=!0,$("body").addClass("show-finance-rates"),b.requestRates()},disableFinanceRates:function(){localStorage.setItem("financeRates",0),b.cbFinanceRates.prop("checked",!1),b.clearRates(),b.enabled=!1,$("body").removeClass("show-finance-rates")},requestRates:function(){b.enabled&&T1.settings.finance&&"true"===T1.settings.finance.showRatesMonthly&&T1.data&&T1.data.finance&&T1.data.finance.configs&&$("[data-tfs-code]").size()&&T1.financeService.requestFinanceData({configs:T1.data.finance.configs,success:b.applyRates,multiple:!0,source:"Global"})},applyRates:function(a){return a.error?void console.log(a.message):($("[data-tfs-code]").each(function(){var b=$(this),c=b.data("tfs-code"),d=a[c]&&a[c].rate?a[c].rate:null,e=a[c]&&a[c].show?a[c].show:null,f=d&&d.productName?d.productName.formatted:T1.labels.viewDisclaimer;d&&(b.find(".tfs-input").each(function(){var a=$(this),b=T1.financeService.formatFinanceString(a.attr("data-tfs-input")||a.html(),d,e);(b||""!==$.trim(b))&&(a.data("tfs-input",a.html()),a.html(b).addClass("finance-rate"))}),b.find(".tfs-disclaimer").html(T1.financeService.getDisclaimer(d,!0,f)).addClass("finance-rate"))}),void PubSub.publishSync(c.FINANCE_RATES_LOADED))},clearRates:function(){$("[data-tfs-code]").each(function(){var a=$(this);a.find(".tfs-input").each(function(){var a=$(this);a.removeClass("finance-rate"),a.html(a.attr("data-tfs-input")||a.html())}),a.find(".tfs-disclaimer").removeClass("finance-rate").empty()})}},b=a,c=T1.constants;return{init:a.init,enabled:function(){return a.enabled}}}();var T1=T1||{};T1.languageSelector=function(){"use strict";var a={init:function(){var b=$(".language-selector label");b.click(a.switchLanguage)},switchLanguage:function(a){location.href=$(a.target).prev().val()}};return{init:a.init}}();var T1=T1||{};T1.glossary=function(){"use strict";var a={init:function(){PubSub.subscribe(c.PAGEOVERLAYER_LOAD,b.initOverlayer)},initOverlayer:function(a,b){b.el.find("#glossary").size()&&$("#glossary .index a").click(function(a){a.preventDefault();var b=$(this);b.parents(".overlayerContent:first").scrollTo(b.attr("href"))})}},b=a,c=T1.constants;return{init:a.init}}();var T1=T1||{};T1.carspin=function(){"use strict";var a={BASEURL_EXT:"CCISHOST/vehicle/MODEL/CARID/width/800/height/400/scale-mode/1/padding/0,0,10,10/background-colour/fff/image-quality/70/MODE-ANGLE.EXTENTION",BASEURL_INT:"CCISHOST/vehicle/MODEL/CARID/width/600/height/600/scale-mode/0/padding/0/background-colour/fff/image-quality/70/MODE-ANGLE.EXTENTION",SERVICE_URL:"/api/cardb/spin360/MODEL",extention:"jpg",init:function(){PubSub.subscribe(T1.constants.CARSPIN_INIT,a.loadCar),PubSub.publish(T1.constants.SCROLL_TRACK_ADD,{elements:$(".carspin"),options:{once:!0,event:T1.constants.CARSPIN_INIT}})},loadCar:function(b,c){var d=a,e=c.section||$("#carspin"),f=e.data("model")||"aygo";0!==e.length&&$.ajax({url:d.SERVICE_URL.replace(/MODEL/g,f),dataType:"json"}).done(function(a){d.loadCarData(e,a)})},loadCarData:function(b,c){var d=a,e=d.getGrade(c.subModels,b.data("grade")||""),f={CCISHost:T1.settings.CCISHost.replace(/\/$/g,"")||"http://t1-ccis.toyota-europe.com",model:c.code||"auris",carId:e.carId||"46f33787-73da-44e6-ba99-f1668542da2a"},g={},h=window.innerWidth||$(window).innerWidth();h<=T1.constants.SCREEN_SMALL?(g.exterior={width:400,height:210},g.interior={width:300,height:300}):h<=T1.constants.SCREEN_MEDIUM?(g.exterior={width:600,height:315},g.interior={width:450,height:450}):(g.exterior={width:800,height:420},g.interior={width:600,height:600}),f.mode="exterior";var i=b.find(".spin.exterior"),j=$("<div></div>");i.css({height:Math.round(.7*g.interior.height)+"px"}),i.append(j),j.spritespin({source:d.getImageUrls(f),width:g.exterior.width,height:g.exterior.height,loop:!1,stopFrame:15,onLoad:function(){b.hideT1Loader()}}),f.mode="interior";var k=b.find(".spin.interior");j=$("<div></div>"),k.css({height:Math.round(.7*g.interior.height)+"px"}),k.append(j),j.spritespin({source:d.getImageUrls(f),width:g.interior.width,height:g.interior.height,loop:!1,stopFrame:0,onLoad:function(){b.hideT1Loader()}}),j.css({top:-Math.round(.3333333333*g.interior.height)+"px"}),b.showT1Loader(),b.find(".toggle").click(d.toggleMode)},getGrade:function(a,b){for(var c=null,d=null,e=0;e<a.length;e++){d=a[e].grades;for(var f=0;f<d.length;f++)if(c=d[f],b.toLowerCase()===c.code.toLowerCase())return c}return a[0].grades[0]},getImageUrls:function(b){for(var c=a,d="exterior"===b.mode,e=d?32:3,f=d?c.BASEURL_EXT:c.BASEURL_INT,g=[],h="",i=0;e>=i;i++)h=i,d&&i%2||g.push(f.replace(/CCISHOST/g,b.CCISHost).replace(/COUNTRY/g,b.country).replace(/MODEL/g,b.model).replace(/CARID/g,b.carId).replace(/MODE/g,b.mode).replace(/ANGLE/g,h).replace(/COLOR/g,b.color).replace(/EXTENTION/g,c.extention));return g},toggleMode:function(a){var b=$(a.target).closest("section").find(".spin");b.toggleClass("active")}};return{init:a.init}}();var T1=T1||{};T1.financeService=function(){"use strict";var a={tokens:{},history:{},init:function(){b.tokens.postRequestFinance=PubSub.subscribe(T1.constants.FINANCE_EXTERNAL_POST_REQUEST,b.onPostRequest),b.tokens.postRequestInsurance=PubSub.subscribe(T1.constants.INSURANCE_EXTERNAL_POST_REQUEST,b.onPostRequest),b.handleConfigPage()},handleConfigPage:function(){$(document).on("keydown",function(a){a.ctrlKey&&a.shiftKey&&a.which===(T1.settings.finance.configPageKey||88)&&PubSub.publish(c.HASH_CHANGE,"/publish/finance_config")}),PubSub.subscribe(c.FINANCE_CONFIG,function(){PubSub.publish(c.PAGEOVERLAYER_OPEN,{url:T1.settings.finance.configPageUrl,ajax:!0,sync:!0,styleClass:b.ovlClass});var a=PubSub.subscribe(c.PAGEOVERLAYER_LOAD,function(){b.loadConfig(),PubSub.unsubscribe(a)})})},loadConfig:function(){var a=$(".finance-config"),c=a.find(".finance-data");b.applyDataTemplate(c,T1);for(var d in b.history){var e=a.find(".tfs-stack.section.template").clone();b.applyDataTemplate(e,b.history[d]),e.attr("id","_"+d),c.append(e),c.find(">.template").removeClass("template")}c.find(".tfs-stack.section >h5").on("click",b.historyPanelClick)},applyDataTemplate:function(a,c){a.size()&&a.find("[data-path]").each(function(){var a=$(this),d=Object.resolve(a.data("path"),c);a.html($.isPlainObject(d)?b.highlightJSON(JSON.stringify(d,null,3)):null!==d?d.toString():"-")})},highlightJSON:function(a){return a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})},historyPanelClick:function(a){var b=$(a.currentTarget.parentNode).find(".panel");b.is(":animated")||b.slideToggle({duration:400,complete:function(){$(this).is(":visible")?b.closest(".tfs-stack").addClass("active"):b.closest(".tfs-stack").removeClass("active")}})},onPostRequest:function(a,b){var c={Country:T1.settings.country,Brand:T1.settings.carconfig.brand,Language:T1.settings.language};for(var d in b)"prototype"!==d&&(c[d]=b[d]);var e={target:T1.utilities.browser.isSafari?"_blank":"_overlayer",fields:{configuration:JSON.stringify(c)}};e.action=a===T1.constants.INSURANCE_EXTERNAL_POST_REQUEST?T1.settings.finance.urlMyInsuranceMiniCC||"http://tfscalcv3uat.synectics-solutions.com/39A2F185-AA9E-46A6-9524-7AA15361A612":T1.settings.finance.urlMyFinanceMiniCC||"http://tfscalcv3uat.synectics-solutions.com/1A951604-12B5-489B-A09C-F4D0F9D06661",PubSub.publish(T1.constants.FORM_CROSS_DOMAIN_POST,e)},requestFinanceData:function(a){var c=T1.settings.mock?"http://t1-dev-proxy.herokuapp.com":T1.settings.loadSaveServer,d=c+"/tfs/car"+(a.multiple?"s/":"/")+T1.settings.country,e=JSON.stringify(a.configs),f=(new Date).getTime();if(b.stackHistory(f,a.source,a.configs),T1.utilities.ieVersion()<10){var g=new XDomainRequest;g.onprogress=function(){},g.onload=function(){if(g){var c=JSON.parse(g.responseText);a.success&&a.success(c),b.stackHistory(f,a.source,a.configs,c)}},g.onerror=function(){console.log("error handling finance information."),b.stackHistory(f,a.source,a.configs,g,!0)},g.timeout=6e4,g.open("POST",d),g.send(e)}else{var h=$.ajax({url:d,type:"POST",data:e,contentType:"application/json",crossDomain:!0});h.done(a.success).done(function(c){b.stackHistory(f,a.source,a.configs,c)}),h.fail(function(c,d,e){console.log("error handling finance information "+e),b.stackHistory(f,a.source,a.configs,c,!0)})}},stackHistory:function(a,c,d,e,f){b.history[a]={xdr:T1.utilities.ieVersion()<10,failed:f||(e&&e.error?e.error:!1),source:c||"Unknown",configs:d,response:e,inProgress:e?!1:!0,start:b.history[a]?b.history[a].start:new Date,stop:b.history[a]?new Date:null},b.history[a].stop&&b.applyDataTemplate($("#_"+a),b.history[a])},formatFinanceString:function(a,c,d,e){return a&&c&&d?(a=b.replaceNode(a,"productName",d.name&&c.productName?b.tag({source:c.productName.formatted,className:"finance-product-name",tag:e}):null),a=b.replaceNode(a,"term",d.term&&c.term?b.tag({source:c.term.formatted,className:"finance-trm",tag:e}):null),a=b.replaceNode(a,"taeg",d.effectiveRate&&c.effectiveInterestRate?b.tag({source:c.effectiveInterestRate.formatted,className:"finance-taeg",tag:e}):null),a=b.replaceNode(a,"tan",d.annualRate&&c.annualInterestRate?b.tag({source:c.annualInterestRate.formatted,className:"finance-tan",tag:e}):null),a=b.replaceNode(a,"price",c.monthlyPayment?b.tag({source:c.monthlyPayment.formatted,className:"finance-monthly-price",tag:e}):null)):""},replaceNode:function(a,c,d){var e=new RegExp("\\["+c+"](.*?)\\[/"+c+"]","gi");return a.replace(e,function(a,c){return b.replaceValue(c,d)})},replaceValue:function(a,b){return b?a.replace(/{value}/g,b):""},tag:function(a){return'<{tag} class="{class}">{source}</{tag}>'.replace(/{tag}/g,a.tag||"i").replace(/{source}/g,a.source||"").replace(/{class}/g,a.className||"")},getDisclaimer:function(a,b,c){if(a&&a.quote){var d=$('<div class="finance-disclaimer"/>');if(c&&d.append($("<h4/>").html(c)),b&&a.quote.calculations)for(var e=0;e<a.quote.calculations.length;e++){var f=$("<div/>").addClass("row").appendTo(d),g=a.quote.calculations[e];f.append($("<div/>").addClass("col-xs-6 col-lg-6").html(g.name)),f.append($("<div/>").addClass("col-xs-6 col-lg-6").html(g.value)),a.quote.calculations[e].format&&a.quote.calculations[e].format.b&&f.css("font-weight","bold")}return d.append($("<p/>").html(a.quote.value)),b||c?d:a.quote.value}return null}},b=a,c=T1.constants;return{init:a.init,requestFinanceData:a.requestFinanceData,formatFinanceString:a.formatFinanceString,getDisclaimer:a.getDisclaimer}}();var T1=T1||{};T1.formCrossDomainPost=function(){"use strict";var a={tokens:{},data:null,newWindow:null,urlPostPage:"/assets/tfs-service.html",init:function(){PubSub.subscribe(T1.constants.FORM_CROSS_DOMAIN_POST,a.postExternalForm),PubSub.subscribe(T1.constants.FORM_CROSS_DOMAIN_PAGE_READY,a.crossDomainWindowReady)},reset:function(){a.data=null,a.newWindow=null},postExternalForm:function(b,c){var d=a,e=c.target||"_blank";d.reset(),d.data=c,"_self"===e||"_blank"===e?d.submit(c):"_overlayer"===e&&(PubSub.publish(T1.constants.HASH_CHANGE,"/iframe/"+encodeURIComponent(d.urlPostPage)),d.data.target="_self",d.tokens.openedOverlayer=PubSub.subscribe(T1.constants.PAGEOVERLAYER_LOAD,d.sendPageReadyEvent))},sendPageReadyEvent:function(){var b=$('.overlayerContent iframe[src="'+a.urlPostPage+'"]'),c=a.newWindow||b[0].contentWindow;PubSub.unsubscribe(a.tokens.openedOverlayer),c.PubSub.publish(T1.constants.FORM_CROSS_DOMAIN_PAGE_READY,a.data)},createFormElement:function(a){var b=a.fields,c=a.id||"crossDomainForm",d=$("#"+c);0===d.length?(d=$("<form/>").css({display:"none"}),$("body").append(d)):d.find("input").remove(),d.attr({id:c,name:a.name||"",method:a.method||"post",action:a.action||"",target:a.target||"_blank"});var e;for(var f in b)"prototype"!==f&&(e=$("<input/>").attr({type:"text",name:f}).val(b[f]),d.append(e));return d},crossDomainWindowReady:function(b,c){a.submit(c)},submit:function(b){var c=a.createFormElement(b);$("body").append(c),c.submit()}};return{init:a.init}}();var T1=T1||{};T1.figure=function(){"use strict";var a={isDocumentLoad:!1,init:function(){var b=a;b.isDocumentLoad=!0,b.processFigures(),PubSub.subscribe(T1.constants.FIGURE_LOAD,b.callbackFigures),b.isDocumentLoad=!1},callbackFigures:function(b,c){a.processFigures(c)},processFigures:function(b){var c;b&&b.length>0||(b=$("body")),c=b.find("figure"),c.each(a.replaceTag),PubSub.publishSync(T1.constants.EPRIVACY_LOAD_COMPONENT,{defer:!1})},replaceTag:function(){var b=a,c=$(this),d=c.data(),e=d.type.toLowerCase(),f=c.data("preventdefaultload");if(!f||!b.isDocumentLoad)switch(e){case"ajax-video":var g={figure:c};$.getJSON(d.url,function(a){$.each(a.movie.sources,function(a,b){var c=b.binary.url;g["src"+b.ext.capitalize()]=c}),g.poster=a.movie.poster.binary.url,PubSub.publishSync(T1.constants.VIDEO_CREATEPLAYER,g)
});break;case"eprivacy":PubSub.publishSync(T1.constants.EPRIVACY_LOAD_COMPONENT,{figures:c,defer:!0});break;default:var h=d.src||"",i=h.indexOf("youtube")>-1;if(!i||!d.eprivacy||T1.ePrivacy.validateLevel(d.eprivacy)){var j=a.initIframe(e,c,d,i);i&&d.eprivacy&&T1.ePrivacy.validateLevel(d.eprivacy)&&T1.ePrivacy.registerComponent(j,c,d.eprivacy)}}},initIframe:function(a,b,c,d){var e=$("<iframe>"),f=null,g="",h=!1;return b.attr("data-copy-querystring")&&(f=T1.request.getQueryStringParameters(),$.isEmptyObject(f)||(g="?"+$.param(f))),$.each(c,function(a,b){"src"===a&&("string"==typeof b&&-1!==b.indexOf("?")&&(g=g.replace(/\?/,"&")),b+=g),-1!==a.indexOf("lazyload")&&(a="data-lazyload-"+a.replace("lazyload",""),"string"==typeof b&&-1!==b.indexOf("?")&&(g=g.replace(/\?/,"&")),b+=g,h=!0),e.attr(a,b)}),h&&PubSub.publish(T1.constants.SCROLL_TRACK_ADD,{elements:e,options:{once:!0}}),d&&e.attr("src",T1.utilities.youtube.getEmbedUrl(c.src,{autoplay:"0"})),b.replaceWith(e),"responsive-iframe"===a&&(e.addClass("iframe-responsive"),PubSub.publish(T1.constants.IFRAME_LOAD,e)),e}};return{init:a.init}}();var T1=T1||{};T1.mobile=function(){"use strict";var a={currentBreakpoint:"",isPageInit:!0,initializedMobile:!1,initializedDesktop:!1,initializeMobileFnName:"initMobile",initializeDesktopFnName:"initDesktop",switchMobileFnName:"switchMobile",switchDesktopFnName:"switchDesktop",lastOpenedMobileSection:null,init:function(){var b=a;PubSub.subscribe(T1.constants.MOBILE_OPEN,b.openMobile),PubSub.subscribe(T1.constants.ON_BREAKPOINT_CHANGE,b.breakpointChange),PubSub.subscribe(T1.constants.PAGEOVERLAYER_REOPEN_MAINCONTENT,b.hideMobilePane)},breakpointChange:function(b,c){var d=a;("xs"===c||"xs"===d.currentBreakpoint||""===d.currentBreakpoint)&&(d.currentBreakpoint=c,"xs"===c?(d.initializedMobile||(d.runFn(d.initializeMobileFnName),d.initializedMobile=!0,PubSub.publish(T1.constants.MODE_INIT_MOBILE,{})),d.runFn(d.switchMobileFnName),PubSub.publish(T1.constants.MODE_SWITCH_MOBILE,{})):(d.initializedDesktop||(d.runFn(d.initializeDesktopFnName),d.initializedDesktop=!0,PubSub.publish(T1.constants.MODE_INIT_DESKTOP,{})),d.runFn(d.switchDesktopFnName),PubSub.publish(T1.constants.MODE_SWITCH_DESKTOP,{})),d.isPageInit&&(d.isPageInit=!1,PubSub.publish(T1.constants.PAGE_INITIALIZED,{mode:d.initializedDesktop?"desktop":"mobile"})))},runFn:function(a){for(var b in T1)if(T1[b][a])try{T1[b][a]()}catch(c){console.log("Error running "+a+" "+b+": "+c)}},openMobile:function(b,c){if(c){var d=a,e=c.id?$("#"+c.id):c.section;e.removeAttr("data-extended-param"),c.param&&e.attr("data-extended-param",c.param),0!==e.length&&(PubSub.publishSync(T1.constants.PAGEOVERLAYER_OPEN,{html:e,inPage:!0,preserveContent:!0,styleClass:"white",noResize:!0,fitImages:!1,noTransitions:!0}),e.prop("className",e.prop("className").replace(/hidden-xs/g,"visible-xs")),PubSub.publish(T1.constants.NAVIGATION_ADD_BREADCRUMB_LINK,{name:e.data("section-title"),url:location.href}),d.lastOpenedMobileSection=e,PubSub.publish(T1.constants.ON_WIN_RESIZE,{}))}},hideMobilePane:function(){var b=a;b.lastOpenedMobileSection&&(PubSub.publish(T1.constants.NAVIGATION_REMOVE_BREADCRUMB_LINK,{}),b.lastOpenedMobileSection.prop("className",b.lastOpenedMobileSection.prop("className").replace(/visible-xs/g,"hidden-xs")),b.lastOpenedMobileSection=null)}};return{init:a.init}}();var T1=T1||{};T1.breakpoints=function(){"use strict";var a={currentBreakpoint:"",breakpoints:{xs:T1.constants.SCREEN_XTRASMALL,sm:T1.constants.SCREEN_SMALL,md:T1.constants.SCREEN_MEDIUM,lg:T1.constants.SCREEN_LARGE}},b={init:function(){b.setCurrentBreakpoint(),PubSub.subscribe(T1.constants.ON_WIN_RESIZE,b.setCurrentBreakpoint)},setCurrentBreakpoint:function(){var b=window.innerWidth||$(window).innerWidth(),c=0,d="";for(var e in a.breakpoints)b>=a.breakpoints[e]&&c<a.breakpoints[e]&&(d=e,c=a.breakpoints[e]);""===d&&(d="xs"),d!=a.currentBreakpoint&&(a.currentBreakpoint=d,PubSub.publish(T1.constants.ON_BREAKPOINT_CHANGE,a.currentBreakpoint))},returnCurrentBreakPoint:function(){return a.currentBreakpoint}};return{init:b.init,currentBP:b.returnCurrentBreakPoint}}();var T1=T1||{};T1.comparer=function(){"use strict";var a={ovlClass:"compare-ovl",highlightClass:"in-evidence",filteredClass:"filtered",dynamicFilterClass:"dynamically-filtered",loadingClass:"loading",errorClass:"error",filteredAreaSelectors:[".details .detail:not(.template) .content >.row >.col-sm-2",".right.filters.row .col-sm-2"],toastPositions:{top:{top:"10%"},bottom:{top:"80%"}},toastTimeout:3e3,extend:function(a,e){return e&&e.size()&&(a=$.extend(!0,{},b,{container:e},d.protectBase(a.extend),$.extend(!0,{},c,d.protectBase(a.override)))),a},protectBase:function(a){if(a)for(var c in b)delete a[c];return a},clearTokens:function(){for(var a=0;a<this.tokens.length;a++)PubSub.unsubscribe(this.tokens[a]);this.tokens=[]},thread:function(a,b){setTimeout($.proxy(b,a),0)},onOverlayerResize:function(){this.uniformizeToolsHeight(),this.uniformizeDetailsHeight(),this.uniformizeHeight(this.compareView.find(".expandable-objects")),setTimeout($.proxy(d.refreshLock,this),300)},toast:function(a,b,c){PubSub.publish(T1.constants.TOAST_CUSTOM,{customContainer:b,customText:a,timeout:d.toastTimeout,css:c})},toastAndClose:function(a){$.proxy(d.toast,this)(a,this.compareView.parent()),setTimeout(function(){PubSub.publishSync(e.HASH_REMOVE,"")},d.toastTimeout)},handleObjectsSelection:function(a){var b=$(a.currentTarget),c=b.closest(".checkboxes-area"),e=c.find('.checkbox-btn input[type="checkbox"]:checked').size();if(e>this.selectionScope.max){var f=b.closest("ul, .col-sm-3").parent(),g={top:f.position().top+f.height()/2};$.proxy(d.toast,this)(T1.labels.comparator.selectMaxReached.replace(/{count}/g,this.selectionScope.max),c,g),b.prop("checked",!b.is(":checked"))}},mirrorSelection:function(a){var b=this.container.add(this.compareView).find(".checkboxes-area").not(a).find(".checkbox-btn");a.find('.checkbox-btn input[type="checkbox"]').each(function(a,c){var e=$(c),f=b.find('input[type="checkbox"][data-filter-value="'+$(c).data("filter-value")+'"]');$.proxy(d.toggleCheckBoxBtn,this)(f,e.prop("checked"))})},toggleCheckBoxBtn:function(a,b){var c=a.closest(".checkbox-btn");a.prop("checked",b),c.toggleClass(c.attr("data-on-class"),a.is(":checked")),c.toggleClass(c.attr("data-off-class"),!a.is(":checked"))},validateObjectsSelection:function(a){a&&a.preventDefault();var b=this.compareView.find(".checkboxes-area"),c=b.find('.checkbox-btn input[type="checkbox"]:checked').size();c>this.selectionScope.max?($.proxy(d.toast,this)(T1.labels.comparator.selectMaxReached.replace(/{count}/g,this.selectionScope.max),b),a&&a.stopImmediatePropagation()):c<this.selectionScope.min?($.proxy(d.toast,this)(T1.labels.comparator.selectMinReached.replace(/{count}/g,this.selectionScope.min),b),a&&a.stopImmediatePropagation()):($.proxy(d.setObjectsSelection,this)(b),$.proxy(d.mirrorSelection,this)(b),$.proxy(d.applyFilters,this)())},compareBtnClick:function(a){a.preventDefault();var b=this.getPageCheckboxesArea(),c=b.find('.checkbox-btn input[type="checkbox"]:checked').size(),f=d.toastPositions[$(a.currentTarget).data("toast-position")];c>this.selectionScope.max?$.proxy(d.toast,this)(T1.labels.comparator.selectMaxReached.replace(/{count}/g,this.selectionScope.max),b,f):c<this.selectionScope.min?$.proxy(d.toast,this)(T1.labels.comparator.selectMinReached.replace(/{count}/g,this.selectionScope.min),b,f):PubSub.publish(e.HASH_CHANGE,"/publish/"+$(a.currentTarget).attr("href").replace(/#/g,""))},getObjectsMaxHeight:function(a,b){var c=0;return b=$.extend({innerCalculation:!1,excludeSelector:null},b),a.each(function(){var a=$(this),d=b.innerCalculation?a.innerHeight():a.height();b.excludeSelector&&a.find(b.excludeSelector).each(function(){d-=b.innerCalculation?$(this).innerHeight():$(this).height()}),c=d>c?d:c}),c},collapsiblePanelClick:function(a,b){var c=$(a.currentTarget.parentNode),e=this.compareView.find(".active.detail");c.find(".detail-group").is(":animated")||(b=$.extend({active:!1},b),c.is(e)||$.proxy(d.togglePanel,this)(e),$.proxy(d.togglePanel,this)(c,b.active))},togglePanel:function(a,b){var c=a.find(".detail-group"),d=this;c.slideToggle({duration:400,start:function(){a.hasClass("active")||d.uniformizeDetailsHeight($(this))},complete:function(){var c=$(this);b||c.is(":visible")?(c.show(),a.addClass("active")):a.removeClass("active")}})},slideToggleFilterPanel:function(a){var b=this.compareView.find(".btn-objects-filter"),c=this.compareView.find(".expandable-objects");(!a||a&&b.hasClass("active"))&&c.slideToggle({duration:400,start:$.proxy(function(){$.proxy(d.lock,this)(!b.hasClass("active"))},this),complete:$.proxy(function(){b.toggleClass("active"),this.uniformizeHeight(c)},this)})},applyFilters:function(){if(this.data){var a=$.proxy(d.buildFilter,this)(),b=$.proxy(d.getFilteredSelector,this)(a),c=this.compareView.find(d.filteredAreaSelectors.join()),e=this.compareView.find(b),f=$.proxy(d.getDynamicFiltersKeys,this)();c.removeClass([f.join(" "),d.filteredClass,d.dynamicFilterClass,"first","last"].join(" "));var g=$.proxy(d.getDynamicSelection,this)(c,e,a);e.not(g).addClass(d.filteredClass),$.proxy(d.executeCustomFilters,this)(a),$.proxy(d.setFirstLast,this)(),$.proxy(d.highlight,this)(a.highlight),this.uniformizeToolsHeight(),this.uniformizeDetailsHeight()}},getDynamicSelection:function(a,b,c){var e=[];if(!$.isEmptyObject(this.dynamicFilters)){var f=$.proxy(d.getIndexedSelection,this)();a.not(b).each($.proxy(function(a,b){var g=$(b);for(var h in this.dynamicFilters){for(var i=!1,j=0;j<this.dynamicFilters[h].length;j++)i=i||$.proxy(this.dynamicFilters[h][j],g)({name:h,filter:c,data:this.data,selection:f});i&&(g.addClass([h,d.dynamicFilterClass].join(" ")),e.push(b))}},this))}return e},executeCustomFilters:function(a){for(var b in this.customFilters)for(var c in this.customFilters[b]){var e=this.compareView.find(c);e.removeClass([b,d.filteredClass,d.dynamicFilterClass].join(" "));for(var f=0;f<this.customFilters[b][c].length;f++){var g=$.proxy(d.applyCustomFilter,this)(a,b,c,f);e.each($.proxy(g,this))}}},applyCustomFilter:function(a,b,c,e){return function(f,g){var h=$(g),i=$.proxy(this.customFilters[b][c][e],h)({filter:a,data:this.data});i&&h.addClass([b,d.dynamicFilterClass].join(" "))}},setFirstLast:function(){var a=this.compareView.find(".details .detail:not(.template) .content >.row"),b=this.compareView.find(".right.filters.row .col-sm-2").not("."+d.filteredClass);$.proxy(d.removeFirstLastClasses,this)(this.compareView.find(d.filteredAreaSelectors.join())),$.proxy(d.addFirstLastClasses,this)(b),a.each($.proxy(function(a,b){$.proxy(d.addFirstLastClasses,this)($(b).children(".col-sm-2").not("."+d.filteredClass))},this))},removeFirstLastClasses:function(a){a.removeClass(["first","last"].join(" "))},addFirstLastClasses:function(a){a.first().addClass("first"),a.filter(":eq("+(this.selectionScope.max-1)+")").addClass("last")},dropdownFilterChanged:function(a){var b=$(a.target);a.preventDefault(),b.closest(".dropdown-menu").find("li a").removeClass("selected"),b.closest(".dropdown").find(".dropdown-toggle >span").html(b.html()),b.addClass("selected"),d.thread(this,d.applyFilters)},resetObjectsFilter:function(){var a=this.compareView.find('.checkboxes-area .checkbox-btn input[type="checkbox"]');a.each(function(){d.toggleCheckBoxBtn($(this),!1)});for(var b=0;b<this.selection.length;b++)d.toggleCheckBoxBtn(a.filter('[data-filter-value="'+this.selection[b]+'"]'),!0)},getFilteredSelector:function(a){var b=[];for(var c in a)"highlight"!==c&&b.push($.proxy(d.getLiteralFilter,this)(c,a[c]));return b.join(",")},getLiteralFilter:function(a,b){if("highlight"!==a){var c="",e=[];if(b instanceof Array)for(var f=0;f<b.length;f++)c+="[data-filter-"+a+"][data-filter-"+a+'!="'+b[f]+'"]';else c+="[data-filter-"+a+"][data-filter-"+a+'!="'+b+'"]';for(var g=0;g<d.filteredAreaSelectors.length;g++)e.push(d.filteredAreaSelectors[g]+c);return e.join(",")}},getData:function(){var a=$.ajax({type:"GET",dataType:"JSON",url:this.container.data("url")});a.done($.proxy(d.onGetDataDone,this)),a.fail($.proxy(d.onGetDataFail,this))},onGetDataDone:function(a){$.proxy(d.resetData,this)(a),$.proxy(this.onDataLoad,this)(this.data),$.proxy(d.applyFilters,this)(),$.proxy(this.initOverlayer,this)()},onGetDataFail:function(a,b,c){this.compareView.addClass(d.errorClass),$.proxy(d.toastAndClose,this)(c||b)},resetData:function(a){this.data=a||null,this.compareView.find(".details >*:not(.template)").remove()},lock:function(a){$.proxy(d.refreshLock,this)().slideToggle(a)},refreshLock:function(){var a=this.compareView.find(".lock"),b=this.compareView.height(),c=$(".overlayerContent").prop("scrollHeight")||0;return a.height(b>c?b:c)},buildFilter:function(){var a={getUnsafeData:$.proxy(this.getUnsafeData,this)};return a.get=$.proxy(function(b){return this.getUnsafeData(a[b])},this),this.compareView.find('[data-filter-name][data-filter-value!=""]').each(function(){var b=$(this),c=void 0!==b.prop("checked");(c&&b.prop("checked")||b.hasClass("selected"))&&(a[b.data("filter-name")]?(a[b.data("filter-name")]instanceof Array||(a[b.data("filter-name")]=[a[b.data("filter-name")]]),a[b.data("filter-name")].push(b.data("filter-value"))):a[b.data("filter-name")]=b.data("filter-value"))}),a},resetFilters:function(){this.compareView.find("[data-filter-default]").each(function(){var a=$(this),b=void 0!==a.prop("checked");b&&!a.prop("checked")?a.prop("checked",!0):"A"===this.nodeName.toUpperCase()&&a.click()})},setObjectsSelection:function(a){var b={};this.selection=[],a.find('.checkbox-btn input[type="checkbox"]:checked').each($.proxy(function(a,c){c=$(c).data("filter-value"),b[c]||(this.selection.push(c),b[c]=!0)},this))},getIndexedSelection:function(){for(var a={},b=0;b<this.selection.length;b++)a[this.selection[b]]=!0;return a},getDynamicFiltersKeys:function(){return $.proxy(d.getObjectKeys,this)(this.dynamicFilters)},getObjectKeys:function(a){var b=[];for(var c in a)b.push(c);return b},removeObject:function(a){var b=$(a.currentTarget),c=this.selection.length;if(c<=this.selectionScope.min)$.proxy(d.toast,this)(T1.labels.comparator.selectMinReached.replace(/{count}/g,this.selectionScope.min),b.closest(".filters"));else{var e=this.selection.indexOf(b.data("value"));e>-1&&(delete this.selection[e],$.proxy(d.resetObjectsFilter,this)(),$.proxy(d.validateObjectsSelection,this)())}},onHighlightChange:function(){var a=$.proxy(d.buildFilter,this)();$.proxy(d.highlight,this)(a.highlight)},resetBrowserCache:function(){this.container.find('.objects.checkboxes-area input[type="checkbox"]').each(function(){var a=$(this);a.prop("checked","checked"===a.attr("checked"))})},highlight:function(a){this.compareView.find(".details ."+d.highlightClass).removeClass(d.highlightClass),a&&this.compareView.find(".detail .content >.row:not(."+this.noHighLightClass+")").each(function(){var a=$(this),b=null;a.find(".col-sm-2:not(."+d.filteredClass+")").each(function(){var c=$(this),e=c.attr("data-value");return b=null===b?e:b,b!=e?(a.addClass(d.highlightClass),!1):void 0})})}},b={noHighLightClass:"not-in-evidence",container:null,compareView:null,tokens:[],selection:[],selectionScope:{min:2,max:3},dynamicFilters:{},customFilters:{},noDataValue:"-",data:null,init:function(){$.proxy(d.resetBrowserCache,this)(),this.container.on("change",'.checkboxes-area .checkbox-btn input[type="checkbox"]',$.proxy(function(a){var b=$(a.currentTarget).closest(".checkboxes-area");$.proxy(d.handleObjectsSelection,this)(a),$.proxy(d.setObjectsSelection,this)(b),$.proxy(d.mirrorSelection,this)(b)},this)),this.container.find(".compare-btn").on("click",$.proxy(d.compareBtnClick,this)),$.proxy(d.setObjectsSelection,this)(this.container.find(".objects.checkboxes-area")),PubSub.subscribe(e.ON_WIN_RESIZE,$.proxy(this.onWindowResize,this)),PubSub.subscribe(e.PAGEOVERLAYER_CLOSED,$.proxy(this.onOverlayerClosed,this)),PubSub.subscribe(e.FINANCE_RATES_OFF,$.proxy(function(){$.proxy(this.uniformizeHeight,this)()},this)),PubSub.subscribe(e.FINANCE_RATES_LOADED,$.proxy(function(){$.proxy(this.uniformizeHeight,this)()},this)),this.initView()},initOverlayer:function(){d.thread(this,function(){T1.formInput.initOnDemand(this.compareView.find(".checkboxes-area")),this.compareView.find('.checkboxes-area .checkbox-btn input[type="checkbox"]').on("change",$.proxy(d.handleObjectsSelection,this)),this.compareView.find(".detail >h4").on("click",$.proxy(d.collapsiblePanelClick,this)),this.compareView.find(".btn-validate").on("click",$.proxy(d.validateObjectsSelection,this)),this.compareView.find(".right.filters.row .icon-remove").on("click",$.proxy(d.removeObject,this)),this.compareView.find('.filters input[data-filter-name="highlight"]').on("change",$.proxy(d.onHighlightChange,this)),this.compareView.find('.filters input[data-filter-name!="highlight"]').on("change",$.proxy(d.applyFilters,this)),this.compareView.find('.filters .dropdown [data-filter-name!="highlight"] a').on("click",$.proxy(d.dropdownFilterChanged,this)),this.compareView.find(".btn-objects-filter, .lock, .actions").on("click",$.proxy(function(a){a.preventDefault(),$.proxy(d.slideToggleFilterPanel,this)(),$.proxy(d.resetObjectsFilter,this)()},this)),this.compareView.removeClass(d.loadingClass),this.uniformizeToolsHeight(),this.uniformizeDetailsHeight()})},compare:function(){var a=this.getPageCheckboxesArea(),b=a.find('.checkbox-btn input[type="checkbox"]:checked').size();if(b>this.selectionScope.max)PubSub.publish(e.HASH_REMOVE,""),$.proxy(d.toast,this)(T1.labels.comparator.selectMaxReached.replace(/{count}/g,this.selectionScope.max),a);else if(b<this.selectionScope.min)PubSub.publish(e.HASH_REMOVE,""),$.proxy(d.toast,this)(T1.labels.comparator.selectMinReached.replace(/{count}/g,this.selectionScope.min),a);else{PubSub.publish(e.PAGEOVERLAYER_OPEN,{url:decodeURIComponent(this.container.data("view-url")),ajax:!0,sync:!0,styleClass:d.ovlClass});var c=PubSub.subscribe(e.PAGEOVERLAYER_LOAD,$.proxy(function(a,b){$.proxy(this.onOverlayerOpen,this)(a,b),PubSub.unsubscribe(c)},this))}},resetView:function(){$.proxy(d.resetFilters,this)(),$.proxy(d.slideToggleFilterPanel,this)(!0),this.expandDetail(0),this.compareView.addClass(d.loadingClass),this.compareView.removeClass(d.errorClass)},expandDetail:function(a){this.compareView.find(".details >.detail:not(.template):eq("+a+") >h4").trigger("click",{active:!0})},getObjectsMaxHeight:function(a,b){return d.getObjectsMaxHeight(a,b)},uniformizeHeight:function(a,b){b=$.extend({innerCalculation:!1,rootFilter:":visible",childFilter:":visible",rule:"margin-top",offsetCalculation:!0,adjust:0},b);var c={innerCalculation:b.innerCalculation,excludeSelector:".responsive-exclude"};(a||this.container).find(".responsive-item"+(b.rootFilter||"")).each($.proxy(function(a,e){var f=$(e).children(b.childFilter),g=(f.find(".responsive-anchor").removeAttr("style"),d.getObjectsMaxHeight(f,c)+b.adjust);f.each(function(a,e){var f=$(e);f.find("*").andSelf().filter(".responsive-anchor").css(b.rule,0).css(b.rule,b.offsetCalculation?g-d.getObjectsMaxHeight(f,c):g)})},this))},uniformizeToolsHeight:function(){this.uniformizeObjectsFilterHeight();var a=this.compareView.find(".tools >.left").removeAttr("style"),b=this.compareView.find(".tools >.right").height(),c=0;a.children().each(function(){c+=$(this).outerHeight(!0)}),a.css("min-height",b),c>b?a.addClass("auto"):a.removeClass("auto")},uniformizeDetailsHeight:function(a){this.uniformizeHeight(a||this.compareView.find(".details"),{rule:"min-height",offsetCalculation:!1,innerCalculation:!0,adjust:1})},handleResponsiveImages:function(a){var b=a.root?a.root.find(".responsive-item img"):a.images;b.bind("load error",$.proxy(function(b){a.handler($(b.currentTarget).closest(".responsive-item").parent())},this))},addCategory:function(a,b){var c=this.compareView.find(".details"),d=c.find(".detail.template").clone().removeClass("template"),e=d.find(">h4");return e.attr({"data-bt-action":"click_tab","data-bt-value":b||a,"data-bt-track":""}),e.find("span").html(a),d.find(".detail-group").remove(),c.append(d),d.toggleClass("active",1===c.find(".detail:not(.template)").size()),d},addSubCategory:function(a,b){var c=this.compareView.find(".details .detail.template .detail-group").clone();return b?c.find(">h5").html(b):c.find(">h5").remove(),c.find(".content >.row").remove(),a.append(c),c},addItem:function(a,b){var c=this.compareView.find(".details .detail.template .content >.row").clone();if(a.hasClass("detail-group")||(a=this.addSubCategory(a)),c.addClass(b.className),c.find(">.col-sm-6").prepend(b.content),c.find(">.col-sm-2").remove(),b.more){var d="item-"+(new Date).getTime();c.find(">.col-sm-6 .readMore").attr("data-tooltip-selector","#"+d),c.find(".expansion-content").attr("id",d),c.find(".expansion-inner").html(b.more)}else c.find(".col-sm-6 .readMore, .expansion-content").remove();return a.find(".content").append(c),c},addItemObjectValue:function(a,b){var c=this.compareView.find(".details .detail.template .content >.row >.col-sm-2").clone();if(b.displayValue?c.html(b.displayValue):"boolean"===$.type(b.value)?c.find(b.value?".icon-minus":".icon-radio-checked").remove():c.html(b.value),b.extra&&c.append(b.extra),c.addClass(b.className),b.filters)for(var d=0;d<b.filters.length;d++)c.attr("data-filter-"+b.filters[d].name,this.getSafeString(b.filters[d].value));return c.attr("data-value",this.getSafeString(b.value)),a.append(c),c},getSafeString:function(a){return encodeURIComponent(a)},getUnsafeData:function(a){var b=decodeURIComponent(a);return a instanceof Array?b.split(","):b},addDynamicFilter:function(a,b){this.dynamicFilters[a]=this.dynamicFilters[a]||[],this.dynamicFilters[a].push(b)},addCustomFilter:function(a,b,c){this.customFilters[a]=this.customFilters[a]||{},this.customFilters[a][b]=this.customFilters[a][b]||[],this.customFilters[a][b].push(c)},getExpansionContainer:function(a,b){var c=this.compareView.find(".expansion-content.template").clone().attr("id",a).removeClass("template");return b&&c.append($("<div/>").addClass("expansion-arrow")),c},getPricesContainer:function(a){var b=a.list?$("<span/>").addClass("old price").html(globalize.format(a.list,"c")):null,c=b?$('<i class="icon-tag"/>'):null,d=$("<span/>").addClass(b?"promo price":"price").html(globalize.format(a.listWithDiscount,"c")).append(c);return d.add(b)},onOverlayerOpen:function(a,b){this.compareView=b.el.find(".compare-view"),this.compareView.size()&&(this.selection.length<this.selectionScope.min?(this.compareView.addClass(d.errorClass),$.proxy(d.toastAndClose,this)(T1.labels.comparator.selectMinReached.replace(/{count}/g,this.selectionScope.min))):this.selection.length>this.selectionScope.max?(this.compareView.addClass(d.errorClass),$.proxy(d.toastAndClose,this)(T1.labels.comparator.selectMaxReached.replace(/{count}/g,this.selectionScope.max))):($.proxy(d.mirrorSelection,this)(this.getPageCheckboxesArea()),this.tokens.push(PubSub.subscribe(e.ON_WIN_RESIZE,$.proxy(d.onOverlayerResize,this))),this.data?$.proxy(d.onGetDataDone,this)(this.data):$.proxy(d.getData,this)()))},onOverlayerClosed:function(a,b){b.content.parent().is(this.container)&&($.proxy(d.clearTokens,this)(),this.uniformizeHeight(this.container))},getBase:function(a){return $.proxy(Object.resolve(a,c),this)}},c={initView:function(){this.uniformizeHeight(this.container),this.handleResponsiveImages({root:this.container.find(".objects"),handler:this.uniformizeHeight}),PubSub.subscribe(this.getCompareEvent(),$.proxy(this.compare,this))},onDataLoad:function(){},getCompareEvent:function(){},onWindowResize:function(){this.uniformizeHeight(this.container)},getPageCheckboxesArea:function(){return this.container.find(".objects.checkboxes-area")},uniformizeObjectsFilterHeight:function(){this.uniformizeHeight(this.compareView.find(".tools"))}},d=a,e=T1.constants;return{extend:a.extend}}();var T1=T1||{};T1.packsComparer=function(){"use strict";var a=T1.comparer.extend({override:{initView:function(){PubSub.subscribe(T1.constants.CAROUSEL_SLIDE,$.proxy(this.onCarouselSlide,this)),PubSub.subscribe(T1.constants.CAROUSEL_CREATED,$.proxy(this.onCarouselCreated,this)),PubSub.subscribe(this.getCompareEvent(),$.proxy(this.compare,this))},onWindowResize:function(){},onDataLoad:function(a){this.indexData();for(var b=0;b<a.categories.length;b++){var c=this.addCategory(a.categories[b].name);this.loadCategoryEquipment(c,a.categories[b].equipment);for(var d=0;d<a.categories[b].categories.length;d++){var e=this.addSubCategory(c,a.categories[b].categories[d].name);this.loadCategoryEquipment(e,a.categories[b].categories[d].equipment)}}},getPageCheckboxesArea:function(){return this.container.find(".objects.checkboxes-area >.carousel-wrapper")},getCompareEvent:function(){return T1.constants.COMPARE_PACKS}},extend:{onCarouselCreated:function(a,b){b.is(this.container.find(".carousel.slide"))&&(this.uniformizeHeight(b),this.handleResponsiveImages({root:this.container.find(".objects"),handler:this.uniformizeHeight}),this.container.find(".carousel-inner").addClass("checkboxes-area"))},onCarouselSlide:function(a,b){b.carousel.is(this.container.find(".carousel.slide"))&&this.uniformizeHeight(b.carousel.find(".item.active"))},indexData:function(){if(this.data){for(var a={items:{},packs:{}},b=0;b<this.data.packs.length;b++){var c=this.data.packs[b];if(c.index={items:{}},a.packs[c.code]||(a.packs[c.code]=c),c.items)for(var d=0;d<c.items.length;d++){var e=c.items[d];c.index.items[e.code]=e,a.items[e.code]||(a.items[e.code]={packs:{}}),a.items[e.code].packs[c.code]||(a.items[e.code].packs[c.code]=c)}}this.data.index=a}},loadCategoryEquipment:function(a,b){if(b)for(var c=0;c<b.length;c++){var d=b[c],e=this.addItem(a,{content:d.name,more:d.description});for(var f in this.data.index.packs){var g=this.data.index.packs[f].index.items,h=g[d.code],i=h&&h.price&&h.price.listWithDiscount?h.price:null,j=h?i?i.listWithDiscount:h.standard:!1,k=h&&i?this.getPricesContainer(i):null;this.addItemObjectValue(e,{filters:[{name:"pack",value:f}],value:j,displayValue:k})}}}}},$("#packsComparer"));return{init:$.proxy(a.init,a)}}();var T1=T1||{};T1.modelsComparer=function(){"use strict";var a=T1.comparer.extend({override:{onDataLoad:function(a){this.indexData(),this.addDynamicFilters(),this.addCustomFilters(),this.loadPricesCategory();for(var b=0;b<a.equipment.length;b++){var c=this.addCategory(a.equipment[b].name,a.equipment[b].code);this.loadCategoryEquipment(c,a.equipment[b].items)}},getCompareEvent:function(){return T1.constants.COMPARE_MODELS}},extend:{indexData:function(){if(this.data){for(var a={equipment:{},grades:{}},b=0;b<this.data.equipment.length;b++){var c=this.data.equipment[b];if(c.items)for(var d=0;d<c.items.length;d++){var e=c.items[d];a.equipment[e.code]={}}}for(var f=0;f<this.data.subModels.length;f++)for(var g=this.data.subModels[f],h=0;h<g.grades.length;h++){var i=g.grades[h];a.grades[i.code]=a.grades[i.code]||{bodyTypes:{}};for(var j in i.bodyType){var k=i.bodyType[j];a.grades[i.code].bodyTypes[j]={fuelType:k.fuelType};for(var l in k.equipment)a.equipment[l]=a.equipment[l]||{},a.equipment[l][i.code]=a.equipment[l][i.code]||{},a.equipment[l][i.code][j]={exceptions:k.equipment[l].cars}}}this.data.index=a}},loadPricesCategory:function(){if(this.data&&"true"!==T1.settings.hidePrices)for(var a=this.addSubCategory(this.addCategory(T1.labels.comparator.prices,"PRC")),c={},d=0;d<this.data.engines.length;d++){var e=this.data.engines[d],f=e.images&&(e.images.IMG_PNG_285x260||e.images["IMG_TECH-GUIDE_91x91"])?T1.settings.cardbImageHost+(e.images.IMG_PNG_285x260||e.images["IMG_TECH-GUIDE_91x91"]):"/images/"+b.MISSING_IMAGE,g=$("<div/>").addClass("col-sm-2").add($("<div/>").addClass("col-sm-10")),h=c[e.fuelCode]||this.addSubCategory(a,e.fuelName);g.filter(".col-sm-10").html(e.name).addClass(e.isHybrid?"hybrid":null),g.filter(".col-sm-2").append($("<img/>").attr("src",f).addClass("img-responsive")),this.handleResponsiveImages({images:g.find("img"),handler:$.proxy(this.uniformizeDetailsHeight,this)});var i=this.addItem(h,{content:g,className:this.noHighLightClass});c[e.fuelCode]=h;for(var j=0;j<this.data.subModels.length;j++)for(var k=this.data.subModels[j],l=0;l<k.grades.length;l++)for(var m=k.grades[l],n=0;n<this.data.bodyTypes.length;n++){var o=this.data.bodyTypes[n],p=m.bodyType[o.code]?m.bodyType[o.code].fuelType[e.fuelCode]:null,q=p&&p.engine[e.code],r=q?p.engine[e.code].minPrice:null;this.addItemObjectValue(i,{filters:[{name:"grade",value:m.code},{name:"body-type",value:o.code}],value:r&&r.listWithDiscount?r.listWithDiscount:!1,displayValue:q?this.getPricesContainer(r):!1})}}},loadCategoryEquipment:function(a,b){if(b){a=this.addSubCategory(a);for(var c=0;c<b.length;c++)for(var d=b[c],e=this.addItem(a,{content:d.name}),f=this.data.index.equipment[d.code],g=0;g<this.data.subModels.length;g++)for(var h=this.data.subModels[g],i=0;i<h.grades.length;i++)for(var j=h.grades[i],k=0;k<this.data.bodyTypes.length;k++){var l=this.data.bodyTypes[k],m=f[j.code]&&f[j.code][l.code]?f[j.code][l.code]:null,n=m&&m.exceptions?this.getExceptionBlock(m.exceptions):null,o=this.addItemObjectValue(e,{filters:[{name:"grade",value:j.code},{name:"body-type",value:l.code}],value:m?!0:!1,extra:n});n&&o.find(">.icon-minus, >.icon-radio-checked").prependTo(n)}}},getExceptionBlock:function(a){for(var b="item-"+(new Date).getTime(),c=this.getExpansionContainer(b),d=c.find(".expansion-inner"),e=$("<span/>").text("?").addClass("readMore exceptions").attr("data-tooltip-selector","#"+b),f=0;f<a.length;f++){var g=$('<div class="row"/>');switch(g.append($('<div class="col-sm-10"/>').html(a[f].name)),g.append($('<div class="col-sm-2"/>')),a[f].equipped){case"s":g.find(".col-sm-2").append('<i class="icon-radio-checked" />');break;case"o":g.find(".col-sm-2").append('<i class="icon-radio-uncheck" />');break;default:g.find(".col-sm-2").append('<i class="icon-minus" />')}d.append(g)}return e.append(c)},addDynamicFilters:function(){this.addDynamicFilter("fade-out",function(a){var b=a.data.index.grades[a.filter.getUnsafeData(this.data("filter-grade"))],c=(b&&b.bodyTypes[a.filter.get("body-type")]?!0:!1)&&$.isEmptyObject(b.bodyTypes[a.filter.get("body-type")].fuelType);return this.find("a").attr("disabled",c),c})},addCustomFilters:function(){this.addCustomFilter("fade-out",".expandable-objects .col-sm-3",function(a){return this.data("filter-body-type")&&-1===this.data("filter-body-type").indexOf(a.filter["body-type"])?!0:!1})}}},$("#modelsComparer")),b=T1.constants;return{init:$.proxy(a.init,a)}}();var T1=T1||{};T1.enginesComparer=function(){"use strict";{var a=T1.comparer.extend({override:{initView:function(){this.getBase("initView")(),this.uniformizeSpecsHeight()},onDataLoad:function(){this.indexData(),this.addDynamicFilters(),this.addCustomFilters(),this.loadPricesCategory();for(var a in this.data.index.details)if(this.data.index.details[a].full){var b=this.addCategory(a);this.loadCategoryDetails(b,this.data.index.details[a].items)}},uniformizeObjectsFilterHeight:function(){this.uniformizeHeight(this.compareView.find(".tools"),{rule:"margin-bottom"})},getCompareEvent:function(){return T1.constants.COMPARE_ENGINES},onWindowResize:function(){this.getBase("onWindowResize")(),this.uniformizeSpecsHeight()}},extend:{uniformizeSpecsHeight:function(){var a=this.container.find(".objects .specs");a.css("min-height",0).css("min-height",this.getObjectsMaxHeight(a))},indexData:function(){for(var a={bodyTypes:{},engines:{},details:{}},b=0;b<this.data.bodyTypes.length;b++){var c=this.data.bodyTypes[b];a.bodyTypes[c.code]={engines:{},grades:{}};for(var d=0;d<this.data.subModels.length;d++)for(var e=this.data.subModels[d],f=0;f<e.grades.length;f++){var g=e.grades[f];g.bodyTypes.index={};for(var h=0;h<g.bodyTypes.length;h++){var i=g.bodyTypes[h];i.engines.index={},i.code===c.code&&(a.bodyTypes[c.code].grades[g.code]=g);for(var j=0;j<i.engines.length;j++){var k=i.engines[j];i.engines.index[k.code]=k}g.bodyTypes.index[i.code]=i}}}for(var l=0;l<this.data.engines.length;l++){var m=this.data.engines[l];for(var n in m.bodyTypes)for(var o in m.bodyTypes[n]){var p=m.bodyTypes[n][o];
a.details[o]=a.details[o]||{items:{},full:!1};for(var q=0;q<p.items.length;q++){var r=p.items[q];a.details[o].items[r.id]=a.details[o].items[r.id]||{engines:{},name:r.name,full:r.full},a.details[o].items[r.id].engines[m.code]=a.details[o].items[r.id].engines[m.code]||{},a.details[o].items[r.id].engines[m.code][n]=p.items[q],a.details[o].items[r.id].full=a.details[o].items[r.id].full||r.full,a.details[o].full=a.details[o].full||a.details[o].items[r.id].full,r.value!==this.noDataValue&&(a.bodyTypes[n].engines[m.code]=m)}}a.engines[m.code]=m}this.data.index=a},loadPricesCategory:function(){if(this.data&&"true"!==T1.settings.hidePrices)for(var a=this.addSubCategory(this.addCategory(T1.labels.comparator.prices)),b=0;b<this.data.subModels.length;b++)for(var c=this.data.subModels[b],d=0;d<c.grades.length;d++){var e=c.grades[d],f=T1.settings.CCISHost+"vehicle/"+this.data.code+"/"+e.car+"/width/100/height/50/"+T1.constants.DEFAULT_EXTERIOR_VIEW,g=e.images&&e.images[0]&&e.images[0].fileName?T1.settings.cardbImageHost+e.images[0].fileName:"/images/"+T1.constants.MISSING_IMAGE,h=$("<div/>").addClass("col-sm-2").add($("<div/>").addClass("col-sm-10"));h.filter(".col-sm-10").html(e.name).addClass(c.isHybrid?"hybrid":null),h.filter(".col-sm-2").append($("<img/>").attr("src","None"===this.data.ccVersion?g:f).addClass("img-responsive")),this.handleResponsiveImages({images:h.find("img"),handler:$.proxy(this.uniformizeDetailsHeight,this)});for(var i=this.addItem(a,{content:h,className:this.noHighLightClass}),j=0;j<this.data.engines.length;j++)for(var k=this.data.engines[j],l=0;l<this.data.bodyTypes.length;l++)for(var m=this.data.bodyTypes[l],n=0;n<this.data.fuelTypes.length;n++){var o=this.data.fuelTypes[n],p=this.data.index.bodyTypes[m.code].grades,q=p[e.code]&&k.fuel===o.code&&p[e.code].bodyTypes.index[m.code]&&p[e.code].bodyTypes.index[m.code].engines.index[k.code],r=q?p[e.code].bodyTypes.index[m.code].engines.index[k.code].price:null;this.addItemObjectValue(i,{filters:[{name:"engine",value:k.code},{name:"body-type",value:m.code},{name:"fuel-type",value:o.code}],value:r&&r.listWithDiscount?r.listWithDiscount:!1,displayValue:q?this.getPricesContainer(r):!1})}}},loadCategoryDetails:function(a,b){if(b){a=this.addSubCategory(a);for(var c in b)if(b[c].full)for(var d=b[c],e=this.addItem(a,{content:d.name}),f=0;f<this.data.engines.length;f++)for(var g=this.data.engines[f],h=0;h<this.data.bodyTypes.length;h++){var i=this.data.bodyTypes[h],j=d.engines[g.code]&&d.engines[g.code][i.code]&&d.engines[g.code][i.code].value!==this.noDataValue,k=j?d.engines[g.code][i.code].grades:null,l=j?d.engines[g.code][i.code].value:!1,m=this.addItemObjectValue(e,{filters:[{name:"engine",value:g.code},{name:"body-type",value:i.code}],value:l,extra:k?this.getExceptionBlock(k,l):null});k&&m.html(m.find(">span"))}}},getExceptionBlock:function(a,b){for(var c="item-"+(new Date).getTime(),d=this.getExpansionContainer(c),e=d.find(".expansion-inner"),f=$("<span/>").text(b||"?").addClass("readMore exceptions").attr("data-tooltip-selector","#"+c),g=0;g<a.length;g++){var h=$('<div class="row"/>');h.append($('<div class="col-sm-9"/>').html(a[g].name)),h.append($('<div class="col-sm-3"/>').html(a[g].value)),e.append(h)}return f.append(d)},addDynamicFilters:function(){this.addDynamicFilter("all-fuel",function(a){if(!a.filter["fuel-type"]){var b=a.data.index.engines[a.filter.getUnsafeData(this.data("filter-engine"))];return!this.data("filter-fuel-type")||a.selection[this.data("filter-engine")]&&b&&a.filter.getUnsafeData(this.data("filter-fuel-type"))==b.fuel?!1:!0}return!1}),this.addDynamicFilter("fade-out",function(a){if(a.filter["fuel-type"]){var b=a.data.index.engines[a.filter.getUnsafeData(this.data("filter-engine"))];return b&&b.fuel==a.filter.get("fuel-type")?!1:!0}return!1}),this.addDynamicFilter("fade-out",function(a){return this.hasClass("all-fuel")?!1:a.data.index.bodyTypes[a.filter.get("body-type")].engines[a.filter.getUnsafeData(this.data("filter-engine"))]?!1:!0})},addCustomFilters:function(){this.addCustomFilter("fade-out",".expandable-objects .col-sm-3",function(a){return!((a.filter["fuel-type"]&&a.filter["fuel-type"]!=this.data("filter-fuel-type")?0:1)&&(this.data("filter-body-type")&&-1===this.data("filter-body-type").indexOf(a.filter["body-type"])?0:1))})}}},$("#enginesComparer"));T1.constants}return{init:$.proxy(a.init,a)}}();var T1=T1||{};T1.client=T1.client||{version:"2.3 (stable)",date:"200141014",release:["Bugfix : INC000000265639 : custom CTA eventwindow","Bugfix : INC000000265639 : Carconfig custom CTA functions","poc cyrillic update","Updated commit comments","Hotfix : INC000000275300 : equipment compare mobile promo count","poc cyrillic font substitution","  bugfix #INC000000256323: full & quick flags for engines comparers (desktop & mobile)","  bugfix #INC000000275794 - W. All NMSC - Finance information isn't visible in Mini Car Config (font colour = background colour)","bugfix #INC000000256323: full & quick flags for engines comparers (desktop & mobile)","Bugfix : INC000000275293 : mobile grades compare : backbutton disappears after view grade","bugfix #INC000000275794 - W. All NMSC - Finance information isn't visible in Mini Car Config (font colour = background colour)","Implemented the following jira tickets: CARDB-2253 BT Tagging updates. CARDB-2216 Proace missing images. CARDB-2250 Add support for special (spotlight) promotions on the grades. CARDB-2254 Issue when loading a preconfiguration which has one or more packs configured, but no modelid defined. CARDB-2251 Grade features > Use CarDB sortorder. CARDB-2256 Use the CAR-DB Promotion headline rather then the Tridion label for each promotion's subtitle. CARDB-2259 Optional pack equipment price not initially shown when opening the pack. CARDB-2258 Update model promotion visualization in the specification sheet. CARDB-2260 Engine promo not visualized in specification sheet.","INC000000249544 : MainFocus : Faster loading of the mainfocus images... The image will start loading when downloading the script files.","bugfix #INC000000265576 #INC000000261104: Wrong map displayed in dealerfinder when no dealer found.","bugfix #INC000000257180: model range in page. Link color set to orange.","Bugfix : Special include : Updated the regex to match <!--SPECIAL.INC data SPECIAL.INC--> This to allow comments in the header includes","INC000000249544 : MainFocus : Keep footer lazyloaded on appearance, header images on load"]},$(document).ready(function(){"use strict";jQuery.support.cors=!0;{var a=$(window);(new Date).getTime()}if(window.globalize={},Globalize){var b=T1.settings.culture;window.globalize=new Globalize(b.name),window.globalize.cultures[b.name]=b}for(var c in T1)if(T1[c].init)try{T1[c].init()}catch(d){console.dir?(console.log(c),console.dir(d)):console.log("Error initializing "+c+": "+d)}$(document).on("click touchstart",function(a){PubSub.publish(T1.constants.ON_DOC_CLICK,a)}),$(document).on("keypress",function(a){PubSub.publish(T1.constants.ON_KEY_PRESS,a)}),a.resize(function(a){PubSub.publish(T1.constants.ON_WIN_RESIZE,a)}),Modernizr.touch?a.bind("touchstart",function(a){PubSub.publish(T1.constants.GLOBAL_SWIPE,a)}):a.scroll(function(a){PubSub.publish(T1.constants.GLOBAL_SCROLL,a)}),PubSub.publish(T1.constants.GLOBAL_SCROLL,{}),T1.utilities.iswindowsTablet()&&$("html").removeClass("no-touch").addClass("touch"),10===T1.utilities.ieVersion()&&($("html").addClass("eq-ie10"),$("input[type='text']").on("keydown",function(a){13===a.which&&a.preventDefault()})),(T1.utilities.browser.isSafari||T1.utilities.browser.isChrome)&&$("html").addClass("opera-or-safari")});var T1=T1||{};T1.hash=function(){"use strict";var a={lastHash:"",lastHashes:[],init:function(){var b=a;$(window).on("hashchange",b.hashChanged),PubSub.subscribe(T1.constants.HASH_ADD,b.addHash),PubSub.subscribe(T1.constants.HASH_CHANGE,b.changeHash),PubSub.subscribe(T1.constants.HASH_REMOVE,b.removeHash),PubSub.subscribe(T1.constants.HASH_REPLACE,b.replaceHash),PubSub.subscribe(T1.constants.HASH_REWRITE,b.rewriteHash)},initDesktop:function(){-1!==location.href.indexOf("#")&&a.hashChanged()},initMobile:function(){location.href.indexOf("#")>-1&&a.hashChanged()},getHash:function(){return-1===location.href.indexOf("#")?"":location.href.replace(/.*#/,"")},getLastHash:function(){var b=a,c=b.getHash();return-1===c.indexOf("/+/")?c:c.replace(/.*\/\+\//,"/")},getAllHashActions:function(){return a.getHash().split("/+")},hashChanged:function(){for(var b,c,d,e=a,f="",g=e.getAllHashActions(),h=[],i=e.lastHashes.slice(),j=0;j<g.length;j++){c=g[j],b=!1;for(var k=0;k<e.lastHashes.length;k++)d=e.lastHashes[k],d.toLowerCase()===c.toLowerCase()&&(b=!0,delete i[k]);b||h.push(c)}for(var l=0;l<i.length;l++)i[[l]]&&PubSub.publish(T1.constants.PAGEOVERLAYER_CLOSE,{});for(l=0;l<h.length;l++)if(f=h[l],"#"!==f&&""!==f){var m=f.split("/"),n=m.length>1?m[1].toLowerCase():"",o=m.length>2?m.splice(2,m.length-1):"";e.runHash(n,o)}e.lastHashes=g},runHash:function(a,b){var c={AJAX:"ajax",CAROUSEL_STOP:"stop_carousel",GALLERY:"gallery",IFRAME:"iframe",MOBILE:"mobile",PUBLISH:"publish",SPOTLIGHT:"spotlight",VIDEO:"video",YOUTUBE:"youtube"};if(a===c.PUBLISH){var d,e=1,f=[],g={};if(b.length>1)for(e;e<b.length;e++){var h=b[e];-1===h.indexOf("=")?h.length>0&&f.push(decodeURIComponent(h)):(d=h.split("="),g[d[0]]=decodeURIComponent(d[1]))}PubSub.publishSync(T1.constants[b[0].toUpperCase()],0!==f.length?f:g)}else if(a===c.AJAX||a===c.IFRAME){var i=decodeURIComponent(b[0]),j={},k="iframe"===a;b.length>1&&(j.pageName=decodeURIComponent(b[1])),j[k?"iframe":"ajax"]=!0,k&&(T1.utilities.isIOS()||(j.noScroll=!0)),j[i.match("[./]")?"url":"el"]=i,j.sync=!0,PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,j)}else if(a===c.GALLERY)PubSub.publish(T1.constants.GALLERY_ITEM_CLICK,{el:$("#"+b[0]),index:parseInt(b[1],10)});else if(a===c.SPOTLIGHT){var l=$("#"+b[0]);l.addClass("gallery"),PubSub.publish(T1.constants.GALLERY_ITEM_CLICK,{el:l,index:parseInt(b[1],10)})}else if(a===c.YOUTUBE){var m={youtubeId:b[0],noScroll:!0};b.length>1&&(m.pageName=decodeURIComponent(b[1])),PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,m)}else if(a===c.VIDEO){var n=$("#"+b[0]),o={autoplay:"true",srcMp4:n.data("video-mp4"),srcWebm:n.data("video-webm"),srcOgv:n.data("video-ogv"),srcFlv:n.data("video-flv"),poster:n.data("poster"),srcVtt:n.data("video-vtt"),srcVttLang:n.data("video-vttlang")};PubSub.publish(T1.constants.PAGEOVERLAYER_OPEN,{video:o,el:n,noScroll:!0,fitImages:!0})}else if(a===c.MOBILE){var p={id:b[0]};b[1]&&(p.param=b[1]),PubSub.publish(T1.constants.MOBILE_OPEN,p)}else a===c.CAROUSEL_STOP&&$(".carousel").carousel("pause")},addHash:function(b,c){var d=a,e=d.getHash();"/"!==c.charAt(0)&&(c="/"+c),location.hash=e+(""===e?"":"/+")+c},removeHash:function(b,c){var d=a;""===c&&(c=d.getLastHash()),"/"!==c.charAt(0)&&(c="/"+c),location.hash=d.getHash().replace(c,"").replace(/\/\+$/,"")},changeHash:function(a,b){"/"!==b.charAt(0)&&(b="/"+b),location.hash=b},replaceHash:function(a,b){var c=location.hash.replace(b.oldValue,b.newValue);location.hash=c},rewriteHash:function(a,b){window.history?history.replaceState(null,null,b):location.replace(b)}};return{init:a.init,initDesktop:a.initDesktop,initMobile:a.initMobile}}();